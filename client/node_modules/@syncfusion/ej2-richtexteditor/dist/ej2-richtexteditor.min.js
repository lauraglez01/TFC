/*!
*  filename: ej2-richtexteditor.min.js
*  version : 29.2.5
*  Copyright Syncfusion Inc. 2001 - 2024. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("SyncfusionBase"),require("SyncfusionNavigations"),require("SyncfusionSplitbuttons"),require("SyncfusionPopups"),require("SyncfusionInputs"),require("SyncfusionButtons"),require("SyncfusionDropdowns"),require("SyncfusionFilemanager")):"function"==typeof define&&define.amd?define(["SyncfusionBase","SyncfusionNavigations","SyncfusionSplitbuttons","SyncfusionPopups","SyncfusionInputs","SyncfusionButtons","SyncfusionDropdowns","SyncfusionFilemanager"],t):"object"==typeof exports?exports.SyncfusionRichtexteditor=t(require("SyncfusionBase"),require("SyncfusionNavigations"),require("SyncfusionSplitbuttons"),require("SyncfusionPopups"),require("SyncfusionInputs"),require("SyncfusionButtons"),require("SyncfusionDropdowns"),require("SyncfusionFilemanager")):e.SyncfusionRichtexteditor=t(e.SyncfusionBase,e.SyncfusionNavigations,e.SyncfusionSplitbuttons,e.SyncfusionPopups,e.SyncfusionInputs,e.SyncfusionButtons,e.SyncfusionDropdowns,e.SyncfusionFilemanager)}(self,((e,t,n,i,o,r,s,a)=>(()=>{"use strict";var l={766:t=>{t.exports=e},741:e=>{e.exports=r},778:e=>{e.exports=s},771:e=>{e.exports=a},323:e=>{e.exports=o},215:e=>{e.exports=t},197:e=>{e.exports=i},295:e=>{e.exports=n}},d={};function c(e){var t=d[e];if(void 0!==t)return t.exports;var n=d[e]={exports:{}};return l[e](n,n.exports,c),n.exports}c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var h={};return(()=>{c.r(h),c.d(h,{ACTION:()=>Qs,ALIGNMENT_TYPE:()=>us,ALLOWED_ACTIONKEYS:()=>To,ALLOWED_TABLE_BLOCK_TAGS:()=>Os,AUDIO:()=>Xr,Alignments:()=>ba,Audio:()=>ml,AudioCommand:()=>Va,BLOCKQUOTE_LIST_HANDLE:()=>ra,BLOCK_TAGS:()=>gs,BaseQuickToolbar:()=>kd,BaseToolbar:()=>Ed,CLASS_AUDIO:()=>Ia,CLASS_AUDIO_BREAK:()=>La,CLASS_AUDIO_FOCUS:()=>Fa,CLASS_AUDIO_INLINE:()=>Aa,CLASS_AUDIO_WRAP:()=>Pa,CLASS_CAPTION:()=>xa,CLASS_CAPTION_INLINE:()=>Da,CLASS_CLICK_ELEM:()=>Ba,CLASS_EMBED_VIDEO_WRAP:()=>ja,CLASS_IMAGE_BREAK:()=>Oa,CLASS_IMAGE_CENTER:()=>Na,CLASS_IMAGE_INLINE:()=>Ma,CLASS_IMAGE_LEFT:()=>Ca,CLASS_IMAGE_RIGHT:()=>ya,CLASS_RTE_CAPTION:()=>wa,CLASS_VIDEO:()=>Ua,CLASS_VIDEO_BREAK:()=>ka,CLASS_VIDEO_CENTER:()=>Ta,CLASS_VIDEO_CLICK_ELEM:()=>Ra,CLASS_VIDEO_FOCUS:()=>qa,CLASS_VIDEO_INLINE:()=>za,CLASS_VIDEO_LEFT:()=>Sa,CLASS_VIDEO_RIGHT:()=>Ea,CLASS_VIDEO_WRAP:()=>Ha,CLEAR_COMMAND:()=>Ud,CLEAR_TYPE:()=>Es,CLS_ACTIVE:()=>fi,CLS_ALIGN_TB_BTN:()=>ki,CLS_AUDIOBREAK:()=>Zn,CLS_AUDIOINLINE:()=>di,CLS_AUDIOWRAP:()=>ni,CLS_AUD_FOCUS:()=>io,CLS_BACK:()=>_n,CLS_BACKGROUND_COLOR_DROPDOWN:()=>Ai,CLS_BACKGROUND_COLOR_PICKER:()=>Ii,CLS_BACKGROUND_COLOR_TARGET:()=>wi,CLS_BULLETFORMATLIST_TB_BTN:()=>Si,CLS_CAPINLINE:()=>ai,CLS_CAPTION:()=>ri,CLS_CLICKELEM:()=>ei,CLS_COLOR_CONTENT:()=>Di,CLS_COLOR_PALETTE:()=>Bi,CLS_CONTENT:()=>dn,CLS_COUNT:()=>hi,CLS_CUSTOM_TILE:()=>fo,CLS_DISABLED:()=>cn,CLS_DROPAREA:()=>co,CLS_DROPDOWN_BTN:()=>Rn,CLS_DROPDOWN_ICONS:()=>An,CLS_DROPDOWN_ITEMS:()=>Bn,CLS_DROPDOWN_POPUP:()=>Mn,CLS_ERROR:()=>ui,CLS_EXPAND_OPEN:()=>gi,CLS_FOCUS:()=>Kn,CLS_FONT_COLOR_DROPDOWN:()=>Mi,CLS_FONT_COLOR_PICKER:()=>Ri,CLS_FONT_COLOR_TARGET:()=>xi,CLS_FONT_NAME_TB_BTN:()=>Oi,CLS_FONT_SIZE_TB_BTN:()=>Li,CLS_FORMATS_TB_BTN:()=>Ti,CLS_FULL_SCREEN:()=>Cn,CLS_HIDE:()=>Wn,CLS_HR_SEPARATOR:()=>yi,CLS_ICONS:()=>mi,CLS_IMAGE_POP:()=>kn,CLS_IMGBREAK:()=>$n,CLS_IMGCENTER:()=>Jn,CLS_IMGINLINE:()=>li,CLS_IMGLEFT:()=>Yn,CLS_IMGRIGHT:()=>Xn,CLS_IMG_FOCUS:()=>no,CLS_IMG_INNER:()=>ho,CLS_IMG_RESIZE:()=>lo,CLS_INLINE:()=>bn,CLS_INLINE_DROPDOWN:()=>Dn,CLS_INLINE_POP:()=>wn,CLS_LIST_PRIMARY_CONTENT:()=>Ni,CLS_MAXIMIZE:()=>zn,CLS_MINIMIZE:()=>qn,CLS_NOCOLOR_ITEM:()=>go,CLS_NUMBERFORMATLIST_TB_BTN:()=>Ei,CLS_POP:()=>Sn,CLS_POPUP:()=>jn,CLS_POPUP_OPEN:()=>ao,CLS_QUICK_DROPDOWN:()=>Ln,CLS_QUICK_POP:()=>On,CLS_QUICK_TB:()=>Nn,CLS_RESIZE:()=>to,CLS_RM_WHITE_SPACE:()=>Gn,CLS_RTE:()=>an,CLS_RTE_CAPTION:()=>si,CLS_RTE_CONTAINER:()=>un,CLS_RTE_CONTENT:()=>In,CLS_RTE_DIALOG_MIN_HEIGHT:()=>Ji,CLS_RTE_DIALOG_UPLOAD:()=>uo,CLS_RTE_DRAG_IMAGE:()=>ro,CLS_RTE_ELEMENTS:()=>bi,CLS_RTE_EXPAND_TB:()=>yn,CLS_RTE_FIXED_TB_EXPAND:()=>Co,CLS_RTE_HIDDEN:()=>Wi,CLS_RTE_IMAGE:()=>eo,CLS_RTE_PASTE_CANCEL:()=>Yi,CLS_RTE_PASTE_KEEP_FORMAT:()=>Qi,CLS_RTE_PASTE_OK:()=>Xi,CLS_RTE_PASTE_PLAIN_FORMAT:()=>Gi,CLS_RTE_PASTE_REMOVE_FORMAT:()=>Ki,CLS_RTE_READONLY:()=>Ui,CLS_RTE_RES_CNT:()=>mo,CLS_RTE_RES_EAST:()=>Zi,CLS_RTE_RES_HANDLE:()=>$i,CLS_RTE_RES_WEST:()=>Eo,CLS_RTE_SOURCE_CODE_TXTAREA:()=>So,CLS_RTE_TABLE_RESIZE:()=>yo,CLS_RTE_TB_ENABLED:()=>No,CLS_RTE_UPLOAD_POPUP:()=>so,CLS_RTL:()=>ln,CLS_SCRIPT_SHEET:()=>hn,CLS_SEPARATOR:()=>Fn,CLS_SHOW:()=>Vn,CLS_STYLE_SHEET:()=>pn,CLS_TABLE:()=>bo,CLS_TABLE_BORDER:()=>vo,CLS_TABLE_MULTI_CELL:()=>ji,CLS_TABLE_SEL:()=>Pi,CLS_TABLE_SEL_END:()=>Hi,CLS_TB_ALT_BOR:()=>qi,CLS_TB_BOX_RES:()=>Vi,CLS_TB_BTN:()=>vi,CLS_TB_COL_RES:()=>zi,CLS_TB_DASH_BOR:()=>Fi,CLS_TB_EXTENDED:()=>Pn,CLS_TB_FIXED:()=>fn,CLS_TB_FLOAT:()=>gn,CLS_TB_INLINE:()=>vn,CLS_TB_IOS_FIX:()=>Ci,CLS_TB_ITEM:()=>Un,CLS_TB_ROW_RES:()=>_i,CLS_TB_STATIC:()=>Tn,CLS_TB_WRAP:()=>Hn,CLS_TEXT_POP:()=>xn,CLS_TEXT_QUICK_TB:()=>En,CLS_TOOLBAR:()=>mn,CLS_UPLOAD_FILES:()=>po,CLS_VIDEOBREAK:()=>oi,CLS_VIDEOINLINE:()=>ci,CLS_VIDEOWRAP:()=>ii,CLS_VID_CLICK_ELEM:()=>ti,CLS_VID_FOCUS:()=>oo,CLS_VISIBLE:()=>Qn,CLS_WARNING:()=>pi,ClearFormat:()=>Wd,ClearFormatExec:()=>Za,ColorPickerInput:()=>Od,ContentRender:()=>qr,Count:()=>wd,DEFAULT_TAG:()=>fs,DELETECOLUMN:()=>ns,DELETEROW:()=>ts,DESTROY:()=>la,DOMNode:()=>Vs,DialogRenderer:()=>El,DialogType:()=>n,DropDownButtons:()=>Sd,EMOJI_PICKER_ACTIONS:()=>sa,EditorManager:()=>rl,EmojiPicker:()=>sc,EmojiPickerAction:()=>il,ExecCommandCallBack:()=>Al,FORMAT_PAINTER_ACTIONS:()=>oa,FORMAT_TYPE:()=>Ks,FileManager:()=>oc,FormatPainter:()=>rc,FormatPainterActions:()=>ol,Formats:()=>fa,Formatter:()=>Ad,FullScreen:()=>cd,HTMLFormatter:()=>$d,HtmlEditor:()=>tc,HtmlToolbarStatus:()=>Zd,IGNORE_BLOCK_TAGS:()=>bs,IMAGE:()=>Gr,INDENT_TYPE:()=>ms,INSERTHTML_TYPE:()=>Cs,INSERT_COLUMN:()=>es,INSERT_ROW:()=>Zr,INSERT_TEXT_COMMAND:()=>Hd,INSERT_TEXT_TYPE:()=>Ns,INTERNAL_DESTROY:()=>da,IframeContentRender:()=>Ol,Image:()=>ul,ImageCommand:()=>_a,ImageInputSource:()=>i,ImportExport:()=>ac,Indents:()=>va,InsertHtml:()=>pa,InsertHtmlExec:()=>Ja,InsertMethods:()=>ca,InsertTextExec:()=>nl,IsFormatted:()=>Kr,KEY_DOWN:()=>Ws,KEY_DOWN_HANDLER:()=>Gs,KEY_UP:()=>Js,KEY_UP_HANDLER:()=>Ys,KeyboardEvents:()=>yl,LINK:()=>$r,LINK_COMMAND:()=>Id,LISTS_COMMAND:()=>Bd,LIST_TYPE:()=>Xs,Link:()=>pl,LinkCommand:()=>ga,Lists:()=>ma,MDFormats:()=>Fd,MDLink:()=>_d,MDLists:()=>jd,MDSelectionFormats:()=>qd,MDTable:()=>Vd,MD_TABLE:()=>Pd,MODEL_CHANGED:()=>Zs,MODEL_CHANGED_PLUGIN:()=>$s,MOUSE_DOWN:()=>aa,MS_WORD_CLEANUP:()=>ta,MS_WORD_CLEANUP_PLUGIN:()=>ea,MarkdownEditor:()=>Yd,MarkdownFormatter:()=>Xd,MarkdownParser:()=>Kd,MarkdownRender:()=>Ll,MarkdownSelection:()=>Dd,MarkdownToolbarStatus:()=>Md,MsWordPaste:()=>tl,NodeCutter:()=>ha,NodeSelection:()=>sl,ON_BEGIN:()=>na,PASTE_SOURCE:()=>Ts,PasteCleanup:()=>nc,PopupRenderer:()=>kl,QuickToolbar:()=>xd,REMOVETABLE:()=>is,Render:()=>zr,RenderType:()=>e,RendererFactory:()=>Ml,Resize:()=>ic,RichTextEditor:()=>Cd,SELECTION_TYPE:()=>ys,SELF_CLOSING_TAGS:()=>Ss,SPACE_ACTION:()=>ia,SelectionBasedExec:()=>Ya,SelectionCommands:()=>Xa,ServiceLocator:()=>Dl,SlashMenu:()=>Nd,TABLE:()=>Jr,TABLEHEADER:()=>os,TABLE_ALTERNATE:()=>cs,TABLE_BACKGROUND_COLOR:()=>hs,TABLE_BLOCK_TAGS:()=>vs,TABLE_DASHED:()=>ds,TABLE_HORIZONTAL_SPLIT:()=>ls,TABLE_MERGE:()=>ss,TABLE_MOVE:()=>ps,TABLE_VERTICAL_ALIGN:()=>rs,TABLE_VERTICAL_SPLIT:()=>as,Table:()=>Nl,TableCommand:()=>Qa,Toolbar:()=>Ld,ToolbarAction:()=>Td,ToolbarRenderer:()=>cl,ToolbarStatus:()=>ll,ToolbarType:()=>t,UndoRedoCommands:()=>zd,UndoRedoManager:()=>el,VIDEO:()=>Yr,Video:()=>fl,VideoCommand:()=>Wa,ViewSource:()=>Cl,XhtmlValidation:()=>ec,actionBegin:()=>$,actionComplete:()=>Z,actionSuccess:()=>te,afterImageDelete:()=>bt,afterKeyDown:()=>Gt,afterMediaDelete:()=>vt,afterPasteCleanup:()=>wt,audioDelete:()=>fe,audioToolbarAction:()=>j,autoResize:()=>Zt,beforeDialogClose:()=>tt,beforeDialogOpen:()=>Je,beforeDropDownItemRender:()=>U,beforeDropDownOpen:()=>Se,beforeFileUpload:()=>St,beforeImageDrop:()=>Lt,beforeImageUpload:()=>Et,beforePasteCleanup:()=>xt,beforeQuickToolbarOpen:()=>it,bindCssClass:()=>qt,bindOnEnd:()=>N,blockEmptyNodes:()=>en,checkUndo:()=>Ke,cleanupInternalElements:()=>Hr,cleanupResizeElements:()=>Kt,clearDialogObj:()=>$e,closeAudioDialog:()=>Pt,closeImageDialog:()=>Ut,closeLinkDialog:()=>At,closeTableDialog:()=>Ft,closeTooltip:()=>$t,closeVideoDialog:()=>Ht,colorPickerChanged:()=>Ie,contentBlur:()=>we,contentChanged:()=>p,contentFocus:()=>xe,contentscroll:()=>Re,conversionFactors:()=>on,convertToBlob:()=>Ir,count:()=>ke,createTable:()=>Ve,created:()=>r,decode:()=>Ar,destroy:()=>f,destroyTooltip:()=>Wt,destroyed:()=>s,dialogClose:()=>nt,dialogOpen:()=>et,disableFullScreen:()=>R,dispatchEvent:()=>Tr,docClick:()=>We,documentClickClosedBy:()=>Yt,drop:()=>yt,dropDownSelect:()=>I,dynamicModule:()=>kt,editAreaClick:()=>Ae,editLink:()=>Y,emojiPicker:()=>Vt,enableFullScreen:()=>B,enterHandler:()=>Ye,execCommandCallBack:()=>P,executeGroup:()=>wl,expandPopupClick:()=>Le,fileRemoving:()=>gt,fileSelected:()=>pt,fileUploadFailed:()=>ft,fileUploadSuccess:()=>mt,fileUploading:()=>ut,focusChange:()=>Ue,formatPainterClick:()=>zt,formatPainterDoubleClick:()=>_t,getCollection:()=>Cr,getDefaultValue:()=>Dr,getDropDownValue:()=>mr,getEditValue:()=>xr,getFormattedFontSize:()=>gr,getIndex:()=>pr,getLocaleFontFormat:()=>Ur,getSelectedHtml:()=>je,getTBarItemsIndex:()=>Er,getTextNodesUnder:()=>Lr,getTooltipText:()=>vr,hasClass:()=>ur,hidePopup:()=>Qt,hideTableQuickToolbar:()=>Ze,htmlKeyConfig:()=>ws,htmlToolbarClick:()=>E,iframeMouseDown:()=>m,imageAlt:()=>ue,imageBreak:()=>ce,imageCaption:()=>be,imageCenter:()=>de,imageDelete:()=>me,imageInline:()=>he,imageLeft:()=>ae,imageLink:()=>pe,imageRemoving:()=>ht,imageResizeFactor:()=>Rs,imageRight:()=>le,imageSelected:()=>at,imageSize:()=>ve,imageToolbarAction:()=>H,imageUploadFailed:()=>ct,imageUploadSuccess:()=>dt,imageUploading:()=>lt,imgModule:()=>ze,initialEnd:()=>u,initialLoad:()=>d,inlineEmptyNodes:()=>tn,insertAudio:()=>oe,insertCompleted:()=>se,insertImage:()=>ie,insertLink:()=>G,insertVideo:()=>re,isEditableValueEmpty:()=>Mr,isIDevice:()=>fr,keyDown:()=>k,keyUp:()=>L,linkToolbarAction:()=>q,listConversionFilters:()=>As,load:()=>l,markdownFormatTags:()=>Ls,markdownKeyConfig:()=>Ds,markdownListsTags:()=>xs,markdownSelectionTags:()=>ks,markdownToolbarClick:()=>S,markerClassName:()=>_s,mentionRestrictKeys:()=>Is,modelChanged:()=>T,mouseDown:()=>De,mouseUp:()=>D,onExport:()=>w,onHandleFontsizeChange:()=>rn,onImport:()=>x,onResize:()=>V,openLink:()=>J,pageYOffset:()=>br,parseHelper:()=>Rr,parseHtml:()=>Or,paste:()=>qe,pasteClean:()=>Xe,pasteCleanupGroupingTags:()=>Ms,popupHide:()=>st,preventQuickToolbarClose:()=>sn,quickToolbarClose:()=>rt,quickToolbarOpen:()=>ot,readOnlyMode:()=>Ge,redo:()=>K,refreshBegin:()=>y,removeSelectionClassStates:()=>jr,renderFileManager:()=>Ot,renderInlineToolbar:()=>Fe,renderQuickToolbar:()=>Ct,resetContentEditableElements:()=>Pr,resizeInitialized:()=>Tt,resizeStart:()=>_,resizeStop:()=>W,rtlMode:()=>_e,sanitizeHelper:()=>Br,scroll:()=>Be,selectAll:()=>Pe,selectRange:()=>He,selectionCommand:()=>Rd,selectionRestore:()=>Oe,selectionSave:()=>Te,selfClosingTags:()=>Bs,setAttributes:()=>dd,setToolbarStatus:()=>yr,showAudioDialog:()=>Rt,showColorPicker:()=>Jt,showImageDialog:()=>Bt,showLinkDialog:()=>Mt,showTableDialog:()=>jt,showVideoDialog:()=>It,slashMenuOpening:()=>v,sourceCode:()=>Ce,sourceCodeMouseDown:()=>Me,statusCollection:()=>al,supportedUnits:()=>nn,tableModulekeyUp:()=>O,tableToolbarAction:()=>Qe,tableclass:()=>a,toObjectLowerCase:()=>kr,toolbarClick:()=>g,toolbarCreated:()=>M,toolbarOpen:()=>Ee,toolbarRefresh:()=>b,toolbarRenderComplete:()=>A,toolbarUpdated:()=>C,unLink:()=>X,undo:()=>Q,updateDropDownFontFormatLocale:()=>Fr,updateDropdownContent:()=>Nr,updateSource:()=>Ne,updateTbItemsStatus:()=>Dt,updateTextNode:()=>wr,updateToolbarItem:()=>ne,updateUndoRedoStatus:()=>Sr,updateValueOnIdle:()=>Xt,updatedToolbarStatus:()=>ee,videoDelete:()=>ge,videoSize:()=>ye,videoToolbarAction:()=>F,windowResize:()=>z,xhtmlValidation:()=>Nt});var e,t,n,i,o=c(766),r="create",s="destroy",a="tableclass",l="load",d="initial-load",p="content-changed",u="initial-end",m="iframe-click",f="destroy",g="toolbarClick",b="toolbar-refresh",v="slash-menu-opening",y="refresh-begin",C="toolbar-updated",N="bind-on-end",E="html-toolbar-click",S="markdown-toolbar-click",T="model-changed",O="tableModulekeyUp",L="keyUp",k="keyDown",x="onImport",w="onExport",D="mouseUp",M="toolbarCreated",A="toolbarRenderComplete",B="enableFullScreen",R="disableFullScreen",I="dropDownSelect",U="beforeDropDownItemRender",P="execCommandCallBack",H="image-toolbar-action",j="audio-toolbar-action",F="video-toolbar-action",q="link-toolbar-action",z="resize",_="resizeStart",V="resizing",W="resizeStop",Q="undo",K="redo",G="insertLink",X="unLink",Y="editLink",J="openLink",$="actionBegin",Z="actionComplete",ee="updatedToolbarStatus",te="actionSuccess",ne="updateToolbarItem",ie="insertImage",oe="insertAudio",re="insertVideo",se="insertCompleted",ae="justifyLeft",le="justifyRight",de="justifyCenter",ce="break",he="inline",pe="insertImgLink",ue="imgAltText",me="delete",fe="delete",ge="delete",be="caption",ve="imageSize",ye="videoSize",Ce="sourceCode",Ne="updateSource",Ee="toolbarOpen",Se="beforeDropDownOpen",Te="selection-save",Oe="selection-restore",Le="expandPopupClick",ke="count",xe="contentFocus",we="contentBlur",De="mouseDown",Me="sourceCodeMouseDown",Ae="editAreaClick",Be="scroll",Re="contentscroll",Ie="colorPickerChanged",Ue="focusChange",Pe="selectAll",He="selectRange",je="getSelectedHtml",Fe="renderInlineToolbar",qe="paste-content",ze="imageModule",_e="rtl-mode",Ve="createTable",We="docClick",Qe="table-toolbar-action",Ke="checkUndoStack",Ge="readOnlyMode",Xe="pasteClean",Ye="enterHandler",Je="beforeDialogOpen",$e="clearDialogObj",Ze="hideTableQuickToolbar",et="dialogOpen",tt="beforeDialogClose",nt="dialogClose",it="beforeQuickToolbarOpen",ot="quickToolbarOpen",rt="quickToolbarClose",st="popupHide",at="imageSelected",lt="imageUploading",dt="imageUploadSuccess",ct="imageUploadFailed",ht="imageRemoving",pt="fileSelected",ut="fileUploading",mt="fileUploadSuccess",ft="fileUploadFailed",gt="fileRemoving",bt="afterImageDelete",vt="afterMediaDelete",yt="drop",Ct="renderQuickToolbar",Nt="xhtmlValidation",Et="beforeImageUpload",St="beforeFileUpload",Tt="resizeInitialized",Ot="renderFileManager",Lt="beforeImageDrop",kt="dynamicModule",xt="beforePasteCleanup",wt="afterPasteCleanup",Dt="updateTbItemsStatus",Mt="showLinkDialog",At="closeLinkDialog",Bt="showImageDialog",Rt="showAudioDialog",It="showVideoDialog",Ut="closeImageDialog",Pt="closeAudioDialog",Ht="closeVideoDialog",jt="showTableDialog",Ft="closeTableDialog",qt="bindCssClass",zt="formatPainterClick",_t="formatPainterDoubleClick",Vt="emojiPicker",Wt="destroyTooltip",Qt="hidePopup",Kt="cleanupResizeElements",Gt="afterKeyDown",Xt="updateValueOnIdle",Yt="documentClickClosedBy",Jt="showColorPicker",$t="closeTooltip",Zt="autoResize",en="address:empty, article:empty, aside:empty, blockquote:empty,\n details:empty, dd:empty, div:empty, dl:empty, dt:empty, fieldset:empty, footer:empty,form:empty, h1:empty,\n h2:empty, h3:empty, h4:empty, h5:empty, h6:empty, header:empty, hgroup:empty, li:empty, main:empty, nav:empty,\n noscript:empty, output:empty, p:empty, pre:empty, section:empty, td:empty, th:empty",tn="a:empty, abbr:empty, acronym:empty, b:empty, bdi:empty, bdo:empty, big:empty, button:empty,\ncanvas:empty, cite:empty, code:empty, data:empty, datalist:empty, del:empty, dfn:empty, em:empty, font:empty, i:empty, iframe:empty,\nins:empty, kbd:empty, label:empty, map:empty, mark:empty, meter:empty, noscript:empty, object:empty, output:empty, picture:empty, progress:empty,\nq:empty, ruby:empty, s:empty, samp:empty, script:empty, select:empty, slot:empty, small:empty, span:empty, strong:empty, strike:empty, sub:empty, sup:empty, svg:empty,\ntemplate:empty, textarea:empty, time:empty, u:empty, tt:empty, var:empty, wbr:empty",nn=["px","em","rem","pt","cm","mm","in","pc","vw","vh","vmin","vmax"],on={px:{px:1,em:.0625,rem:.0625,pt:.75,cm:.0264583,mm:.0026458,in:.0104167,pc:.0625,vw:.00625,vh:.00625,vmin:.00625,vmax:.00625},em:{px:16,em:1,rem:1,pt:12,cm:.423333,mm:.0423333,in:.166667,pc:.0625,vw:1,vh:1,vmin:1,vmax:1},rem:{px:16,em:1,rem:1,pt:12,cm:.423333,mm:.0423333,in:.166667,pc:.0625,vw:1,vh:1,vmin:1,vmax:1},pt:{px:1.33333,em:.0833333,rem:.0833333,pt:1,cm:.0352778,mm:.0035278,in:.0138889,pc:.0416667,vw:.00416667,vh:.00416667,vmin:.00416667,vmax:.00416667},cm:{px:37.7953,em:2.3622,rem:2.3622,pt:28.3465,cm:1,mm:.1,in:.393701,pc:.148148,vw:.0377953,vh:.0377953,vmin:.0377953,vmax:.0377953},mm:{px:3.77953,em:.23622,rem:.23622,pt:2.83465,cm:10,mm:1,in:.0393701,pc:.0148148,vw:.00377953,vh:.00377953,vmin:.00377953,vmax:.00377953},in:{px:96,em:6,rem:6,pt:72,cm:2.54,mm:25.4,in:1,pc:.375,vw:.09375,vh:.09375,vmin:.09375,vmax:.09375},pc:{px:16,em:1,rem:1,pt:12,cm:.423333,mm:.0423333,in:.166667,pc:1,vw:.0625,vh:.0625,vmin:.0625,vmax:.0625},vw:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1},vh:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1},vmin:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1},vmax:{px:160,em:10,rem:10,pt:120,cm:4.23333,mm:.423333,in:1.66667,pc:.625,vw:1,vh:1,vmin:1,vmax:1}},rn="onHandleFontsizeChange",sn="preventQuickToolbarClose",an="e-richtexteditor",ln="e-rtl",dn="e-content",cn="e-disabled",hn="rte-iframe-script-sheet",pn="rte-iframe-style-sheet",un="e-rte-container",mn="e-rte-toolbar",fn="e-rte-tb-fixed",gn="e-rte-tb-float",bn="e-rte-inline",vn="e-rte-tb-inline",yn="e-rte-tb-expand",Cn="e-rte-full-screen",Nn="e-rte-quick-toolbar",En="e-rte-text-quicktoolbar",Sn="e-rte-pop",Tn="e-tb-static",On="e-rte-quick-popup",Ln="e-quick-dropdown",kn="e-rte-image-popup",xn="e-rte-text-popup",wn="e-rte-inline-popup",Dn="e-rte-inline-dropdown",Mn="e-rte-dropdown-popup",An="e-rte-dropdown-icons",Bn="e-rte-dropdown-items",Rn="e-rte-dropdown-btn",In="e-rte-content",Un="e-toolbar-item",Pn="e-toolbar-extended",Hn="e-toolbar-wrapper",jn="e-popup",Fn="e-separator",qn="e-minimize",zn="e-maximize",_n="e-back",Vn="e-show",Wn="e-hide",Qn="e-visible",Kn="e-focused",Gn="e-remove-white-space",Xn="e-imgright",Yn="e-imgleft",Jn="e-imgcenter",$n="e-imgbreak",Zn="e-audio-break",ei="e-clickelem",ti="e-video-clickelem",ni="e-audio-wrap",ii="e-video-wrap",oi="e-video-break",ri="e-img-caption",si="e-rte-img-caption",ai="e-caption-inline",li="e-imginline",di="e-audio-inline",ci="e-video-inline",hi="e-rte-character-count",pi="e-warning",ui="e-error",mi="e-icons",fi="e-active",gi="e-expand-open",bi="e-rte-elements",vi="e-tbar-btn",yi="e-rte-horizontal-separator",Ci="e-tbar-ios-fixed",Ni="e-rte-list-primary-content",Ei="e-rte-numberformatlist-dropdown",Si="e-rte-bulletformatlist-dropdown",Ti="e-formats-tbar-btn",Oi="e-font-name-tbar-btn",Li="e-font-size-tbar-btn",ki="e-alignment-tbar-btn",xi="e-rte-fontcolor-element",wi="e-rte-backgroundcolor-element",Di="e-rte-color-content",Mi="e-rte-fontcolor-dropdown",Ai="e-rte-backgroundcolor-dropdown",Bi="e-rte-square-palette",Ri="e-rte-fontcolor-colorpicker",Ii="e-rte-backgroundcolor-colorpicker",Ui="e-rte-readonly",Pi="e-cell-select",Hi="e-cell-select-end",ji="e-multi-cells-select",Fi="e-dashed-border",qi="e-alternate-border",zi="e-column-resize",_i="e-row-resize",Vi="e-table-box",Wi="e-rte-hidden",Qi="e-rte-keepformat",Ki="e-rte-removeformat",Gi="e-rte-plainformat",Xi="e-rte-pasteok",Yi="e-rte-pastecancel",Ji="e-rte-dialog-minheight",$i="e-resize-handle",Zi="e-south-east",eo="e-rte-image",to="e-resize",no="e-img-focus",io="e-audio-focus",oo="e-video-focus",ro="e-rte-drag-image",so="e-rte-upload-popup",ao="e-popup-open",lo="e-img-resize",co="e-droparea",ho="e-img-inner",po="e-upload-files",uo="e-rte-dialog-upload",mo="e-rte-resize",fo="e-custom-tile",go="e-nocolor-item",bo="e-rte-table",vo="e-rte-table-border",yo="e-rte-table-resize",Co="e-rte-fixed-tb-expand",No="e-rte-toolbar-enabled",Eo="e-south-west",So="e-rte-srctextarea",To=["Enter","ArrowRight","ArrowLeft"];!function(e){e[e.Toolbar=0]="Toolbar",e[e.Content=1]="Content",e[e.Popup=2]="Popup",e[e.LinkToolbar=3]="LinkToolbar",e[e.TextToolbar=4]="TextToolbar",e[e.ImageToolbar=5]="ImageToolbar",e[e.AudioToolbar=6]="AudioToolbar",e[e.VideoToolbar=7]="VideoToolbar",e[e.InlineToolbar=8]="InlineToolbar",e[e.TableToolbar=9]="TableToolbar"}(e||(e={})),function(e){e.Expand="Expand",e.MultiRow="MultiRow",e.Scrollable="Scrollable"}(t||(t={})),function(e){e.InsertLink="InsertLink",e.InsertImage="InsertImage",e.InsertAudio="InsertAudio",e.InsertVideo="InsertVideo",e.InsertTable="InsertTable"}(n||(n={})),function(e){e.Uploaded="Uploaded",e.Dropped="Dropped",e.Pasted="Pasted"}(i||(i={}));var Oo=["alignments","formats","fontname","fontsize","fontcolor","backgroundcolor","align","display","audiolayoutoption","videolayoutoption","videoalign","tablerows","tablecolumns","tablecell","tablecellhorizontalalign","tablecellverticalalign","styles","numberformatlist","bulletformatlist"],Lo={alignments:{id:"Alignments",icon:"e-alignments",tooltip:"Alignments",command:"Alignments",subCommand:"Alignments"},justifyleft:{id:"JustifyLeft",icon:"e-justify-left",tooltip:"JustifyLeft",command:"Alignments",subCommand:"JustifyLeft"},justifycenter:{id:"JustifyCenter",icon:"e-justify-center",tooltip:"JustifyCenter",command:"Alignments",subCommand:"JustifyCenter"},justifyright:{id:"JustifyRight",icon:"e-justify-right",tooltip:"JustifyRight",command:"Alignments",subCommand:"JustifyRight"},justifyfull:{id:"JustifyFull",icon:"e-justify-full",tooltip:"JustifyFull",command:"Alignments",subCommand:"JustifyFull"},fontname:{id:"FontName",icon:"e-font-name",tooltip:"Font Name",command:"Font",subCommand:"FontName"},fontsize:{id:"FontSize",icon:"e-font-size",tooltip:"Font Size",command:"Font",subCommand:"FontSize"},fontcolor:{id:"FontColor",icon:"e-rte-font-color",tooltip:"Font Color",command:"Font",subCommand:"FontColor",value:"#ff0000ff"},backgroundcolor:{id:"BackgroundColor",icon:"e-background-color",tooltip:"Background Color",command:"Font",subCommand:"BackgroundColor",value:"#ffff00ff"},importword:{id:"ImportWord",icon:"e-rte-import-doc",tooltip:"Import from Word",command:"Import",subCommand:"ImportWord"},exportword:{id:"ExportWord",icon:"e-rte-export-doc",tooltip:"Export to Word",command:"Export",subCommand:"ExportWord"},exportpdf:{id:"ExportPdf",icon:"e-rte-export-pdf",tooltip:"Export to PDF",command:"Export",subCommand:"ExportPdf"},bold:{id:"Bold",icon:"e-bold",tooltip:"Bold",command:"Style",subCommand:"Bold"},italic:{id:"Italic",icon:"e-italic",tooltip:"Italic",command:"Style",subCommand:"Italic"},underline:{id:"Underline",icon:"e-underline",tooltip:"Underline",command:"Style",subCommand:"Underline"},strikethrough:{id:"StrikeThrough",icon:"e-strike-through",tooltip:"StrikeThrough",command:"Style",subCommand:"StrikeThrough"},clearformat:{id:"ClearFormat",icon:"e-clear-format",tooltip:"Clear Format",command:"Clear",subCommand:"ClearFormat"},clearall:{id:"ClearAll",icon:"e-clear-all",tooltip:"Clear All",command:"Clear",subCommand:"ClearAll"},cut:{id:"Cut",icon:"e-cut",tooltip:"Cut",command:"ClipBoard",subCommand:"Cut"},copy:{id:"Copy",icon:"e-copy",tooltip:"Copy",command:"ClipBoard",subCommand:"Copy"},paste:{id:"Paste",icon:"e-paste",tooltip:"Paste",command:"ClipBoard",subCommand:"Paste"},unorderedlist:{id:"UnorderedList",icon:"e-unorder-list",tooltip:"Bulleted List",command:"Lists",subCommand:"UL"},orderedlist:{id:"OrderedList",icon:"e-order-list",tooltip:"Numbered List",command:"Lists",subCommand:"OL"},numberformatlist:{id:"NumberFormatList",icon:"e-order-list",tooltip:"Number Format List",command:"NumberFormatList",subCommand:"NumberFormatList"},bulletformatlist:{id:"BulletFormatList",icon:"e-unorder-list",tooltip:"Bullet Format List",command:"BulletFormatList",subCommand:"BulletFormatList"},indent:{id:"Indent",icon:"e-indent",tooltip:"Increase Indent",command:"Indents",subCommand:"Indent"},outdent:{id:"Outdent",icon:"e-outdent",tooltip:"Decrease Indent",command:"Indents",subCommand:"Outdent"},undo:{id:"Undo",icon:"e-undo",tooltip:"Undo",command:"Actions",subCommand:"Undo"},redo:{id:"Redo",icon:"e-redo",tooltip:"Redo",command:"Actions",subCommand:"Redo"},superscript:{id:"SuperScript",icon:"e-super-script",tooltip:"Superscript",command:"Effects",subCommand:"SuperScript"},subscript:{id:"SubScript",icon:"e-sub-script",tooltip:"Subscript",command:"Effects",subCommand:"SubScript"},createlink:{id:"CreateLink",icon:"e-create-link",tooltip:"Insert Hyperlink",command:"Links",subCommand:"CreateLink"},openlink:{id:"OpenLink",icon:"e-open-link",tooltip:"Open Link",command:"Links",subCommand:"OpenLink"},editlink:{id:"EditLink",icon:"e-edit-link",tooltip:"Edit Link",command:"Links",subCommand:"EditLink"},removelink:{id:"RemoveLink",icon:"e-remove-link",tooltip:"Remove Link",command:"Links",subCommand:"RemoveLink"},image:{id:"Image",icon:"e-image",tooltip:"Insert Image",command:"Images",subCommand:"Image"},audio:{id:"Audio",icon:"e-audio",tooltip:"Insert Audio",command:"Audios",subCommand:"Audio"},video:{id:"Video",icon:"e-video",tooltip:"Insert Video",command:"Videos",subCommand:"Video"},filemanager:{id:"FileManager",icon:"e-rte-file-manager",tooltip:"File Manager",command:"Files",subCommand:"File"},createtable:{id:"CreateTable",icon:"e-create-table",tooltip:"Create Table",command:"Table",subCommand:"CreateTable"},removetable:{id:"removeTable",icon:"e-remove-table",tooltip:"Remove Table",command:"removeTable",subCommand:"removeTable"},replace:{id:"Replace",icon:"e-replace",tooltip:"Replace",command:"Images",subCommand:"Replace"},audioreplace:{id:"AudioReplace",icon:"e-audio-replace",tooltip:"Audio Replace",command:"Audios",subCommand:"AudioReplace"},audioremove:{id:"AudioRemove",icon:"e-audio-remove",tooltip:"Audio Remove",command:"Audios",subCommand:"AudioRemove"},audiolayoutoption:{id:"AudioLayoutOption",icon:"e-audio-display",tooltip:"Audio LayoutOption",command:"Audios",subCommand:"AudioLayoutOption"},videoreplace:{id:"VideoReplace",icon:"e-video-replace",tooltip:"Video Replace",command:"Videos",subCommand:"VideoReplace"},videoalign:{id:"VideoAlign",icon:"e-video-align",tooltip:"Video Align",command:"Videos",subCommand:"VideoAlign"},videoremove:{id:"VideoRemove",icon:"e-video-remove",tooltip:"Video Remove",command:"Videos",subCommand:"VideoRemove"},videolayoutoption:{id:"VideoLayoutOption",icon:"e-video-display",tooltip:"Video LayoutOption",command:"Videos",subCommand:"VideoLayoutOption"},videodimension:{id:"VideoDimension",icon:"e-video-dimension",tooltip:"Video Dimension",command:"Videos",subCommand:"VideoDimension"},align:{id:"Align",icon:"e-align",tooltip:"Align",command:"Images",subCommand:"Align"},caption:{id:"Caption",icon:"e-caption",tooltip:"Image Caption",command:"Images",subCommand:"Caption"},remove:{id:"Remove",icon:"e-remove",tooltip:"Remove",command:"Images",subCommand:"Remove"},openimagelink:{id:"OpenImageLink",icon:"e-open-link",tooltip:"Open Link",command:"Images",subCommand:"OpenImageLink"},editimagelink:{id:"EditImageLink",icon:"e-edit-link",tooltip:"Edit Link",command:"Images",subCommand:"EditImageLink"},removeimagelink:{id:"RemoveImageLink",icon:"e-remove-link",tooltip:"Remove Link",command:"Images",subCommand:"RemoveImageLink"},insertlink:{id:"InsertLink",icon:"e-insert-link",tooltip:"Insert Link",command:"Images",subCommand:"InsertLink"},display:{id:"Display",icon:"e-display",tooltip:"Display",command:"Images",subCommand:"Display"},alttext:{id:"AltText",icon:"e-alt-text",tooltip:"Alternative Text",command:"Images",subCommand:"AltText"},dimension:{id:"Dimension",icon:"e-img-dimension",tooltip:"Change Size",command:"Images",subCommand:"Dimension"},fullscreen:{id:"Maximize",icon:"e-maximize",tooltip:"Maximize",command:"View",subCommand:"Maximize"},maximize:{id:"Maximize",icon:"e-maximize",tooltip:"Maximize",command:"FullScreen",subCommand:"Maximize"},minimize:{id:"Minimize",icon:"e-minimize",tooltip:"Minimize",command:"FullScreen",subCommand:"Minimize"},lowercase:{id:"LowerCase",icon:"e-lower-case",tooltip:"Lower Case",command:"Casing",subCommand:"LowerCase"},uppercase:{id:"UpperCase",icon:"e-upper-case",tooltip:"Upper Case",command:"Casing",subCommand:"UpperCase"},print:{id:"Print",icon:"e-print",tooltip:"Print",command:"Print",subCommand:"Print"},formats:{id:"Formats",icon:"e-formats",tooltip:"Formats",command:"Formats",subCommand:"Formats"},sourcecode:{id:"SourceCode",icon:"e-source-code",tooltip:"Code View (Ctrl+Shift+H)",command:"SourceCode",subCommand:"SourceCode"},preview:{id:"Preview",icon:"e-preview",tooltip:"Preview (Ctrl+Shift+H)",command:"Preview",subCommand:"Preview"},viewside:{id:"ViewSide",icon:"e-view-side",tooltip:"ViewSide",command:"ViewSide",subCommand:"ViewSide"},insertcode:{id:"InsertCode",icon:"e-preformat-code",tooltip:"Insert Code",command:"Formats",subCommand:"Pre"},blockquote:{id:"Blockquote",icon:"e-blockquote",tooltip:"Blockquote",command:"Formats",subCommand:"blockquote"},tableheader:{id:"TableHeader",icon:"e-table-header",tooltip:"Table Header",command:"Table",subCommand:"TableHeader"},tableremove:{id:"TableRemove",icon:"e-table-remove",tooltip:"Table Remove",command:"Table",subCommand:"TableRemove"},tablerows:{id:"TableRows",icon:"e-table-rows",tooltip:"Table Rows",command:"Table",subCommand:"TableRows"},tablecolumns:{id:"TableColumns",icon:"e-table-columns",tooltip:"Table Columns",command:"Table",subCommand:"TableColumns"},tablecell:{id:"TableCell",icon:"e-table-cell",tooltip:"Table Cell",command:"Table",subCommand:"TableCell"},tablecellbackground:{id:"TableCellBackground",icon:"e-table-cell-background",tooltip:"Table Cell Background",command:"Table",subCommand:"TableCellBackground"},tablecellhorizontalalign:{id:"TableCellHorizontalAlign",icon:"e-table-cell-horizontalAlign",tooltip:"Table Cell HorizontalAlign",command:"Table",subCommand:"TableCellHorizontalAlign"},tablecellverticalalign:{id:"TableCellVerticalAlign",icon:"e-table-cell-verticalAlign",tooltip:"Table Cell VerticalAlign",command:"Table",subCommand:"TableCellVerticalAlign"},tableeditproperties:{id:"TableEditProperties",icon:"e-table-edit-properties",tooltip:"Table Edit Properties",command:"Table",subCommand:"TableEditProperties"},styles:{id:"Styles",icon:"e-table-styles",tooltip:"Styles",command:"Table",subCommand:"Styles"},formatpainter:{id:"FormatPainter",icon:"e-rte-format-painter",tooltip:"Format Painter",command:"FormatPainter",subCommand:"FormatPainter"},emojipicker:{id:"EmojiPicker",icon:"e-emoji",tooltip:"Emoji Icon",command:"EmojiPicker",subCommand:"EmojiPicker"},inlinecode:{id:"inlineCode",icon:"e-inline-code",tooltip:"inlineCode",command:"Style",subCommand:"InlineCode"}},ko=[{locale:"alignmentsDropDownLeft",value:"JustifyLeft"},{locale:"alignmentsDropDownCenter",value:"JustifyCenter"},{locale:"alignmentsDropDownRight",value:"JustifyRight"},{locale:"alignmentsDropDownJustify",value:"JustifyFull"}],xo=[{iconCss:"e-icons e-justify-left",text:"Align Left",command:"Alignments",subCommand:"JustifyLeft"},{iconCss:"e-icons e-justify-center",text:"Align Center",command:"Alignments",subCommand:"JustifyCenter"},{iconCss:"e-icons e-justify-right",text:"Align Right",command:"Alignments",subCommand:"JustifyRight"},{iconCss:"e-icons e-justify-full",text:"Align Justify",command:"Alignments",subCommand:"JustifyFull"}],wo=[{iconCss:"e-icons e-justify-left",command:"Images",subCommand:"JustifyLeft"},{iconCss:"e-icons e-justify-center",command:"Images",subCommand:"JustifyCenter"},{iconCss:"e-icons e-justify-right",command:"Images",subCommand:"JustifyRight"}],Do=[{iconCss:"e-icons e-justify-left",command:"Videos",subCommand:"JustifyLeft"},{iconCss:"e-icons e-justify-center",command:"Videos",subCommand:"JustifyCenter"},{iconCss:"e-icons e-justify-right",command:"Videos",subCommand:"JustifyRight"}],Mo=[{locale:"imageDisplayDropDownInline",value:"Inline"},{locale:"imageDisplayDropDownBreak",value:"Break"}],Ao=[{locale:"audioLayoutOptionDropDownInline",value:"Inline"},{locale:"audioLayoutOptionDropDownBreak",value:"Break"}],Bo=[{locale:"videoLayoutOptionDropDownInline",value:"Inline"},{locale:"videoLayoutOptionDropDownBreak",value:"Break"}],Ro=[{text:"Inline",cssClass:"e-inline",command:"Images",subCommand:"Inline"},{text:"Break",cssClass:"e-break",command:"Images",subCommand:"Break"}],Io=[{text:"Inline",cssClass:"e-audio-inline",command:"Audios",subCommand:"Inline"},{text:"Break",cssClass:"e-audio-break",command:"Audios",subCommand:"Break"}],Uo=[{text:"Inline",cssClass:"e-video-inline",command:"Videos",subCommand:"Inline"},{text:"Break",cssClass:"e-video-break",command:"Videos",subCommand:"Break"}],Po=[{iconCss:"e-icons e-cell-merge",text:"Merge cells",command:"Table",subCommand:"Merge"},{iconCss:"e-icons e-cell-horizontal-split",text:"Horizontal split",command:"Table",subCommand:"HorizontalSplit"},{iconCss:"e-icons e-cell-vertical-split",text:"Vertical split",command:"Table",subCommand:"VerticalSplit"}],Ho=[{locale:"tableInsertRowDropDownBefore",value:"InsertRowBefore"},{locale:"tableInsertRowDropDownAfter",value:"InsertRowAfter"},{locale:"tableInsertRowDropDownDelete",value:"DeleteRow"}],jo=[{iconCss:"e-icons e-insert-row-before",text:"Insert row before",command:"Table",subCommand:"InsertRowBefore"},{iconCss:"e-icons e-insert-row-after",text:"Insert row after",command:"Table",subCommand:"InsertRowAfter"},{iconCss:"e-icons e-delete-row",text:"Delete row",command:"Table",subCommand:"DeleteRow"}],Fo=[{locale:"tableInsertColumnDropDownLeft",value:"InsertColumnLeft"},{locale:"tableInsertColumnDropDownRight",value:"InsertColumnRight"},{locale:"tableInsertColumnDropDownDelete",value:"DeleteColumn"}],qo=[{iconCss:"e-icons e-insert-column-left",text:"Insert column left",command:"Table",subCommand:"InsertColumnLeft"},{iconCss:"e-icons e-insert-column-right",text:"Insert column right",command:"Table",subCommand:"InsertColumnRight"},{iconCss:"e-icons e-delete-column",text:"Delete column",command:"Table",subCommand:"DeleteColumn"}],zo=[{locale:"tableVerticalAlignDropDownTop",value:"AlignTop"},{locale:"tableVerticalAlignDropDownMiddle",value:"AlignMiddle"},{locale:"tableVerticalAlignDropDownBottom",value:"AlignBottom"}],_o=[{iconCss:"e-icons e-align-top",text:"Align Top",command:"Table",subCommand:"AlignTop"},{iconCss:"e-icons e-align-middle",text:"Align Middle",command:"Table",subCommand:"AlignMiddle"},{iconCss:"e-icons e-align-bottom",text:"Align Bottom",command:"Table",subCommand:"AlignBottom"}],Vo=[{locale:"tableStylesDropDownDashedBorder",value:"Dashed"},{locale:"tableStylesDropDownAlternateRows",value:"Alternate"}],Wo=[{text:"Dashed Borders",cssClass:"e-dashed-borders",command:"Table",subCommand:"Dashed"},{text:"Alternate Rows",cssClass:"e-alternate-rows",command:"Table",subCommand:"Alternate"}],Qo=["Bold","Italic","Underline","|","Formats","Alignments","Blockquote","OrderedList","UnorderedList","|","CreateLink","Image","|","SourceCode","Undo","Redo"],Ko=[{cssClass:"e-default",text:"Default",command:"Font",subCommand:"FontName",value:""},{cssClass:"e-segoe-ui",text:"Segoe UI",command:"Font",subCommand:"FontName",value:"Segoe UI"},{cssClass:"e-arial",text:"Arial",command:"Font",subCommand:"FontName",value:"Arial,Helvetica,sans-serif"},{cssClass:"e-georgia",text:"Georgia",command:"Font",subCommand:"FontName",value:"Georgia,serif"},{cssClass:"e-impact",text:"Impact",command:"Font",subCommand:"FontName",value:"Impact,Charcoal,sans-serif"},{cssClass:"e-tahoma",text:"Tahoma",command:"Font",subCommand:"FontName",value:"Tahoma,Geneva,sans-serif"},{cssClass:"e-times-new-roman",text:"Times New Roman",command:"Font",subCommand:"FontName",value:"Times New Roman,Times,serif"},{cssClass:"e-verdana",text:"Verdana",command:"Font",subCommand:"FontName",value:"Verdana,Geneva,sans-serif"}],Go=[{text:"Default",value:""},{text:"8 pt",value:"8pt"},{text:"10 pt",value:"10pt"},{text:"12 pt",value:"12pt"},{text:"14 pt",value:"14pt"},{text:"18 pt",value:"18pt"},{text:"24 pt",value:"24pt"},{text:"36 pt",value:"36pt"}],Xo=[{cssClass:"e-paragraph",text:"Paragraph",command:"Formats",subCommand:"P",value:"P"},{cssClass:"e-h1",text:"Heading 1",command:"Formats",subCommand:"H1",value:"H1"},{cssClass:"e-h2",text:"Heading 2",command:"Formats",subCommand:"H2",value:"H2"},{cssClass:"e-h3",text:"Heading 3",command:"Formats",subCommand:"H3",value:"H3"},{cssClass:"e-h4",text:"Heading 4",command:"Formats",subCommand:"H4",value:"H4"},{cssClass:"e-code",text:"preformatted",command:"Formats",subCommand:"Pre",value:"Pre"}],Yo={Custom:["","#000000","#e7e6e6","#44546a","#4472c4","#ed7d31","#a5a5a5","#ffc000","#70ad47","#ff0000","#f2f2f2","#808080","#cfcdcd","#d5dce4","#d9e2f3","#fbe4d5","#ededed","#fff2cc","#e2efd9","#ffcccc","#d9d9d9","#595959","#aeaaaa","#acb9ca","#b4c6e7","#f7caac","#dbdbdb","#ffe599","#c5e0b3","#ff8080","#bfbfbf","#404040","#747070","#8496b0","#8eaadb","#f4b083","#c9c9c9","#ffd966","#a8d08d","#ff3333","#a6a6a6","#262626","#3b3838","#323e4f","#2f5496","#c45911","#7b7b7b","#bf8f00","#538135","#b30000","#7f7f7f","#0d0d0d","#161616","#212934","#1f3763","#823b0b","#525252","#7f5f00","#375623","#660000"]},Jo={Custom:["","#000000","#ffff00","#00ff00","#00ffff","#0000ff","#ff0000","#000080","#800080","#996633","#f2f2f2","#808080","#ffffcc","#b3ffb3","#ccffff","#ccccff","#ffcccc","#ccccff","#ff80ff","#f2e6d9","#d9d9d9","#595959","#ffff80","#80ff80","#b3ffff","#8080ff","#ff8080","#8080ff","#ff00ff","#dfbf9f","#bfbfbf","#404040","#ffff33","#33ff33","#33ffff","#3333ff","#ff3333","#0000b3","#b300b3","#c68c53","#a6a6a6","#262626","#e6e600","#00b300","#009999","#000099","#b30000","#000066","#660066","#86592d","#7f7f7f","#0d0d0d","#999900","#006600","#006666","#000066","#660000","#00004d","#4d004d","#734d26"]},$o=[{text:"None",command:"Lists",subCommand:"NumberFormatList",value:"none"},{text:"Number",command:"Lists",subCommand:"NumberFormatList",value:"decimal"},{text:"Lower Greek",command:"Lists",subCommand:"NumberFormatList",value:"lowerGreek"},{text:"Lower Roman",command:"Lists",subCommand:"NumberFormatList",value:"lowerRoman"},{text:"Upper Alpha",command:"Lists",subCommand:"NumberFormatList",value:"upperAlpha"},{text:"Lower Alpha",command:"Lists",subCommand:"NumberFormatList",value:"lowerAlpha"},{text:"Upper Roman",command:"Lists",subCommand:"NumberFormatList",value:"upperRoman"}],Zo=[{text:"None",command:"Lists",subCommand:"BulletFormatList",value:"none"},{text:"Disc",command:"Lists",subCommand:"BulletFormatList",value:"disc"},{text:"Circle",command:"Lists",subCommand:"BulletFormatList",value:"circle"},{text:"Square",command:"Lists",subCommand:"BulletFormatList",value:"square"}];function er(e,t,n){for(var i=0;t.length>i;i++)if(t[i].value===n.subCommand)return e.localeObj.getConstant(t[i].locale);return n.text}var tr={CreateLink:"Ctrl+K",Image:"Ctrl+Shift+I",CreateTable:"Ctrl+Shift+E",Undo:"Ctrl+Z",Redo:"Ctrl+Y",Copy:"Ctrl+C",Cut:"Ctrl+X",Paste:"Ctrl+V",Bold:"Ctrl+B",Italic:"Ctrl+I",Underline:"Ctrl+U",StrikeThrough:"Ctrl+Shift+S",UpperCase:"Ctrl+Shift+U",LowerCase:"Ctrl+Shift+L",SuperScript:"Ctrl+Shift+=",SubScript:"Ctrl+=",SourceCode:"Ctrl+Shift+H",Maximize:"Ctrl+Shift+F",Minimize:"Esc",ClearFormat:"Ctrl+Shift+R",OL:"Ctrl+Shift+O",UL:"Ctrl+Alt+O",NumberFormatList:"Ctrl+Shift+O",BulletFormatList:"Ctrl+Alt+O",Audio:"Ctrl+Shift+A",Video:"Ctrl+Alt+V",Indent:"Ctrl+]",Outdent:"Ctrl+[","Decrease Fontsize":"Ctrl+Shift+<","Increase Fontsize":"Ctrl+Shift+>",JustifyCenter:"Ctrl+E",JustifyFull:"Ctrl+J",JustifyLeft:"Ctrl+L",JustifyRight:"Ctrl+R",FormatPainter:"Alt+Shift+C, Alt+Shift+V",InlineCode:"Ctrl+`"},nr=[{name:"Smilies & People",code:"1F600",iconCss:"e-emoji",icons:[{code:"1F600",desc:"Grinning face"},{code:"1F603",desc:"Grinning face with big eyes"},{code:"1F604",desc:"Grinning face with smiling eyes"},{code:"1F606",desc:"Grinning squinting face"},{code:"1F605",desc:"Grinning face with sweat"},{code:"1F602",desc:"Face with tears of joy"},{code:"1F923",desc:"Rolling on the floor laughing"},{code:"1F60A",desc:"Smiling face with smiling eyes"},{code:"1F607",desc:"Smiling face with halo"},{code:"1F642",desc:"Slightly smiling face"},{code:"1F643",desc:"Upside-down face"},{code:"1F60D",desc:"Smiling face with heart-eyes"},{code:"1F618",desc:"Face blowing a kiss"},{code:"1F61B",desc:"Face with tongue"},{code:"1F61C",desc:"Winking face with tongue"},{code:"1F604",desc:"Grinning face with smiling eyes"},{code:"1F469",desc:"Woman"},{code:"1F468",desc:"Man"},{code:"1F467",desc:"Girl"},{code:"1F466",desc:"Boy"},{code:"1F476",desc:"Baby"},{code:"1F475",desc:"Old woman"},{code:"1F474",desc:"Old man"},{code:"1F46E",desc:"Police officer"},{code:"1F477",desc:"Construction worker"},{code:"1F482",desc:"Guard"},{code:"1F575",desc:"Detective"},{code:"1F9D1",desc:"Cook"}]},{name:"Animals & Nature",code:"1F435",iconCss:"e-animals",icons:[{code:"1F436",desc:"Dog face"},{code:"1F431",desc:"Cat face"},{code:"1F42D",desc:"Mouse face"},{code:"1F439",desc:"Hamster face"},{code:"1F430",desc:"Rabbit face"},{code:"1F98A",desc:"Fox face"},{code:"1F43B",desc:"Bear face"},{code:"1F43C",desc:"Panda face"},{code:"1F428",desc:"Koala"},{code:"1F42F",desc:"Tiger face"},{code:"1F981",desc:"Lion face"},{code:"1F42E",desc:"Cow face"},{code:"1F437",desc:"Pig face"},{code:"1F43D",desc:"Pig nose"},{code:"1F438",desc:"Frog face"},{code:"1F435",desc:"Monkey face"},{code:"1F649",desc:"Hear-no-evil monkey"},{code:"1F64A",desc:"Speak-no-evil monkey"},{code:"1F412",desc:"Monkey"},{code:"1F414",desc:"Chicken"},{code:"1F427",desc:"Penguin"},{code:"1F426",desc:"Bird"},{code:"1F424",desc:"Baby chick"},{code:"1F986",desc:"Duck"},{code:"1F985",desc:"Eagle"}]},{name:"Food & Drink",code:"1F347",iconCss:"e-food-and-drinks",icons:[{code:"1F34E",desc:"Red apple"},{code:"1F34C",desc:"Banana"},{code:"1F347",desc:"Grapes"},{code:"1F353",desc:"Strawberry"},{code:"1F35E",desc:"Bread"},{code:"1F950",desc:"Croissant"},{code:"1F955",desc:"Carrot"},{code:"1F354",desc:"Hamburger"},{code:"1F355",desc:"Pizza"},{code:"1F32D",desc:"Hot dog"},{code:"1F35F",desc:"French fries"},{code:"1F37F",desc:"Popcorn"},{code:"1F366",desc:"Soft ice cream"},{code:"1F367",desc:"Shaved ice"},{code:"1F36A",desc:"Cookie"},{code:"1F382",desc:"Birthday cake"},{code:"1F370",desc:"Shortcake"},{code:"1F36B",desc:"Chocolate bar"},{code:"1F369",desc:"Donut"},{code:"1F36E",desc:"Custard"},{code:"1F36D",desc:"Lollipop"},{code:"1F36C",desc:"Candy"},{code:"1F377",desc:"Wine glass"},{code:"1F37A",desc:"Beer mug"},{code:"1F37E",desc:"Bottle with popping cork"}]},{name:"Activities",code:"1F383",iconCss:"e-activities",icons:[{code:"26BD",desc:"Soccer ball"},{code:"1F3C0",desc:"Basketball"},{code:"1F3C8",desc:"American football"},{code:"26BE",desc:"Baseball"},{code:"1F3BE",desc:"Tennis"},{code:"1F3D0",desc:"Volleyball"},{code:"1F3C9",desc:"Rugby football"},{code:"1F3B1",desc:"Pool 8 ball"},{code:"1F3D3",desc:"Ping pong"},{code:"1F3F8",desc:"Badminton"},{code:"1F94A",desc:"Boxing glove"},{code:"1F3CA",desc:"Swimmer"},{code:"1F3CB",desc:"Weightlifter"},{code:"1F6B4",desc:"Bicyclist"},{code:"1F6F9",desc:"Skateboard"},{code:"1F3AE",desc:"Video game"},{code:"1F579",desc:"Joystick"},{code:"1F3CF",desc:"Cricket"},{code:"1F3C7",desc:"Horse racing"},{code:"1F3AF",desc:"Direct hit"},{code:"1F3D1",desc:"Field hockey"},{code:"1F3B0",desc:"Slot machine"},{code:"1F3B3",desc:"Bowling"},{code:"1F3B2",desc:"Game die"},{code:"265F",desc:"Chess pawn"}]},{name:"Travel & Places",code:"1F30D",iconCss:"e-travel-and-places",icons:[{code:"2708",desc:"Airplane"},{code:"1F697",desc:"Automobile"},{code:"1F695",desc:"Taxi"},{code:"1F6B2",desc:"Bicycle"},{code:"1F68C",desc:"Bus"},{code:"1F682",desc:"Locomotive"},{code:"1F6F3",desc:"Passenger ship"},{code:"1F680",desc:"Rocket"},{code:"1F681",desc:"Helicopter"},{code:"1F6A2",desc:"Ship"},{code:"1F3DF",desc:"Stadium"},{code:"1F54C",desc:"Mosque"},{code:"26EA",desc:"Church"},{code:"1F6D5",desc:"Hindu Temple"},{code:"1F3D4",desc:"Snow-capped mountain"},{code:"1F3EB",desc:"School"},{code:"1F30B",desc:"Volcano"},{code:"1F3D6",desc:"Beach with umbrella"},{code:"1F3DD",desc:"Desert island"},{code:"1F3DE",desc:"National park"},{code:"1F3F0",desc:"Castle"},{code:"1F5FC",desc:"Tokyo tower"},{code:"1F5FD",desc:"Statue of liberty"},{code:"26E9",desc:"Shinto shrine"},{code:"1F3EF",desc:"Japanese castle"},{code:"1F3A2",desc:"Roller coaster"}]},{name:"Objects",code:"1F507",iconCss:"e-objects",icons:[{code:"1F4A1",desc:"Light bulb"},{code:"1F526",desc:"Flashlight"},{code:"1F4BB",desc:"Laptop computer"},{code:"1F5A5",desc:"Desktop computer"},{code:"1F5A8",desc:"Printer"},{code:"1F4F7",desc:"Camera"},{code:"1F4F8",desc:"Camera with flash"},{code:"1F4FD",desc:"Film projector"},{code:"1F3A5",desc:"Movie camera"},{code:"1F4FA",desc:"Television"},{code:"1F4FB",desc:"Radio"},{code:"1F50B",desc:"Battery"},{code:"231A",desc:"Watch"},{code:"1F4F1",desc:"Mobile phone"},{code:"260E",desc:"Telephone"},{code:"1F4BE",desc:"Floppy disk"},{code:"1F4BF",desc:"Optical disk"},{code:"1F4C0",desc:"Digital versatile disc"},{code:"1F4BD",desc:"Computer disk"},{code:"1F3A7",desc:"Headphone"},{code:"1F3A4",desc:"Microphone"},{code:"1F3B6",desc:"Multiple musical notes"},{code:"1F4DA",desc:"Books"}]},{name:"Symbols",code:"1F3E7",iconCss:"e-symbols",icons:[{code:"274C",desc:"Cross mark"},{code:"2714",desc:"Check mark"},{code:"26A0",desc:"Warning sign"},{code:"1F6AB",desc:"Prohibited"},{code:"2139",desc:"Information"},{code:"267B",desc:"Recycling symbol"},{code:"1F6AD",desc:"No smoking"},{code:"1F4F5",desc:"No mobile phones"},{code:"1F6AF",desc:"No littering"},{code:"1F6B3",desc:"No bicycles"},{code:"1F6B7",desc:"No pedestrians"},{code:"2795",desc:"Plus"},{code:"2796",desc:"Minus"},{code:"2797",desc:"Divide"},{code:"2716",desc:"Multiplication"},{code:"1F4B2",desc:"Dollar banknote"},{code:"1F4AC",desc:"Speech balloon"},{code:"2755",desc:"White exclamation mark"},{code:"2754",desc:"White question mark"},{code:"2764",desc:"Heart"}]}],ir={alignments:"Alignments",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",fontName:"Font Name",fontSize:"Font Size",fontColor:"Font Color",backgroundColor:"Background Color",importWord:"Import from Word",exportWord:"Export to Word",exportPdf:"Export to PDF",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",clearFormat:"Clear Format",clearAll:"Clear All",cut:"Cut",copy:"Copy",paste:"Paste",unorderedList:"Bulleted List",orderedList:"Numbered List",indent:"Increase Indent",outdent:"Decrease Indent",undo:"Undo",redo:"Redo",superscript:"Superscript",subscript:"Subscript",createLink:"Insert Link",openLink:"Open Link",editLink:"Edit Link",removeLink:"Remove Link",image:"Insert Image",audio:"Insert Audio",video:"Insert Video",replace:"Replace",numberFormatList:"Number Format List",bulletFormatList:"Bullet Format List",audioReplace:"Replace",videoReplace:"Replace",videoAlign:"Align",videoDimension:"Dimension",audioRemove:"Remove",videoRemove:"Remove",audioLayoutOption:"Layout option",videoLayoutOption:"Layout option",align:"Align",caption:"Caption",remove:"Remove",insertLink:"Insert Link",display:"Display",altText:"Alternative text",dimension:"Change Size",fullscreen:"Maximize",maximize:"Maximize",minimize:"Minimize",lowerCase:"Lower Case",upperCase:"Upper Case",print:"Print",formats:"Formats",sourcecode:"Code View",preview:"Preview",viewside:"ViewSide",insertCode:"Insert Code",blockquote:"Blockquote",linkText:"Display text",linkTooltipLabel:"Title",linkWebUrl:"Web address",linkTitle:"Enter a title",linkurl:"https://example.com",linkOpenInNewWindow:"Open link in new window",linkHeader:"Insert Link",dialogInsert:"Insert",dialogCancel:"Cancel",dialogUpdate:"Update",imageHeader:"Insert Image",audioHeader:"Insert Audio",videoHeader:"Insert Video",imageLinkHeader:"You can also provide a link from the web",audioLinkHeader:"You can also provide a link from the web",videoLinkHeader:"Web URL",embedVideoLinkHeader:"Media Embed URL",mdimageLink:"Please provide a URL for your image",imageUploadMessage:"Drop image here or browse to upload",audioUploadMessage:"Drop an audio file or browse to upload",videoUploadMessage:"Drop a video file or browse to upload",imageDeviceUploadMessage:"Click here to upload",audioDeviceUploadMessage:"Click here to upload",videoDeviceUploadMessage:"Click here to upload",imageAlternateText:"Alternate Text",alternateHeader:"Alternative Text",browse:"Browse",imageUrl:"https://example.com/image.png",audioUrl:"https://example.com/audio.mp3",videoUrl:"https://example.com/video.mp4",webUrl:"Web URL",embedUrl:"Embed Code",imageCaption:"Caption",imageSizeHeader:"Image Size",videoSizeHeader:"Video Size",imageHeight:"Height",imageWidth:"Width",videoHeight:"Height",videoWidth:"Width",textPlaceholder:"Enter text",inserttablebtn:"Insert Table",tabledialogHeader:"Insert Table",tableWidth:"Width",cellpadding:"Cell Padding",cellspacing:"Cell Spacing",columns:"Number of columns",rows:"Number of rows",tableRows:"Row",tableColumns:"Column",tableCellHorizontalAlign:"Table Cell Horizontal Align",tableCellVerticalAlign:"Vertical Align",createTable:"Create Table",removeTable:"Remove Table",tableHeader:"Header Row",tableRemove:"Delete Table",tableCellBackground:"Table Cell Background",tableEditProperties:"Table Edit Properties",styles:"Styles",insertColumnLeft:"Insert Column Left",insertColumnRight:"Insert Column Right",deleteColumn:"Delete Column",insertRowBefore:"Insert Row Before",insertRowAfter:"Insert Row After",deleteRow:"Delete Row",tableEditHeader:"Edit Table",TableHeadingText:"Heading",TableColText:"Col",imageInsertLinkHeader:"Insert Link",editImageHeader:"Edit Image",editAudioHeader:"Edit Audio",editVideoHeader:"Edit Video",alignmentsDropDownLeft:"Align Left",alignmentsDropDownCenter:"Align Center",alignmentsDropDownRight:"Align Right",alignmentsDropDownJustify:"Align Justify",imageDisplayDropDownInline:"Inline",imageDisplayDropDownBreak:"Break",audioLayoutOptionDropDownInline:"Inline",audioLayoutOptionDropDownBreak:"Break",videoLayoutOptionDropDownInline:"Inline",videoLayoutOptionDropDownBreak:"Break",tableInsertRowDropDownBefore:"Insert row before",tableInsertRowDropDownAfter:"Insert row after",tableInsertRowDropDownDelete:"Delete row",tableInsertColumnDropDownLeft:"Insert column left",tableInsertColumnDropDownRight:"Insert column right",tableInsertColumnDropDownDelete:"Delete column",tableVerticalAlignDropDownTop:"Align Top",tableVerticalAlignDropDownMiddle:"Align Middle",tableVerticalAlignDropDownBottom:"Align Bottom",tableStylesDropDownDashedBorder:"Dashed Borders",tableStylesDropDownAlternateRows:"Alternate Rows",pasteFormat:"Paste Format",pasteFormatContent:"Choose the formatting action",plainText:"Plain Text",cleanFormat:"Clean",keepFormat:"Keep",pasteDialogOk:"OK",pasteDialogCancel:"Cancel",fileManager:"File Manager",fileDialogHeader:"File Browser",formatsDropDownParagraph:"Paragraph",formatsDropDownCode:"Preformatted",formatsDropDownQuotation:"Blockquote",formatsDropDownHeading1:"Heading 1",formatsDropDownHeading2:"Heading 2",formatsDropDownHeading3:"Heading 3",formatsDropDownHeading4:"Heading 4",fontNameSegoeUI:"Segoe UI",fontNameArial:"Arial",fontNameGeorgia:"Georgia",fontNameImpact:"Impact",fontNameTahoma:"Tahoma",fontNameTimesNewRoman:"Times New Roman",fontNameVerdana:"Verdana",numberFormatListNumber:"Number",numberFormatListLowerAlpha:"Lower Alpha",numberFormatListUpperAlpha:"Upper Alpha",numberFormatListLowerRoman:"Lower Roman",numberFormatListUpperRoman:"Upper Roman",numberFormatListLowerGreek:"Lower Greek",bulletFormatListDisc:"Disc",bulletFormatListCircle:"Circle",bulletFormatListSquare:"Square",numberFormatListNone:"None",bulletFormatListNone:"None",formatPainter:"Format Painter",emojiPicker:"Emoji Picker",embeddedCode:"Embedded code",pasteEmbeddedCodeHere:"Paste embedded code here",emojiPickerTypeToFind:"Type to find",emojiPickerNoResultFound:"No results found",emojiPickerTrySomethingElse:"Try something else",linkAriaLabel:"Open in new window",imageLinkAriaLabel:"Open in new window",unsupportedImage:"Unsupported file format",mergecells:"Merge cells",verticalsplit:"Vertical split",horizontalsplit:"Horizontal split",inlinecode:"Inline Code",slashMenuItemHeadingOneText:"Heading 1",slashMenuItemHeadingOneDescription:"Use this for a top level heading or title.",slashMenuItemHeadingTwoText:"Heading 2",slashMenuItemHeadingTwoDescription:"Use this for key sections.",slashMenuItemHeadingThreeText:"Heading 3",slashMenuItemHeadingThreeDescription:"Use this for sub sections and group headings.",slashMenuItemHeadingFourText:"Heading 4",slashMenuItemHeadingFourDescription:"Use this for the key points of the sub topics.",slashMenuItemParagraphText:"Paragraph",slashMenuItemParagraphDescription:"Writing with paragraphs.",slashMenuItemBlockquoteText:"Blockquote",slashMenuItemBlockquoteDescription:"Create a quote or citation.",slashMenuItemOrderedListText:"Ordered List",slashMenuItemOrderedListDescription:"Create an ordered list.",slashMenuItemUnorderedListText:"Unordered List",slashMenuItemUnorderedListDescription:"Create an unordered list.",slashMenuItemCodeText:"CodeBlock",slashMenuItemCodeDescription:"Create a preformatted code block.",slashMenuItemTableText:"Table",slashMenuItemTableDescription:"Insert a table.",slashMenuItemLinkText:"Link",slashMenuItemLinkDescription:"Insert a link.",slashMenuItemImageText:"Image",slashMenuItemImageDescription:"Insert an image.",slashMenuItemAudioText:"Audio",slashMenuItemAudioDescription:"Insert an audio.",slashMenuItemVideoText:"Video",slashMenuItemVideoDescription:"Insert a video.",slashMenuItemEmojiText:"Emojipicker",slashMenuItemEmojiDescription:"Use emojis to express ideas and emoticons."},or={alignments:"alignments",justifyleft:"justifyLeft",justifycenter:"justifyCenter",justifyright:"justifyRight",justifyfull:"justifyFull",fontname:"fontName",fontsize:"fontSize",fontcolor:"fontColor",backgroundcolor:"backgroundColor",importword:"importWord",exportword:"exportWord",exportpdf:"exportPdf",bold:"bold",italic:"italic",underline:"underline",strikethrough:"strikethrough",clearformat:"clearFormat",clearall:"clearAll",cut:"cut",copy:"copy",paste:"paste",unorderedlist:"unorderedList",orderedlist:"orderedList",indent:"indent",outdent:"outdent",numberformatlist:"numberFormatList",bulletformatlist:"bulletFormatList",undo:"undo",redo:"redo",filemanager:"fileManager",superscript:"superscript",subscript:"subscript",createlink:"createLink",openlink:"openLink",editlink:"editLink",removelink:"removeLink",openimagelink:"openLink",editimagelink:"editLink",removeimagelink:"removeLink",image:"image",audio:"audio",video:"video",replace:"replace",audioreplace:"audioReplace",videoreplace:"videoReplace",videoalign:"videoAlign",videodimension:"videoDimension",audioremove:"audioRemove",videoremove:"videoRemove",audiolayoutoption:"audioLayoutOption",videolayoutoption:"videoLayoutOption",align:"align",caption:"caption",remove:"remove",insertlink:"insertLink",display:"display",alttext:"imageAlternateText",dimension:"dimension",fullscreen:"fullscreen",maximize:"maximize",minimize:"minimize",lowercase:"lowerCase",uppercase:"upperCase",print:"print",formats:"formats",sourcecode:"sourcecode",preview:"preview",viewside:"viewside",insertcode:"insertCode",blockquote:"blockquote",tablerows:"tableRows",tablecolumns:"tableColumns",tablecellhorizontalalign:"tableCellHorizontalAlign",tablecellverticalalign:"tableCellVerticalAlign",createtable:"createTable",removetable:"removeTable",tableheader:"tableHeader",tableremove:"tableRemove",tablecellbackground:"tableCellBackground",tableeditproperties:"tableEditProperties",styles:"styles",insertcolumnleft:"insertColumnLeft",insertcolumnright:"insertColumnRight",deletecolumn:"deleteColumn",aligntop:"AlignTop",alignmiddle:"AlignMiddle",alignbottom:"AlignBottom",insertrowbefore:"insertRowBefore",insertrowafter:"insertRowAfter",deleterow:"deleteRow",formatpainter:"formatPainter",emojipicker:"emojiPicker",embeddedCode:"Embedded code",pasteEmbeddedCodeHere:"Paste embedded code here",emojiPickerTypeToFind:"Type to find",emojiPickerNoResultFound:"No results found",emojiPickerTrySomethingElse:"Try something else",inlinecode:"inlinecode"},rr=[{locale:"fontNameSegoeUI",value:"Segoe UI"},{locale:"fontNameArial",value:"Arial,Helvetica,sans-serif"},{locale:"fontNameGeorgia",value:"Georgia,serif"},{locale:"fontNameImpact",value:"Impact,Charcoal,sans-serif"},{locale:"fontNameTahoma",value:"Tahoma,Geneva,sans-serif"},{locale:"fontNameTimesNewRoman",value:"Times New Roman,Times,serif"},{locale:"fontNameVerdana",value:"Verdana,Geneva,sans-serif"}],sr=[{locale:"formatsDropDownParagraph",value:"P"},{locale:"formatsDropDownCode",value:"Pre"},{locale:"formatsDropDownHeading1",value:"H1"},{locale:"formatsDropDownHeading2",value:"H2"},{locale:"formatsDropDownHeading3",value:"H3"},{locale:"formatsDropDownHeading4",value:"H4"}],ar=[{locale:"numberFormatListNone",value:"none"},{locale:"numberFormatListNumber",value:"decimal"},{locale:"numberFormatListLowerAlpha",value:"lowerAlpha"},{locale:"numberFormatListUpperAlpha",value:"upperAlpha"},{locale:"numberFormatListLowerRoman",value:"lowerRoman"},{locale:"numberFormatListUpperRoman",value:"upperRoman"},{locale:"numberFormatListLowerGreek",value:"lowerGreek"}],lr=[{locale:"bulletFormatListNone",value:"none"},{locale:"bulletFormatListDisc",value:"disc"},{locale:"bulletFormatListCircle",value:"circle"},{locale:"bulletFormatListSquare",value:"square"}],dr=new Map([["Heading 1",{text:"slashMenuItemHeadingOneText",description:"slashMenuItemHeadingOneDescription"}],["Heading 2",{text:"slashMenuItemHeadingTwoText",description:"slashMenuItemHeadingTwoDescription"}],["Heading 3",{text:"slashMenuItemHeadingThreeText",description:"slashMenuItemHeadingThreeDescription"}],["Heading 4",{text:"slashMenuItemHeadingFourText",description:"slashMenuItemHeadingFourDescription"}],["Paragraph",{text:"slashMenuItemParagraphText",description:"slashMenuItemParagraphDescription"}],["Blockquote",{text:"slashMenuItemBlockquoteText",description:"slashMenuItemBlockquoteDescription"}],["OrderedList",{text:"slashMenuItemOrderedListText",description:"slashMenuItemOrderedListDescription"}],["UnorderedList",{text:"slashMenuItemUnorderedListText",description:"slashMenuItemUnorderedListDescription"}],["CodeBlock",{text:"slashMenuItemCodeText",description:"slashMenuItemCodeDescription"}],["Table",{text:"slashMenuItemTableText",description:"slashMenuItemTableDescription"}],["Link",{text:"slashMenuItemLinkText",description:"slashMenuItemLinkDescription"}],["Image",{text:"slashMenuItemImageText",description:"slashMenuItemImageDescription"}],["Audio",{text:"slashMenuItemAudioText",description:"slashMenuItemAudioDescription"}],["Video",{text:"slashMenuItemVideoText",description:"slashMenuItemVideoDescription"}],["Emojipicker",{text:"slashMenuItemEmojiText",description:"slashMenuItemEmojiDescription"}]]),cr=["Undo","Redo"],hr=["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","font","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","strike","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"];function pr(e,t){var n=-1;return t.some((function(t,i){return"string"==typeof t&&e===t.toLocaleLowerCase()&&(n=i,!0)})),n}function ur(e,t){var n=!1;return e.classList.contains(t)&&(n=!0),n}function mr(e,t,n,i){var r,s;if(0===e.length&&"FontSize"===t)return"Font Size";for(var a=0;a<e.length;a++){if("value"===n&&e[a].value.toLocaleLowerCase()===t.toLocaleLowerCase()){r=e[a];break}if("text"===n&&e[a].text.toLocaleLowerCase()===t.toLocaleLowerCase()){r=e[a];break}if("subCommand"===n&&e[a].subCommand.toLocaleLowerCase()===t.toLocaleLowerCase()){r=e[a];break}}if(!(0,o.isNullOrUndefined)(r))switch(i){case"text":s=r.text;break;case"value":s=r.value;break;case"iconCss":s=r.iconCss}return s}function fr(){var e=!1;return o.Browser.isDevice&&o.Browser.isIos&&(e=!0),e}function gr(e){return(0,o.isNullOrUndefined)(e)?"":e}function br(e,t,n){return n?window.pageYOffset+t.getBoundingClientRect().top+e.clientY:e.pageY}function vr(e,t){var n=t.getService("rteLocale"),i=or[""+e];return n.getConstant(i)}function yr(e,t,n){Fr(n);for(var i=e.dropDownModule,r=e.args,s=0,a=Object.keys(e.args);s<a.length;s++)for(var l=a[s],d=0;d<e.tbItems.length;d++){var c=e.tbItems[d].subCommand,h=c&&c.toLocaleLowerCase();if(c&&h===l||"UL"===c&&"unorderedlist"===l||"OL"===c&&"orderedlist"===l||"pre"===h&&"insertcode"===l||"NumberFormatList"===c&&"numberFormatList"===l||"BulletFormatList"===c&&"bulletFormatList"===l)if("boolean"==typeof r[""+l])!0===r[""+l]?(0,o.addClass)([e.tbElements[d]],[fi]):(0,o.removeClass)([e.tbElements[d]],[fi]);else if(("string"==typeof r[""+l]||null===r[""+l])&&pr(l,e.parent.toolbarSettings.items)>=-1){var p=r[""+l]?r[""+l]:"",u="";switch(l){case"formats":if((0,o.isNullOrUndefined)(i.formatDropDown)||t||!(0,o.isNullOrUndefined)(i.formatDropDown)&&i.formatDropDown.isDestroyed)break;var m=e.parent.format.types,f=(0,o.isNullOrUndefined)(e.parent.format.default)?m[0].text:e.parent.format.default;u="empty"===p?"":mr(m,p,"subCommand","text"),i.formatDropDown.content='<span style="display: inline-flex;width:'+e.parent.format.width+'" ><span class="e-rte-dropdown-btn-text'+((0,o.isNullOrUndefined)(e.parent.cssClass)?"":" "+e.parent.cssClass)+'">'+((0,o.isNullOrUndefined)(u)?f:u)+"</span></span>",i.formatDropDown.dataBind();break;case"alignments":if((0,o.isNullOrUndefined)(i.alignDropDown)||!(0,o.isNullOrUndefined)(i.alignDropDown)&&i.alignDropDown.isDestroyed)break;u=mr(xo,p,"subCommand","iconCss"),i.alignDropDown.iconCss=(0,o.isNullOrUndefined)(u)?"e-icons e-justify-left":u,i.alignDropDown.dataBind();break;case"fontname":if((0,o.isNullOrUndefined)(i.fontNameDropDown)||t||!(0,o.isNullOrUndefined)(i.fontNameDropDown)&&i.fontNameDropDown.isDestroyed)break;var g=e.parent.fontFamily.items;u="empty"===p?"":mr(g,p,"value","text");var b=(0,o.isNullOrUndefined)(e.parent.fontFamily.default)?0===g.length?n.serviceLocator.getService("rteLocale").getConstant("fontName"):g[0].text:e.parent.fontFamily.default,v="Default"===((0,o.isNullOrUndefined)(u)?b:u)?n.serviceLocator.getService("rteLocale").getConstant("fontName"):(0,o.isNullOrUndefined)(u)?b:u,y='<span style="display: inline-flex;width:'+e.parent.fontFamily.width+'" ><span class="e-rte-dropdown-btn-text'+((0,o.isNullOrUndefined)(e.parent.cssClass)?"":" "+e.parent.cssClass)+'">'+v+"</span></span>";Nr(i.fontNameDropDown,y);break;case"fontsize":if((0,o.isNullOrUndefined)(i.fontSizeDropDown)||!(0,o.isNullOrUndefined)(i.fontSizeDropDown)&&i.fontSizeDropDown.isDestroyed)break;var C=e.parent.fontSize.items,N=(0,o.isNullOrUndefined)(e.parent.fontSize.default)?0===C.length?n.serviceLocator.getService("rteLocale").getConstant("fontSize"):C[0].text:e.parent.fontSize.default,E=mr(C,""===p?N.replace(/\s/g,""):p,C.length>0&&C[0]&&N.replace(/\s/g,"")===C[0].text&&""===p?"text":"value","text");u="empty"===p?"":"Default"===E?n.serviceLocator.getService("rteLocale").getConstant("fontSize"):E;y='<span style="display: inline-flex;width:'+e.parent.fontSize.width+'" ><span class="e-rte-dropdown-btn-text'+((0,o.isNullOrUndefined)(e.parent.cssClass)?"":" "+e.parent.cssClass)+'">'+gr(u)+"</span></span>";Nr(i.fontSizeDropDown,y);break;case"bulletFormatList":case"numberFormatList":""!==p?(0,o.addClass)([e.tbElements[d]],[fi]):(0,o.removeClass)([e.tbElements[d]],[fi])}}}}function Cr(e){return"object"==typeof e?e:[e]}function Nr(e,t){var n=t.match(/style="([^"]*)"/),i="";n&&(i=n[1]);var o=t.replace(/ style="([^"]*)"/,"");e.content=o,e.dataBind(),e.element.firstChild&&(e.element.firstChild.style.cssText=i)}function Er(e,t){for(var n=[],i=0;i<e.length;i++)for(var o=0;o<t.length;o++)if("Separator"!==t[o].type){if(("OrderedList"===e[i]||"NumberFormatList"===e[i])&&"OL"===t[o].subCommand){n.push(o);break}if(("UnorderedList"===e[i]||"BulletFormatList"===e[i])&&"UL"===t[o].subCommand){n.push(o);break}if("InsertCode"===e[i]&&"Pre"===t[o].subCommand){n.push(o);break}if("Blockquote"===e[i]&&"blockquote"===t[o].subCommand){n.push(o);break}if("FileManager"===e[i]&&"File"===t[o].subCommand){n.push(o);break}if("object"==typeof e[i]&&"Custom"===e[i].command){n.push(i);break}if(e[i]===t[o].subCommand){n.push(o);break}}return n}function Sr(e,t){for(var n=0,i=Er(Cr(cr),e.toolbarObj.items),r=(0,o.selectAll)("."+Un,e.toolbarObj.element),s=0,a=Object.keys(t);s<a.length;s++){var l=a[s],d=r[i[n]];d&&e.toolbarObj.enableItems(d,t[""+l]),n++}}function Tr(e,t){var n=document.createEvent("HTMLEvents");n.initEvent(t,!1,!0),e.dispatchEvent(n)}function Or(e){var t=(0,o.createElement)("template");return t.innerHTML=e,t.content instanceof DocumentFragment?t.content:document.createRange().createContextualFragment(e)}function Lr(e,t){var n=[];for(t=t.firstChild;t;t=t.nextSibling)3===t.nodeType?n.push(t):n=n.concat(Lr(e,t));return n}function kr(e){for(var t={},n=Object.keys(e),i=0;i<Object.keys(e).length;i++)t[n[i].toLocaleLowerCase()]=e[n[i]];return t}function xr(e,t){var n;return null!==e&&""!==e?(n=t.enableHtmlEncode?wr(Ar(e),t):wr(e,t),t.setProperties({value:n},!0)):n="DIV"===t.enterKey?t.enableHtmlEncode?"&lt;div&gt;&lt;br/&gt;&lt;/div&gt;":"<div><br/></div>":"BR"===t.enterKey?t.enableHtmlEncode?"&lt;br/&gt;":"<br/>":t.enableHtmlEncode?"&lt;p&gt;&lt;br/&gt;&lt;/p&gt;":"<p><br/></p>",n}function wr(e,t){var n=document.createElement("div"),i=document.createElement("div"),r=n.childNodes;if(n.innerHTML=e,n.setAttribute("class","tempDiv"),r.length>0){for(var s=void 0,a=void 0,l=void 0;n.firstChild;){for(var d=n.querySelectorAll(en),c=0;c<d.length;c++)d[c].innerHTML="<br>";var h=n.querySelectorAll("p");for(c=0;c<h.length;c++)0===h[c].textContent.trim().length&&1===h[c].childNodes.length&&"#text"===h[c].childNodes[0].nodeName&&(0,o.isNullOrUndefined)(h[c].childNodes[0].textContent.match(/\u00a0/g))&&(h[c].innerHTML="<br>");var p=n.querySelectorAll(tn);for(c=0;c<p.length;c++)p[c].innerHTML="&ZeroWidthSpace;";"BR"!==t.enterKey&&("#text"===n.firstChild.nodeName&&(n.firstChild.textContent.indexOf("\n")<0||""!==n.firstChild.textContent.trim())||hr.indexOf(n.firstChild.nodeName.toLocaleLowerCase())>=0)?(s?a.appendChild(n.firstChild):(l="DIV"===t.enterKey?(0,o.createElement)("div"):(0,o.createElement)("p"),i.appendChild(l),l.appendChild(n.firstChild)),a=l,s=!0):"#text"===n.firstChild.nodeName&&("\n"===n.firstChild.textContent||n.firstChild.textContent.indexOf("\n")>=0&&""===n.firstChild.textContent.trim())?(0,o.detach)(n.firstChild):(i.appendChild(n.firstChild),s=!1)}var u=i.querySelectorAll("img");for(c=0;c<u.length;c++)u[c].classList.contains("e-rte-image-unsupported")||(u[c].classList.contains(eo)||u[c].classList.add(eo),u[c].classList.contains(li)||u[c].classList.contains($n)||u[c].classList.contains("e-imgleft")||u[c].classList.contains("e-imgright")||u[c].classList.contains("e-imgcenter")||u[c].classList.add(li))}return i.innerHTML}function Dr(e){return"DIV"===e.enterKey?e.enableHtmlEncode?"&lt;div&gt;&lt;br/&gt;&lt;/div&gt;":"<div><br/></div>":"BR"===e.enterKey?e.enableHtmlEncode?"&lt;br/&gt;":"<br/>":e.enableHtmlEncode?"&lt;p&gt;&lt;br/&gt;&lt;/p&gt;":"<p><br/></p>"}function Mr(e){return"<p><br></p>"===e||"&lt;p&gt;&lt;br&gt;&lt;/p&gt;"===e||"<div><br></div>"===e||"&lt;div&gt;&lt;br&gt;&lt;/div&gt;"===e||"<br>"===e||"&lt;br&gt;"===e||""===e}function Ar(e){return e.replace(/&amp;/g,"&").replace(/&amp;lt;/g,"<").replace(/&lt;/g,"<").replace(/&amp;gt;/g,">").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&amp;nbsp;/g," ").replace(/&quot;/g,"")}function Br(e,t){if(t.enableHtmlSanitizer){var n=o.SanitizeHtmlHelper.beforeSanitize();n.selectors.tags[2]&&n.selectors.tags[2].indexOf("iframe")>-1&&(n.selectors.tags[2]="iframe:not(.e-rte-embed-url)");(0,o.extend)(n,n,{cancel:!1,helper:null}),t.trigger("beforeSanitizeHtml",n),n.cancel&&!(0,o.isNullOrUndefined)(n.helper)?e=n.helper(e):n.cancel||(e=o.SanitizeHtmlHelper.serializeValue(n,e))}return e=Rr(e)}function Rr(e){var t=(0,o.createElement)("div");e=e.replace(/&(times|divide|ne)/g,"&amp;amp;$1"),t.innerHTML=e,t.querySelectorAll("font").forEach((function(e){var t=document.createElement("span"),n=(e.getAttribute("style")||"").replace(/style:/gi,"").trim();(0,o.isNullOrUndefined)(n)||""===n.trim()||n.endsWith(";")||(n+=";"),Array.from(e.attributes).forEach((function(e){var t=e.name.toLowerCase(),i=e.value;switch(t){case"size":n+="font-size:"+i+";";break;case"face":n+="font-family:"+i+";";break;case"bgcolor":n+="background-color:"+i+";";break;case"style":break;default:n+=t+":"+i+";"}})),(0,o.isNullOrUndefined)(n)||""===n.trim()||(n=n.replace(/;;+/g,";"),t.style.cssText=n),t.innerHTML=e.innerHTML,(0,o.isNullOrUndefined)(e.parentNode)||e.parentNode.replaceChild(t,e)}));var n=t.innerHTML;return t.remove(),n}function Ir(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],i=atob(t[1]),o=i.length,r=new Uint8Array(o);o--;)r[o]=i.charCodeAt(o);return new Blob([r],{type:n})}function Ur(e,t,n){for(var i=0;t.length>i;i++)if(t[i].value===n.value||t[i].value===n.subCommand)return e.localeObj.getConstant(t[i].locale);return n.text}function Pr(e,t){if(t&&"HTML"===t&&e){var n=document.createElement("div");n.innerHTML=e,n.querySelectorAll(".e-img-inner").forEach((function(e){e.setAttribute("contenteditable","true")})),e=n.innerHTML,n.remove()}return e}function Hr(e,t){if(e&&t){var n=document.createElement("div");if("HTML"===t){n.innerHTML=e,n.querySelectorAll(".e-img-inner").forEach((function(e){e.setAttribute("contenteditable","false")}));var i=n.querySelectorAll(".e-column-resize, .e-row-resize, .e-table-box, .e-table-rhelper, .e-img-resize, .e-vid-resize");if(i.length>0)for(var r=0;r<i.length;r++)(0,o.detach)(i[r]);jr(n)}else n.textContent=e;return"Markdown"===t?n.textContent.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):n.innerHTML}return e}function jr(e){for(var t=[no,Pi,ji,Hi,oo,io,to,ro],n=0;n<t.length;n++){var i=e.querySelectorAll("."+t[n]);if((0,o.removeClass)(i,t[n]),0!==i.length)for(var r=0;r<i.length;r++)0===i[r].classList.length&&i[r].removeAttribute("class"),"IMG"!==i[r].nodeName&&"VIDEO"!==i[r].nodeName||""===i[r].style.outline||(i[r].style.outline="")}e.querySelectorAll('[class=""]').forEach((function(e){e.removeAttribute("class")}))}function Fr(e){Ko.forEach((function(t,n){Ko[n].text=Ur(e,rr,Ko[n])})),Xo.forEach((function(t,n){Xo[n].text=Ur(e,sr,Xo[n])})),$o.forEach((function(t,n){$o[n].text=Ur(e,ar,$o[n])})),Zo.forEach((function(t,n){Zo[n].text=Ur(e,lr,Zo[n])}))}var qr=function(){function e(e){this.parent=e}return e.prototype.renderPanel=function(){var e=this.parent,t=this.parent.createElement("div",{className:"e-rte-content",id:this.parent.getID()+"rte-view"}),n=xr(e.value,e);this.editableElement=this.parent.createElement("div",{className:"e-content",id:this.parent.getID()+"_rte-edit-view",attrs:{contenteditable:"true"}}),(0,o.isNullOrUndefined)(this.parent.fontFamily.default)||(this.editableElement.style.fontFamily=this.parent.fontFamily.default),(0,o.isNullOrUndefined)(this.parent.fontSize.default)||(this.editableElement.style.fontSize=this.parent.fontSize.default),this.editableElement.innerHTML=n,t.appendChild(this.editableElement),this.setPanel(t),e.rootContainer.appendChild(t)},e.prototype.getPanel=function(){return this.contentPanel},e.prototype.getEditPanel=function(){return this.editableElement},e.prototype.getText=function(){var e=this.getEditPanel().innerText;return"\n"===e?"":e},e.prototype.setPanel=function(e){this.contentPanel=e},e.prototype.getDocument=function(){return this.getEditPanel().ownerDocument},e}(),zr=function(){function t(e,t){this.parent=e,this.locator=t,this.renderer=this.locator.getService("rendererFactory"),this.addEventListener()}return t.prototype.render=function(){this.parent;this.contentRenderer=this.renderer.getRenderer(e.Content),this.contentRenderer.renderPanel()},t.prototype.refresh=function(e){void 0===e&&(e={requestType:"refresh"}),this.parent.notify(e.requestType+"-begin",e)},t.prototype.destroy=function(){(0,o.isNullOrUndefined)(this.parent)||(this.removeEventListener(),this.locator.destroy(),this.renderer.destroy())},t.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(T,this.refresh,this),this.parent.on(L,this.keyUp,this))},t.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(T,this.refresh),this.parent.off(L,this.keyUp))},t.prototype.keyUp=function(e){if("HTML"===this.parent.editorMode)switch(e.args.which){case 46:case 8:var t=this.parent.contentModule.getEditPanel().childNodes;if(0===t.length||1===t.length&&0===t[0].childNodes.length&&("BR"===t[0].tagName||("P"===t[0].tagName||"DIV"===t[0].tagName)&&""===t[0].textContent)){var n=this.parent.contentModule.getEditPanel();"DIV"===this.parent.enterKey?n.innerHTML="<div><br/></div>":"BR"===this.parent.enterKey?n.innerHTML="<br/>":n.innerHTML="<p><br/></p>",this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),n.childNodes[0],0)}}},t}(),_r=c(215),Vr=c(295),Wr=c(197),Qr=c(323),Kr=function(){function e(){}return e.prototype.getFormattedNode=function(e,t,n){var i=this.getFormatParent(e,t,n);return null!==i&&i!==n?i:null},e.prototype.getFormatParent=function(e,t,n){do{e=e.parentNode}while(e&&e!==n&&!this.isFormattedNode(e,t));return e},e.prototype.isFormattedNode=function(t,n){switch(n){case"bold":return e.isBold(t);case"italic":return e.isItalic(t);case"underline":return e.isUnderline(t);case"strikethrough":return e.isStrikethrough(t);case"superscript":return e.isSuperscript(t);case"subscript":return e.isSubscript(t);case"fontcolor":return this.isFontColor(t);case"fontname":return this.isFontName(t);case"fontsize":return this.isFontSize(t);case"backgroundcolor":return this.isBackgroundColor(t);case"inlinecode":return e.isCode(t);default:return!1}},e.isBold=function(e){return-1!==["strong","b"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"bold"!==e.style.fontWeight)},e.isItalic=function(e){return-1!==["em","i"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"italic"!==e.style.fontStyle)},e.isUnderline=function(e){return-1!==["u"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"underline"!==e.style.textDecoration&&"underline"!==e.style.textDecorationLine)},e.isStrikethrough=function(e){return-1!==["del","strike","s"].indexOf(e.nodeName.toLowerCase())||!(-1===this.inlineTags.indexOf(e.nodeName.toLowerCase())||!e.style||"line-through"!==e.style.textDecoration&&"line-through"!==e.style.textDecorationLine)},e.isSuperscript=function(e){return-1!==["sup"].indexOf(e.nodeName.toLowerCase())},e.isSubscript=function(e){return-1!==["sub"].indexOf(e.nodeName.toLowerCase())},e.prototype.isFontColor=function(t){var n=t.style&&t.style.color;return-1!==e.inlineTags.indexOf(t.nodeName.toLowerCase())&&null!==n&&""!==n&&void 0!==n},e.prototype.isBackgroundColor=function(t){var n=t.style&&t.style.backgroundColor;return-1!==e.inlineTags.indexOf(t.nodeName.toLowerCase())&&null!==n&&""!==n&&void 0!==n},e.prototype.isFontSize=function(t){var n=t.style&&t.style.fontSize;return-1!==e.inlineTags.indexOf(t.nodeName.toLowerCase())&&null!==n&&""!==n&&void 0!==n},e.prototype.isFontName=function(t){var n=t.style&&t.style.fontFamily;return-1!==e.inlineTags.indexOf(t.nodeName.toLowerCase())&&null!==n&&""!==n&&void 0!==n},e.isCode=function(e){return-1!==["code"].indexOf(e.nodeName.toLowerCase())},e.inlineTags=["a","abbr","acronym","b","bdo","big","cite","code","dfn","em","font","i","kbd","label","q","samp","small","span","strong","sub","sup","tt","u","var","del"],e}(),Gr="INSERT-IMAGE",Xr="INSERT-AUDIO",Yr="INSERT-VIDEO",Jr="INSERT-TABLE",$r="INSERT-LINK",Zr="INSERT-ROW",es="INSERT-COLUMN",ts="DELETE-ROW",ns="DELETE-COLUMN",is="REMOVE-TABLE",os="TABLE-HEADER",rs="TABLE_VERTICAL_ALIGN",ss="TABLE_MERGE",as="TABLE_VERTICAL_SPLIT",ls="TABLE_HORIZONTAL_SPLIT",ds="TABLE_DASHED",cs="TABLE_ALTERNATE",hs="TABLE_BACKGROUND_COLOR",ps="TABLE_MOVE",us="alignment-type",ms="indent-type",fs="p",gs=["address","article","aside","audio","blockquote","canvas","details","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","ol","output","p","pre","section","table","tbody","td","tfoot","th","thead","tr","ul","video","body"],bs=["td","th"],vs=["table","tbody","td","tfoot","th","thead","tr"],ys="selection-type",Cs="inserthtml-type",Ns="insert-text-type",Es="clear-type",Ss=["area","base","br","embed","hr","img","input","param","source","track","wbr","iframe","td","table"],Ts=["word","excel","onenote"],Os=["article","aside","blockquote","body","canvas","details","div","fieldset","figure","footer","form","header","li","main","nav","noscript","section"],Ls={h6:"###### ",h5:"##### ",h4:"#### ",h3:"### ",h2:"## ",h1:"# ",blockquote:"> ",pre:"```\n",p:""},ks={Bold:"**",Italic:"*",StrikeThrough:"~~",InlineCode:"`",SubScript:"<sub>",SuperScript:"<sup>",UpperCase:"A-Z",LowerCase:"a-z"},xs={OL:"1. ",UL:"- "},ws={"toolbar-focus":"alt+f10",escape:"escape",backspace:"backspace","insert-link":"ctrl+k","insert-image":"ctrl+shift+i","insert-audio":"ctrl+shift+a","insert-video":"ctrl+alt+v","insert-table":"ctrl+shift+e",undo:"ctrl+z",redo:"ctrl+y",copy:"ctrl+c",cut:"ctrl+x",paste:"ctrl+v",bold:"ctrl+b",italic:"ctrl+i",underline:"ctrl+u",strikethrough:"ctrl+shift+s",uppercase:"ctrl+shift+u",lowercase:"ctrl+shift+l",superscript:"ctrl+shift+=",subscript:"ctrl+=",indents:"ctrl+]",outdents:"ctrl+[","html-source":"ctrl+shift+h","full-screen":"ctrl+shift+f","decrease-fontsize":"ctrl+shift+<","increase-fontsize":"ctrl+shift+>","justify-center":"ctrl+e","justify-full":"ctrl+j","justify-left":"ctrl+l","justify-right":"ctrl+r","clear-format":"ctrl+shift+r","ordered-list":"ctrl+shift+o","unordered-list":"ctrl+alt+o",space:"space",enter:"enter",tab:"tab",delete:"delete","format-copy":"alt+shift+c","format-paste":"alt+shift+v",inlinecode:"ctrl+`"},Ds={"toolbar-focus":"alt+f10",escape:"27","insert-link":"ctrl+k","insert-image":"ctrl+shift+i","insert-table":"ctrl+shift+e",undo:"ctrl+z",redo:"ctrl+y",copy:"ctrl+c",cut:"ctrl+x",paste:"ctrl+v",bold:"ctrl+b",italic:"ctrl+i",strikethrough:"ctrl+shift+s",uppercase:"ctrl+shift+u",lowercase:"ctrl+shift+l",superscript:"ctrl+shift+=",subscript:"ctrl+=","full-screen":"ctrl+shift+f","ordered-list":"ctrl+shift+o","unordered-list":"ctrl+alt+o"},Ms={b:["strong"],strong:["b"],i:["emp","cite"],emp:["i","cite"],cite:["i","emp"]},As={first:"MsoListParagraphCxSpFirst",middle:"MsoListParagraphCxSpMiddle",last:"MsoListParagraphCxSpLast"},Bs=["BR","IMG"],Rs={topLeft:[-1,-1],topRight:[1,-1],botRight:[1,1],botLeft:[-1,1]},Is=["ArrowUp","ArrowDown","Enter","Tab","Escape"];function Us(){var e=!1;return o.Browser.isDevice&&o.Browser.isIos&&(e=!0),e}function Ps(e,t){if("BODY"===e.nodeName&&!(0,o.isNullOrUndefined)(t)){var n=top.window.document.querySelector(t);(0,o.isNullOrUndefined)(n)||n.contentWindow.focus()}}function Hs(e,t){var n="BODY"===t.nodeName?t.ownerDocument.defaultView.frameElement.closest(".e-richtexteditor"):t.closest(".e-richtexteditor"),i=n.style.height;if(0!==e.getSelection().rangeCount){var r=e.getSelection().getRangeAt(0),s="#text"===r.startContainer.nodeName?r.startContainer.parentElement:r.startContainer,a=s.getBoundingClientRect(),l=a.top,d=a.bottom,c=n.getBoundingClientRect(),h=n.querySelectorAll(".e-count-enabled, .e-resize-enabled").length>0;"BODY"===t.nodeName?"auto"===i?window.innerHeight<l&&s.scrollIntoView(!1):(l>t.getBoundingClientRect().height||d>c.bottom)&&s.scrollIntoView({block:"nearest",inline:"nearest"}):"auto"===i?window.innerHeight<l&&s.scrollIntoView({block:"end",inline:"nearest"}):d>c.bottom&&(n.querySelector(".e-rte-content").scrollTop+=d-c.bottom+(h?20:0));var p=t.closest('div[style*="overflow-y: scroll"]');if(!(0,o.isNullOrUndefined)(p)){var u=p.getBoundingClientRect();d>u.bottom&&(p.scrollTop+=d-u.bottom)}}}function js(e,t,n){for(var i=0;i<t.length;i++)0===i?e.splice(n+i,1,t[i]):e.splice(n+i,0,t[i]);return e}function Fs(e,t){(0,o.removeClass)(e,t);for(var n=0;n<e.length;n++)0===e[n].classList.length&&e[n].getAttribute("class")&&e[n].removeAttribute("class");return e}var qs,zs=function(){function e(e,t){this.BLOCK_TAGS=["p","h1","h2","h3","h4","h5","h6","blockquote","li","pre","td","th","div","hr","section","figure"],this.BASIC_FORMATS=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],this.root=e,this.currentDocument=t}return e.prototype.getBlockNodes=function(){var e=[];if((0,o.isNullOrUndefined)(this.root.querySelector(".e-cell-select")))return e;var t=this.root.querySelector(".e-cell-select").closest("table").querySelectorAll(".e-cell-select");if((0,o.isNullOrUndefined)(t)||t.length<2)return e;for(var n=0;n<t.length;n++)this.addBlockNodes(t[n],e);return this.wrapParagraphNodes(e),e},e.prototype.addBlockNodes=function(e,t){var n=e.childNodes;if(0!==n.length)for(var i=0;i<n.length;i++){var o=n[i];t.indexOf(o.parentElement)>=0||(!o.parentElement||"TD"!==o.parentElement.nodeName&&"TH"!==o.parentElement.nodeName||1!==o.parentElement.childNodes.length||"BR"===o.nodeName||(o.nodeType,Node.TEXT_NODE),t.push(o.parentElement))}else t.push(e)},e.prototype.getTextNodes=function(){var e=[];if((0,o.isNullOrUndefined)(this.root.querySelector(".e-cell-select")))return e;var t=this.root.querySelector(".e-cell-select").closest("table").querySelectorAll(".e-cell-select");if((0,o.isNullOrUndefined)(t)||t.length<2)return e;for(var n=0;n<t.length;n++)this.addTextNodes(t[n],e);return e},e.prototype.addTextNodes=function(e,t){var n=e.childNodes;if(0===n.length&&("TD"===e.nodeName||"TH"===e.nodeName)){var i=this.currentDocument.createTextNode("​");return e.appendChild(i),void t.push(i)}if(1===n.length&&("TD"===e.nodeName||"TH"===e.nodeName)&&"BR"===n[0].nodeName){i=this.currentDocument.createTextNode("​");return e.insertBefore(i,n[0]),void t.push(i)}for(var o=0;o<n.length;o++){var r=n[o];r.nodeType===Node.TEXT_NODE?t.push(r):r.nodeType===Node.ELEMENT_NODE&&this.addTextNodes(r,t)}},e.prototype.wrapParagraphNodes=function(e){for(var t=Array.from(e),n=0;n<t.length;n++){var i=t[n];if("TD"===i.nodeName||"TH"===i.nodeName)if(1!==i.childNodes.length||"BR"!==i.childNodes[0].nodeName&&i.childNodes[0].nodeType!==Node.TEXT_NODE){var r=e.indexOf(i);this.wrapInlineNodes(i,e,r)}else{var s=i.childNodes[0],a=(0,o.createElement)("p");s.parentElement.insertBefore(a,s),a.appendChild(s);var l=e.indexOf(i);e[l]=a}}for(n=0;n<e.length;n++){var d=e[n];if("LI"===d.nodeName&&1===d.childNodes.length){var c=d.childNodes[0];c.nodeType===Node.ELEMENT_NODE&&this.BASIC_FORMATS.indexOf(c.nodeName.toLocaleLowerCase())>=0&&c.textContent===d.textContent&&(e[n]=c)}}},e.prototype.wrapInlineNodes=function(e,t,n){var i=e.childNodes[0],r=(0,o.createElement)("p"),s=[];if((0,o.isNullOrUndefined)(i))return e.appendChild(r),s.push(r),void js(t,s,n);for(;i;)if("BR"===i.nodeName)i.parentNode.insertBefore(r,i),r.appendChild(i),r.childNodes.length>0&&s.indexOf(r)<0&&s.push(r),i=r.nextSibling,r=(0,o.createElement)("p");else if(this.BLOCK_TAGS.indexOf(i.nodeName.toLocaleLowerCase())>=0)if(s.push(i),r.childNodes.length>0)i=r.nextSibling;else{if(i&&"LI"===i.nodeName&&i.querySelectorAll("li").length>0)for(var a=i.querySelectorAll("li"),l=0;l<a.length;l++)s.push(a[l]);i="LI"===i.nodeName&&(0,o.isNullOrUndefined)(i.nextSibling)?i.parentElement.nextSibling:i.nextSibling}else if(i.nodeType===Node.TEXT_NODE){if(""===i.textContent.trim()&&i.textContent.indexOf("​")<0){var d=i.nextSibling;(0,o.detach)(i),i=d;continue}i.parentNode.insertBefore(r,i);var c=i;r.appendChild(c),r.childNodes.length>0&&s.indexOf(r)<0&&s.push(r),i=r.nextSibling}else if("TABLE"===i.nodeName||"UL"===i.nodeName||"OL"===i.nodeName)if("TABLE"===i.nodeName){var h=[],p=i.querySelectorAll("td, th");for(l=0;l<p.length;l++)this.addBlockNodes(p[l],h);this.wrapParagraphNodes(h);for(l=0;l<h.length;l++)s.push(h[l]);i=i.nextSibling}else i=i.firstElementChild;else this.BLOCK_TAGS.indexOf(i.nodeName.toLocaleLowerCase())<0&&(i.parentNode.insertBefore(r,i),r.appendChild(i),r.childNodes.length>0&&s.indexOf(r)<0&&s.push(r),i=r.nextSibling);js(t,s,n)},e}(),_s={startSelection:"e-editor-select-start",endSelection:"e-editor-select-end"},Vs=function(){function e(e,t){this.parent=e,this.nodeSelection=new sl(e),this.currentDocument=t,this.tableSelection=new zs(e,t)}return e.prototype.contents=function(e){return e&&"IFRAME"!==e.tagName?Array.prototype.slice.call(e.childNodes||[]):[]},e.prototype.isBlockNode=function(e){return!!e&&e.nodeType===Node.ELEMENT_NODE&&gs.indexOf(e.tagName.toLowerCase())>=0},e.prototype.isLink=function(e){return!!e&&e.nodeType===Node.ELEMENT_NODE&&"a"===e.tagName.toLowerCase()},e.prototype.blockParentNode=function(e){for(;e&&e.parentNode!==this.parent&&(!e.parentNode||!this.hasClass(e.parentNode,"e-node-inner"));null)if(e=e.parentNode,this.isBlockNode(e))return e;return e},e.prototype.rawAttributes=function(e){var t={},n=e.attributes;if(n.length>0)for(var i=0;i<n.length;i++){var o=n[i];t[o.nodeName]=o.value}return t},e.prototype.attributes=function(e){if(!e)return"";for(var t="",n=this.rawAttributes(e),i=Object.keys(n).sort(),o=0;o<i.length;o++){var r=i[o],s=n[""+r];s.indexOf("'")<0&&s.indexOf('"')>=0?t+=" "+r+"='"+s+"'":s.indexOf('"')>=0&&s.indexOf("'")>=0?t+=" "+r+'="'+(s=s.replace(/"/g,"&quot;"))+'"':t+=" "+r+'="'+s+'"'}return t},e.prototype.clearAttributes=function(e){for(var t=e.attributes,n=t.length-1;n>=0;n--){var i=t[n];e.removeAttribute(i.nodeName)}},e.prototype.openTagString=function(e){return"<"+e.tagName.toLowerCase()+this.attributes(e)+">"},e.prototype.closeTagString=function(e){return"</"+e.tagName.toLowerCase()+">"},e.prototype.createTagString=function(e,t,n){return"<"+e.toLowerCase()+this.attributes(t)+">"+n+"</"+e.toLowerCase()+">"},e.prototype.isList=function(e){return!!e&&["UL","OL"].indexOf(e.tagName)>=0},e.prototype.isElement=function(e){return e===this.parent},e.prototype.isEditable=function(e){return(!e.getAttribute||"true"===e.getAttribute("contenteditable"))&&["STYLE","SCRIPT"].indexOf(e.tagName)<0},e.prototype.hasClass=function(e,t){return e&&e.classList&&e.classList.contains(t)},e.prototype.replaceWith=function(e,t){e.parentNode.insertBefore(this.parseHTMLFragment(t),e),(0,o.detach)(e)},e.prototype.parseHTMLFragment=function(e){var t=(0,o.createElement)("template");return t.innerHTML=e,t.content instanceof DocumentFragment?t.content:document.createRange().createContextualFragment(e)},e.prototype.wrap=function(e,t){return e.parentNode.insertBefore(t,e),(t=e.previousSibling).appendChild(e),t},e.prototype.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},e.prototype.wrapInner=function(e,t){for(e.appendChild(t),(t=e.querySelector(".e-rte-wrap-inner")).classList.remove("e-rte-wrap-inner"),0===t.classList.length&&t.removeAttribute("class");e.firstChild!==t;)t.appendChild(e.firstChild);return t},e.prototype.unWrap=function(e){var t=e&&e.parentNode;if(!t)return[];for(var n=[];e.firstChild&&" "!==e.textContent;)n.push(e.firstChild),t.insertBefore(e.firstChild,e);return n=n.length>0?n:[e.parentNode],t.removeChild(e),n},e.prototype.getSelectedNode=function(e,t){return e.nodeType===Node.ELEMENT_NODE&&e.childNodes.length>0&&e.childNodes[t-1]&&e.childNodes[t-1].nodeType===Node.ELEMENT_NODE&&(e.childNodes[t-1].classList.contains(_s.startSelection)||e.childNodes[t-1].classList.contains(_s.endSelection))?e=e.childNodes[t-1]:e.nodeType===Node.ELEMENT_NODE&&e.childNodes.length>0&&e.childNodes[t]&&(e=e.childNodes[t]),e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),e},e.prototype.nodeFinds=function(e,t){for(var n=[],i=0;i<t.length;i++)e.contains(t[i])&&e!==t[i]&&n.push(t[i]);return n},e.prototype.isEditorArea=function(){var e;for(e=this.getRangePoint(0).commonAncestorContainer;e&&!this.isElement(e);null)e=e.parentNode;return!!this.isElement(e)},e.prototype.getRangePoint=function(e){var t=this.getSelection(),n=[];if(t&&t.getRangeAt&&t.rangeCount){n=[];for(var i=0;i<t.rangeCount;i++)n.push(t.getRangeAt(i))}else n=[this.currentDocument.createRange()];return void 0!==e?n[e]:n},e.prototype.getSelection=function(){return this.nodeSelection.get(this.currentDocument)},e.prototype.getPreviousNode=function(e){for(e=e.previousElementSibling;e&&"\n"===e.textContent;null)e=e.previousElementSibling;return e},e.prototype.encode=function(e){var t=document.createElement("div");return t.innerText=e,t.innerHTML.replace(/<br\s*[\/]?>/gi,"\n")},e.prototype.saveMarker=function(e){var t,n,i=this.parent.querySelector("."+_s.startSelection),o=this.parent.querySelector("."+_s.endSelection);if(this.hasClass(i,_s.startSelection)&&i.classList.length>1){var r=this.createTagString(fs,i,this.encode(i.textContent));this.replaceWith(i,r),(i=this.parent.querySelector("."+_s.startSelection)).classList.remove(_s.startSelection),t=i.childNodes[0]}else t=this.unWrap(i)[0];if(this.hasClass(o,_s.endSelection)&&o.classList.length>1){r=this.createTagString(fs,o,this.encode(o.textContent));this.replaceWith(o,r),(o=this.parent.querySelector("."+_s.endSelection)).classList.remove(_s.endSelection),n=o.childNodes[0]}else n=o?this.unWrap(o)[0]:t;return e.startContainer=e.getNodeArray(t,!0),e.endContainer=e.getNodeArray(n,!1),e},e.prototype.marker=function(e,t){return'<span class="'+e+'">'+t+"</span>"},e.prototype.setMarker=function(e){var t=e.range,n=t.startContainer.childNodes,i=n.length>1&&"TABLE"===n[0].nodeName&&0===t.startOffset,r=n.length>1&&"IMAGE"===n[0].nodeName&&1===t.endOffset&&"#text"===t.endContainer.nodeName&&0===t.endContainer.textContent.length,s=(i?function(e){var t=e;do{t.childNodes.length>0&&(t=t.childNodes[0])}while(t.childNodes.length>0);return t}(n[t.startOffset+1]):n[t.startOffset>0?t.startOffset-1:t.startOffset])||t.startContainer,a=t.endContainer.childNodes[t.endOffset>0?r?t.endOffset:t.endOffset-1:t.endOffset]||t.endContainer;if(s.nodeType===Node.ELEMENT_NODE&&a.nodeType===Node.ELEMENT_NODE&&(s.contains(a)||a.contains(s))){var l=s.contains(a)?s:a;if(l.nodeType!==Node.TEXT_NODE){for(var d=[],c=[],h=l;l.contains(h);null)d.indexOf(h)<0&&h.childNodes&&h.childNodes.length?(d.push(h),h=h.childNodes[0]):h.nextSibling?h=h.nextSibling:h.parentNode&&(h=h.parentNode,d.push(h)),c.indexOf(h)<0&&(h.nodeType===Node.TEXT_NODE||bs.indexOf(h.parentNode.tagName.toLocaleLowerCase())>=0&&("BR"===h.tagName||"IMG"===h.tagName))&&c.push(h);c.length&&(s=s.contains(a)?c[0]:s,a=c[c.length-1])}}if(s!==a){if(s.nodeType!==Node.TEXT_NODE&&("BR"===s.tagName&&bs.indexOf(s.parentNode.tagName.toLocaleLowerCase())>=0||"IMG"===s.tagName))this.replaceWith(s,this.marker(_s.startSelection,this.encode(s.textContent))),t.startContainer.querySelector("."+_s.startSelection).appendChild(s);else if(3!==s.nodeType&&"#text"!==s.nodeName&&"BR"!==s.nodeName){var p=this.marker(_s.startSelection,"");(0,o.append)([this.parseHTMLFragment(p)],s)}else this.replaceWith(s,this.marker(_s.startSelection,this.encode(s.textContent)));if(a.nodeType!==Node.TEXT_NODE&&"BR"===a.tagName&&bs.indexOf(a.parentNode.tagName.toLocaleLowerCase())>=0)this.replaceWith(a,this.marker(_s.endSelection,this.encode(a.textContent))),t.endContainer.querySelector("."+_s.endSelection).appendChild(a);else this.ensureSelfClosingTag(a,_s.endSelection,t)}else this.ensureSelfClosingTag(s,_s.startSelection,t)},e.prototype.ensureSelfClosingTag=function(e,t,n){var i=!1;if(3===e.nodeType)this.replaceWith(e,this.marker(t,this.encode(e.textContent)));else if("BR"===e.tagName){this.replaceWith(e,this.marker(t,this.encode(e.textContent)));var r=n.startContainer.querySelector("."+t);r&&r.parentElement.appendChild(e)}else{var s=(0,o.isNullOrUndefined)(e.parentElement)?"":e.parentElement.tagName.toLocaleLowerCase();if("IMG"===e.tagName&&"p"!==s&&"div"!==s){var a=document.createElement("p");e.parentElement.insertBefore(a,e),a.appendChild(e),e=a.children[0]}if("TABLE"===e.tagName)if(i=!0,""===e.textContent){var l=e.querySelectorAll("td");e=l[l.length-1],e=(0,o.isNullOrUndefined)(e.childNodes[0])?e:e.childNodes[0]}else{for(var d=e.lastChild;3!==d.nodeType&&"#text"!==d.nodeName&&"BR"!==d.nodeName;)d=d.lastChild;e=d}for(var c=0;c<Bs.length;c++)e=e.tagName!==Bs[c]||i?e:e.parentNode;if(3===e.nodeType&&"#text"===e.nodeName)this.replaceWith(e,this.marker(t,this.encode(e.textContent)));else if("BR"===e.nodeName){this.replaceWith(e,this.marker(_s.endSelection,this.encode(e.textContent))),n.endContainer.querySelector("."+_s.endSelection).appendChild(e)}else{var h=this.marker(t,"");(0,o.append)([this.parseHTMLFragment(h)],e)}}},e.prototype.createTempNode=function(e){var t=e.textContent;if("BR"===e.tagName){var n="<"+fs+"></"+fs+">",i=e.parentNode;bs.indexOf(i.tagName.toLocaleLowerCase())>=0&&(e=this.wrap(e,this.parseHTMLFragment(n)))}else if(e.nodeType!==Node.TEXT_NODE&&(e.classList.contains(_s.startSelection)||e.classList.contains(_s.endSelection))||t.replace(/\n/g,"").replace(/(^ *)|( *$)/g,"").length>0||t.length&&t.indexOf("\n")<0){n="<"+fs+"></"+fs+">";var o=e;e=this.wrap(e,this.parseHTMLFragment(n)),!(o.nodeType===Node.ELEMENT_NODE&&o.firstChild&&"BR"===o.firstChild.nodeName&&(o.classList.contains(_s.startSelection)||o.classList.contains(_s.endSelection)))&&e.nextElementSibling&&"BR"===e.nextElementSibling.tagName&&e.appendChild(e.nextElementSibling)}return e},e.prototype.getImageTagInSelection=function(){var e=this.getSelection();return this.isEditorArea()&&e.rangeCount?e.focusNode.querySelectorAll("img"):null},e.prototype.gatherElementsAround=function(e,t){var n=(0,o.createElement)(t),i=e.previousSibling,r=e.parentElement;"e-editor-select-start"===r.className?r.parentNode.insertBefore(n,r):r&&r.insertBefore(n,e);for(var s=0;null!==i&&"BR"!==i.nodeName&&!this.isBlockNode(i);){var a=i.previousSibling;3!==i.nodeType&&1!==i.nodeType||(0===s?n.appendChild(i):n.insertBefore(i,n.firstChild)),i=a,s++}for(n.appendChild(e),i=n.nextSibling?n.nextSibling:n.parentElement.nextSibling;null!==i&&"BR"!==i.nodeName&&!this.isBlockNode(i);){var l=i.nextSibling?i.nextSibling:i.parentElement.nextSibling;3!==i.nodeType&&1!==i.nodeType||n.appendChild(i),i=l}return n},e.prototype.convertToBlockNodes=function(e,t){if(e.length>1)for(var n=0,i=e[0];!(0,o.isNullOrUndefined)(i);){if("BR"===i.nodeName){var r=i.nextSibling;(0,o.detach)(i),i=r}if(!(0,o.isNullOrUndefined)(i)){e[n]=t?"LI"===i.nodeName||this.isBlockNode(i)?i:this.gatherElementsAround(i,t?"p":"div"):this.isBlockNode(e[n])?e[n]:this.gatherElementsAround(i,t?"p":"div");var s="LI"===e[n].nodeName?e[n].parentElement:e[n],a="#text"===s.nodeName?s.parentElement:s;null!==(i=(0,o.isNullOrUndefined)(a.querySelector(".e-editor-select-end"))&&(0,o.isNullOrUndefined)((0,o.closest)(i,".e-editor-select-end"))?s.nextSibling:null)||(0,o.isNullOrUndefined)(s.nextSibling)||"BR"!==s.nextSibling.nodeName||(0,o.detach)(s.nextSibling)}n++}else this.isBlockNode(e[0])||(e[0]=this.gatherElementsAround(e[0],t?"p":"div"),(0,o.isNullOrUndefined)(e[0].nextSibling)||"BR"!==e[0].nextSibling.nodeName||(0,o.detach)(e[0].nextSibling));return e},e.prototype.blockNodes=function(e){var t=[],n=this.getSelection(),i=this.tableSelection.getBlockNodes();if(i.length>0)return i;if(this.isEditorArea()&&n.rangeCount)for(var r=this.getRangePoint(),s=function(n){var i=void 0,s=r[n],l=a.getSelectedNode(s.startContainer,s.startOffset),d=a.getSelectedNode(s.endContainer,s.endOffset);a.isBlockNode(l)&&t.indexOf(l)<0&&t.push(l),i=a.blockParentNode(l);var c=a.blockParentNode(d);if(i&&t.indexOf(i)<0)if(!(0,o.isNullOrUndefined)(e)&&e){var h=["TD","TH"];if([s.commonAncestorContainer,i,c].some((function(e){return-1!==h.indexOf(e.nodeName)}))){var p=a.getPreBlockNodeCollection(s);p.length>1?a.wrapWithBlockNode(p,t):p.length>0&&(l!==d&&"BR"!==l.nodeName||l===d&&"SPAN"===l.nodeName&&(l.classList.contains(_s.startSelection)||l.classList.contains(_s.endSelection)))&&t.push(a.createTempNode(l))}else t.push(i)}else if(bs.indexOf(i.tagName.toLocaleLowerCase())>=0&&("BR"===l.tagName||l.nodeType===Node.TEXT_NODE||l.classList.contains(_s.startSelection)||l.classList.contains(_s.endSelection))){var u=l.previousSibling&&l.previousSibling.nodeType===Node.TEXT_NODE?l.previousSibling:l;l.nextSibling||l.previousSibling||"BR"!==l.tagName?t.push(a.createTempNode(u)):t.push(u)}else t.push(i);for(var m=[],f=l;f!==d&&f!==a.parent;null)m.indexOf(f)<0&&f.childNodes&&f.childNodes.length?(m.push(f),f=f.childNodes[0]):f&&8!==f.nodeType&&("BR"===f.tagName||f.nodeType===Node.TEXT_NODE&&""!==f.textContent.trim()||f.nodeType!==Node.TEXT_NODE&&(f.classList.contains(_s.startSelection)||f.classList.contains(_s.endSelection)))&&bs.indexOf(f.parentNode.tagName.toLocaleLowerCase())>=0?f=a.createTempNode(f):f.nextSibling&&8!==f.nextSibling.nodeType&&("BR"===f.nextSibling.tagName||f.nextSibling.nodeType===Node.TEXT_NODE||f.nextSibling.classList.contains(_s.startSelection)||f.nextSibling.classList.contains(_s.endSelection))&&bs.indexOf(f.nextSibling.parentNode.tagName.toLocaleLowerCase())>=0?f=a.createTempNode(f.nextSibling):f.nextSibling?f=f.nextSibling:f.parentNode&&(f=f.parentNode,m.push(f)),t.indexOf(f)<0&&f.nodeType===Node.ELEMENT_NODE&&bs.indexOf(f.parentNode.tagName.toLocaleLowerCase())>=0&&(f.classList.contains(_s.startSelection)||f.classList.contains(_s.endSelection))&&t.push(a.createTempNode(f)),a.isBlockNode(f)&&a.ignoreTableTag(f)&&m.indexOf(f)<0&&t.indexOf(f)<0&&(f!==d||s.endOffset>0)&&t.push(f),"IMG"===f.nodeName&&"true"===f.parentElement.contentEditable&&t.push(f);(i=a.blockParentNode(d))&&a.ignoreTableTag(i)&&t.indexOf(i)<0&&!(0,o.isNullOrUndefined)(i.previousElementSibling)&&"IMG"!==i.previousElementSibling.tagName&&t.push(i)},a=this,l=0;l<r.length;l++)s(l);for(var d=t.length-1;d>0;d--){if(this.nodeFinds(t[d],t).length){var c=t[d].querySelectorAll("ul, ol");if("LI"===t[d].tagName&&c.length>0)continue;t.splice(d,1)}}return t},e.prototype.ignoreTableTag=function(e){return!(vs.indexOf(e.tagName.toLocaleLowerCase())>=0)},e.prototype.getPreBlockNodeCollection=function(e){var t=this.getSelectedNode(e.startContainer,e.startOffset),n=this.getSelectedNode(e.endContainer,e.endOffset),i=[],r=t.closest("td, th");if((0,o.isNullOrUndefined)(r))return i;for(var s=Array.from(r.childNodes),a=!0,l=this.getClosestInlineParent(t,r,!0),d=this.getClosestInlineParent(n,r,!1),c=0;c<s.length;c++){var h=s[c];l===d&&h===l?(i.push(h),a=!0):h===l?a=!1:h===d&&(i.push(h),a=!0),a||i.push(h)}return i},e.prototype.getClosestInlineParent=function(e,t,n){if(e.nodeType===Node.TEXT_NODE)return e;if(this.isBlockNode(e))return e;for(var i=e,o=!1;i;){var r=i;if(o){if(this.isBlockNode(i))return r;if(n&&i.previousSibling){if(this.isBlockNode(i.previousSibling)||"BR"===i.previousSibling.nodeName)return r;i=i.previousSibling}else{if(n||!i.nextSibling)return i;if(this.isBlockNode(i.nextSibling)||"BR"===i.nextSibling.nodeName)return r;i=i.nextSibling}}else(i=i.parentElement)===t&&(i=r,o=!0)}return null},e.prototype.wrapWithBlockNode=function(e,t){for(var n=(0,o.createElement)("p"),i=0;i<e.length;i++){var r=e[i];if("BR"===r.nodeName)r.parentNode.insertBefore(n,r),n.appendChild(r),n.childNodes.length>0&&t.push(n),n=(0,o.createElement)("p");else{if(this.isBlockNode(r))t.push(r);else{if("#text"===r.nodeName&&""===r.textContent.trim())continue;0===n.childElementCount?(r.parentNode.insertBefore(n,r),n.appendChild(r)):n.appendChild(r)}i===e.length-1&&n.nextElementSibling&&0===n.querySelectorAll("br").length&&"BR"===n.nextElementSibling.nodeName&&n.appendChild(n.nextElementSibling)}}n.childNodes.length>0&&t.indexOf(n)<0&&t.push(n)},e.prototype.getImmediateBlockNode=function(e){for(;e&&gs.indexOf(e.nodeName.toLocaleLowerCase())<0;)e=e.parentNode;return e},e}(),Ws="keydown",Qs="action",Ks="format-type",Gs="keydown-handler",Xs="list-type",Ys="keyup-handler",Js="keyup",$s="model_changed_plugin",Zs="model_changed",ea="ms_word_cleanup_plugin",ta="ms_word_cleanup",na="onBegin",ia="actionBegin",oa="format_painter_actions",ra="blockquote_list_handled",sa="emoji_picker_actions",aa="mouseDown",la="destroy",da="internal_destroy",ca=function(){function e(){}return e.WrapBefore=function(e,t,n){return t.innerText=e.textContent,n?this.AppendBefore(t,e,!0):this.AppendBefore(t,e),e.parentNode&&e.parentNode.removeChild(e),t.childNodes[0]},e.Wrap=function(e,t){return this.AppendBefore(t,e),t.appendChild(e),e},e.unwrap=function(e){for(var t=e.parentNode,n=[];e.firstChild;null)n.push(t.insertBefore(e.firstChild,e));return t.removeChild(e),n},e.AppendBefore=function(e,t,n){return t.parentNode?n?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.insertBefore(e,t):t},e}(),ha=function(){function e(){this.enterAction="P",this.position=-1,this.nodeSelection=new sl}return e.prototype.GetSpliceNode=function(e,t){return t=this.SplitNode(e,t,!0),t=this.SplitNode(e,t,!1)},e.prototype.SplitNode=function(e,t,n){if(t){var i=e.cloneRange(),o=t.parentNode,r=this.nodeSelection.getIndex(t);i.collapse(n),n?i.setStartBefore(t):i.setEndAfter(t);var s=i.extractContents();if(n){if(t=o.childNodes[r],(s=this.spliceEmptyNode(s,!1))&&s.childNodes.length>0)if(!!(1!==s.childNodes.length||"IMG"===s.childNodes[0].nodeName||s.querySelectorAll("img").length>0||!this.isRteElm(s)||""!==s.textContent.trim()||32===s.textContent.charCodeAt(0)||160===s.textContent.charCodeAt(0)))if(t)ca.AppendBefore(s,t);else o.appendChild(s),(a=document.createElement("div")).innerHTML="&#65279;&#65279;",t=a.firstChild,o.appendChild(t)}else if(t=o.childNodes.length>1?o.childNodes[r]:o.childNodes[0],(s=this.spliceEmptyNode(s,!0))&&s.childNodes.length>0)if(!!(1!==s.childNodes.length||"IMG"===s.childNodes[0].nodeName||!this.isRteElm(s)||""!==s.textContent.trim()||32===s.textContent.charCodeAt(0)||160===s.textContent.charCodeAt(0)))if(t)ca.AppendBefore(s,t,!0);else if(o.childNodes.length>1&&o.childNodes.length!==r)t=o.childNodes[o.childNodes.length-1],ca.AppendBefore(s,t,!0),t=t.nextSibling;else{var a;o.appendChild(s),(a=document.createElement("div")).innerHTML="&#65279;&#65279;",o.insertBefore(a.firstChild,o.firstChild),t=o.firstChild}return t}return null},e.prototype.isRteElm=function(e){var t=!0;if(1===e.childNodes.length&&"IMG"!==e.childNodes[0].nodeName)for(var n=e.childNodes[0],i=0;!(0,o.isNullOrUndefined)(n.childNodes)&&i<n.childNodes.length;i++)("IMG"===n.childNodes[i].nodeName||"SPAN"===n.childNodes[i].nodeName&&(n.childNodes[i].classList.contains("e-video-wrap")||n.childNodes[i].classList.contains("e-embed-video-wrap")||n.childNodes[i].classList.contains("e-audio-wrap"))||"TABLE"===n.childNodes[i].nodeName)&&(t=!1);else t=!0;return t},e.prototype.spliceEmptyNode=function(e,t){var n;return(n=1===e.childNodes.length&&"#text"===e.childNodes[0].nodeName&&""===e.childNodes[0].textContent||""===e.textContent?-1:e.childNodes.length-1)>-1&&!t?this.spliceEmptyNode(e.childNodes[n],t):n>-1?this.spliceEmptyNode(e.childNodes[0],t):3===e.nodeType||11===e.nodeType||"IMG"===e.nodeName||e.querySelectorAll("img").length>0||e.classList.contains("e-video-wrap")||e.classList.contains("e-audio-wrap")||e.parentNode.removeChild(e),e},e.prototype.GetCursorStart=function(e,t,n){for(var i=(e=n?e:e.reverse())[0],o=0;o<e.length&&(n?e[o]<t:e[o]>=t);o++)i=e[o];return i},e.prototype.GetCursorRange=function(e,t,n){var i=e.createRange(),o=[];o.push(0);for(var r=this.TrimLineBreak(n.data),s=r.indexOf(" ",0);-1!==s;)o.indexOf(s)<0&&o.push(s),new RegExp("\\s").test(r[s-1])&&o.indexOf(s-1)<0&&o.push(s-1),new RegExp("\\s").test(r[s+1])&&o.push(s+1),s=r.indexOf(" ",s+1);if(o.push(r.length),o.indexOf(t.startOffset)>=0||o.indexOf(t.startOffset-1)>=0&&(1!==t.startOffset||1===t.startOffset&&new RegExp("\\s").test(r[0]))||o[o.length-1]-1===t.startOffset&&t.endOffset!==r.length-1&&!new RegExp("\\s").test(r[0]))i=t,this.position=1;else{var a=this.GetCursorStart(o,t.startOffset,!0);0!==a&&r[a]&&" "===r[a]&&(a+=1),this.position=t.startOffset-a,i.setStart(t.startContainer,a),i.setEnd(t.startContainer,this.GetCursorStart(o,t.startOffset,!1))}return i},e.prototype.GetCursorNode=function(e,t,n){return this.GetSpliceNode(this.GetCursorRange(e,t,n),n)},e.prototype.TrimLineBreak=function(e){return e.replace(/(\r\n\t|\n|\r\t)/gm," ")},e}(),pa=function(){function e(){}return e.Insert=function(e,t,n,i,r){var s,a;"string"==typeof t?((a=document.createElement("div")).innerHTML=t.replace(/&(times|divide|ne)(;?)/g,"&amp;$1$2"),s=i?a:a.firstChild):i&&((0,o.isNullOrUndefined)(t)||(0,o.isNullOrUndefined)(t.classList)||!t.classList.contains("pasteContent"))?((a=document.createElement("div")).appendChild(t),s=a):s=t;var l=(0,o.isNullOrUndefined)(n)?0:n.scrollHeight,d=new sl(n),c=new ha,h=d.getRange(e);if(h.startContainer!==n||h.startContainer!==h.endContainer||0!==h.startOffset||h.startOffset!==h.endOffset||0!==n.textContent.length||"P"!==n.children[0].tagName&&"DIV"!==n.children[0].tagName&&"BR"!==n.children[0].tagName||(d.setSelectionText(e,h.startContainer.children[0],h.startContainer.children[0],0,0),h=d.getRange(e)),h.startContainer===n&&h.startContainer===h.endContainer&&0===h.startOffset&&h.startOffset===h.endOffset&&n.textContent.trim().length>0){var p=this.findFirstTextNode(h.startContainer);(0,o.isNullOrUndefined)(p)||(d.setSelectionText(e,p,p,0,0),h=d.getRange(e))}if("BR"===h.startContainer.nodeName&&0===h.startOffset&&h.startOffset===h.endOffset&&h.startContainer===h.endContainer){var u=Array.prototype.slice.call(h.startContainer.parentElement.childNodes).indexOf(h.startContainer);d.setSelectionText(e,h.startContainer.parentElement,h.startContainer.parentElement,u,u),h=d.getRange(e)}var m=h.startOffset===h.endOffset&&0===h.startOffset&&h.startContainer===h.endContainer,f=h.collapsed,g=this.getNodeCollection(h,d,s),b="table"===s.nodeName.toLowerCase()?(0,o.isNullOrUndefined)(g[0])?h.startContainer:this.closestEle(g[0].parentNode,n):g[0];if(b&&"BR"===b.nodeName&&(b=b.parentNode),b&&"LI"===b.nodeName&&"table"===s.nodeName.toLowerCase()){if(0===g.length){var v=d.processedTableImageCursor(h);if("TABLE"===v.startName||"TABLE"===v.endName){var y=v.start?v.startNode:v.endNode;g.push(y)}}var C=this.closestEle(g[g.length-1].parentNode,n);this.insertTableInList(h,s,b,g[0],c,C,n)}else if(!m||""!==h.startContainer.textContent||"BR"===h.startContainer.nodeName||"BR"===r||"#text"===s.nodeName||(0,o.isNullOrUndefined)(s.children[0])||(0,o.isNullOrUndefined)(s.children[0].tagName)||"IMG"!==s.children[0].tagName||1!==s.children.length||(h.startContainer.innerHTML=""),i||!(0,o.isNullOrUndefined)(s)&&!(0,o.isNullOrUndefined)(s.classList)&&s.classList.contains("pasteContent"))this.pasteInsertHTML(g,s,h,d,c,e,f,b,n,r);else{if(n!==h.startContainer&&(!f&&(b.nodeType!==Node.ELEMENT_NODE||-1===vs.indexOf(b.tagName.toLocaleLowerCase()))||"table"===s.nodeName.toLowerCase()&&b&&-1===vs.indexOf(b.tagName.toLocaleLowerCase()))){var N=c.GetSpliceNode(h,b),E=N.previousSibling,S=N.parentNode;if(1===g.length||"table"===s.nodeName.toLowerCase()&&0===N.childElementCount)d.setSelectionContents(e,N),h=d.getRange(e);else if(S&&"LI"!==S.nodeName){var T=c.GetSpliceNode(h,g[g.length-1].parentElement);T=(0,o.isNullOrUndefined)(T)?N:T,d.setSelectionText(e,N,T,0,3===T.nodeType?T.textContent.length:T.childNodes.length),h=d.getRange(e)}if(null!==h.startContainer.parentElement.closest("ol,ul")&&null!==h.endContainer.parentElement.closest("ol,ul")?function(e,t){if(null!==e.startContainer.parentElement.closest("ol,ul")&&null!==e.endContainer.parentElement.closest("ol,ul")){e.extractContents();var n=("#text"===e.startContainer.nodeName?e.startContainer.parentElement:e.startContainer).querySelectorAll("li");n.length>0&&n.forEach((function(e){(0,o.isNullOrUndefined)(e.firstChild)||"OL"!==e.firstChild.nodeName&&"UL"!==e.firstChild.nodeName||(e.style.listStyleType="none"),""===e.innerHTML.trim()&&e!==t&&e.remove()}))}}(h,S):h.extractContents(),"TABLE"===t.tagName){var O=(0,o.closest)(h.startContainer,"blockquote");if(!(0,o.isNullOrUndefined)(O)&&O.childNodes.length>0)for(var L=O.childNodes.length-1;L>=0;L--){var k=O.childNodes[L];(0,o.isNullOrUndefined)(k)||""!==k.innerText.trim()||(0,o.detach)(k)}this.removeEmptyElements(n,!1,O)}for(var x=0;x<g.length;x++)if(3!==g[x].nodeType&&null!=g[x].parentNode){if("IMG"===g[x].nodeName)continue;g[x].parentNode.removeChild(g[x])}if((0,o.isNullOrUndefined)(E)||(0,o.isNullOrUndefined)(E.parentNode)){for(var w=null;S!==n&&S.firstChild&&""===S.textContent.trim()&&"LI"!==S.nodeName;){w=S,S=S.parentNode}null!==w&&(S=w),S.firstChild&&(S!==n||"TABLE"===s.nodeName&&m&&S===h.startContainer&&S===h.endContainer)?""===S.textContent.trim()&&S!==n&&"LI"===S.nodeName?S.appendChild(s):""===S.textContent.trim()&&S!==n?(ca.AppendBefore(s,S,!1),(0,o.detach)(S)):ca.AppendBefore(s,S.firstChild,!1):(0,o.isNullOrUndefined)(N.previousSibling)&&"TABLE"===t.tagName?S.prepend(s):S.appendChild(s)}else e.contains(E)?ca.AppendBefore(s,E,!0):h.insertNode(s);"IMG"===s.nodeName?this.imageFocus(s,d,e):3!==s.nodeType?d.setSelectionText(e,s,s,0,s.childNodes.length):d.setSelectionText(e,s,s,0,s.textContent.length)}else{var D=(0,o.isNullOrUndefined)(b)?null:(0,o.closest)(b,"li");if((0,o.isNullOrUndefined)(b)||"TD"!==b.nodeName&&"TH"!==b.nodeName||(0,o.isNullOrUndefined)(D)||m)if(h.deleteContents(),m&&""===h.startContainer.textContent&&"BR"!==h.startContainer.nodeName&&(h.startContainer.innerHTML=""),o.Browser.isIE){var M=e.createDocumentFragment();M.appendChild(s),h.insertNode(M)}else if(1===h.startContainer.nodeType&&"hr"===h.startContainer.nodeName.toLowerCase()&&"hr"===h.endContainer.nodeName.toLowerCase()){var A=h.startContainer.nextElementSibling;A&&(A.querySelector("br")&&(0,o.detach)(A.querySelector("br")),A.appendChild(s))}else"BR"===h.startContainer.nodeName?h.startContainer.parentElement.insertBefore(s,h.startContainer):h.insertNode(s);else h.extractContents(),D.appendChild(s),this.removeEmptyNextLI(D);3!==s.nodeType&&s.childNodes.length>0?d.setSelectionText(e,s,s,1,1):"IMG"===s.nodeName?this.imageFocus(s,d,e):3!==s.nodeType?d.setSelectionContents(e,s):d.setSelectionText(e,s,s,s.textContent.length,s.textContent.length)}(0,o.isNullOrUndefined)(n)||!(l<n.scrollHeight)||1!==s.nodeType||"IMG"!==s.nodeName&&(0,o.isNullOrUndefined)(s.querySelector("img"))||Hs(e,n)}},e.removeEmptyNextLI=function(e){for(var t=(0,o.closest)(e,"ul,ol");t&&t.parentElement&&"LI"===t.parentElement.nodeName;)t=(0,o.closest)(t.parentElement,"ul,ol");if(t){var n=t.querySelectorAll("li");n.forEach((function(e){(function(e){return""===e.textContent.trim()&&!e.querySelector("audio,video,img,table,br")})(e)&&(0,o.detach)(e)}))}},e.findFirstTextNode=function(e){if(e.nodeType===Node.TEXT_NODE)return e;for(var t=0;t<e.childNodes.length;t++){var n=this.findFirstTextNode(e.childNodes[t]);if(!(0,o.isNullOrUndefined)(n))return n}return null},e.pasteInsertHTML=function(e,t,n,i,r,s,a,l,d,c){var h=this.getImmediateBlockNode(e[e.length-1],d);if(h&&0===h.textContent.length){var p=h.querySelector("br:last-of-type");p&&p.classList.add("rte-temp-br")}var u,m,f,g,b=n.startOffset===n.endOffset&&n.startContainer===n.endContainer;if(b&&n.startContainer===d&&""===d.textContent&&0===n.startOffset&&0===n.endOffset){var v=this.getImmediateBlockNode(e[e.length-1],d);i.setSelectionText(s,v,v,0,0),n=i.getRange(s)}d!==n.startContainer&&(!a&&(l.nodeType!==Node.ELEMENT_NODE||-1===vs.indexOf(l.tagName.toLocaleLowerCase()))||"table"===t.nodeName.toLowerCase()&&l&&-1===vs.indexOf(l.tagName.toLocaleLowerCase()))&&(g=r.GetSpliceNode(n,l),(0,o.isNullOrUndefined)(g)||(m=(0,o.isNullOrUndefined)(g.previousSibling)?g.parentNode.previousSibling:g.previousSibling,1===e.length?(i.setSelectionContents(s,g),n=i.getRange(s),f=!0):(u=r.GetSpliceNode(n,e[e.length-1].parentElement),u=(0,o.isNullOrUndefined)(u)?g:u,i.setSelectionText(s,g,u,0,3===u.nodeType?u.textContent.length:u.childNodes.length),n=i.getRange(s),f=!1)));var y=!1;this.removingComments(t);for(var C,N=t.childNodes,E=0;E<N.length;E++)if(gs.indexOf(N[E].nodeName.toLocaleLowerCase())>=0){y=!0;break}var S=document.createDocumentFragment();if(y){for(var T=n.startContainer;!(0,o.isNullOrUndefined)(T)&&"PRE"!==T.nodeName&&T!==d;)T=T.parentElement;if((0,o.isNullOrUndefined)(t)||(0,o.isNullOrUndefined)(T)||"PRE"!==T.nodeName){this.insertTempNode(n,t,e,r,d);var O=!0,L=void 0,k=void 0,x=void 0;for(this.contentsDeleted||(a||0!==n.startContainer.parentElement.textContent.length||"BR"!==n.startContainer.nodeName||"P"!==n.startContainer.parentElement.nodeName||d.removeChild(n.startContainer.parentElement),n.deleteContents());t.firstChild;)if("#text"!==t.firstChild.nodeName||""!==t.firstChild.textContent.trim())if("#text"===t.firstChild.nodeName&&O||this.inlineNode.indexOf(t.firstChild.nodeName.toLocaleLowerCase())>=0&&O){if(C=t.firstChild,(0,o.isNullOrUndefined)(t.previousElementSibling)){var w="DIV"===c?(0,o.createElement)("div"):(0,o.createElement)("p");t.parentElement.insertBefore(w,t)}"BR"===t.previousElementSibling.nodeName?t.parentElement.insertBefore(t.firstChild,t):t.previousElementSibling.appendChild(t.firstChild)}else C=t.firstChild,"#text"===t.firstChild.nodeName||this.inlineNode.indexOf(t.firstChild.nodeName.toLocaleLowerCase())>=0?(L?(x.appendChild(t.firstChild),S.appendChild(x)):((k="DIV"===c?(0,o.createElement)("div"):(0,o.createElement)("p")).appendChild(t.firstChild),S.appendChild(k)),x=k,L=!0):(S.appendChild(t.firstChild),L=!1),O=!1;else(0,o.detach)(t.firstChild);t.parentNode.replaceChild(S,t)}else n.insertNode(t),C=t.lastChild}else if(b){var D=(0,o.createElement)("span",{className:"tempSpan"}),M=(0,o.closest)(n.startContainer.parentElement,"a");if(3===n.startContainer.nodeType&&M&&(0,o.closest)(M,"span")){var A=this.getImmediateBlockNode(n.startContainer,d);A.querySelectorAll("br").length>0&&(0,o.detach)(A.querySelector("br")),(0,o.closest)(M,"span").appendChild(D)}else e[0]&&"#text"===e[0].nodeName&&e[0].nodeValue.includes("​")&&!(0,o.isNullOrUndefined)(e[0].parentElement)&&!(0,o.isNullOrUndefined)(e[0].parentElement.previousElementSibling)&&e[0].parentElement.previousElementSibling.classList.contains("e-mention-chip")?n.startContainer.parentElement.insertAdjacentElement("afterend",D):n.insertNode(D);for(;t.firstChild;)C=t.firstChild,S.appendChild(t.firstChild);var B=this.getClosestMatchingElement(D.parentNode,S);if(1===S.childNodes.length&&S.firstChild&&B){var R=document.createElement("div"),I=S.firstChild.textContent||"";R.innerHTML=S.firstChild.innerHTML||"";var U=C=R.firstChild;if(U&&(B.replaceChild(U,D),B.parentNode&&U.nodeType===Node.TEXT_NODE&&(U.previousSibling&&U.previousSibling.nodeType===Node.TEXT_NODE||U.nextSibling&&U.nextSibling.nodeType===Node.TEXT_NODE))){B.parentNode.normalize();var P=n.startOffset+I.length;i.setCursorPoint(s,B.firstChild,P),C=null}R.remove()}else D.parentNode.replaceChild(S,D)}else{for(;t.firstChild;)C=t.firstChild,S.appendChild(t.firstChild);if(f)n.deleteContents(),this.removeEmptyElements(d,!0),n.insertNode(S);else{var H=d===n.startContainer?n.startContainer:n.startContainer.parentNode,j=Array.prototype.indexOf.call(H.childNodes,-1!==o.Browser.userAgent.indexOf("Firefox")&&d===n.startContainer?n.startContainer.firstChild:n.startContainer);n.deleteContents(),-1!==j&&(n.setStart(H,j),n.setEnd(H,j)),(0,o.isNullOrUndefined)(u)||u===d||((0,o.detach)(u),this.removeEmptyElements(d,!0)),(0,o.isNullOrUndefined)(m)?n.insertNode(S):m.parentNode===d?m.appendChild(S):m.parentNode.appendChild(S)}}if(C instanceof Element&&"GOOGLE-SHEETS-HTML-ORIGIN"===C.nodeName){var F=C.querySelector("table"),q=F.querySelector("colgroup");if(q)for(E=0;E<F.rows.length;E++)for(var z=0;z<F.rows[E].cells.length;z++)if(q.querySelectorAll("col")[z].hasAttribute("width")){var _=q.querySelectorAll("col")[z].getAttribute("width");F.rows[E].cells[z].style.width=_+"px"}}if(C&&"TABLE"===C.nodeName){var V=(0,o.createElement)("p");V.appendChild((0,o.createElement)("br")),C.parentElement.insertBefore(V,C.nextSibling),C=V}if(C&&"#text"===C.nodeName)this.placeCursorEnd(C,t,i,s,d);else if(C&&"HR"===C.nodeName){var W=C.nextSibling?C.nextSibling:null,Q="DIV"===c?(0,o.createElement)("div"):(0,o.createElement)("p");Q.appendChild((0,o.createElement)("br")),(0,o.isNullOrUndefined)(W)||"HR"!==W.nodeName?(0,o.isNullOrUndefined)(W)?(C.parentNode.appendChild(Q),C.parentNode.insertBefore(C,Q),C=Q):C=W:(C.parentNode.insertBefore(Q,W),C=Q),i.setSelectionText(s,C,C,0,0)}else C&&this.cursorPos(C,t,i,s,d);this.alignCheck(d),this.listCleanUp(i,s),this.removeEmptyBrFromParagraph(d)},e.removeEmptyBrFromParagraph=function(e){var t=e.querySelector("br.rte-temp-br");t&&t.remove()},e.compareParentElements=function(e,t){return!(!e||!t)&&(e.tagName===t.tagName&&this.getFilteredAttributes(e)===this.getFilteredAttributes(t))},e.getFilteredAttributes=function(e){return Array.from(e.attributes).map((function(e){if("class"===e.name){var t=e.value.split(" ").filter((function(e){return"pasteContent_RTE"!==e})).join(" ");return t?"class='"+t+"'":""}return e.name+"='"+e.value+"'"})).filter((function(e){return e.length>0})).sort().join(" ")},e.getClosestMatchingElement=function(e,t){for(var n=e;n;){if(this.findMatchingChild(t,n))return n;n=n.parentElement}return null},e.findMatchingChild=function(e,t){for(var n=0,i=Array.from(e.children);n<i.length;n++){var o=i[n];if(this.compareParentElements(o,t))return o;var r=this.findMatchingChild(o,t);if(r)return r}return null},e.listCleanUp=function(e,t){var n=e.getRange(t),i=n.startContainer,r=n.startOffset,s=n.startContainer.parentElement,a=n.endContainer.parentElement;if(!(0,o.isNullOrUndefined)(s)&&!(0,o.isNullOrUndefined)(a)){var l=s.closest("ol, ul"),d=a.closest("ol, ul");if(!(0,o.isNullOrUndefined)(l)&&!(0,o.isNullOrUndefined)(d)){var c=this.cleanUpListItems(l),h=this.cleanUpListContainer(l);(c||h)&&(n.setStart(i,r),n.setEnd(i,r))}}},e.cleanUpListItems=function(e){var t,n=this,i=!1;if((0,o.isNullOrUndefined)(e.closest("ol, ul"))||(t=e.closest("ol, ul").querySelectorAll("li")),(0,o.isNullOrUndefined)(t)||0===t.length)return!1;var r=null;t.forEach((function(e){var t=e.parentElement;if(!(0,o.isNullOrUndefined)(t)&&"OL"!==t.nodeName&&"UL"!==t.nodeName&&((0,o.isNullOrUndefined)(r)&&(r=t.closest("li")),!(0,o.isNullOrUndefined)(r))){var s=e.nextSibling;if(!(0,o.isNullOrUndefined)(s)&&"LI"!==s.nodeName){for(var a=Array.prototype.indexOf.call(t.childNodes,s),l=t.cloneNode(!1),d=t.childNodes.length,c=a;c<d;c++)l.appendChild(t.childNodes[a]);if(l.childNodes.length>0){var h=document.createElement("li");h.appendChild(l),r.insertAdjacentElement("afterend",h)}else l.remove()}var p=t.closest("ol, ul");r.insertAdjacentElement("afterend",e),r=r.nextSibling,(0,o.isNullOrUndefined)(p)||n.removeEmptyElements(p),i=!0}}));var s=this.cleanUpFlattenListContainer(e);return i=s||i},e.cleanUpFlattenListContainer=function(e){var t,n=!1;return(0,o.isNullOrUndefined)(e.closest("ol, ul"))||(t=e.closest("ol, ul").querySelectorAll("li")),!(0,o.isNullOrUndefined)(t)&&0!==t.length&&(t.forEach((function(e){(0,o.isNullOrUndefined)(e.firstChild)||"OL"!==e.firstChild.nodeName&&"UL"!==e.firstChild.nodeName||(e.style.listStyleType="none");var t=Array.from(e.children).find((function(e){return"LI"===e.tagName&&e.parentElement&&"OL"!==e.parentElement.tagName&&"UL"!==e.parentElement.tagName}));(0,o.isNullOrUndefined)(t)||(0,o.isNullOrUndefined)(e.parentNode)||(e.parentNode.replaceChild(t,e),((0,o.isNullOrUndefined)(t.textContent)||""===t.textContent.trim())&&t.remove(),n=!0)})),n)},e.cleanUpListContainer=function(e){var t=!1,n=[],i=[];return(0,o.isNullOrUndefined)(e)||(e.childNodes.forEach((function(t){"LI"!==t.nodeName.toLocaleUpperCase()&&n.push(t),("LI"===t.nodeName.toLocaleUpperCase()||e.lastChild===t)&&n.length>0&&(i.push({elements:n.slice()}),n=[])})),i.forEach((function(n){var i=n.elements,o=document.createElement("li");i[0].parentNode.replaceChild(o,i[0]),i.forEach((function(e){return o.appendChild(e)})),o.textContent&&""===o.textContent.trim()&&!o.querySelector("img")&&e.removeChild(o),t=!0}))),t},e.placeCursorEnd=function(e,t,n,i,r){for(e="BR"===e.nodeName?(0,o.isNullOrUndefined)(e.previousSibling)?e.parentNode:e.previousSibling:e;!(0,o.isNullOrUndefined)(e)&&"#text"!==e.nodeName&&"IMG"!==e.nodeName&&"BR"!==e.nodeName&&"HR"!==e.nodeName;){if(!(0,o.isNullOrUndefined)(e.lastChild)&&"P"===e.lastChild.nodeName&&""===e.lastChild.innerHTML){var s=(0,o.createElement)("br");e.lastChild.appendChild(s)}e=e.lastChild}"IMG"===(e=(0,o.isNullOrUndefined)(e)?t:e).nodeName?this.imageFocus(e,n,i):n.setSelectionText(i,e,e,e.textContent.length,e.textContent.length),this.removeEmptyElements(r)},e.getNodeCollection=function(e,t,n){var i=[];return e.startOffset===e.endOffset&&e.startContainer===e.endContainer&&"BR"!==e.startContainer.nodeName&&e.startContainer.childNodes.length>0&&("TD"===e.startContainer.nodeName||3!==e.startContainer.nodeType&&n.classList&&n.classList.contains("pasteContent"))?i.push(e.startContainer.childNodes[e.endOffset]):i=t.getInsertNodeCollection(e),i},e.insertTempNode=function(e,t,n,i,r){if(e.startContainer!==r||(0,o.isNullOrUndefined)(e.startContainer.childNodes[e.endOffset-1])||"TABLE"!==e.startContainer.childNodes[e.endOffset-1].nodeName)if(e.startContainer!==r||(0,o.isNullOrUndefined)(e.startContainer.childNodes[e.endOffset])||"TABLE"!==e.startContainer.childNodes[e.endOffset].nodeName)if(e.startContainer===e.endContainer&&3!==e.startContainer.nodeType&&"HR"===t.firstChild.nodeName)e.startContainer.classList.contains("e-content")||"BODY"===e.startContainer.nodeName?e.startContainer.appendChild(t):e.startContainer.parentNode.insertBefore(t,e.startContainer);else{var s=this.getImmediateBlockNode(n[n.length-1],r);if(((0,o.isNullOrUndefined)(s)||(0,o.isNullOrUndefined)(s.parentElement))&&3!==e.endContainer.nodeType&&(s=e.endContainer,e.setEnd(s,e.endContainer.textContent.length)),(s&&"BODY"===s.nodeName||"DIV"===s.nodeName&&e.startContainer===e.endContainer&&1===e.startContainer.nodeType)&&(s=e.startContainer),s&&"#text"!==s.nodeName&&s.closest("LI")&&r.contains(s.closest("LI"))&&"TD"!==s.nodeName&&"TH"!==s.nodeName&&"TR"!==s.nodeName&&t&&t.firstElementChild&&("OL"===t.firstElementChild.tagName||"UL"===t.firstElementChild.tagName))for(var a=void 0;t.firstElementChild.lastElementChild&&"LI"===t.firstElementChild.lastElementChild.tagName;)(a=t.firstElementChild.lastElementChild).style.removeProperty("margin-left"),a.style.removeProperty("margin-top"),a.style.removeProperty("margin-bottom"),t.firstElementChild.insertAdjacentElement("afterend",a);if(s&&"TD"===s.nodeName||"TH"===s.nodeName||"TR"===s.nodeName){for(var l=e.startContainer;!(0,o.isNullOrUndefined)(l)&&l.parentElement!==s;)l=l.parentElement;return e.deleteContents(),(h=i.GetSpliceNode(e,l))?h.parentNode.replaceChild(t,h):e.insertNode(t),void(this.contentsDeleted=!0)}var d=new sl(r),c=this.getNodeCollection(e,d,t)[this.getNodeCollection(e,d,t).length-1],h=void 0;if(!c||"BR"!==c.nodeName&&"HR"!==c.nodeName&&("#text"!==c.nodeName||(0,o.isNullOrUndefined)(c.parentElement)||"LI"!==c.parentElement.nodeName)||(0,o.isNullOrUndefined)(c.parentElement)||0!==c.parentElement.textContent.trim().length){if(c&&("#text"===c.nodeName||"BR"===c.nodeName)&&!(0,o.isNullOrUndefined)(c.parentElement)&&("LI"===c.parentElement.nodeName||c.parentElement.closest("LI")||s===r&&c.parentElement===s)&&c.parentElement.textContent.trim().length>0){if(h=c,"LI"!==c.parentElement.nodeName||(0,o.isNullOrUndefined)(c.nextSibling)||"BR"!==c.nextSibling.nodeName||(0,o.detach)(c.nextSibling),!e.collapsed){var p=e.startContainer,u=e.startOffset;this.removeListfromPaste(e),e.setStart(p,u),e.setEnd(p,u)}return e.insertNode(t),void(this.contentsDeleted=!0)}h=i.GetSpliceNode(e,s)}else if(h=c,"LI"!==c.parentElement.nodeName||(0,o.isNullOrUndefined)(c.nextSibling)||"BR"!==c.nextSibling.nodeName||(0,o.detach)(c.nextSibling),"LI"===c.parentElement.nodeName&&""===c.parentElement.textContent)return this.removeListfromPaste(e),1===c.parentElement.childNodes.length&&"BR"===c.nodeName&&(0,o.detach)(c),e.insertNode(t),void(this.contentsDeleted=!0);h.parentNode.replaceChild(t,h)}else e.startContainer.appendChild(t);else(0,o.isNullOrUndefined)(e.startContainer.childNodes[e.endOffset-1].nextSibling)?e.startContainer.appendChild(t):e.startContainer.insertBefore(t,e.startContainer.childNodes[e.endOffset-1].nextSibling)},e.cursorPos=function(e,t,n,i,r){e.classList.add("lastNode"),r.innerHTML=function(e){var t=document.createElement("div");t.innerHTML=e;for(var n=t.querySelectorAll("table"),i=0;i<n.length;i++)if(n[i].classList.length>0&&!n[i].classList.contains("e-rte-table")&&!n[i].classList.contains("e-rte-custom-table")){if(n[i].classList.add("e-rte-paste-table"),n[i].classList.contains("e-rte-paste-word-table")){n[i].classList.remove("e-rte-paste-word-table");continue}if(n[i].classList.contains("e-rte-paste-excel-table")){n[i].classList.remove("e-rte-paste-excel-table"),"0"===n[i].getAttribute("border")&&n[i].removeAttribute("border");for(var o=n[i].querySelectorAll("td"),r=0;r<o.length;r++)"none"===o[r].style.borderLeft&&o[r].style.removeProperty("border-left"),"none"===o[r].style.borderRight&&o[r].style.removeProperty("border-right"),"none"===o[r].style.borderBottom&&o[r].style.removeProperty("border-bottom"),"none"===o[r].style.borderTop&&o[r].style.removeProperty("border-top"),"none"===o[r].style.border&&o[r].style.removeProperty("border")}else{if(n[i].classList.contains("e-rte-paste-onenote-table")){n[i].classList.remove("e-rte-paste-onenote-table");continue}if(n[i].classList.contains("e-rte-paste-html-table")){n[i].classList.remove("e-rte-paste-html-table");continue}}}var s=t.querySelectorAll("img");for(i=0;i<s.length;i++)s[i].classList.contains("e-rte-image-unsupported")||(s[i].classList.contains("e-rte-image")||s[i].classList.add("e-rte-image"),s[i].classList.contains("e-imginline")||s[i].classList.contains("e-imgbreak")||s[i].classList.add("e-imginline"));return t.innerHTML}(r.innerHTML),e=r.querySelector(".lastNode"),(0,o.isNullOrUndefined)(e)||(this.placeCursorEnd(e,t,n,i,r),e.classList.remove("lastNode"),0===e.classList.length&&e.removeAttribute("class"))},e.imageFocus=function(e,t,n){var i=document.createTextNode(" ");if(e.parentNode&&"A"===e.parentNode.nodeName){var o=e.parentNode,r=o.parentNode;r.insertBefore(i,o.nextSibling),r.insertBefore(e,i)}else e.parentNode.insertBefore(i,e.nextSibling);t.setSelectionText(n,e.nextSibling,e.nextSibling,0,0)},e.getImmediateBlockNode=function(e,t){for(;e&&gs.indexOf(e.nodeName.toLocaleLowerCase())<0;)e=e.parentNode;return e},e.removingComments=function(e){var t=e.innerHTML;t=t.replace(/<!--[\s\S]*?-->/g,""),e.innerHTML=t},e.findDetachEmptyElem=function(e,t){var n;(void 0===t&&(t=!1),(0,o.isNullOrUndefined)(e.parentElement))?n=null:n=!(e.parentElement.textContent.length>0&&e.parentElement.textContent.match(/\u00a0/g)&&e.parentElement.textContent.match(/\u00a0/g).length>0)&&""===e.parentElement.textContent.trim()&&"true"!==e.parentElement.contentEditable&&(0,o.isNullOrUndefined)(e.parentElement.querySelector("img"))&&"TD"!==e.parentElement.nodeName&&"TH"!==e.parentElement.nodeName?t&&-1!==gs.indexOf(e.parentElement.tagName.toLowerCase())?e:this.findDetachEmptyElem(e.parentElement,t):t&&-1!==gs.indexOf(e.tagName.toLowerCase())?null:e;return n},e.removeEmptyElements=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=null);for(var i=e.querySelectorAll(":empty"),r=Array.from(i).filter((function(e){var t=e.tagName.toLowerCase();return!(e.closest("svg")||e.closest("canvas")||["td","th","textarea","input","img","video","audio","br","hr","iframe"].indexOf(t)>-1)})),s=0;s<r.length;s++){var a=!0,l=r[s];if("DIV"===l.tagName&&(a="none"===l.style.borderBottom||""===l.style.borderBottom),"COL"!==l.nodeName){var d=!(0,o.isNullOrUndefined)(n)&&l===n;if(Ss.indexOf(l.tagName.toLowerCase())<0&&a&&!d){var c=this.findDetachEmptyElem(l,t);(0,o.isNullOrUndefined)(c)||c.nodeType===Node.ELEMENT_NODE&&"TEXTAREA"===c.nodeName.toUpperCase()||(0,o.detach)(c)}}else{var h=l.parentElement;(0,o.detach)(h)}}},e.closestEle=function(e,t){var n=e;if((0,o.closest)(n,"li"))return(0,o.closest)(n,"li");for(;n&&1===n.nodeType;){if(n.parentNode===t||!(0,o.isNullOrUndefined)(n.parentNode.tagName)&&(-1!==bs.indexOf(n.parentNode.tagName.toLocaleLowerCase())||-1!==Os.indexOf(n.parentNode.tagName.toLocaleLowerCase())))return n;n=n.parentNode}return null},e.insertTableInList=function(e,t,n,i,r,s,a){var l=(0,o.isNullOrUndefined)((0,o.closest)(n,"ul,ol"))?0:(0,o.closest)(n,"ul,ol").querySelectorAll("li").length,d=r.SplitNode(e,n,!0),c=d.previousElementSibling,h=(0,o.isNullOrUndefined)(s)?null:(0,o.closest)(s,"li"),p=(0,o.isNullOrUndefined)(h)?null:h.innerHTML;!(0,o.isNullOrUndefined)(c)&&!(0,o.isNullOrUndefined)((0,o.closest)(c,"ol,ul"))&&(0,o.closest)(c,"ol,ul").querySelectorAll("li").length>l?(c.appendChild(t),e.deleteContents(),d.childNodes.length>0&&this.moveChildNodes(d,c),n===s||(0,o.isNullOrUndefined)(p)||p===h.innerHTML||this.moveChildNodes(h,c)):(e.deleteContents(),d.insertBefore(t,d.firstChild),n!==s&&this.moveChildNodes(s,n)),this.removeEmptyNextLI((0,o.closest)(t,"li")),t.classList.add("ignore-table")},e.moveChildNodes=function(e,t){for(;!(0,o.isNullOrUndefined)(e)&&!(0,o.isNullOrUndefined)(e.firstChild);)t.appendChild(e.firstChild)},e.alignCheck=function(e){for(var t=e.querySelectorAll('span[style*="text-align"]'),n=0;n<t.length;n++){var i=t[n];if(i){var o=this.getImmediateBlockNode(i,null);if(o){for(var r="",s=0;s<t.length;s++){var a=t[s];o.contains(a)&&(r+=a.textContent)}o.textContent.trim()===r.trim()&&(o.style.textAlign=i.style.textAlign)}}}},e.removeListfromPaste=function(e){e.deleteContents();var t=e.startContainer;(0,o.isNullOrUndefined)(t)||"LI"!==t.nodeName||(0,o.isNullOrUndefined)(t.parentElement)||"OL"!==t.parentElement.nodeName&&"UL"!==t.parentElement.nodeName||""!==t.textContent.trim()||t.parentElement.querySelectorAll("li").forEach((function(e){""===e.textContent.trim()&&e!==t&&e.remove()}))},e.inlineNode=["a","abbr","acronym","audio","b","bdi","bdo","big","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","font","i","iframe","img","input","ins","kbd","label","map","mark","meter","noscript","object","output","picture","progress","q","ruby","s","samp","script","select","slot","small","span","strong","sub","sup","svg","template","textarea","time","u","tt","var","video","wbr"],e.contentsDeleted=!1,e}(),ua=function(){function e(e){this.directRangeElems=["IMG","TABLE","AUDIO","VIDEO","HR"],this.BLOCK_TAGS=["address","article","aside","audio","blockquote","canvas","details","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","output","p","pre","section","td","tfoot","th","video","body"],this.editableElement=e,this.currentDocument=e.ownerDocument}return e.prototype.getBlockNode=function(){var e=this,t=[],n=this.currentDocument.getSelection().getRangeAt(0);if(n.startContainer===this.editableElement&&n.startContainer===n.endContainer&&"#text"!==n.startContainer.nodeName){if(n.startOffset===n.endOffset)this.editableElement.childNodes[n.startOffset]&&this.directRangeElems.indexOf(this.editableElement.childNodes[n.startOffset].nodeName)>-1&&t.push(this.editableElement.childNodes[n.startOffset]);else n.endOffset===n.startOffset+1&&t.push(this.editableElement.childNodes[n.startOffset]);if(t.length>0)return t}else{var i=n.startContainer.nodeType===Node.TEXT_NODE?n.startContainer.parentElement:n.startContainer,o=n.endContainer.nodeType===Node.TEXT_NODE?n.endContainer.parentElement:n.endContainer,r=this.isBlockNode(o)?o:this.getParentBlockNode(o),s=this.currentDocument.createTreeWalker(this.editableElement,NodeFilter.SHOW_ELEMENT,{acceptNode:function(t){return n.intersectsNode(t)?e.isBlockNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT}});for(s.currentNode=i;s.currentNode;)if(this.isBlockNode(s.currentNode)?(this.addToBlockCollection(t,s,n),s.nextNode()):s.previousNode(),s.currentNode===o||s.currentNode===r){this.addToBlockCollection(t,s,n);break}}return t},e.prototype.addToBlockCollection=function(e,t,n){var i=t.currentNode;if(t.currentNode&&-1===e.indexOf(t.currentNode))if("LI"===i.nodeName)if(!i.parentNode.closest("li"))e.push(t.currentNode);else{var o=n.commonAncestorContainer;if(!!("OL"!==o.nodeName&&"UL"!==o.nodeName||!o.closest("li")))return;e.push(t.currentNode)}else e.push(t.currentNode)},e.prototype.getTextNodes=function(e){for(var t=[],n=this.currentDocument.getSelection().getRangeAt(0),i=this.currentDocument.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return n.intersectsNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),o=i.nextNode();o;)t.push(o),o=i.nextNode();return t},e.prototype.isBlockNode=function(e){return!!e&&e.nodeType===Node.ELEMENT_NODE&&this.BLOCK_TAGS.indexOf(e.tagName.toLowerCase())>=0},e.prototype.getLastTextNode=function(e){for(var t=this.currentDocument.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),n=null,i=t.nextNode();i;)n=i,i=t.nextNode();return n},e.prototype.getFirstTextNode=function(e){return this.currentDocument.createTreeWalker(e,NodeFilter.SHOW_TEXT,null).nextNode()},e.prototype.getParentBlockNode=function(e){var t=this,n=this.currentDocument.createTreeWalker(this.editableElement,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return t.isBlockNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return n.currentNode=e,n.parentNode()},e.prototype.getTopMostNode=function(e){if(this.isBlockNode(e.parentNode))return e;for(var t=e.parentNode;t;){if(this.isBlockNode(t.parentNode)||e.textContent!==t.textContent)return t;t=t.parentNode}return t},e}(),ma=function(){function e(e){this.listTabIndentation=!1,this.parent=e,this.domNode=this.parent.domNode,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Xs,this.applyListsHandler,this),this.parent.observer.on(Ys,this.onKeyUp,this),this.parent.observer.on(Gs,this.keyDownHandler,this),this.parent.observer.on(ia,this.spaceKeyAction,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Xs,this.applyListsHandler),this.parent.observer.off(Ys,this.onKeyUp),this.parent.observer.off(Gs,this.keyDownHandler),this.parent.observer.off(ia,this.spaceKeyAction),this.parent.observer.off(da,this.destroy)},e.prototype.testList=function(e){var t=[/^[\d]+[.]+$/,/^(?=[MDCLXVI])M*(C[MD]|D?C{0,3})(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})[.]$/gi,/^[a-zA-Z][.]+$/],n=(0,o.isNullOrUndefined)(e)?null:e.innerText.trim().split(".")[0]+".";if(!(0,o.isNullOrUndefined)(n))for(var i=0;i<t.length;i++)if(t[i].test(n))return!0;return!1},e.prototype.testCurrentList=function(e){var t=[/^[1]+[.]+$/,/^[i]+[.]+$/,/^[a]+[.]+$/];if(!(0,o.isNullOrUndefined)(e.startContainer.textContent.slice(0,e.startOffset)))for(var n=e.startContainer.textContent.replace(/\u200B/g,"").slice(0,e.startOffset).trim(),i=0;i<t.length;i++)if(t[i].test(n)&&2===n.length)return!0;return!1},e.prototype.createAutoList=function(e,t){var n={BR:{BR:!0,P:!0,DIV:!0},P:{BR:!1,P:!0,DIV:!0},DIV:{BR:!1,P:!0,DIV:!0}};return!(!n[e]||void 0===n[e][t])&&n[e][t]},e.prototype.isInsideSameListType=function(e,t){if(!e)return!1;var n=e.closest("li");if(!n)return!1;var i=n.closest("ul, ol");return!!i&&("OL"===i.tagName&&t||"UL"===i.tagName&&!t)},e.prototype.spaceList=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument);this.saveSelection=this.parent.nodeSelection.save(t,this.parent.currentDocument);var n=this.parent.domNode.getSelectedNode(t.startContainer,t.startOffset),i=(this.parent.domNode.getSelectedNode(t.endContainer,t.endOffset),n.previousElementSibling),r=n.nextElementSibling,s=(0,o.isNullOrUndefined)(i)?null:i.innerText.trim().substring(0,1),a=(0,o.isNullOrUndefined)(r)?null:r.innerText.trim().substring(0,1),l=this.testCurrentList(t),d=this.testList(i),c=this.testList(r),h=this.isInsideSameListType(n,l),p=t.startContainer.previousElementSibling&&"BR"===t.startContainer.previousElementSibling.tagName;if(!h&&!d&&!c&&"*"!==s&&"*"!==a&&(this.createAutoList(e.enterKey,e.shiftEnterKey)||!p)){var u=(0,o.createElement)("br");l?(t.startContainer.textContent=t.startContainer.textContent.slice(t.startOffset,t.startContainer.textContent.length),"#text"===t.startContainer.nodeName&&0===t.startContainer.textContent.length&&this.parent.domNode.insertAfter(u,t.startContainer),this.applyListsHandler({subCommand:"OL",callBack:e.callBack}),e.event.preventDefault()):"*"!==t.startContainer.textContent.replace(/\u200B/g,"").slice(0,t.startOffset).trim()&&"-"!==t.startContainer.textContent.replace(/\u200B/g,"").slice(0,t.startOffset).trim()||(t.startContainer.textContent=t.startContainer.textContent.slice(t.startOffset,t.startContainer.textContent.length),"#text"===t.startContainer.nodeName&&0===t.startContainer.textContent.length&&this.parent.domNode.insertAfter(u,t.startContainer),this.applyListsHandler({subCommand:"UL",callBack:e.callBack}),e.event.preventDefault())}},e.prototype.enterList=function(e){var t,n,i=this.parent.nodeSelection.getRange(this.parent.currentDocument),r="LI"===i.startContainer.nodeName?i.startContainer:i.startContainer.parentElement.closest("LI"),s="LI"===i.endContainer.nodeName?i.endContainer:i.endContainer.parentElement.closest("LI"),a=!1;if(!(0,o.isNullOrUndefined)(r)){var l=r.querySelectorAll(".e-video-clickelem"),d=l.length>0&&"IFRAME"===l[0].childNodes[0].nodeName;a=r.querySelectorAll("IMG").length>0||r.querySelectorAll("AUDIO").length>0||r.querySelectorAll("VIDEO").length>0||d}r&&(t=r.parentElement)&&(n=t.parentElement);var c=(0,o.isNullOrUndefined)(r)?null:r.querySelector("TABLE");if(!(0,o.isNullOrUndefined)(r)&&!(0,o.isNullOrUndefined)(s)&&r===s&&"LI"===r.tagName&&""===r.textContent.trim()&&!a&&(0,o.isNullOrUndefined)(c)){if(r.innerHTML.indexOf("&nbsp;")>=0)return;if(65279===r.textContent.charCodeAt(0)&&(r.textContent=""),(0,o.isNullOrUndefined)(n.closest("UL"))&&(0,o.isNullOrUndefined)(n.closest("OL"))){if(!(0,o.isNullOrUndefined)(r.nextElementSibling)){var h=this.parent.domNode.blockParentNode(r);this.parent.nodeCutter.GetSpliceNode(i,h)}var p=void 0;"DIV"===e.enterAction?(p=(0,o.createElement)("div")).innerHTML="<br>":"P"===e.enterAction?(p=(0,o.createElement)("p")).innerHTML="<br>":p=(0,o.createElement)("br");var u=this.domNode.getImmediateBlockNode(i.startContainer),m=this.applyFormattingFromRange(p,i,u,e.enterAction),f=m.formattedElement,g=m.cursorTarget;p=f,(0,o.isNullOrUndefined)(n)||"BLOCKQUOTE"!==n.nodeName||this.parent.observer.notify("blockquote_list_handled",{}),this.parent.domNode.insertAfter(p,t),e.event.preventDefault(),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,g,0),""===t.textContent&&0===t.querySelectorAll("audio,video,table").length?(0,o.detach)(t):(0,o.detach)(r)}(0,o.isNullOrUndefined)(n)||(0,o.isNullOrUndefined)(n.closest("UL"))&&(0,o.isNullOrUndefined)(n.closest("OL"))||"LI"!==n.nodeName||"none"!==n.style.listStyleType||""!==n.textContent||""!==r.textContent||r!==t.firstElementChild||!(0,o.isNullOrUndefined)(r.nextSibling)||((0,o.detach)(t),n.style.removeProperty("list-style-type"),e.event.preventDefault())}this.handleNestedEnterKeyForLists(e,n,r,t)},e.prototype.applyFormattingFromRange=function(e,t,n,i){var r=e,s=[];if(n){for(var a=t.startContainer,l=["div","p","h1","h2","h3","h4","h5","h6","li","ul","ol","table","tr","td","th"];a&&a!==n;){var d=a.nodeName.toLowerCase();-1===l.indexOf(d)&&a.nodeType===Node.ELEMENT_NODE&&s.push({tag:d,element:a}),a=a.parentNode}if(s.length>0){(e="BR"===i?(0,o.createElement)("DIV"):e).innerHTML="";var c=e;s.reverse().forEach((function(e){var t=(0,o.createElement)(e.tag);Array.from(e.element.attributes).forEach((function(e){t.setAttribute(e.name,e.value)})),c.appendChild(t),c=t}));var h=(0,o.createElement)("br");c.appendChild(h),r=c}}return{formattedElement:"BR"===i&&s.length>0?e.firstChild:e,cursorTarget:r}},e.prototype.handleNestedEnterKeyForLists=function(e,t,n,i){var r=!1;if(!(0,o.isNullOrUndefined)(n)&&n.querySelectorAll("audio,video,table,img").length>0&&(r=!0),!(0,o.isNullOrUndefined)(t)&&(!(0,o.isNullOrUndefined)(t.closest("UL"))||!(0,o.isNullOrUndefined)(t.closest("OL"))||"UL"===i.nodeName||"OL"===i.nodeName)&&("LI"===t.nodeName||"LI"===n.nodeName)&&("none"===t.style.listStyleType||""===t.style.listStyleType)&&""!==t.textContent&&!(0,o.isNullOrUndefined)(n.lastElementChild)&&""!==n.lastElementChild.textContent&&n.firstElementChild&&""===n.firstElementChild.textContent&&!r&&(n===i.firstElementChild||"LI"===n.nodeName)){var s=this.parent.nodeSelection.getRange(this.parent.currentDocument);this.saveSelection=this.parent.nodeSelection.save(s,this.parent.currentDocument),this.domNode.setMarker(this.saveSelection),e.event.preventDefault();var a=[];n===i.firstElementChild?a.push(i.firstElementChild):"LI"===n.nodeName&&a.push(n),this.revertList(a,e),this.revertClean(),this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore()}},e.prototype.backspaceList=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.domNode.getSelectedNode(t.startContainer,t.startOffset),i=this.parent.domNode.getSelectedNode(t.endContainer,t.endOffset);if(n="BR"===n.nodeName?n.parentElement:n,i="BR"===i.nodeName?i.parentElement:i,!(0,o.isNullOrUndefined)(n)&&n.closest("li")){var r=this.getListCursorInfo(t),s=null===n.previousElementSibling,a=this.parent.domNode.blockNodes(),l=this.isAllListNodesSelected(n.closest("li").parentElement),d="StartNested"===r.position&&n&&n.parentElement&&n.parentElement.closest("li")&&n.parentElement.closest("li").getAttribute("style")&&-1!==n.parentElement.closest("li").getAttribute("style").indexOf("list-style-type: none;");if(s&&(["StartParent"].indexOf(r.position)>-1||d)){e.event.preventDefault();var c=this.parent.nodeSelection.save(t,this.parent.currentDocument);return this.domNode.setMarker(c),this.revertList([a[0]],e),this.revertClean(),void(c=this.domNode.saveMarker(c)).restore()}if(["SingleFull","MultipleFull"].indexOf(r.selectionState)>-1&&l){if(e.event.preventDefault(),a[0].innerHTML="",t.deleteContents(),a.length>1)for(var h=0;h<a.length;h++)if(0!==h){var p=a[h];(0,o.detach)(p)}return void this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,a[0],0)}}if(n===i&&!(0,o.isNullOrUndefined)((0,o.closest)(n,"li"))&&(""===n.textContent.trim()&&65279===n.textContent.charCodeAt(0)||1===n.textContent.length&&8203===n.textContent.charCodeAt(0))&&(n.textContent=""),n===i&&"LI"===n.tagName&&0===n.textContent.length&&(0,o.isNullOrUndefined)(n.previousElementSibling)&&n.removeAttribute("style"),n===i&&""===n.textContent){if("LI"===n.parentElement.tagName&&"LI"===i.parentElement.tagName)(0,o.detach)(n);else if(n.closest("ul")||n.closest("ol")){if((u=(0,o.isNullOrUndefined)(n.closest("ul"))?n.closest("ol"):n.closest("ul")).firstElementChild===n&&!(0,o.isNullOrUndefined)(u.children[1])&&("OL"===u.children[1].tagName||"UL"===u.children[1].tagName))if(u.tagName===u.children[1].tagName){for(;u.children[1].lastChild;)this.parent.domNode.insertAfter(u.children[1].lastChild,u.children[1]);(0,o.detach)(u.children[1])}else u.parentElement.insertBefore(u.children[1],u)}}else if(!((0,o.isNullOrUndefined)(n.firstChild)||"BR"!==n.firstChild.nodeName||(0,o.isNullOrUndefined)(n.childNodes[1])||"UL"!==n.childNodes[1].nodeName&&"OL"!==n.childNodes[1].nodeName)){var u;if((u=(0,o.isNullOrUndefined)(n.closest("ul"))?n.closest("ol"):n.closest("ul")).tagName===n.childNodes[1].nodeName){for(;n.childNodes[1].lastChild;)this.parent.domNode.insertAfter(n.children[1].lastChild,n);(0,o.detach)(n.childNodes[1])}else u.parentElement.insertBefore(n.children[1],u)}if(n===i&&"LI"===n.tagName&&this.isAtListStart(n,t)&&!(0,o.isNullOrUndefined)(n.closest("ul, ol"))){var m=n.closest("ul, ol"),f=m.parentElement,g=n.previousElementSibling,b=n.querySelector("ol, ul");(!(0,o.isNullOrUndefined)(f)&&"LI"===f.tagName&&!(0,o.isNullOrUndefined)(m.previousSibling)||!(0,o.isNullOrUndefined)(g)&&"LI"===g.nodeName)&&((0,o.isNullOrUndefined)(b)||!(0,o.isNullOrUndefined)(g)&&(0,o.isNullOrUndefined)(g)||(e.event.preventDefault(),this.handleNestedListRearrangement(n,m,f,g,b)))}this.removeList(t,e),this.firstListBackSpace(t,e)},e.prototype.handleNestedListRearrangement=function(e,t,n,i,r){for(var s=this.parent.nodeSelection.findLastTextPosition((0,o.isNullOrUndefined)(i)?t.previousSibling:i),a=Array.from(e.childNodes),l=0;l<a.length;l++){var d=a[l];if(d===r&&r)for(;r.firstChild;){t.insertBefore(r.firstChild,e),e.querySelector("OL:empty,UL:empty")&&e.remove()}else(0,o.isNullOrUndefined)(i)?n.insertBefore(d,t):s.node.parentElement.closest("li").appendChild(d)}this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,s.node,s.offset)},e.prototype.findPreviousElementForCursor=function(e){var t=null;return e.previousElementSibling?t=e.previousElementSibling:e.parentElement&&e.parentElement!==this.parent.editableElement&&(t=e.parentElement),t},e.prototype.handleCursorPositioningAfterListRemoval=function(e){if(e&&this.parent.userAgentData.isSafari()){var t=this.parent.nodeSelection.findLastTextPosition(e);t?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t.node,t.offset):this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,e.childNodes.length)}},e.prototype.removeList=function(e,t){var n,i,r=this,s=this.parent.domNode.getSelectedNode(e.startContainer,e.startOffset),a=!(0,o.isNullOrUndefined)(e.endContainer.parentElement.closest("li"))&&e.endContainer.parentElement.closest("li").childElementCount>1&&"#text"===e.endContainer.nodeName?e.endContainer:this.parent.domNode.getSelectedNode(e.endContainer,e.endOffset),l="#text"===e.startContainer.nodeName?e.startContainer.parentElement.closest("li"):e.startContainer.closest("li"),d="#text"===e.endContainer.nodeName?e.endContainer.parentElement.closest("li"):e.endContainer.closest("li"),c="";((0,o.isNullOrUndefined)(l)||(0,o.isNullOrUndefined)(l.firstChild)||l.childNodes.forEach((function(e){c+=e.textContent})),s="BR"===s.nodeName?s.parentElement:s,a="BR"===a.nodeName?a.parentElement:a,s="LI"===s.nodeName||(0,o.isNullOrUndefined)(s.closest("LI"))?s:s.closest("LI"),a="LI"===a.nodeName||"#text"===a.nodeName||(0,o.isNullOrUndefined)(a.closest("LI"))?a:a.closest("LI"),("OL"===e.commonAncestorContainer.nodeName||"UL"===e.commonAncestorContainer.nodeName||"LI"===e.commonAncestorContainer.nodeName)&&(0,o.isNullOrUndefined)(a.nextElementSibling)&&a.textContent.length===e.endOffset&&(0,o.isNullOrUndefined)(s.previousElementSibling)&&0===e.startOffset||-1!==o.Browser.userAgent.indexOf("Firefox")&&e.startContainer===e.endContainer&&e.startContainer===this.parent.editableElement&&0===e.startOffset&&1===e.endOffset)&&(-1!==o.Browser.userAgent.indexOf("Firefox")?(n=this.findPreviousElementForCursor(e.commonAncestorContainer.childNodes[0]),(0,o.detach)(e.commonAncestorContainer.childNodes[0])):"LI"===e.commonAncestorContainer.nodeName?(n=this.findPreviousElementForCursor(e.commonAncestorContainer.parentElement),(0,o.detach)(e.commonAncestorContainer.parentElement)):(n=this.findPreviousElementForCursor(e.commonAncestorContainer),(0,o.detach)(e.commonAncestorContainer)),t.event.preventDefault(),this.handleCursorPositioningAfterListRemoval(n),l="#text"===e.startContainer.nodeName?e.startContainer.parentElement.closest("li"):e.startContainer.closest("li"));if(!(0,o.isNullOrUndefined)(d)&&e.commonAncestorContainer===this.parent.editableElement||!(0,o.isNullOrUndefined)(l)&&(!e.collapsed||""===l.textContent.trim()&&(0,o.isNullOrUndefined)(l.previousElementSibling)&&(0,o.isNullOrUndefined)(l.nextElementSibling))&&l.textContent===c){e.deleteContents();for(var h=this.parent.editableElement.querySelectorAll("li"),p=function(e){(0,o.isNullOrUndefined)(h[e].childNodes)||h[e].childNodes.forEach((function(t){"A"===t.nodeName&&""===t.textContent&&h[e].removeChild(t)})),h[e].firstChild&&""!==h[e].textContent.trim()||h[e]!==s&&h[e]!==a||(i=u.findPreviousElementForCursor(h[e]),h[e].parentNode.removeChild(h[e]))},u=this,m=0;m<h.length;m++)p(m);this.parent.editableElement.querySelectorAll("ol").forEach((function(e){e.firstChild&&""!==e.textContent.trim()||(i=r.findPreviousElementForCursor(e),e.parentNode.removeChild(e))})),this.parent.editableElement.querySelectorAll("ul").forEach((function(e){e.firstChild&&""!==e.textContent.trim()||(i=r.findPreviousElementForCursor(e),e.parentNode.removeChild(e))})),t.event.preventDefault(),this.handleCursorPositioningAfterListRemoval(i)}},e.prototype.onKeyUp=function(e){if(!(0,o.isNullOrUndefined)(this.commonLIParent)&&!(0,o.isNullOrUndefined)(this.commonLIParent.querySelector(".removeList"))){for(var t=this.commonLIParent.querySelector(".removeList");!(0,o.isNullOrUndefined)(t.firstChild);)this.parent.domNode.insertAfter(t.firstChild,t);(0,o.detach)(t)}if(13===e.event.keyCode)for(var n=this.parent.editableElement.querySelectorAll("UL, OL"),i=0;i<n.length;i++)(0,o.isNullOrUndefined)(n[i])||(0,o.isNullOrUndefined)(n[i].parentElement)||(0,o.isNullOrUndefined)(n[i].previousElementSibling)||"UL"!==n[i].parentElement.nodeName&&"OL"!==n[i].parentElement.nodeName||n[i].previousElementSibling.appendChild(n[i])},e.prototype.firstListBackSpace=function(e,t){var n=this.parent.domNode.getSelectedNode(e.startContainer,e.startOffset),i=n.closest("LI");if(((0,o.isNullOrUndefined)(i)||this.isAtListStart(i,e))&&((0,o.isNullOrUndefined)(n.closest("OL"))?(0,o.isNullOrUndefined)(n.closest("UL"))||(this.commonLIParent=n.closest("UL")):this.commonLIParent=n.closest("OL"),!(0,o.isNullOrUndefined)(i)&&0===e.startOffset&&0===e.endOffset&&(0,o.isNullOrUndefined)(n.previousSibling)&&!(0,o.isNullOrUndefined)(this.commonLIParent)&&(0,o.isNullOrUndefined)(this.commonLIParent.previousSibling)&&(0,o.isNullOrUndefined)(this.commonLIParent.parentElement.closest("OL"))&&(0,o.isNullOrUndefined)(this.commonLIParent.parentElement.closest("UL"))&&(0,o.isNullOrUndefined)(this.commonLIParent.parentElement.closest("LI")))){var r=(0,o.createElement)("P");r.innerHTML="&#8203;",n.classList.add("removeList"),this.commonLIParent.parentElement.insertBefore(r,this.commonLIParent)}},e.prototype.isAtListStart=function(e,t){if("LI"!==e.nodeName)return!1;var n=e;return this.getFirstTextNode(n)===t.startContainer&&0===t.startOffset},e.prototype.getFirstTextNode=function(e){if(e.nodeType===Node.TEXT_NODE)return e;for(var t=0;t<e.childNodes.length;t++){var n=this.getFirstTextNode(e.childNodes[t]);if(n)return n}return null},e.prototype.keyDownHandler=function(e){if(13===e.event.which&&this.enterList(e),32===e.event.which&&this.spaceList(e),8===e.event.which&&this.backspaceList(e),46===e.event.which&&"delete"===e.event.action){var t=(a=this.parent.nodeSelection.getRange(this.parent.currentDocument)).commonAncestorContainer,n=a.startContainer,i=a.endContainer,r=3===n.nodeType?this.domNode.blockParentNode(n):n,s=3===i.nodeType?this.domNode.blockParentNode(i):i;"UL"!==t.nodeName&&"OL"!==t.nodeName||r===s||(0,o.isNullOrUndefined)((0,o.closest)(r,"ul"))&&(0,o.isNullOrUndefined)((0,o.closest)(r,"ol"))||(0,o.isNullOrUndefined)((0,o.closest)(s,"ul"))&&(0,o.isNullOrUndefined)((0,o.closest)(s,"ol"))||t.lastElementChild!==(0,o.closest)(s,"li")||t.lastChild===s||a.collapsed||this.areAllListItemsSelected(t,a)&&(0,o.detach)(t),this.removeList(a,e)}if(9===e.event.which){var a=this.parent.nodeSelection.getRange(this.parent.currentDocument);e.event.action&&"indent"===e.event.action||(this.saveSelection=this.parent.nodeSelection.save(a,this.parent.currentDocument)),e.enableTabKey&&this.handleListIndentation();var l=void 0;a.startOffset,a.endOffset;if((r=this.parent.domNode.getSelectedNode(a.startContainer,a.startOffset))===(s=this.parent.domNode.getSelectedNode(a.endContainer,a.endOffset))&&("BR"===r.nodeName||"#text"===r.nodeName)&&bs.indexOf(r.parentNode.tagName.toLocaleLowerCase())>=0)return;e.event.action&&"indent"===e.event.action||this.listTabIndentation||this.domNode.setMarker(this.saveSelection),l=this.domNode.blockNodes();for(var d=[],c=!0,h=0;h<l.length;h++)"LI"===l[h].parentNode.tagName?d.push(l[h].parentNode):(0,o.closest)(l[h],"OL")||(0,o.closest)(l[h],"UL")||!(0,o.closest)(l[h],"LI")?"LI"===l[h].tagName&&"P"!==l[h].childNodes[0].tagName&&"OL"!==l[h].childNodes[0].tagName&&"UL"!==l[h].childNodes[0].tagName&&d.push(l[h]):d.push((0,o.closest)(l[h],"LI"));d.length>1||1===d.length?(e.event.preventDefault(),e.event.stopPropagation(),this.currentAction=this.getAction(d[0]),e.event.shiftKey&&(!e.enableTabKey||e.enableTabKey&&!this.listTabIndentation)?(this.revertList(d,e),this.revertClean()):(!e.enableTabKey||e.enableTabKey&&!this.listTabIndentation)&&(c=this.nestedList(d)),c&&(this.cleanNode(),this.parent.editableElement.focus({preventScroll:!0})),e.event.action&&"indent"===e.event.action||this.listTabIndentation||(this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore(),e.callBack&&e.callBack({requestType:this.currentAction,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes(),event:e.event}))):e.event.action&&"indent"===e.event.action||this.listTabIndentation||(e.event&&e.event.shiftKey&&"Tab"===e.event.key&&(e.event.action="tab"),this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore()),this.listTabIndentation=!1}else switch(e.event.action){case"ordered-list":this.applyListsHandler({subCommand:"OL",callBack:e.callBack}),e.event.preventDefault();break;case"unordered-list":this.applyListsHandler({subCommand:"UL",callBack:e.callBack}),e.event.preventDefault()}},e.prototype.handleListIndentation=function(){var e=this.parent.nodeSelection.getRange(this.parent.currentDocument),t=this.saveSelection.getParentNodeCollection(e);if(("LI"===t[0].nodeName||(0,o.closest)(t[0],"li"))&&!this.isCursorAtStartOfLI(e)){var n=t[t.length-1],i=t[0],r=e.startContainer;if(n&&i){if(e.deleteContents(),n!==i){for(var s=r;s.parentElement;){if(this.parent.domNode.isBlockNode(s.parentElement)){s=s.parentElement;break}s=s.parentElement}var a=void 0;this.parent.domNode.isBlockNode(n.lastChild)?(r.nodeValue+="    ",a=r.nodeValue.length):n.innerHTML+='&nbsp;&nbsp;&nbsp;&nbsp;<span class="rte-tab-space"></span>';var l=i.firstChild;if(l&&this.parent.domNode.isBlockNode(l)){for(;l.firstChild;)s.appendChild(l.firstChild);l.remove()}for(;i.firstChild;)this.parent.domNode.isBlockNode(i.firstChild)?this.parent.domNode.insertAfter(i.firstChild,s):n.appendChild(i.firstChild);i.remove();var d=n.querySelector(".rte-tab-space");d&&d.previousSibling?(this.saveSelection.setCursorPoint(this.parent.currentDocument,d.previousSibling,d.previousSibling.textContent.length),d.parentNode.removeChild(d)):this.saveSelection.setCursorPoint(this.parent.currentDocument,r,a)}else pa.Insert(this.parent.currentDocument,"&nbsp;&nbsp;&nbsp;&nbsp;");this.listTabIndentation=!0}}},e.prototype.isCursorAtStartOfLI=function(e){for(var t=e.startContainer;t&&"LI"!==t.nodeName;)t=t.parentNode;if(!t)return!1;var n=e.cloneRange();return n.selectNodeContents(t),n.setEnd(e.startContainer,e.startOffset),""===n.toString().trim()},e.prototype.spaceKeyAction=function(e){32===e.event.which&&this.spaceList(e)},e.prototype.getAction=function(e){return"OL"===e.parentNode.nodeName?"OL":"UL"},e.prototype.revertClean=function(){for(var e=this.parent.editableElement.querySelectorAll("ul, ol"),t=0;t<e.length;t++){var n=e[t].querySelectorAll("ul, ol");if(n.length>0)for(var i=0;i<n.length;i++){var o=n[i].previousSibling;o&&"LI"===o.tagName&&o.appendChild(n[i])}}},e.prototype.noPreviousElement=function(e){var t,n,i=e.querySelectorAll("ol, ul"),r=e.querySelectorAll("li"),s=this.domNode.contents(r[0])[0];if(r.length>0&&(i.length<=1||i[0].childNodes.length>1)&&("OL"===s.nodeName||"UL"===s.nodeName)?t=r[0]:n=i[0],t)for(var a=this.domNode.contents(e)[0];a&&!this.domNode.isList(a);null){var l=a.nextSibling;(0,o.prepend)([a],t),(0,o.setStyleAttribute)(e,{"list-style-type":"none"}),(0,o.setStyleAttribute)(t,{"list-style-type":""}),a=l}else if(n){var d=(0,o.createElement)("li");(0,o.prepend)([d],n);for(a=this.domNode.contents(e)[0];a&&!this.domNode.isList(a);null){l=a.nextSibling;d.appendChild(a),a=l}(0,o.prepend)([n],e.parentNode),(0,o.detach)(e);var c=(0,o.createElement)("li",{styles:"list-style-type: none;"});(0,o.prepend)([c],n.parentNode),(0,o.append)([n],c)}else{c=(0,o.createElement)("li",{styles:"list-style-type: none;"});(0,o.prepend)([c],e.parentNode);d=(0,o.createElement)(e.parentNode.tagName);(0,o.prepend)([d],c),(0,o.append)([e],d)}},e.prototype.nestedList=function(e){for(var t=!1,n=0;n<e.length;n++){var i=this.domNode.getPreviousNode(e[n]);if(i){t=!0;var r=void 0,s=void 0,a=e[n].querySelectorAll("ol, ul"),l=e[n].querySelectorAll("li"),d=this.domNode.contents(l[0])[0];if(l.length>0&&(a.length<=1||a[0].childNodes.length>1)&&("OL"===d.nodeName||"UL"===d.nodeName)?s=l[0]:r=a[0],r){var c=(0,o.createElement)("li");(0,o.prepend)([c],r);for(var h=this.domNode.contents(e[n])[0];h&&!this.domNode.isList(h);null){var p=h.nextSibling;c.appendChild(h),h=p}(0,o.append)([r],i),(0,o.detach)(e[n])}else if(s){if("LI"===i.tagName){for(h=this.domNode.contents(e[n])[0];h&&!this.domNode.isList(h);null){p=h.nextSibling;(0,o.prepend)([h],s),(0,o.setStyleAttribute)(e[n],{"list-style-type":"none"}),(0,o.setStyleAttribute)(s,{"list-style-type":""}),h=p}(0,o.append)([s.parentNode],i),(0,o.detach)(e[n])}}else{if("LI"===i.tagName)(c=(0,o.createElement)(e[n].parentNode.tagName)).style.listStyleType=e[n].parentNode.style.listStyleType,(0,o.append)([c],i),(0,o.append)([e[n]],c);else"OL"!==i.tagName&&"UL"!==i.tagName||(0,o.append)([e[n]],i)}}else{var u=e[n];t=!0,this.noPreviousElement(u)}}return t},e.prototype.isCursorBeforeTable=function(e){return e.startOffset===e.endOffset&&e.startContainer.childNodes.length>0&&!(0,o.isNullOrUndefined)(e.startContainer.childNodes[e.startOffset])&&"TABLE"===e.startContainer.childNodes[e.startOffset].nodeName},e.prototype.isCursorAtEndOfTable=function(e){return e.startOffset===e.endOffset&&e.startContainer.childNodes.length>0&&!(0,o.isNullOrUndefined)(e.startContainer.childNodes[e.startOffset-1])&&"TABLE"===e.startContainer.childNodes[e.startOffset-1].nodeName},e.prototype.isListItemWithTableChild=function(e){return"LI"===e.nodeName&&!(0,o.isNullOrUndefined)(e.firstChild)&&"TABLE"===e.firstChild.nodeName},e.prototype.applyListsHandler=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument);if(-1!==o.Browser.userAgent.indexOf("Firefox")&&t.startContainer===t.endContainer&&t.startContainer===this.parent.editableElement){for(var n=t.startContainer.childNodes[t.startOffset>0?t.startOffset-1:t.startOffset]||t.startContainer,i=t.endContainer.childNodes[t.endOffset>0?t.endOffset-1:t.endOffset]||t.endContainer,r="BR"===i.lastChild.nodeName?(0,o.isNullOrUndefined)(i.lastChild.previousSibling)?i:i.lastChild.previousSibling:i.lastChild;!(0,o.isNullOrUndefined)(r)&&"#text"!==r.nodeName&&"IMG"!==r.nodeName&&"BR"!==r.nodeName&&"HR"!==r.nodeName;)r=r.lastChild;this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,n,r,0,r.textContent.length),t=this.parent.nodeSelection.getRange(this.parent.currentDocument)}if(t.startContainer===t.endContainer&&t.startContainer===this.parent.editableElement&&t.startOffset===t.endOffset&&0===t.startOffset&&0===this.parent.editableElement.textContent.length&&"TABLE"!==this.parent.editableElement.childNodes[0].nodeName&&"IMG"!==this.parent.editableElement.childNodes[0].nodeName){var s=t.startContainer.childNodes[0];this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,s,s,0,0),t=this.parent.nodeSelection.getRange(this.parent.currentDocument)}this.saveSelection=this.parent.nodeSelection.save(t,this.parent.currentDocument),this.currentAction=e.subCommand,this.currentAction=e.subCommand="NumberFormatList"===this.currentAction?"OL":"BulletFormatList"===this.currentAction?"UL":this.currentAction,this.domNode.setMarker(this.saveSelection);var a=this.domNode.blockNodes(!0);"BR"===e.enterAction&&(this.isCursorBeforeTable(t)?a=[t.startContainer.childNodes[t.startOffset]]:this.isCursorAtEndOfTable(t)?a=[t.startContainer.childNodes[t.startOffset-1]]:1===a.length&&this.isListItemWithTableChild(a[0])?a[0]=a[0].firstChild:(this.setSelectionBRConfig(),this.parent.domNode.convertToBlockNodes(this.parent.domNode.blockNodes(),!0),this.setSelectionBRConfig(),a=this.parent.domNode.blockNodes()));for(var l=0;l<a.length;l++)"TABLE"!==a[l].tagName||t.collapsed||a.splice(l,1),a.length>0&&"LI"!==a[l].tagName&&"LI"===a[l].parentNode.tagName&&(a[l]=a[l].parentNode);this.applyLists(a,this.currentAction,e.selector,e.item,e),e.callBack&&e.callBack({requestType:this.currentAction,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},e.prototype.setSelectionBRConfig=function(){var e=this.parent.editableElement.querySelector("."+_s.startSelection),t=this.parent.editableElement.querySelector("."+_s.endSelection);(0,o.isNullOrUndefined)(t)?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,0):this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,e,t,0,0)},e.prototype.applyLists=function(e,t,n,i,r){if(this.isRevert(e,t,i)&&(0,o.isNullOrUndefined)(i))this.revertList(e,r),this.removeEmptyListElements();else{this.checkLists(e,t,i);var s="";""!==e[0].style.marginLeft&&(s=' style = "margin-left: '+e[0].style.marginLeft+';"');for(var a=0;a<e.length;a++){(0,o.isNullOrUndefined)(i)||(0,o.isNullOrUndefined)(i.listStyle)||("listImage"===i.listStyle?(0,o.setStyleAttribute)(e[a],{"list-style-image":i.listImage}):((0,o.setStyleAttribute)(e[a],{"list-style-image":"none"}),(0,o.setStyleAttribute)(e[a],{"list-style-type":i.listStyle.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}))),e[a].style.removeProperty("margin-left");var l="IMG"===e[a].tagName||e[a].classList.contains("e-editor-select-start")?"":this.domNode.attributes(e[a]);if("true"===e[a].getAttribute("contenteditable")&&1===e[a].childNodes.length&&"TABLE"===e[a].childNodes[0].nodeName){var d=document.createElement(t);d.innerHTML="<li><br/></li>",e[a].appendChild(d)}else if("LI"!==e[a].tagName&&(0,o.isNullOrUndefined)(i)&&"BLOCKQUOTE"===e[a].nodeName){0;var c="<"+t+s+">",h="</"+t+">",p="li"+l,u=e[a].innerHTML,m=c+(f=this.domNode.createTagString(p,null,u))+h;e[a].innerHTML=m}else if("LI"!==e[a].tagName&&(0,o.isNullOrUndefined)(i)){0;c="<"+t+s+">",h="</"+t+">",p="li"+l,u=e[a].tagName.toLowerCase()===fs?e[a].innerHTML:e[a].outerHTML;var f=this.domNode.createTagString(p,null,u);m=c+(f=this.setStyle(f))+h;this.domNode.replaceWith(e[a],m)}else if(!(0,o.isNullOrUndefined)(i)&&"LI"!==e[a].tagName){0;c="<"+t+("IMG"===e[a].tagName?"":this.domNode.attributes(e[a]))+">",h="</"+t+">",p="li",u=e[a].tagName.toLowerCase()===fs?e[a].innerHTML:e[a].outerHTML,m=c+(f=this.domNode.createTagString(p,null,u))+h;this.domNode.replaceWith(e[a],m)}}}(this.cleanNode(),"BR"===r.enterAction)&&document.querySelectorAll("span#removeSpan").forEach((function(e){for(var t=document.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e)}));this.parent.editableElement.focus({preventScroll:!0}),Us()&&Ps(this.parent.editableElement,n),this.saveSelection=this.domNode.saveMarker(this.saveSelection),this.saveSelection.restore()},e.prototype.setStyle=function(e){var t=document.createElement("div");t.innerHTML=e.trim();var n=t.querySelector("li"),i=n;if(n&&1===n.children.length){for(var r=function(){var e=n.firstChild;if(e&&(e.style.cssText||"B"===e.tagName.toUpperCase()||"STRONG"===e.tagName.toUpperCase()||"I"===e.tagName.toUpperCase()||"EM"===e.tagName.toUpperCase())){var t=["font-size","font-family","color","font-weight"],r=e.style.cssText.split(";").map((function(e){return e.trim()})).filter((function(e){var n=(0,o.isNullOrUndefined)(e.split(":")[0])?"":e.split(":")[0].trim();return n&&-1!==t.indexOf(n)})).join(";");r?i.style.cssText+=(i.style.cssText?";":"")+r:"B"===e.tagName.toUpperCase()||"STRONG"===e.tagName.toUpperCase()?(r="font-weight: bold;",i.style.cssText+=(i.style.cssText?";":"")+r):"I"!==e.tagName.toUpperCase()&&"EM"!==e.tagName.toUpperCase()||(r="font-style: italic;",i.style.cssText+=(i.style.cssText?";":"")+r)}n=e};n&&1===n.children.length&&n.firstChild&&n.firstChild.nodeType!==Node.TEXT_NODE;)r();e=t.innerHTML}return e},e.prototype.removeEmptyListElements=function(){for(var e=this.parent.editableElement.querySelectorAll("ol, ul"),t=0;t<e.length;t++)""===e[t].textContent.trim()&&(0,o.detach)(e[t])},e.prototype.isRevert=function(e,t,n){for(var i=!0,r=0;r<e.length;r++){if("LI"!==e[r].tagName)return!1;(e[r].parentNode.tagName!==t||(0,o.isNullOrUndefined)(n)&&""!==e[r].parentNode.style.listStyleType)&&(i=!1),e[r].parentNode.tagName===t&&""!==e[r].parentNode.style.listStyleType&&(i=!0)}return i},e.prototype.checkLists=function(e,t,n){for(var i=[],r=0;r<e.length;r++){var s=e[r].parentNode;(0,o.isNullOrUndefined)(n)||"LI"!==e[r].tagName||(0,o.isNullOrUndefined)(n.listStyle)||("listImage"===n.listStyle?(0,o.setStyleAttribute)(s,{"list-style-image":n.listImage}):((0,o.setStyleAttribute)(s,{"list-style-image":"none"}),(0,o.setStyleAttribute)(s,{"list-style-type":n.listStyle.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}))),("LI"===e[r].tagName&&s.tagName!==t&&i.indexOf(s)<0||"LI"===e[r].tagName&&s.tagName===t&&i.indexOf(s)<0&&null!==n)&&i.push(s),(0,o.isNullOrUndefined)(n)&&(s.tagName===t||("UL"===s.tagName||"OL"===s.tagName)&&s.hasAttribute("style"))&&s.hasAttribute("style")&&s.removeAttribute("style")}for(var a=i.length-1;a>=0;a--){var l=i[a],d="<"+t.toLowerCase()+" "+this.domNode.attributes(l)+">"+l.innerHTML+"</"+t.toLowerCase()+">";this.domNode.replaceWith(i[a],d)}},e.prototype.cleanNode=function(){for(var e,t,n=this.parent.editableElement.querySelectorAll("ol + ol, ul + ul"),i=0;i<n.length;i++){for(var r=n[i],s=!0,a=r;a.parentElement&&(!a.parentElement||"LI"===a.parentElement.tagName||"OL"===a.parentElement.tagName||"UL"===a.parentElement.tagName);)a=a.parentElement;if(s&&("OL"===n[i].parentElement.parentElement.nodeName||"UL"===n[i].parentElement.parentElement.nodeName))s=!1,e=n[i].parentElement.parentElement.style.listStyleType,t=r.previousElementSibling;if(this.domNode.isList(r.previousElementSibling)&&this.domNode.openTagString(r)===this.domNode.openTagString(r.previousElementSibling)){for(var l=this.domNode.contents(r),d=0;d<l.length;d++)r.previousElementSibling.appendChild(l[d]);r.parentNode.removeChild(r)}else if((0,o.isNullOrUndefined)(r.getAttribute("level"))){if(this.domNode.isList(r.previousElementSibling)&&a.contains(r.previousElementSibling)&&("OL"===r.tagName||"UL"===r.tagName)&&("OL"===r.previousElementSibling.nodeName||"UL"===r.previousElementSibling.nodeName)){for(l=this.domNode.contents(r),d=0;d<l.length;d++)r.previousElementSibling.appendChild(l[d]);r.parentNode.removeChild(r)}}else r.tagName===r.previousElementSibling.tagName&&r.previousElementSibling.lastChild.append(r)}if(t){t.style.listStyleType=e;var c=this.parent.nodeSelection.getRange(this.parent.currentDocument),h=[];"UL"===c.commonAncestorContainer.nodeName||"OL"===c.commonAncestorContainer.nodeName?(c.commonAncestorContainer instanceof Element&&h.push(c.commonAncestorContainer),h=h.concat(Array.from(c.commonAncestorContainer.querySelectorAll("ol, ul")))):h=Array.from(c.commonAncestorContainer.querySelectorAll("ol, ul"));for(var p=0;p<h.length;p++)for(var u=void 0,m=h[p];m;)"OL"!==m.nodeName&&"OL"!==m.nodeName||(""!==m.style.listStyleType&&"none"!==m.style.listStyleType&&"LI"!==m.nodeName?u=m.style.listStyleType:(0,o.isNullOrUndefined)(u)||""!==m.style.listStyleType&&"none"!==m.style.listStyleType||"LI"===m.nodeName||"UL"!==m.nodeName&&"OL"!==m.nodeName||(m.style.listStyleType=u)),m=m.querySelector("UL,OL")}},e.prototype.findUnSelected=function(e,t){if((e=e.slice().reverse()).length>0){var n=[],i=[],o=[],r=[];o=t[t.length-1].childNodes;for(var s=0;s<o.length;s++)if("OL"===o[s].tagName||"UL"===o[s].tagName){var a=o[s].querySelectorAll("li");if(a.length>0)for(var l=0;l<a.length;l++)r.push(a[l])}for(var d=0;d<r.length;d++){for(var c=0,h=0;h<e.length;h++)r[d].contains(e[h])||(c+=1);c===e.length&&i.push(r[d])}if(i.length>0)for(var p=0;p<i.length;p++)"OL"!==this.domNode.contents(i[p])[0].nodeName&&"UL"!==this.domNode.contents(i[p])[0].nodeName&&n.push(i[p]);n.length>0&&this.nestedList(n)}},e.prototype.revertList=function(e,t){for(var n=[],i=e.length-1;i>=0;i--)for(var r=i-1;r>=0;r--)if(e[r].contains(e[i])||e[r]===e[i]){n.push(e[i]),e.splice(i,1);break}this.findUnSelected(n,e);var s=[];for(i=0;i<e.length;i++){var a=e[i];3===this.domNode.contents(a)[0].nodeType&&0===this.domNode.contents(a)[0].textContent.trim().length&&(0,o.detach)(this.domNode.contents(a)[0]);var l=e[i].parentNode,d=a.getAttribute("class");if(0===n.length){var c=e[i].querySelectorAll("ul, ol")[0];if(c)if(c.querySelectorAll("li")){var h=(0,o.createElement)(c.tagName);(0,o.append)([h],c.parentNode);var p=(0,o.createElement)("li",{styles:"list-style-type: none;"});(0,o.append)([p],h),(0,o.append)([c],p)}}if(a.parentNode.insertBefore(this.closeTag(l.tagName),a),"LI"===l.parentNode.tagName||"OL"===l.parentNode.tagName||"UL"===l.parentNode.tagName)a.parentNode.insertBefore(this.closeTag("LI"),a);else{d&&' class="'+d+'"';var u=this.getClosestListParentMargin(a);if(fs&&0===a.querySelectorAll(gs.join(", ")).length){var m=(0,o.isNullOrUndefined)(d)?' class="e-rte-wrap-inner"':' class="'+d+' e-rte-wrap-inner"',f=l;e.length===f.querySelectorAll("li").length&&((0,o.isNullOrUndefined)(f.style.listStyleType)||l.style.removeProperty("list-style-type"),(0,o.isNullOrUndefined)(f.style.listStyleImage)||l.style.removeProperty("list-style-image"),0===f.style.length&&l.removeAttribute("style"));var g=(0,o.isNullOrUndefined)(t.enterAction)?fs:t.enterAction,b="<"+g+m+this.domNode.attributes(a)+"></"+g+">",v=document.createElement("div");if(v.innerHTML=b,""!==u&&(v.firstElementChild.style.marginLeft=u),"BR"!==t.enterAction)this.domNode.wrapInner(a,this.domNode.parseHTMLFragment(v.innerHTML));else{var y=document.createElement("br");this.domNode.wrapInner(a,this.domNode.parseHTMLFragment("<span class=e-rte-wrap-inner id=removeSpan></span>")),a.appendChild(y)}}else if(3===this.domNode.contents(a)[0].nodeType){var C=this.domNode.createTagString(fs,l,this.parent.domNode.encode(this.domNode.contents(a)[0].textContent));this.domNode.replaceWith(this.domNode.contents(a)[0],C)}else if(this.domNode.contents(a)[0].classList.contains(_s.startSelection)||this.domNode.contents(a)[0].classList.contains(_s.endSelection)){C=this.domNode.createTagString(fs,l,"<br>"+this.domNode.contents(a)[0].outerHTML);this.domNode.contents(a)[1]&&"BR"===this.domNode.contents(a)[1].tagName?(this.domNode.contents(a)[1].remove(),C=this.domNode.createTagString(fs,l,"<br>"+this.domNode.contents(a)[0].outerHTML)):C=this.domNode.createTagString(fs,l,this.domNode.contents(a)[0].outerHTML),this.domNode.replaceWith(this.domNode.contents(a)[0],C)}else{var N=a.firstChild;if(N){var E=a.parentElement.attributes;if(E.length>0)for(var S=0;S<E.length;S++){var T=E[S],O=function(e){return e?e.split(";").filter((function(e){return!/list-style-(image|type):/.test(e.trim())})).join(";").trim():""},L=O(N.getAttribute(T.nodeName)),k=O(a.parentElement.getAttribute(T.nodeName));L&&L!==k?N.setAttribute(T.nodeName,L?k+" "+L:k):N.setAttribute(T.nodeName,k),0===N.style.length&&N.removeAttribute("style")}}(d=N.getAttribute("class"))&&N.getAttribute("class")&&d!==N.getAttribute("class")&&(0,o.attributes)(N,{class:d+" "+N.getAttribute("class")})}(0,o.append)([this.openTag("LI")],a),(0,o.prepend)([this.closeTag("LI")],a)}this.domNode.insertAfter(this.openTag(l.tagName),a),"LI"===l.parentNode.tagName&&(l=l.parentNode.parentNode),s.indexOf(l)<0&&s.push(l)}for(i=0;i<s.length;i++){var x=s[i],w=x.innerHTML;w=(w=w.replace(/<span class="e-rte-list-close-([a-z]*)"><\/span>/g,"</$1>")).replace(/<span class="e-rte-list-open-([a-z]*)"><\/span>/g,"<$1 "+this.domNode.attributes(x)+">"),this.domNode.replaceWith(x,this.domNode.openTagString(x)+w.trim()+this.domNode.closeTagString(x))}var D=this.parent.editableElement.querySelectorAll("ul:empty, ol:empty");for(i=0;i<D.length;i++)(0,o.detach)(D[i]);var M=this.parent.editableElement.querySelectorAll("li:empty");for(i=0;i<M.length;i++)(0,o.detach)(M[i])},e.prototype.getClosestListParentMargin=function(e){for(var t=e;t&&t!==this.parent.editableElement;){if("UL"===t.nodeName||"OL"===t.nodeName)return t.style.marginLeft;t=t.parentElement}return""},e.prototype.openTag=function(e){return this.domNode.parseHTMLFragment('<span class="e-rte-list-open-'+e.toLowerCase()+'"></span>')},e.prototype.closeTag=function(e){return this.domNode.parseHTMLFragment('<span class="e-rte-list-close-'+e.toLowerCase()+'"></span>')},e.prototype.destroy=function(){this.removeEventListener(),this.domNode&&(this.domNode=null)},e.prototype.areAllListItemsSelected=function(e,t){for(var n=e.querySelectorAll("li"),i=0;i<n.length;i++){var o=n[i];if(this.parent.currentDocument.createRange().selectNodeContents(o),!t.intersectsNode(o))return!1}return!0},e.prototype.getListCursorInfo=function(e){var t,n,i=new ua(this.parent.editableElement),o=e.startContainer.nodeType===Node.TEXT_NODE?i.getTopMostNode(e.startContainer):e.startContainer,r=e.endContainer.nodeType===Node.TEXT_NODE?i.getTopMostNode(e.endContainer):e.endContainer,s=!e.collapsed,a=o.nodeType===Node.TEXT_NODE?o.parentElement.closest("li"):o.closest("li"),l=r.nodeType===Node.TEXT_NODE?r.parentElement.closest("li"):r.closest("li"),d=!(!a||!a.closest("ol, ul"))&&this.checkIsNestedList(a.closest("ol, ul")),c=!(!l||!l.closest("ol, ul"))&&this.checkIsNestedList(l.closest("ol, ul")),h=this.parent.domNode.blockNodes(),p=h.length,u=this.getListSelectionType(d?"Nested":"Parent",c?"Nested":"Parent");return s?(n=1===h.length?0===e.startOffset&&e.endOffset===a.textContent.length?"SingleFull":"SinglePartial":0===e.startOffset&&e.endOffset===h[p-1].textContent.length?"MultipleFull":"MultiplePartial",t="None"):(t=0===e.startOffset&&null===o.previousSibling?d?"StartNested":"StartParent":e.startOffset===a.textContent.length&&null===o.nextSibling?d?"EndNested":"EndParent":d?"MiddleNested":"MiddleParent",n="None"),{position:t,selectionState:n,itemType:u}},e.prototype.checkIsNestedList=function(e){return!(e.parentElement===this.parent.editableElement)&&!!e.closest("li")},e.prototype.getListSelectionType=function(e,t){return"Nested"===e&&"Nested"===t?"Nested":"Parent"===e&&"Parent"===t?"Parent":"Mixed"},e.prototype.isAllListNodesSelected=function(e){for(var t=this.parent.currentDocument.getSelection(),n=!1,i=e.querySelectorAll("li"),o=0;o<i.length;o++){if(!t.containsNode(i[o],!1)){n=!1;break}n=!0}return n},e}(),fa=function(){function e(e){this.blockquotePrevent=!1,this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Ks,this.applyFormats,this),this.parent.observer.on(Ys,this.onKeyUp,this),this.parent.observer.on(Gs,this.onKeyDown,this),this.parent.observer.on(ra,this.blockQuotesHandled,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Ks,this.applyFormats),this.parent.observer.off(Ys,this.onKeyUp),this.parent.observer.off(Gs,this.onKeyDown),this.parent.observer.off(da,this.destroy)},e.prototype.getParentNode=function(e){for(var t=e,n=["DIV","SECTION","ARTICLE","ASIDE","FOOTER","HEADER","NAV","MAIN"];e.parentNode&&e.parentNode!==this.parent.editableElement;null)e=e.parentNode;if(-1!==n.indexOf(e.nodeName.toUpperCase()))for(e=t;-1===n.indexOf(e.nodeName.toUpperCase())&&-1===n.indexOf(e.parentNode.nodeName.toUpperCase());)e=e.parentNode;return e},e.prototype.blockQuotesHandled=function(){this.blockquotePrevent=!0},e.prototype.onKeyUp=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=t.endContainer,i=n.lastChild;if(13===e.event.which&&t.startContainer===n&&3!==n.nodeType)if((s=(0,o.createElement)("p")).innerHTML="<br>",!(0,o.isNullOrUndefined)(i)&&i&&"BR"===i.nodeName&&i.previousSibling&&"TABLE"===i.previousSibling.nodeName)n.replaceChild(s,i),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,s,0);else{var r=this.parent.nodeSelection.getSelectionNodeCollectionBr(t)[0];!(0,o.isNullOrUndefined)(r)&&"BR"===r.nodeName&&r.previousSibling&&"TABLE"===r.previousSibling.nodeName&&(n.replaceChild(s,r),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,s,0))}if("BR"!==e.enterAction&&!(0,o.isNullOrUndefined)(t.startContainer)&&!(0,o.isNullOrUndefined)(t.startContainer.parentElement)&&t.startContainer===t.endContainer&&"#text"===t.startContainer.nodeName&&t.startContainer.parentElement.classList.contains("e-content")&&t.startContainer.parentElement.isContentEditable){var s=(0,o.createElement)(e.enterAction);t.startContainer.parentElement.insertBefore(s,t.startContainer),s.appendChild(t.startContainer),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,s,1)}},e.prototype.getBlockParent=function(e,t){for(var n=e;e!==t;)n=e,e=e.parentElement;return n},e.prototype.onKeyDown=function(e){if(13===e.event.which&&!this.blockquotePrevent){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=0===t.startContainer.textContent.length||"PRE"===t.startContainer.nodeName?t.startContainer:t.startContainer.parentElement,i=0===t.endContainer.textContent.length||"PRE"===t.endContainer.nodeName?t.endContainer:t.endContainer.parentElement,r=(0,o.closest)(n,"pre"),s=(0,o.closest)(i,"pre"),a=(0,o.closest)(n,"blockquote"),l=(0,o.closest)(i,"blockquote");if(!(0,o.isNullOrUndefined)(r)&&!(0,o.isNullOrUndefined)(r.parentElement)&&"LI"===r.parentElement.tagName)return;if(((0,o.isNullOrUndefined)(r)&&!(0,o.isNullOrUndefined)(s)||!(0,o.isNullOrUndefined)(r)&&(0,o.isNullOrUndefined)(s))&&(e.event.preventDefault(),this.deleteContent(t),this.removeCodeContent(t),t=this.parent.nodeSelection.getRange(this.parent.currentDocument),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0)),13===e.event.which&&(!(0,o.isNullOrUndefined)(a)&&!(0,o.isNullOrUndefined)(l)||!(0,o.isNullOrUndefined)(a)&&(0,o.isNullOrUndefined)(l)))if(8203===(h=this.getBlockParent(t.startContainer,a)).textContent.charCodeAt(0)&&1===h.textContent.length||0===h.textContent.length&&0===h.querySelectorAll("img").length&&0===h.querySelectorAll("table").length)if(e.event.preventDefault(),(0,o.isNullOrUndefined)(h.nextElementSibling))this.paraFocus(h.parentElement===this.parent.editableElement?h:h.parentElement);else{(new ha).SplitNode(t,h.parentElement,!1).cloneNode(!0);this.paraFocus(h.parentElement===this.parent.editableElement?h:h.parentElement)}if(13===e.event.which&&!(0,o.isNullOrUndefined)(r)&&!(0,o.isNullOrUndefined)(s)){e.event.preventDefault(),this.deleteContent(t),this.removeCodeContent(t);var d=(t=this.parent.nodeSelection.getRange(this.parent.currentDocument)).startContainer.childNodes[t.endOffset],c=t.startContainer.childNodes[t.endOffset-1],h=t.startContainer;if((0,o.isNullOrUndefined)(d)||(0,o.isNullOrUndefined)(c)||!(0,o.isNullOrUndefined)(d.nextSibling)||"BR"!==d.nodeName||"BR"!==c.nodeName)if(8203===h.textContent.charCodeAt(0)&&1===h.textContent.length||0===h.textContent.length){for(;"PRE"!==h.parentElement.nodeName&&(1===h.textContent.length||0===h.textContent.length);)h=h.parentElement;!(0,o.isNullOrUndefined)(h.previousSibling)&&"BR"===h.previousSibling.nodeName&&(0,o.isNullOrUndefined)(h.nextSibling)?this.paraFocus(h.parentElement):this.isNotEndCursor(r,t)}else this.isNotEndCursor(r,t);else this.paraFocus(t.startContainer,e.enterAction)}}this.blockquotePrevent=!1},e.prototype.removeCodeContent=function(e){var t=new RegExp("\ufeff","g");if(!(0,o.isNullOrUndefined)(e.endContainer.textContent.match(t))){var n=65279===e.endContainer.textContent.charCodeAt(e.endOffset-1)?e.endOffset-2:e.endOffset;e.endContainer.textContent=e.endContainer.textContent.replace(t,""),""===e.endContainer.textContent?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e.endContainer.parentElement,0):this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e.endContainer,n)}},e.prototype.deleteContent=function(e){e.startContainer===e.endContainer&&e.startOffset===e.endOffset||e.deleteContents()},e.prototype.paraFocus=function(e,t){var n;"DIV"===t?(n=(0,o.createElement)("div")).innerHTML="<br>":"BR"===t?n=(0,o.createElement)("br"):(n=(0,o.createElement)("p")).innerHTML="<br>",this.parent.domNode.insertAfter(n,e),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,n,0),(0,o.detach)(e.lastChild)},e.prototype.isNotEndCursor=function(e,t){var n=new ha,i=t.startOffset===e.lastChild.textContent.length&&e.lastChild.textContent===t.startContainer.textContent;if(0===e.textContent.indexOf(t.startContainer.textContent)&&(0===t.startOffset&&0===t.endOffset||"PRE"===t.startContainer.nodeName)){this.insertMarker(e,t);var r=(0,o.createElement)("br");e.childNodes[t.endOffset].parentElement.insertBefore(r,e.childNodes[t.endOffset])}else{var s=n.SplitNode(t,e,!0);this.insertMarker(e,t);var a=e.previousElementSibling;"PRE"===a.tagName&&(a.insertAdjacentHTML("beforeend","<br>"+s.innerHTML),(0,o.detach)(e))}this.setCursorPosition(i,e)},e.prototype.setCursorPosition=function(e,t){var n=!1,i=this.parent.editableElement.querySelector(".tempSpan"),r=i.parentElement;if(""===i.parentNode.textContent?n=!0:this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),e)if(n)r===t?(this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),(0,o.detach)(i)):this.focusSelectionParent(i,r);else{var s=(0,o.createElement)("br");this.parent.domNode.insertAfter(s,i),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),(0,o.detach)(i)}else n?this.focusSelectionParent(i,r):(0,o.detach)(i)},e.prototype.focusSelectionParent=function(e,t){(0,o.detach)(e),t.innerHTML="​",this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,t,0)},e.prototype.insertMarker=function(e,t){var n=(0,o.createElement)("span",{className:"tempSpan"});"PRE"===t.startContainer.nodeName?e.childNodes[t.endOffset].parentElement.insertBefore(n,e.childNodes[t.endOffset]):t.startContainer.parentElement.insertBefore(n,t.startContainer)},e.prototype.applyFormats=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection.processedTableImageCursor(t);if(!n.start&&!n.end||"blockquote"===e.subCommand.toLowerCase()||"TABLE"!==n.startName&&"TABLE"!==n.endName){var i=!1;this.parent.editableElement!==t.endContainer||(0,o.isNullOrUndefined)(this.parent.editableElement.children[t.endOffset-1])||"TABLE"!==this.parent.editableElement.children[t.endOffset-1].tagName||t.collapsed||(i=!0);var r=this.parent.nodeSelection.save(t,this.parent.currentDocument);this.parent.domNode.setMarker(r);var s=this.parent.domNode.blockNodes(!0);if("BR"===e.enterAction){this.setSelectionBRConfig();var a=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),l=this.parent.nodeSelection.getSelectionNodes(a),d=[];0===l.length&&l.push(s[0]);for(var c=0;c<l.length;c++){for(var h=l[c],p=void 0;!this.parent.domNode.isBlockNode(h)&&h!==this.parent.editableElement;)p=h,h=h.parentElement;this.parent.domNode.isBlockNode(h)&&h===this.parent.editableElement&&d.push(p)}for(c=0;c<d.length;c++)if(!this.parent.domNode.isBlockNode(d[c])){for(var u=h=d[c];h===this.parent.editableElement;)u=h,h=h.parentElement;var m=void 0;this.parent.domNode.isBlockNode(u.parentElement)&&u.parentElement===this.parent.editableElement?(m=(0,o.createElement)("div"),u.parentElement.insertBefore(m,u),m.appendChild(u),0===u.textContent.length&&u.appendChild((0,o.createElement)("br"))):m=u;for(var f=m.previousSibling;!(0,o.isNullOrUndefined)(f)&&"BR"!==f.nodeName&&!this.parent.domNode.isBlockNode(f);)m.firstChild.parentElement.insertBefore(f,m.firstChild),f=m.previousSibling;(0,o.isNullOrUndefined)(f)||"BR"!==f.nodeName||(0,o.detach)(f);for(var g=m.nextSibling;!(0,o.isNullOrUndefined)(g)&&"BR"!==g.nodeName&&!this.parent.domNode.isBlockNode(g);)m.appendChild(g),g=m.nextSibling;(0,o.isNullOrUndefined)(g)||"BR"!==g.nodeName||(0,o.detach)(g)}this.setSelectionBRConfig(),s=this.parent.domNode.blockNodes()}var b=!1,v=!1;for(c=0;c<s.length;c++)((0,o.isNullOrUndefined)((0,o.closest)(s[0],"blockquote"))||(0,o.isNullOrUndefined)((0,o.closest)(s[s.length-1],"blockquote")))&&(v=!0);var y=!1;for(c=0;c<s.length;c++){var C=void 0,N=void 0;if("blockquote"===e.subCommand.toLowerCase()?(C=this.getParentNode(s[c]),N="BR"===e.enterAction?C.innerHTML:!(0,o.isNullOrUndefined)((0,o.closest)(s[c],"table"))&&this.parent.editableElement.contains((0,o.closest)(s[c],"table"))?(0,o.isNullOrUndefined)((0,o.closest)(s[c],"blockquote"))?s[c].outerHTML:(0,o.closest)(s[c],"blockquote").outerHTML:C.outerHTML):N=(C=s[c]).innerHTML,!("blockquote"===e.subCommand.toLowerCase()&&e.subCommand.toLowerCase()===C.tagName.toLowerCase()&&v||e.subCommand.toLowerCase()===C.tagName.toLowerCase()&&("pre"!==e.subCommand.toLowerCase()&&"blockquote"!==e.subCommand.toLowerCase()||!(0,o.isNullOrUndefined)(e.exeValue)&&"dropDownSelect"===e.exeValue.name)||(0,o.isNullOrUndefined)(C.parentNode)||"TABLE"===C.tagName&&"pre"===e.subCommand.toLowerCase())){this.cleanFormats(C,e.subCommand);var E="pre"===e.subCommand.toLowerCase()&&"pre"===C.tagName.toLowerCase()?"p":e.subCommand,S=e.subCommand.toLowerCase()===C.tagName.toLowerCase()&&"blockquote"===e.subCommand.toLowerCase()&&!(0,o.isNullOrUndefined)((0,o.closest)(s[c],"li")),T="TABLE"===C.tagName?(0,o.isNullOrUndefined)((0,o.closest)(s[c],"blockquote"))?C:(0,o.closest)(s[c],"blockquote"):C;y=e.subCommand.toLowerCase()===T.tagName.toLowerCase()&&"blockquote"===e.subCommand.toLowerCase();var O=void 0,L=this.getNode(s[c]),k=this.getNode(s[s.length-1]);if(((0,o.isNullOrUndefined)((0,o.closest)(s[c],"table"))||(0,o.isNullOrUndefined)((0,o.closest)(s[c],"td"))&&(0,o.isNullOrUndefined)((0,o.closest)(s[c],"th"))?y&&C.firstChild===L&&C.lastChild===k:this.hasOnlyBlockquotes((0,o.closest)(s[c],"td")||(0,o.closest)(s[c],"th")))?O=N.replace(/<blockquote[^>]*>|<\/blockquote>/g,""):S?(b=!0,0===c&&this.createBlockquoteSpan("e-rte-blockquote-close",L,"before"),c===s.length-1&&this.createBlockquoteSpan("e-rte-blockquote-open",k,"after")):y&&(0,o.closest)(s[0],"blockquote")&&(0,o.closest)(s[s.length-1],"blockquote")?(b=!0,0===c&&this.createBlockquoteSpan("e-rte-blockquote-close",s[c],"before"),c===s.length-1&&this.createBlockquoteSpan("e-rte-blockquote-open",s[c],"after")):O=this.parent.domNode.createTagString(E,"blockquote"===e.subCommand.toLowerCase()?null:C,N.replace(/>\s+</g,"><")),"LI"===C.tagName)C.innerHTML="",C.insertAdjacentHTML("beforeend",O);else if(!b){var x=!(0,o.isNullOrUndefined)((0,o.closest)(s[c],"table"))&&this.parent.editableElement.contains((0,o.closest)(s[c],"table"))?(0,o.isNullOrUndefined)((0,o.closest)(s[c],"blockquote"))?s[c]:(0,o.closest)(s[c],"blockquote"):C;this.parent.domNode.replaceWith(x,O)}}}if(b){var w=this.parent.editableElement.querySelectorAll(".e-rte-blockquote-open, .e-rte-blockquote-close");for(c=0;c<w.length;c++){var D=w[c].parentElement,M=D.innerHTML;if(M=(M=M.replace(/<span class="e-rte-blockquote-open"><\/span>/g,"<blockquote>")).replace(/<span class="e-rte-blockquote-close"><\/span>/g,"</blockquote>"),w[0].parentElement===w[1].parentElement){this.parent.domNode.replaceWith(D,this.parent.domNode.openTagString(D)+M.trim()+this.parent.domNode.closeTagString(D));break}c!==w.length-1||(0,o.isNullOrUndefined)(w[c])||(0,o.isNullOrUndefined)(w[c-1])||w[c].parentElement===w[c-1].parentElement?this.parent.domNode.replaceWith(D,this.parent.domNode.openTagString(D)+M.trim()+this.parent.domNode.closeTagString(D)):this.parent.domNode.replaceWith(D,M.trim())}}this.preFormatMerge(),this.blockquotesFormatMerge(e.enterAction);var A=this.parent.editableElement.querySelector("."+_s.startSelection),B=this.parent.editableElement.querySelector("."+_s.endSelection);if((0,o.isNullOrUndefined)(A)||(0,o.isNullOrUndefined)(B)||(A=A.lastChild,B=B.lastChild),r=this.parent.domNode.saveMarker(r),Us()&&Ps(this.parent.editableElement,e.selector),i)this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,A,B,0,B.textContent.length);else if(n.start&&"blockquote"===e.subCommand.toLowerCase()){var R=r.range.startContainer.childNodes[y?r.range.startOffset-1:r.range.startOffset];if(y){var I=R.parentElement,U=Array.prototype.indexOf.call(I.childNodes,R);this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,I,I,U,U)}else this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,R,R,0,0)}else r.restore();e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})}else{var P=n.start?n.startNode:n.endNode;this.applyTableSidesFormat(e,n.start,P)}},e.prototype.hasOnlyBlockquotes=function(e){for(var t=!1,n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(i.nodeType===Node.TEXT_NODE){if(""!==i.textContent.replace(/[\u200B\u200C\u200D]/g,"").trim())return!1}else if(i.nodeType===Node.ELEMENT_NODE){if("BLOCKQUOTE"!==i.tagName)return!1;t=!0}}return t},e.prototype.getNode=function(e){if("BLOCKQUOTE"===e.nodeName)return e=e.firstChild;for(;e.parentNode&&"BLOCKQUOTE"!==e.parentNode.nodeName;null)e=e.parentNode;return e},e.prototype.createBlockquoteSpan=function(e,t,n){var i=(0,o.createElement)("span");return i.classList.add(e),"before"===n?t.parentNode.insertBefore(i,t):this.parent.domNode.insertAfter(i,t),i},e.prototype.setSelectionBRConfig=function(){var e=this.parent.editableElement.querySelector("."+_s.startSelection),t=this.parent.editableElement.querySelector("."+_s.endSelection);(0,o.isNullOrUndefined)(t)?this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,0):this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,e,t,0,0)},e.prototype.preFormatMerge=function(){var e=this.parent.editableElement.querySelectorAll("PRE");if(!(0,o.isNullOrUndefined)(e))for(var t=0;t<e.length;t++){var n=e[t].previousElementSibling;(0,o.isNullOrUndefined)(n)||"PRE"!==n.tagName||(n.insertAdjacentHTML("beforeend","<br>"+e[t].innerHTML),(0,o.detach)(e[t]))}},e.prototype.blockquotesFormatMerge=function(e){var t=this.parent.editableElement.querySelectorAll("BLOCKQUOTE");if(!(0,o.isNullOrUndefined)(t))for(var n=0;n<t.length;n++){""===t[n].innerHTML.trim()&&(0,o.detach)(t[n]);var i=t[n].previousElementSibling;(0,o.isNullOrUndefined)(i)||"BLOCKQUOTE"!==i.tagName||(i.insertAdjacentHTML("beforeend",("BR"===e?"<br>":"")+t[n].innerHTML),(0,o.detach)(t[n]))}},e.prototype.cleanFormats=function(e,t){var n=["display","font-size","margin-top","margin-bottom","margin-left","margin-right","font-weight"];t=t.toLowerCase();for(var i=0;i<n.length&&"p"!==t&&"blockquote"!==t&&"pre"!==t;i++)e.style.removeProperty(n[i])},e.prototype.applyTableSidesFormat=function(e,t,n){var i=(0,o.createElement)(e.subCommand);"BR"!==e.enterAction&&i.appendChild((0,o.createElement)("br")),n.insertAdjacentElement(t?"beforebegin":"afterend",i),this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},e.prototype.destroy=function(){this.removeEventListener()},e}(),ga=function(){function e(e){this.parent=e,this.drop=this.dragDrop.bind(this),this.enter=this.dragEnter.bind(this),this.start=this.dragStart.bind(this),this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on($r,this.linkCommand,this),this.parent.observer.on(da,this.destroy,this);var e=this.parent.editableElement;e&&(o.EventHandler.add(e,"drop",this.drop),o.EventHandler.add(e,"dragenter",this.enter),o.EventHandler.add(e,"dragover",this.start))},e.prototype.removeEventListener=function(){this.parent.observer.off($r,this.linkCommand),this.parent.observer.off(da,this.destroy);var e=this.parent.editableElement;e&&(o.EventHandler.remove(e,"drop",this.drop),o.EventHandler.remove(e,"dragenter",this.enter),o.EventHandler.remove(e,"dragover",this.start)),this.drop=null,this.enter=null,this.start=null},e.prototype.linkCommand=function(e){switch(e.value.toString().toLocaleLowerCase()){case"createlink":case"editlink":this.createLink(e);break;case"openlink":this.openLink(e);break;case"removelink":this.removeLink(e)}},e.prototype.dragStart=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument);if(t){var n,i=t.startContainer,o=t.endContainer,r=null,s=null;if(i.nodeType===Node.ELEMENT_NODE)r=i.closest("a");else(n=i.parentElement)&&(r=n.closest("a"));if(o.nodeType===Node.ELEMENT_NODE)s=o.closest("a");else(n=o.parentElement)&&(s=n.closest("a"));("A"===e.target.nodeName||r||s)&&(this.dragSelectionRange=t.cloneRange())}},e.prototype.dragEnter=function(e){e.dataTransfer.dropEffect="copy",e.preventDefault()},e.prototype.dragDrop=function(e){if(this.dragSelectionRange){e.preventDefault();var t=void 0;this.parent.currentDocument.caretRangeFromPoint?t=this.parent.currentDocument.caretRangeFromPoint(e.clientX,e.clientY):e.rangeParent&&(t=this.parent.currentDocument.createRange()).setStart(e.rangeParent,e.rangeOffset);var n=e.dataTransfer.getData("text/html");if(n){var i=null;if(t.startContainer&&t.startContainer.nodeType===Node.TEXT_NODE?i=t.startContainer.parentNode:t.startContainer instanceof HTMLAnchorElement&&(i=t.startContainer),i)i&&"A"!==i.nodeName&&(i=i.closest("a"));else if(t.collapsed){var r=t.startContainer;if(r){var s=r.closest("a");s&&(i=s)}}if(i){var a=(0,o.createElement)("div",{innerHTML:n});a.querySelectorAll("a").forEach((function(e){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.remove()})),n=a.innerHTML}t.deleteContents();var l=t.createContextualFragment(n);l.querySelectorAll("a").forEach((function(e){e.style.textDecoration=""})),this.dragSelectionRange&&(this.dragSelectionRange.deleteContents(),this.normalizeEmptyLinks(),this.dragSelectionRange=null),this.parent.nodeSelection.setRange(this.parent.currentDocument,t),pa.Insert(this.parent.currentDocument,l,this.parent.editableElement,!0),i&&i.normalize()}}},e.prototype.normalizeEmptyLinks=function(){if(this.dragSelectionRange){var e=this.dragSelectionRange.commonAncestorContainer,t=e.nodeType===Node.TEXT_NODE?e.parentElement:e;if(t&&-1===gs.indexOf(t.nodeName.toLocaleLowerCase())&&(t=this.parent.domNode.getImmediateBlockNode(t)),t)t.querySelectorAll("a:empty").forEach((function(e){""!==e.textContent.trim()||e.querySelector("img")||e.querySelector("video")||e.parentNode&&e.parentNode.removeChild(e)}))}},e.prototype.createLink=function(e){var t=!(0,o.isNullOrUndefined)(e.item.selectParent)&&1===e.item.selectParent.length&&(0,o.closest)(e.item.selectParent[0],"a");if(t=(0,o.isNullOrUndefined)(t)?(0,o.isNullOrUndefined)(e.item.selectParent)||1!==e.item.selectParent.length?null:e.item.selectParent[0]:t,(0,o.isNullOrUndefined)(t)||"A"!==t.tagName){var n=new sl(this.parent.editableElement),i=n.getRange(this.parent.currentDocument);"#text"!==i.endContainer.nodeName||i.startContainer.textContent.length!==i.endOffset+1||" "!==i.endContainer.textContent.charAt(i.endOffset)||(0,o.isNullOrUndefined)(i.endContainer.nextSibling)||"A"!==i.endContainer.nextSibling.nodeName||(n.setSelectionText(this.parent.currentDocument,i.startContainer,i.endContainer,i.startOffset,i.endOffset+1),i=n.getRange(this.parent.currentDocument));var r=!!(0,o.isNullOrUndefined)(e.item.text)||e.item.text.replace(/ /g,"").localeCompare(i.toString().replace(/\n/g," ").replace(/ /g,""))<0;if(e.event&&"keydown"===e.event.type&&(32===e.event.keyCode||13===e.event.keyCode)||"Paste"===e.item.action||i.collapsed||r){var s=this.createAchorNode(e);s.innerText=""===e.item.text?e.item.url:e.item.text;var a=s.innerText.replace(/  +/g,(function(e){return" ".repeat(e.length)}));s.innerText=a,e.item.selection.restore(),pa.Insert(this.parent.currentDocument,s,this.parent.editableElement),(0,o.isNullOrUndefined)(s.parentElement)||"LI"!==s.parentElement.nodeName||(0,o.isNullOrUndefined)(s.parentNode.childNodes)||""!==s.parentNode.childNodes[0].textContent||s.parentNode.removeChild(s.parentNode.childNodes[0]);if(e.event&&"keydown"===e.event.type&&(32===e.event.keyCode||13===e.event.keyCode||/[^\w\s\\/\\.\\:]/g.test(e.event.key))){var l=e.item.selection.range.startContainer;l.textContent=this.removeText(l.textContent,e.item.text)}else{h="Paste"===e.item.action?s.childNodes[0].textContent.length:0;e.item.selection.setSelectionText(this.parent.currentDocument,s.childNodes[0],s.childNodes[0],h,s.childNodes[0].textContent.length)}}else this.handleLinkFormat(e)}else{var d=t,c="";if((0,o.isNullOrUndefined)(e.item.url)||d.setAttribute("href",e.item.url),(0,o.isNullOrUndefined)(e.item.title)||d.setAttribute("title",e.item.title),(0,o.isNullOrUndefined)(e.item.text)||""===e.item.text||(c=d.innerText,d.innerText=e.item.text),(0,o.isNullOrUndefined)(e.item.target)?(d.removeAttribute("target"),d.removeAttribute("aria-label")):(d.setAttribute("target",e.item.target),d.setAttribute("aria-label",e.item.ariaLabel)),c===e.item.text)e.item.selection.setSelectionText(this.parent.currentDocument,d,d,1,1),e.item.selection.restore();else{var h="Paste"===e.item.action?d.childNodes[0].textContent.length:0,p="#text"===d.firstChild.nodeName?d.childNodes[0].textContent.length:d.childNodes.length;e.item.selection.setSelectionText(this.parent.currentDocument,d.childNodes[0],d.childNodes[0],h,p)}}e.callBack&&e.callBack({requestType:"Links",editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.createAchorNode=function(e){var t=(0,o.createElement)("a",{className:"e-rte-anchor",attrs:{href:e.item.url,title:(0,o.isNullOrUndefined)(e.item.title)||""===e.item.title?e.item.url:e.item.title}});return(0,o.isNullOrUndefined)(e.item.target)||t.setAttribute("target",e.item.target),(0,o.isNullOrUndefined)(e.item.ariaLabel)||t.setAttribute("aria-label",e.item.ariaLabel),t},e.prototype.removeText=function(e,t){for(var n=e.split(" "),i=0;i<n.length;i++)n[i]===t&&(n.splice(i,1),i--);return n.join(" ")+" "},e.prototype.openLink=function(e){document.defaultView.open(e.item.url,e.item.target),this.callBack(e)},e.prototype.removeLink=function(e){var t=this.parent.domNode.blockNodes();if(t.length<2){this.parent.domNode.setMarker(e.item.selection);for(var n=(0,o.closest)(e.item.selectParent[0],"a"),i=n||e.item.selectParent[0],r=i.parentNode,s=[];i.firstChild&&r;null)s.push(r.insertBefore(i.firstChild,i));r.removeChild(i),s&&1===s.length&&(e.item.selection.startContainer=e.item.selection.getNodeArray(s[s.length-1],!0),e.item.selection.endContainer=e.item.selection.startContainer,e.item.selection.startOffset=0,e.item.selection.endOffset=s[s.length-1].textContent.length),e.item.selection=this.parent.domNode.saveMarker(e.item.selection)}else for(var a=0;a<t.length;a++)for(var l=t[a].querySelectorAll("a"),d=0;d<l.length;d++)this.parent.currentDocument.getSelection().containsNode(l[d],!0)&&(l[d].outerHTML=l[d].innerHTML);e.item.selection.restore(),this.callBack(e)},e.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.handleLinkFormat=function(e){var t=this.parent.editableElement,n=this.parent.nodeSelection.getRange(t.ownerDocument),i=this.parent.currentDocument.getSelection();if(i&&0!==i.rangeCount){var o,r,s,a=new ua(t),l="BR"===e.enterAction?[this.parent.editableElement]:a.getBlockNode(),d=[],c=["IMG","AUDIO","VIDEO"];if(1===n.startContainer.nodeType)o=(s=n.startContainer.childNodes[n.startOffset])&&c.indexOf(s.nodeName)>-1?s:null;if(1===n.endContainer.nodeType)r=(s=n.endContainer.childNodes[n.endContainer.childNodes.length>1?n.endOffset-1:n.endOffset])&&c.indexOf(s.nodeName)>-1?s:null;for(var h={startContainer:n.startContainer,endContainer:n.endContainer,endOffset:n.endOffset,startOffset:n.startOffset,collapsed:n.collapsed},p=0;p<l.length;p++){var u=l[p];this.unwrapLink(u),u.normalize(),this.applyLinkToBlockNode(u,e,d)}if(0!==d.length)if(o||r){var m=o?o.parentElement:h.startContainer,f=r?r.parentElement:h.endContainer,g=o?0:h.startOffset,b=h.endOffset;this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,m,f,g,b)}else 1===d.length?this.parent.nodeSelection.setSelectionContents(this.parent.currentDocument,d[0]):this.parent.nodeSelection.setSelectionText(this.parent.currentDocument,d[0],d[d.length-1],0,d[d.length-1].textContent.length)}},e.prototype.applyLinkToBlockNode=function(e,t,n){for(var i=new ua(this.parent.editableElement),o=i.getTextNodes(e),r=e.querySelectorAll("*"),s=this.parent.nodeSelection.getRange(this.parent.currentDocument),a=[],l=0===r.length,d=0;d<o.length;d++){var c=void 0,h=o[d],p=(new Kr).getFormattedNode(h,"fontcolor",e);if(l)c=this.getSplitNode(h,s),n.push(ca.Wrap(c,this.createAchorNode(t)));else if(p)a.length>0&&this.replaceElementsWithAnchor(a,this.createAchorNode(t),t.enterAction),c=this.getSplitNode(p,s),s.intersectsNode(p)&&(ca.Wrap(p.firstChild,this.createAchorNode(t)),n.push(h));else{var u="#text"===s.startContainer.nodeName&&s.startContainer===h&&0!==s.startOffset,m="#text"===s.endContainer.nodeName&&s.endContainer===h&&s.endOffset!==s.startContainer.textContent.length;if(d>0)("BR"===t.enterAction?this.parent.editableElement:i.getParentBlockNode(h))!==e&&this.replaceElementsWithAnchor(a,this.createAchorNode(t),t.enterAction);if(u||m){var f=i.getTopMostNode(h);c=this.getSplitNode(f,s),n.push(h),a.push(h)}else n.push(h),a.push(h);d===o.length-1&&this.replaceElementsWithAnchor(a,this.createAchorNode(t),t.enterAction)}}},e.prototype.unwrapLink=function(e){var t=e.querySelectorAll("a");if(0!==t.length){var n=this.parent.nodeSelection.getRange(this.parent.currentDocument),i=n.startContainer,o=n.endContainer,r=n.startOffset,s=n.endOffset;this.parent.nodeSelection.save(n,this.parent.currentDocument);for(var a=this.parent.nodeSelection.get(this.parent.currentDocument),l=0;l<t.length;l++)if(n.intersectsNode(t[l]))if(a.containsNode(t[l],!1))ca.unwrap(t[l]);else{var d=t[l]&&t[l].textContent;d&&n.startContainer.textContent&&-1!==d.indexOf(n.startContainer.textContent)&&(r=0);var c=this.getSplitNode(t[l],n);ca.unwrap(c)}n.setStart(i,r),n.setEnd(o,s)}},e.prototype.replaceElementsWithAnchor=function(e,t,n){for(var i=new ua(this.parent.editableElement),r=[],s=0;s<e.length;s++){var a=e[s];r.push(i.getTopMostNode(a))}e.length=0;var l,d=r[0],c=t.cloneNode(!0);d.parentElement.insertBefore(t,d);for(var h=0;h<r.length;h++){var p=r[h];if("BR"===n)if(0===h)t.appendChild(p);else if((0,o.isNullOrUndefined)(l)){var u=c.cloneNode(!0);p.parentElement.insertBefore(u,p),u.appendChild(p),l=u}else{var m=p.nextSibling&&"BR"===p.nextSibling.nodeName||i.isBlockNode(p.nextSibling),f=p.previousSibling&&"BR"===p.previousSibling.nodeName||i.isBlockNode(p.previousSibling),g=this.parent.editableElement.lastChild===p,b=i.isBlockNode(p.parentElement);if(m&&f){u=c.cloneNode(!0);p.parentElement.insertBefore(u,p),u.appendChild(p),l=u}else if(g){u=c.cloneNode(!0);p.parentElement.insertBefore(u,p),u.appendChild(p)}else if(b){u=c.cloneNode(!0);p.parentElement.insertBefore(u,p),u.appendChild(p),l=u}else l.appendChild(p)}else t.appendChild(p)}},e.prototype.getSplitNode=function(e,t){var n=new ha;return t.collapsed?n.SplitNode(t,e,!0):n.GetSpliceNode(t,e)},e}(),ba=function(){function e(e){this.alignments={JustifyLeft:"left",JustifyCenter:"center",JustifyRight:"right",JustifyFull:"justify"},this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(us,this.applyAlignment,this),this.parent.observer.on(Gs,this.onKeyDown,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(us,this.applyAlignment),this.parent.observer.off(Gs,this.onKeyDown),this.parent.observer.off(da,this.destroy)},e.prototype.onKeyDown=function(e){switch(e.event.action){case"justify-center":this.applyAlignment({subCommand:"JustifyCenter",callBack:e.callBack}),e.event.preventDefault();break;case"justify-full":this.applyAlignment({subCommand:"JustifyFull",callBack:e.callBack}),e.event.preventDefault();break;case"justify-left":this.applyAlignment({subCommand:"JustifyLeft",callBack:e.callBack}),e.event.preventDefault();break;case"justify-right":this.applyAlignment({subCommand:"JustifyRight",callBack:e.callBack}),e.event.preventDefault()}},e.prototype.getTableNode=function(e){var t=e.startContainer.nodeType===Node.ELEMENT_NODE?e.startContainer:e.startContainer.parentNode;return[(0,o.closest)(t,"td,th")]},e.prototype.applyAlignment=function(e){var t="Table"===e.value,n=this.parent.nodeSelection.getRange(this.parent.currentDocument),i=this.parent.nodeSelection.save(n,this.parent.currentDocument);if(t)(0,o.setStyleAttribute)(this.getTableNode(n)[0],{"text-align":this.alignments[e.subCommand]});else{this.parent.domNode.setMarker(i);var r=this.parent.domNode.blockNodes();"BR"===e.enterAction&&(r=this.parent.domNode.convertToBlockNodes(r,!1));for(var s=0;s<r.length;s++){var a=r[s];(0,o.setStyleAttribute)(a,{"text-align":this.alignments[e.subCommand]})}var l=this.parent.domNode.getImageTagInSelection();for(s=0;s<l.length;s++){var d=[];d.push(l[s]),this.parent.imgObj.imageCommand({item:{selectNode:d},subCommand:e.subCommand,value:e.subCommand,callBack:e.callBack,selector:e.selector})}this.parent.editableElement.focus({preventScroll:!0}),i=this.parent.domNode.saveMarker(i),Us()&&Ps(this.parent.editableElement,e.selector),i.restore()}e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:t?this.getTableNode(n):this.parent.domNode.blockNodes()})},e.prototype.destroy=function(){this.removeEventListener()},e}(),va=function(){function e(e){this.indentValue=20,this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(ms,this.applyIndents,this),this.parent.observer.on(Gs,this.onKeyDown,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(ms,this.applyIndents),this.parent.observer.off(Gs,this.onKeyDown),this.parent.observer.off(da,this.destroy)},e.prototype.onKeyDown=function(e){switch(e.event.action){case"indents":this.applyIndents({subCommand:"Indent",callBack:e.callBack}),e.event.preventDefault();break;case"outdents":this.applyIndents({subCommand:"Outdent",callBack:e.callBack}),e.event.preventDefault()}},e.prototype.applyIndents=function(e){var t=this.parent.editableElement,n=t.classList.contains("e-rtl"),i=this.parent.nodeSelection.getRange(this.parent.currentDocument),o=this.parent.nodeSelection.save(i,this.parent.currentDocument);this.parent.domNode.setMarker(o);var r=this.parent.domNode.blockNodes();"BR"===e.enterAction&&(r=this.parent.domNode.convertToBlockNodes(r,!1));for(var s=r.slice(),a=[],l=0;l<s.length;l++)"LI"!==s[l].tagName&&"LI"===s[l].parentNode.tagName?(r.splice(r.indexOf(s[l]),1),a.push(s[l].parentNode)):"LI"===s[l].tagName&&(r.splice(r.indexOf(s[l]),1),a.push(s[l]));a.length>0&&this.parent.observer.notify(Gs,{event:{preventDefault:function(){},stopPropagation:function(){},shiftKey:"Indent"!==e.subCommand,which:9,action:"indent"}});for(l=0;l<r.length;l++){var d=r[l],c=n?d.style.marginRight:d.style.marginLeft,h=void 0;"Indent"===e.subCommand?(h=""===c?this.indentValue+"px":parseInt(c,null)+this.indentValue+"px",n?d.style.marginRight=h:d.style.marginLeft=h):(h=""===c||"0px"===c||"0in"===c?"":parseInt(c,null)-this.indentValue<0?"0px":parseInt(c,null)-this.indentValue+"px",n?d.style.marginRight=h:d.style.marginLeft=h)}t.focus({preventScroll:!0}),Us()&&Ps(t,e.selector),(0===r.length||r[0]&&"TABLE"!==r[0].nodeName)&&(o=this.parent.domNode.saveMarker(o)).restore(),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.domNode.blockNodes()})},e.prototype.destroy=function(){this.removeEventListener()},e}(),ya="e-imgright",Ca="e-imgleft",Na="e-imgcenter",Ea="e-video-right",Sa="e-video-left",Ta="e-video-center",Oa="e-imgbreak",La="e-audio-break",ka="e-video-break",xa="e-img-caption",wa="e-rte-img-caption",Da="e-caption-inline",Ma="e-imginline",Aa="e-audio-inline",Ba="e-clickelem",Ra="e-video-clickelem",Ia="e-rte-audio",Ua="e-rte-video",Pa="e-audio-wrap",Ha="e-video-wrap",ja="e-embed-video-wrap",Fa="e-audio-focus",qa="e-video-focus",za="e-video-inline",_a=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Gr,this.imageCommand,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Gr,this.imageCommand),this.parent.observer.off(da,this.destroy)},e.prototype.imageCommand=function(e){switch(e.value.toString().toLowerCase()){case"image":case"replace":this.createImage(e);break;case"insertlink":this.insertImageLink(e);break;case"openimagelink":this.openImageLink(e);break;case"editimagelink":this.editImageLink(e);break;case"removeimagelink":this.removeImageLink(e);break;case"remove":this.removeImage(e);break;case"alttext":this.insertAltTextImage(e);break;case"dimension":this.imageDimension(e);break;case"caption":this.imageCaption(e);break;case"justifyleft":this.imageJustifyLeft(e);break;case"justifycenter":this.imageJustifyCenter(e);break;case"justifyright":this.imageJustifyRight(e);break;case"inline":this.imageInline(e);break;case"break":this.imageBreak(e)}},e.prototype.createImage=function(e){var t=this,n=!1;if(e.item.url=(0,o.isNullOrUndefined)(e.item.url)||"undefined"===e.item.url?e.item.src:e.item.url,(0,o.isNullOrUndefined)(e.item.selectParent)||"IMG"!==e.item.selectParent[0].tagName){var i=(0,o.createElement)("img");this.setStyle(i,e),(0,o.isNullOrUndefined)(e.item.selection)||e.item.selection.restore(),(0,o.isNullOrUndefined)(e.selector)||"pasteCleanupModule"!==e.selector?pa.Insert(this.parent.currentDocument,i,this.parent.editableElement):(0,o.isNullOrUndefined)(this.parent.currentDocument)||e.callBack({requestType:"Images",editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:[i]})}else{var r=e.item.selectParent[0];n=!0,this.setStyle(r,e,n)}if(e.callBack&&((0,o.isNullOrUndefined)(e.selector)||!(0,o.isNullOrUndefined)(e.selector)&&"pasteCleanupModule"!==e.selector)){var s=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0],a="Replace"===e.value||n?e.item.selectParent[0]:o.Browser.isIE?s.previousSibling:s.previousElementSibling,l=function(){if(!(0,o.isNullOrUndefined)(t.parent.currentDocument)){t.parent.userAgentData.isSafari()&&Hs(t.parent.currentDocument,t.parent.editableElement);var n=a.getAttribute("width"),i=a.getAttribute("height");((0,o.isNullOrUndefined)(n)||"auto"===n)&&a.setAttribute("width",a.offsetWidth.toString()),((0,o.isNullOrUndefined)(i)||"auto"===i)&&a.setAttribute("height",a.offsetHeight.toString()),e.callBack({requestType:"Replace"===e.value?(e.item.subCommand="Replace","Replace"):"Images",editorMode:"HTML",event:e.event,range:t.parent.nodeSelection.getRange(t.parent.currentDocument),elements:[a]})}a.removeEventListener("load",l)};a.addEventListener("load",l)}},e.prototype.setStyle=function(e,t,n){var i;if((0,o.isNullOrUndefined)(t.item.url)||e.setAttribute("src",t.item.url),n)for(var r={"e-imgcenter":"e-imgcenter","e-imgright":"e-imgright","e-imgleft":"e-imgleft"},s=e.classList,a=0;a<s.length;a++)(0,o.isNullOrUndefined)(r[s[a]])||(i=r[s[a]]);e.setAttribute("class","e-rte-image"+((0,o.isNullOrUndefined)(t.item.cssClass)?"":" "+t.item.cssClass)+((0,o.isNullOrUndefined)(i)?"":" "+i)),(0,o.isNullOrUndefined)(t.item.altText)||e.setAttribute("alt",t.item.altText.replace(/\.[a-zA-Z0-9]+$/,"")),(0,o.isNullOrUndefined)(t.item.width)||(0,o.isNullOrUndefined)(t.item.width.width)||e.setAttribute("width",this.calculateStyleValue(t.item.width.width)),(0,o.isNullOrUndefined)(t.item.height)||(0,o.isNullOrUndefined)(t.item.height.height)||e.setAttribute("height",this.calculateStyleValue(t.item.height.height)),(0,o.isNullOrUndefined)(t.item.width)||(0,o.isNullOrUndefined)(t.item.width.minWidth)||(e.style.minWidth=this.calculateStyleValue(t.item.width.minWidth)),(0,o.isNullOrUndefined)(t.item.width)||(0,o.isNullOrUndefined)(t.item.width.maxWidth)||(e.style.maxWidth=this.calculateStyleValue(t.item.width.maxWidth)),(0,o.isNullOrUndefined)(t.item.height)||(0,o.isNullOrUndefined)(t.item.height.minHeight)||(e.style.minHeight=this.calculateStyleValue(t.item.height.minHeight)),(0,o.isNullOrUndefined)(t.item.height)||(0,o.isNullOrUndefined)(t.item.height.maxHeight)||(e.style.maxHeight=this.calculateStyleValue(t.item.height.maxHeight))},e.prototype.calculateStyleValue=function(e){return"string"==typeof e&&(e.indexOf("px")||e.indexOf("%")||e.indexOf("auto"))?e:e+"px"},e.prototype.insertImageLink=function(e){var t=(0,o.createElement)("a",{attrs:{href:e.item.url}});e.item.selectNode[0].parentElement.classList.contains("e-img-wrap")&&(e.item.selection.restore(),t.setAttribute("contenteditable","true")),t.appendChild(e.item.selectNode[0]),(0,o.isNullOrUndefined)(e.item.target)||t.setAttribute("target",e.item.target),(0,o.isNullOrUndefined)(e.item.ariaLabel)||t.setAttribute("aria-label",e.item.ariaLabel),pa.Insert(this.parent.currentDocument,t,this.parent.editableElement),this.callBack(e)},e.prototype.openImageLink=function(e){document.defaultView.open(e.item.url,e.item.target),this.callBack(e)},e.prototype.removeImageLink=function(e){var t=e.item.selectParent[0];if(t.classList.contains("e-img-caption")){var n=(0,o.select)(".e-img-wrap",t),i=(0,o.select)(".e-img-inner",t),r=i.cloneNode(!0);(0,o.detach)((0,o.select)("a",t)),(0,o.detach)(i),n.appendChild(e.item.insertElement),n.appendChild(r)}else(0,o.detach)(t),o.Browser.isIE&&e.item.selection&&e.item.selection.restore(),pa.Insert(this.parent.currentDocument,e.item.insertElement,this.parent.editableElement);this.callBack(e)},e.prototype.editImageLink=function(e){e.item.selectNode[0].parentElement.href=e.item.url,(0,o.isNullOrUndefined)(e.item.target)?(e.item.selectNode[0].parentElement.removeAttribute("target"),e.item.selectNode[0].parentElement.removeAttribute("aria-label")):(e.item.selectNode[0].parentElement.target=e.item.target,e.item.selectNode[0].parentElement.setAttribute("aria-label",e.item.ariaLabel)),this.callBack(e)},e.prototype.removeImage=function(e){(0,o.closest)(e.item.selectNode[0],"a")&&("A"!==e.item.selectNode[0].parentElement.nodeName||(0,o.isNullOrUndefined)(e.item.selectNode[0].parentElement.innerText))?(0,o.detach)((0,o.closest)(e.item.selectNode[0],"a")):(0,o.isNullOrUndefined)((0,o.closest)(e.item.selectNode[0],"."+xa))?(0,o.detach)(e.item.selectNode[0]):(0,o.detach)((0,o.closest)(e.item.selectNode[0],"."+xa)),this.callBack(e)},e.prototype.insertAltTextImage=function(e){e.item.selectNode[0].setAttribute("alt",e.item.altText),this.callBack(e)},e.prototype.imageDimension=function(e){var t=e.item.selectNode[0];t.style.height="",t.style.width="","auto"!==e.item.width?t.style.width=(0,o.formatUnit)(e.item.width):t.removeAttribute("width"),"auto"!==e.item.height?t.style.height=(0,o.formatUnit)(e.item.height):t.removeAttribute("height"),this.callBack(e)},e.prototype.imageCaption=function(e){pa.Insert(this.parent.currentDocument,e.item.insertElement,this.parent.editableElement),this.callBack(e)},e.prototype.imageJustifyLeft=function(e){var t=e.item.selectNode[0];(0,o.isNullOrUndefined)(t)||(t.removeAttribute("class"),(0,o.addClass)([t],"e-rte-image"),(0,o.isNullOrUndefined)((0,o.closest)(t,"."+xa))||((0,o.removeClass)([(0,o.closest)(t,"."+xa)],ya),(0,o.addClass)([(0,o.closest)(t,"."+xa)],Ca)),"A"===t.parentElement.nodeName?((0,o.removeClass)([t.parentElement],ya),(0,o.addClass)([t.parentElement],Ca),(0,o.addClass)([t],Ca)):null!=t.parentElement.nextElementSibling?((0,o.addClass)([t],Ca),t.parentElement.nextElementSibling.style.clear="left"):(0,o.addClass)([t],Ca),this.callBack(e))},e.prototype.imageJustifyCenter=function(e){var t=e.item.selectNode[0];(0,o.isNullOrUndefined)(t)||(t.removeAttribute("class"),(0,o.addClass)([t],"e-rte-image"),(0,o.isNullOrUndefined)((0,o.closest)(t,"."+xa))||((0,o.removeClass)([(0,o.closest)(t,"."+xa)],Ca),(0,o.removeClass)([(0,o.closest)(t,"."+xa)],ya),(0,o.addClass)([(0,o.closest)(t,"."+xa)],Na)),"A"===t.parentElement.nodeName?((0,o.removeClass)([t.parentElement],Ca),(0,o.removeClass)([t.parentElement],ya),(0,o.addClass)([t.parentElement],Na),(0,o.addClass)([t],Na)):(0,o.addClass)([t],Na),this.callBack(e))},e.prototype.imageJustifyRight=function(e){var t=e.item.selectNode[0];(0,o.isNullOrUndefined)(t)||(t.removeAttribute("class"),(0,o.addClass)([t],"e-rte-image"),(0,o.isNullOrUndefined)((0,o.closest)(t,"."+xa))||((0,o.removeClass)([(0,o.closest)(t,"."+xa)],Ca),(0,o.addClass)([(0,o.closest)(t,"."+xa)],ya)),"A"===t.parentElement.nodeName?((0,o.removeClass)([t.parentElement],Ca),(0,o.addClass)([t.parentElement],ya),(0,o.addClass)([t],ya)):null!=t.parentElement.nextElementSibling?((0,o.addClass)([t],ya),t.parentElement.nextElementSibling.style.clear="right"):(0,o.addClass)([t],ya),this.callBack(e))},e.prototype.imageInline=function(e){var t=e.item.selectNode[0];t.removeAttribute("class"),(0,o.addClass)([t],"e-rte-image"),(0,o.addClass)([t],Ma),(0,o.isNullOrUndefined)((0,o.closest)(t,"."+xa))||((0,o.removeClass)([(0,o.closest)(t,"."+xa)],Oa),(0,o.removeClass)([(0,o.closest)(t,"."+xa)],Na),(0,o.removeClass)([(0,o.closest)(t,"."+xa)],Ca),(0,o.removeClass)([(0,o.closest)(t,"."+xa)],ya),(0,o.addClass)([(0,o.closest)(t,"."+xa)],Da)),this.callBack(e)},e.prototype.imageBreak=function(e){var t=e.item.selectNode[0];t.removeAttribute("class"),(0,o.addClass)([t],Oa),(0,o.addClass)([t],"e-rte-image"),(0,o.isNullOrUndefined)((0,o.closest)(t,"."+xa))||((0,o.removeClass)([(0,o.closest)(t,"."+xa)],Da),(0,o.removeClass)([(0,o.closest)(t,"."+xa)],Na),(0,o.removeClass)([(0,o.closest)(t,"."+xa)],Ca),(0,o.removeClass)([(0,o.closest)(t,"."+xa)],ya),(0,o.addClass)([(0,o.closest)(t,"."+xa)],Oa)),this.callBack(e)},e.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e}(),Va=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Xr,this.audioCommand,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Xr,this.audioCommand),this.parent.observer.off(da,this.destroy)},e.prototype.audioCommand=function(e){var t,n,i=e.value.toString().toLowerCase();switch("inline"!==i&&"break"!==i&&"audioremove"!==i||(n=(t=e.item.selectNode[0]).closest("."+Pa)),i){case"audio":case"audioreplace":this.createAudio(e);break;case"inline":t.removeAttribute("class"),n.style.display="inline-block",(0,o.addClass)([t],[Ia,Aa,Fa]),this.callBack(e);break;case"break":t.removeAttribute("class"),n.style.display="block",(0,o.addClass)([t],[La,Ia,Fa]),this.callBack(e);break;case"audioremove":n?(0,o.detach)(n):(0,o.detach)(t),this.callBack(e)}},e.prototype.createAudio=function(e){var t,n=this,i=!1;if(!(0,o.isNullOrUndefined)(e.item.selectParent)&&e.item.selectParent[0].classList&&(e.item.selectParent[0].classList.contains(Ba)||e.item.selectParent[0].classList.contains(Pa)||"AUDIO"===e.item.selectParent[0].tagName)){var r=e.item.selectParent[0].querySelector("source");this.setStyle(r,e),i=!0}else{t=(0,o.createElement)("span",{className:Pa,attrs:{contentEditable:"false",title:(0,o.isNullOrUndefined)(e.item.title)?(0,o.isNullOrUndefined)(e.item.fileName)?"":e.item.fileName:e.item.title}});var s=(0,o.createElement)("audio",{className:Ia+" "+Aa,attrs:{controls:""}}),a=(0,o.createElement)("source"),l=(0,o.createElement)("span",{className:Ba});if(this.setStyle(a,e),s.appendChild(a),l.appendChild(s),t.appendChild(l),(0,o.isNullOrUndefined)(e.item.selection)||e.item.selection.restore(),pa.Insert(this.parent.currentDocument,t,this.parent.editableElement),!(0,o.isNullOrUndefined)(e.item.selection)){var d=e.item.selection.getRange(this.parent.currentDocument),c=document.createTextNode(" "),h=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0];t.parentNode.insertBefore(c,h.nextSibling);e.item.selection.save(d,this.parent.currentDocument)}}if(e.callBack&&((0,o.isNullOrUndefined)(e.selector)||!(0,o.isNullOrUndefined)(e.selector)&&"pasteCleanupModule"!==e.selector)){var p=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0],u="AudioReplace"===e.value||i?"audio"===e.item.selectParent[0].tagName.toLowerCase()?e.item.selectParent[0]:e.item.selectParent[0].querySelector("audio"):o.Browser.isIE?p:p.querySelector("audio");u.addEventListener("loadeddata",(function(){"AudioReplace"===e.value&&i||(0,o.isNullOrUndefined)(n.parent.currentDocument)||(n.parent.userAgentData.isSafari()&&Hs(n.parent.currentDocument,n.parent.editableElement),e.callBack({requestType:"Audios",editorMode:"HTML",event:e.event,range:n.parent.nodeSelection.getRange(n.parent.currentDocument),elements:[u]}))})),i&&u.load()}},e.prototype.setStyle=function(e,t){(0,o.isNullOrUndefined)(t.item.url)||e.setAttribute("src",t.item.url);var n=t.item.fileName?t.item.fileName.split(".").pop().toLowerCase():t.item.url?t.item.url.split(".").pop().toLowerCase():"";e.type="opus"===n?"audio/ogg":"m4a"===n?"audio/mp4":t.item.fileName&&t.item.fileName.split(".").length>0?"audio/"+t.item.fileName.split(".")[t.item.fileName.split(".").length-1]:t.item.url&&t.item.url.split(".").length>0?"audio/"+t.item.url.split(".")[t.item.url.split(".").length-1]:""},e.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e}(),Wa=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Yr,this.videoCommand,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Yr,this.videoCommand),this.parent.observer.off(da,this.destroy)},e.prototype.videoCommand=function(e){var t,n,i,r="",s=e.value.toString().toLowerCase();switch("video"!==s&&"videoreplace"!==s&&(n=(t=e.item.selectNode[0]).closest("."+ja),i=t.closest("."+Ra)),t&&(r=t.classList.contains("e-rte-embed-url")?"e-rte-embed-url":""),s){case"video":case"videoreplace":this.createVideo(e);break;case"videodimension":this.videoDimension(e);break;case"inline":t.removeAttribute("class"),n&&(n.style.display="inline-block"),i&&(t.parentElement.style.cssFloat=""),(0,o.addClass)([t],[Ua,za,qa]),this.callBack(e);break;case"break":t.removeAttribute("class"),n&&(n.style.display="block"),i&&(t.parentElement.style.cssFloat=""),(0,o.addClass)([t],[ka,Ua,qa]),this.callBack(e);break;case"justifyleft":t.removeAttribute("class"),n&&(n.style.display="block"),i?t.parentElement.style.cssFloat="left":null!=t.parentElement.nextElementSibling?((0,o.addClass)([t],""===r?[Ua,Sa]:[Ua,Sa,r]),t.parentElement.nextElementSibling.style.clear="left"):(0,o.addClass)([t],""===r?[Ua,Sa]:[Ua,Sa,r]),this.callBack(e);break;case"justifycenter":t.removeAttribute("class"),n&&(n.style.display="block"),i&&(t.parentElement.style.cssFloat=""),(0,o.addClass)([t],""===r?[Ua,Ta]:[Ua,Ta,r]),this.callBack(e);break;case"justifyright":t.removeAttribute("class"),n&&(n.style.display="block"),i?t.parentElement.style.cssFloat="right":null!=t.parentElement.nextElementSibling?((0,o.addClass)([t],""===r?[Ua,Ea]:[Ua,Sa,r]),t.parentElement.nextElementSibling.style.clear="right"):(0,o.addClass)([t],""===r?[Ua,Ea]:[Ua,Ea,r]),this.callBack(e);break;case"videoremove":(0,o.detach)(t.parentElement),this.callBack(e)}},e.prototype.wrapVideo=function(e){var t,n;if(e.item.isEmbedUrl){t=(0,o.createElement)("span",{className:ja,attrs:{contentEditable:"false"}});var i=(0,o.createElement)("span",{className:Ra}),r=(0,o.createElement)("template");r.innerHTML=e.item.fileName,i.appendChild(r.content),this.vidElement=n=i.firstElementChild,this.setStyle(n,e,this.vidElement),t.style.display=e.item.cssClass===za?"inline-block":"block",t.appendChild(i)}else t=(0,o.createElement)("span",{className:Ha,attrs:{contentEditable:"false",title:(0,o.isNullOrUndefined)(e.item.title)?(0,o.isNullOrUndefined)(e.item.fileName)?"":e.item.fileName:e.item.title}}),this.vidElement=(0,o.createElement)("video",{className:Ua+" "+za,attrs:{controls:""}}),n=(0,o.createElement)("source"),this.setStyle(n,e,this.vidElement),this.vidElement.appendChild(n),t.appendChild(this.vidElement);return t},e.prototype.createVideo=function(e){var t,n=this,i=!1;if("VideoReplace"!==e.value||(0,o.isNullOrUndefined)(e.item.selectParent)||"VIDEO"!==e.item.selectParent[0].tagName)if("VideoReplace"===e.value&&!(0,o.isNullOrUndefined)(e.item.selectParent)&&(0,o.isNullOrUndefined)(e.item.selectParent[0].querySelector("iframe"))&&e.item.selectParent[0].classList&&e.item.selectParent[0].classList.contains(Ra))e.item.selectParent[0].innerHTML=e.item.fileName,this.setStyle(e.item.selectParent[0].firstElementChild,e,e.item.selectParent[0].firstElementChild);else if("VideoReplace"!==e.value||(0,o.isNullOrUndefined)(e.item.selectParent)||(0,o.isNullOrUndefined)(e.item.selectParent[0].querySelector("iframe"))||e.item.isEmbedUrl){if(e.item.isEmbedUrl)t=this.wrapVideo(e);else{if("VideoReplace"===e.value){var r=e.item.selection.range.startContainer.closest(".e-embed-video-wrap");(0,o.isNullOrUndefined)(r)||r.remove()}t=this.wrapVideo(e)}if((0,o.isNullOrUndefined)(e.item.selection)||e.item.selection.restore(),pa.Insert(this.parent.currentDocument,t,this.parent.editableElement),!(0,o.isNullOrUndefined)(e.item.selection)){var s=e.item.selection.getRange(this.parent.currentDocument),a=document.createTextNode(" "),l=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0];t.parentNode.insertBefore(a,l.nextSibling);e.item.selection.save(s,this.parent.currentDocument)}}else{t=this.wrapVideo(e),(d=e.item.selection.range.startContainer).parentNode.replaceChild(t,d)}else if(e.item.isEmbedUrl){var d;t=this.wrapVideo(e),(d=e.item.selection.range.startContainer).parentNode.replaceChild(t,d)}else{var c=e.item.selectParent[0].querySelector("source");this.setStyle(c,e,c),i=!0}if(e.callBack&&((0,o.isNullOrUndefined)(e.selector)||!(0,o.isNullOrUndefined)(e.selector)&&"pasteCleanupModule"!==e.selector)){var h,p=this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)[0];"VideoReplace"===e.value||i?e.item.isEmbedUrl?e.item.isEmbedUrl?(0,o.isNullOrUndefined)(t)||(h=t.querySelector("iframe")):h=e.item.selectParent[0].querySelector("iframe"):h=e.item.selectParent[0]:h=e.item.isEmbedUrl?p.querySelector("iframe"):"VIDEO"===p.tagName?p:p.lastElementChild,h.addEventListener("IFRAME"!==h.tagName?"loadeddata":"load",(function(){"VideoReplace"===e.value&&i||(e.item.isEmbedUrl&&h&&h.classList.add("e-rte-embed-url"),(0,o.isNullOrUndefined)(n.parent.currentDocument)||(n.parent.userAgentData.isSafari()&&Hs(n.parent.currentDocument,n.parent.editableElement),e.callBack({requestType:"Videos",editorMode:"HTML",event:e.event,range:n.parent.nodeSelection.getRange(n.parent.currentDocument),elements:[h]})))})),i&&h.load(),-1!==o.Browser.userAgent.indexOf("Firefox")&&(this.vidElement.addEventListener("play",(function(){n.editAreaVideoClick(e)})),this.vidElement.addEventListener("pause",(function(){n.editAreaVideoClick(e)})))}},e.prototype.editAreaVideoClick=function(e){e.callBack({requestType:"VideosPlayPause",editorMode:"HTML",event:e.event})},e.prototype.setStyle=function(e,t,n){""!==t.item.url&&!(0,o.isNullOrUndefined)(t.item.url)&&(0,o.isNullOrUndefined)(e)||"iframe"===e.nodeName.toLowerCase()||e.setAttribute("src",t.item.url),t.item.isEmbedUrl||(e.type=t.item.fileName&&t.item.fileName.split(".").length>0?"video/"+t.item.fileName.split(".")[t.item.fileName.split(".").length-1]:t.item.url&&t.item.url.split(".").length>0?"video/"+t.item.url.split(".")[t.item.url.split(".").length-1]:""),(0,o.isNullOrUndefined)(t.item.width)||(0,o.isNullOrUndefined)(t.item.width.width)||n.setAttribute("width",(0,o.formatUnit)(t.item.width.width)),(0,o.isNullOrUndefined)(t.item.height)||(0,o.isNullOrUndefined)(t.item.height.height)||n.setAttribute("height",(0,o.formatUnit)(t.item.height.height)),(0,o.isNullOrUndefined)(t.item.width)||(0,o.isNullOrUndefined)(t.item.width.minWidth)||(n.style.minWidth=(0,o.formatUnit)(t.item.width.minWidth)),(0,o.isNullOrUndefined)(t.item.width)||(0,o.isNullOrUndefined)(t.item.width.maxWidth)||(n.style.maxWidth=(0,o.formatUnit)(t.item.width.maxWidth)),(0,o.isNullOrUndefined)(t.item.height)||(0,o.isNullOrUndefined)(t.item.height.minHeight)||(n.style.minHeight=(0,o.formatUnit)(t.item.height.minHeight)),(0,o.isNullOrUndefined)(t.item.height)||(0,o.isNullOrUndefined)(t.item.height.maxHeight)||(n.style.maxHeight=(0,o.formatUnit)(t.item.height.maxHeight)),(0,o.isNullOrUndefined)(t.item.cssClass)||(t.item.cssClass===ka?((0,o.addClass)([n],[ka]),(0,o.removeClass)([n],[za])):((0,o.addClass)([n],[za]),(0,o.removeClass)([n],[ka])))},e.prototype.videoDimension=function(e){var t=e.item.selectNode[0].classList.contains(Ra)?e.item.selectNode[0].querySelector("iframe"):e.item.selectNode[0];t.style.height="",t.style.width="","auto"!==e.item.width&&(t.style.width=(0,o.formatUnit)(e.item.width)),"auto"!==e.item.height&&(t.style.height=(0,o.formatUnit)(e.item.height)),this.callBack(e)},e.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e}(),Qa=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Jr,this.createTable,this),this.parent.observer.on(Zr,this.insertRow,this),this.parent.observer.on(es,this.insertColumn,this),this.parent.observer.on(ts,this.deleteRow,this),this.parent.observer.on(ns,this.deleteColumn,this),this.parent.observer.on(is,this.removeTable,this),this.parent.observer.on(os,this.tableHeader,this),this.parent.observer.on(rs,this.tableVerticalAlign,this),this.parent.observer.on(ss,this.cellMerge,this),this.parent.observer.on(ls,this.HorizontalSplit,this),this.parent.observer.on(as,this.VerticalSplit,this),this.parent.observer.on(ds,this.tableStyle,this),this.parent.observer.on(hs,this.setBGColor,this),this.parent.observer.on(cs,this.tableStyle,this),this.parent.observer.on(ps,this.tableMove,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Jr,this.createTable),this.parent.observer.off(Zr,this.insertRow),this.parent.observer.off(es,this.insertColumn),this.parent.observer.off(ts,this.deleteRow),this.parent.observer.off(ns,this.deleteColumn),this.parent.observer.off(is,this.removeTable),this.parent.observer.off(os,this.tableHeader),this.parent.observer.off(rs,this.tableVerticalAlign),this.parent.observer.off(ss,this.cellMerge),this.parent.observer.off(ls,this.HorizontalSplit),this.parent.observer.off(as,this.VerticalSplit),this.parent.observer.off(ds,this.tableStyle),this.parent.observer.off(cs,this.tableStyle),this.parent.observer.off(hs,this.setBGColor),this.parent.observer.off(ps,this.tableMove),this.parent.observer.off(da,this.destroy)},e.prototype.createTable=function(e){var t=(0,o.createElement)("table",{className:"e-rte-table"}),n=(0,o.createElement)("tbody");(0,o.isNullOrUndefined)(e.item.width.width)||(t.style.width=this.calculateStyleValue(e.item.width.width)),(0,o.isNullOrUndefined)(e.item.width.minWidth)||(t.style.minWidth=this.calculateStyleValue(e.item.width.minWidth)),(0,o.isNullOrUndefined)(e.item.width.maxWidth)||(t.style.maxWidth=this.calculateStyleValue(e.item.width.maxWidth));for(var i=parseInt(e.item.width.width,10)>100?100/e.item.columns:parseInt(e.item.width.width,10)/e.item.columns,r=0;r<e.item.rows;r++){for(var s=(0,o.createElement)("tr"),a=0;a<e.item.columns;a++){var l=(0,o.createElement)("td");l.appendChild((0,o.createElement)("br")),l.style.width=i+"%",s.appendChild(l)}n.appendChild(s)}if(t.appendChild(n),e.item.selection.restore(),pa.Insert(this.parent.currentDocument,t,this.parent.editableElement),e.item.selection.setSelectionText(this.parent.currentDocument,t.querySelector("td"),t.querySelector("td"),0,0),null===t.nextElementSibling&&!t.classList.contains("ignore-table")){var d=void 0;"DIV"===e.enterAction?(d=(0,o.createElement)("div")).appendChild((0,o.createElement)("br")):"BR"===e.enterAction?d=(0,o.createElement)("br"):(d=(0,o.createElement)("p")).appendChild((0,o.createElement)("br")),this.insertAfter(d,t)}return t.classList.contains("ignore-table")&&Fs([t],["ignore-table"]),t.querySelector("td").classList.add("e-cell-select"),e.callBack&&e.callBack({requestType:"Table",editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:[t]}),t},e.prototype.calculateStyleValue=function(e){return"string"==typeof e&&(e.indexOf("px")>=0||e.indexOf("%")>=0||e.indexOf("auto")>=0)?e:e+"px"},e.prototype.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},e.prototype.getSelectedCellMinMaxIndex=function(e){for(var t=this.curTable.querySelectorAll(".e-cell-select"),n=0,i=e.length,o=0,r=e[0].length,s=0;n<t.length;n++){var a=this.getCorrespondingIndex(t[n],e),l=this.FindIndex(a[0],a[1],e);i=Math.min(a[0],i),o=Math.max(l[0],o),r=Math.min(a[1],r),s=Math.max(l[1],s)}return{startRow:i,endRow:o,startColumn:r,endColumn:s}},e.prototype.insertRow=function(e){var t="InsertRowBefore"!==e.item.subCommand,n=e.item.selection.range.startContainer;if("TH"!==n.nodeName&&"TD"!==n.nodeName&&(n=(0,o.closest)(n.parentElement,"td,th")),this.curTable=(0,o.closest)(this.parent.nodeSelection.range.startContainer.parentElement,"table"),0===this.curTable.querySelectorAll(".e-cell-select").length){var i=this.curTable.rows[this.curTable.rows.length-1],r=i.cloneNode(!0);r.removeAttribute("rowspan"),this.insertAfter(r,i)}else{for(var s=this.getCorrespondingColumns(),a=this.getSelectedCellMinMaxIndex(s),l=t?a.endRow:a.startRow,d=(0,o.createElement)("tr"),c=this.curTable.querySelectorAll("th.e-cell-select").length>0,h=0;h<s[l].length;h++)if(t&&l<s.length-1&&s[l][h]===s[l+1][h]||!t&&0<l&&s[l][h]===s[l-1][h])(0===h||0<h&&s[l][h]!==s[l][h-1])&&s[l][h].setAttribute("rowspan",(parseInt(s[l][h].getAttribute("rowspan"),10)+1).toString());else{var p=(0,o.createElement)("td");p.appendChild((0,o.createElement)("br")),d.appendChild(p);var u=s[c&&t&&s[l+1]?l+1:l][h].getAttribute("style");if(u){var m=this.cellStyleCleanup(u);p.style.cssText=m}}var f=void 0;f=c&&t?this.curTable.querySelector("tbody").childNodes[0]:this.curTable.rows[l],"InsertRowBefore"===e.item.subCommand||c?f.parentElement.insertBefore(d,f):this.insertAfter(d,f)}e.item.selection.setSelectionText(this.parent.currentDocument,e.item.selection.range.startContainer,e.item.selection.range.startContainer,0,0),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.insertColumn=function(e){var t=e.item.selection.range.startContainer;"TH"!==t.nodeName&&"TD"!==t.nodeName&&(t=(0,o.closest)(t.parentElement,"td,th"));for(var n,i=(0,o.closest)(t,"tr"),r=(0,o.closest)(i,"table").rows,s=Array.prototype.slice.call(i.querySelectorAll(":scope > td, :scope > th")).indexOf(t),a=parseInt(e.item.width,10)/i.querySelectorAll(":scope > td, :scope > th").length,l=parseInt(e.item.width,10)/(i.querySelectorAll(":scope > td, :scope > th").length+1),d=(0,o.closest)(i,"table"),c=(0,o.closest)(i,"table").querySelectorAll("th,td"),h=0;h<c.length;h++)c[h].dataset.oldWidth=c[h].offsetWidth/d.offsetWidth*100+"%";((0,o.isNullOrUndefined)(d.style.width)||""===d.style.width)&&(d.style.width=d.offsetWidth+"px");for(h=0;h<r.length;h++){var p=(n=r[h].querySelectorAll(":scope > td, :scope > th")[s]).cloneNode(!0),u=p.getAttribute("style");if(u){var m=this.cellStyleCleanup(u);p.style.cssText=m}p.innerHTML="",p.appendChild((0,o.createElement)("br")),p.removeAttribute("class"),p.removeAttribute("colspan"),p.removeAttribute("rowspan"),"InsertColumnLeft"===e.item.subCommand?n.parentElement.insertBefore(p,n):this.insertAfter(p,n),p.style.width=l.toFixed(4)+"%",delete p.dataset.oldWidth}for(h=0;h<c.length;h++)c[h].style.width=(Number(c[h].dataset.oldWidth.split("%")[0])*l/a).toFixed(4)+"%",delete c[h].dataset.oldWidth;e.item.selection.setSelectionText(this.parent.currentDocument,t,t,0,0),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.setBGColor=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=3===t.startContainer.nodeType?t.startContainer.parentNode:t.startContainer;this.curTable=n.closest("table");for(var i=this.curTable.querySelectorAll(".e-cell-select"),o=0;o<i.length;o++)i[o].style.backgroundColor=e.value.toString();this.parent.undoRedoManager.saveData(),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.deleteColumn=function(e){var t=e.item.selection.range.startContainer;3===t.nodeType&&(t=(0,o.closest)(t.parentElement,"td,th"));var n=(0,o.closest)(t,"TH"===t.tagName?"thead":"tbody"),i=n&&Array.prototype.indexOf.call(n.childNodes,t.parentNode);if(this.curTable=(0,o.closest)(t,"table"),1===(0,o.closest)(t,"tr").querySelectorAll("th,td").length)e.item.selection.restore(),(0,o.detach)((0,o.closest)(t.parentElement,"table"));else{for(var r=void 0,s=this.getCorrespondingColumns(),a=this.getSelectedCellMinMaxIndex(s),l=a.startColumn,d=a.endColumn,c=0;c<s.length;c++)for(var h=s[c],p=0;p<h.length;p++){var u=h[p],m=this.getCorrespondingIndex(u,s),f=parseInt(u.getAttribute("colspan"),10)||1;m[1]+(f-1)>=l&&m[1]<=d&&(f>1?u.setAttribute("colspan",(f-1).toString()):((0,o.detach)(u),r=p,o.Browser.isIE&&(e.item.selection.setSelectionText(this.parent.currentDocument,this.curTable.querySelector("td"),this.curTable.querySelector("td"),0,0),this.curTable.querySelector("td, th").classList.add("e-cell-select"))))}if(r>-1){var g=n.children[i],b=g&&g.children[r<=g.children.length-1?r:r-1];b&&(e.item.selection.setSelectionText(this.parent.currentDocument,b,b,0,0),b.classList.add("e-cell-select"))}}if(e.callBack){var v=this.parent.nodeSelection.getRange(this.parent.currentDocument).startContainer;if("TD"!==v.nodeName){var y=this.parent.nodeSelection.getRange(this.parent.currentDocument).startOffset,C=v.children[y];C&&this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,C,0)}e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})}},e.prototype.deleteRow=function(e){var t=e.item.selection.range.startContainer;3===t.nodeType&&(t=(0,o.closest)(t.parentElement,"td,th"));var n,i=Array.prototype.indexOf.call(t.parentNode.childNodes,t);this.curTable=(0,o.closest)(t,"table");var r,s,a=this.getCorrespondingColumns(),l=this.getSelectedCellMinMaxIndex(a);if(1===this.curTable.rows.length)e.item.selection.restore(),(0,o.detach)((0,o.closest)(t.parentElement,"table"));else for(r=l.endRow;r>=l.startRow;r--){for(n=this.curTable.rows[r],s=0;s<a[r].length;s++){if((0===s||a[r][s]!==a[r][s-1])&&1<parseInt(a[r][s].getAttribute("rowspan"),10)){var d=parseInt(a[r][s].getAttribute("rowspan"),10)-1;if(1===d){a[r][s].removeAttribute("rowspan");var c=this.getMergedRow(this.getCorrespondingColumns())[s];if(c){var h=c.cloneNode(!0);h.innerHTML="<br>",c.parentElement&&c.parentElement.insertBefore(h,c)}}else a[r][s].setAttribute("rowspan",d.toString())}if(r<a.length-1&&a[r][s]===a[r+1][s]&&(0===r||a[r][s]!==a[r-1][s])){var p=a[r][s],u=void 0;for(u=s;0<u&&a[r][u]===a[r][u-1];u--)0===u?this.curTable.rows[r+1].prepend(p):a[r+1][u-1].insertAdjacentElement("afterend",p)}}var m=n.rowIndex;this.curTable.deleteRow(m);var f=(0,o.isNullOrUndefined)(this.curTable.rows[m])?this.curTable.querySelectorAll("tbody tr")[m-1]:this.curTable.querySelectorAll("tbody tr")[m],g=f&&f.querySelectorAll("td")[i];g?(e.item.selection.setSelectionText(this.parent.currentDocument,g,g,0,0),g.classList.add("e-cell-select")):(e.item.selection.setSelectionText(this.parent.currentDocument,this.curTable.querySelector("td"),this.curTable.querySelector("td"),0,0),this.curTable.querySelector("td, th").classList.add("e-cell-select"))}e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.getMergedRow=function(e){for(var t,n=0;n<e.length;n++)e[n].length!==this.curTable.rows[0].childNodes.length&&(t=e[n]);return t},e.prototype.removeTable=function(e){var t=e.item.selection.range.startContainer;t=3===t.nodeType?t.parentNode:t;var n=(0,o.closest)(t.parentElement,"table");n&&((0,o.detach)(n),e.item.selection.restore()),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.tableHeader=function(e){var t=!1,n=e.item.selection.range.startContainer;n=3===n.nodeType?n.parentNode:n;var i=(0,o.closest)(n.parentElement,"table");if([].slice.call(i.childNodes).forEach((function(e){"THEAD"===e.nodeName&&(t=!0)})),i&&!t){for(var r=i.querySelector("tr").childElementCount,s=0,a=0;a<r;a++)s+=parseInt(i.querySelector("tr").children[a].getAttribute("colspan"),10)||1;for(var l=i.createTHead().insertRow(0),d=0;d<s;d++){var c=(0,o.createElement)("th");c.appendChild((0,o.createElement)("br")),l.appendChild(c)}}else i.deleteTHead();e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.tableVerticalAlign=function(e){var t="";switch(e.item.subCommand){case"AlignTop":t="top";break;case"AlignMiddle":t="middle";break;case"AlignBottom":t="bottom"}e.item.tableCell.style.verticalAlign=t,t&&""!==t&&e.item.tableCell.getAttribute("valign")&&e.item.tableCell.removeAttribute("valign"),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.cellMerge=function(e){(0,o.isNullOrUndefined)(this.curTable)&&(this.curTable=(0,o.closest)(this.parent.nodeSelection.range.startContainer.parentElement,"table"));var t=this.curTable.querySelectorAll(".e-cell-select");if(!(t.length<2)){this.mergeCellContent();for(var n=this.getSelectedMinMaxIndexes(this.getCorrespondingColumns()),i=t[0],r=i.parentElement.querySelectorAll(".e-cell-select"),s=0,a=0;a<r.length;a++){var l=r[a].offsetHeight;l>s&&(s=l)}n.startColumn<n.endColumn&&i.setAttribute("colspan",(n.endColumn-n.startColumn+1).toString()),n.startRow<n.endRow&&i.setAttribute("rowspan",(n.endRow-n.startRow+1).toString());var d,c=0;for(a=r.length-1;a>=0;a--)if((0,o.isNullOrUndefined)(r[a].style.width)||""===r[a].style.width)c+=r[a].offsetWidth/this.curTable.offsetWidth*100,d="%";else{if(!d){var h=r[a].style.width.match(/^([\d.]+)([a-z%]+)$/i);d=h?h[2]:"%"}c+=parseFloat(r[a].style.width)}i.style.width=c+d,i.style.height=s+"px";for(var p=1;p<=t.length-1;p++)(0,o.detach)(t[p]);for(p=0;p<this.curTable.rows.length;p++)""===this.curTable.rows[p].innerHTML.trim()&&(0,o.detach)(this.curTable.rows[p]);Fs(this.curTable.querySelectorAll("table td, table th"),"e-multi-cells-select"),Fs(this.curTable.querySelectorAll("table td, table th"),"e-cell-select-end"),this.updateRowSpanStyle(n.startRow,n.endRow,this.getCorrespondingColumns()),this.updateColSpanStyle(n.startColumn,n.endColumn,this.getCorrespondingColumns()),e.item.selection.setSelectionText(this.parent.currentDocument,e.item.selection.range.startContainer,e.item.selection.range.startContainer,0,0),this.parent.nodeSelection&&i&&this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,i,0),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})}},e.prototype.updateColSpanStyle=function(e,t,n){var i,o,r,s,a=0,l=0,d=n;if(e<(t=Math.min(t,d[0].length-1))){for(o=e;o<=t;o++)if(a=Math.min(parseInt(d[0][o].getAttribute("colspan"),10)||1,t-e+1),!(e<o&&d[0][o]===d[0][o-1])&&1<a&&d[0][o]===d[0][o+1])for(l=a-1,i=1;i<d.length;i++){if(d[i][o]!==d[i-1][o])for(r=o;r<o+a;r++)if(1<(s=parseInt(d[i][r].getAttribute("colspan"),10)||1)&&d[i][r]===d[i][r+1])r+=l=Math.min(l,s-1);else if(0===(l=Math.max(0,l-1)))break;if(!l)break}l&&this.updateCellAttribute(d,l,"colspan",0,d.length-1,e,t)}},e.prototype.updateRowSpanStyle=function(e,t,n){var i,o,r,s,a=0,l=0,d=n;if(e<(t=Math.min(t,d.length-1))){for(i=e;i<=t;i++)if(!(e<i&&d[i][0]===d[i-1][0])&&d[i][0]&&1<(a=Math.min(parseInt(d[i][0].getAttribute("rowspan"),10)||1,t-e+1))&&d[i][0]===d[i+1][0])for(l=a-1,o=1;o<d[0].length;o++)if(d[i][o]!==d[i][o-1]){for(r=i;r<i+a;r++)if(1<(s=parseInt(d[r][o].getAttribute("rowspan"),10)||1)&&d[r][o]===d[r+1][o])r+=l=Math.min(l,s-1);else if(!(l=Math.max(0,l-1)))break;if(!l)break}l&&this.updateCellAttribute(d,l,"rowspan",e,t,0,d[0].length-1)}},e.prototype.updateCellAttribute=function(e,t,n,i,o,r,s){var a,l,d;for(a=i;a<=o;a++)for(l=r;l<=s;l++)d=parseInt(e[a][l].getAttribute(n),10)||1,(i<a&&e[a][l]===e[a-1][l]||r<l&&e[a][l]===e[a][l-1]||1<d)&&(1<d-t?e[a][l].setAttribute(n,(d-t).toString()):e[a][l].removeAttribute(n))},e.prototype.mergeCellContent=function(){for(var e=this.curTable.querySelectorAll(".e-cell-select"),t="<br>"===e[0].innerHTML?"":e[0].innerHTML,n=1;n<e.length;n++)"<br>"!==e[n].innerHTML&&(t=t?t+"<br>"+e[n].innerHTML:t+e[n].innerHTML);e[0].innerHTML=t},e.prototype.getSelectedMinMaxIndexes=function(e){var t=this.curTable.querySelectorAll(".e-cell-select");if(0<t.length){for(var n=e.length,i=0,o=e[0].length,r=0,s=0;s<t.length;s++){var a=this.getCorrespondingIndex(t[s],e),l=this.FindIndex(a[0],a[1],e);n=Math.min(a[0],n),i=Math.max(l[0],i),o=Math.min(a[1],o),r=Math.max(l[1],r)}return{startRow:n,endRow:i,startColumn:o,endColumn:r}}return null},e.prototype.HorizontalSplit=function(e){var t=e.item.selection.range.startContainer;if(this.curTable=(0,o.closest)(t.parentElement,"table"),!(this.curTable.querySelectorAll(".e-cell-select").length>1)){this.activeCell=this.curTable.querySelector(".e-cell-select");var n=this.activeCell.cloneNode(!0);n.removeAttribute("class"),n.innerHTML="</br>";var i=this.getCorrespondingIndex(this.activeCell,this.getCorrespondingColumns()),r=this.getCorrespondingColumns(),s=this.activeCell.getAttribute("rowspan")?parseInt(this.activeCell.getAttribute("rowspan"),10):1;if(s>1){var a=Math.ceil(s/2);1<a?this.activeCell.setAttribute("rowspan",a.toString()):this.activeCell.removeAttribute("rowspan"),1<s-a?n.setAttribute("rowspan",(s-a).toString()):n.removeAttribute("rowspan");var l,d=void 0;for(l=i[0]+Math.ceil(s/2),d=0===i[1]?i[1]:i[1]-1;0<=d&&(r[l][d]===r[l][d-1]||0<l&&r[l][d]===r[l-1][d]);)d--;-1===d?this.curTable.rows[l].firstChild?this.curTable.rows[l].prepend(n):this.curTable.appendChild(n):r[l][d].insertAdjacentElement("afterend",n)}else{var c=(0,o.createElement)("tr");c.appendChild(n);for(var h=r[i[0]],p=0;p<=h.length-1;p++)h[p]!==h[p-1]&&h[p]!==this.activeCell&&h[p].setAttribute("rowspan",((parseInt(h[p].getAttribute("rowspan"),10)?parseInt(h[p].getAttribute("rowspan"),10):1)+1).toString());this.activeCell.parentNode.insertAdjacentElement("afterend",c)}e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})}},e.prototype.VerticalSplit=function(e){var t=e.item.selection.range.startContainer;if(this.curTable=(0,o.closest)(t.parentElement,"table"),!(this.curTable.querySelectorAll(".e-cell-select").length>1)){this.activeCell=this.curTable.querySelector(".e-cell-select");var n=this.curTable.rows,i=this.activeCell.cloneNode(!0);i.removeAttribute("class"),i.innerHTML="</br>";var r=this.getCorrespondingIndex(this.activeCell,this.getCorrespondingColumns()),s=this.getCorrespondingColumns(),a=parseInt(this.activeCell.getAttribute("colspan"),10)||1;if(a>1){var l=Math.ceil(a/2),d=this.getColSizes(this.curTable),c=this.getSplitColWidth(r[1],r[1]+l-1,d),h=this.getSplitColWidth(r[1]+l,r[1]+a-1,d),p=this.convertPixelToPercentage(this.activeCell.offsetWidth,this.curTable.offsetWidth);h=p-c<h?p-c:h,1<l?this.activeCell.setAttribute("colspan",l.toString()):this.activeCell.removeAttribute("colspan"),1<a-l?i.setAttribute("colspan",(a-l).toString()):i.removeAttribute("colspan"),this.activeCell.style.width=c+"%",i.style.width=h+"%"}else{for(var u=parseFloat(this.activeCell.style.width)/2,m=0;m<=n.length-1;m++)if(0===m||s[m][r[1]]!==s[m-1][r[1]]){var f=s[m][r[1]];f!==this.activeCell&&f.setAttribute("colspan",((parseInt(f.getAttribute("colspan"),10)?parseInt(f.getAttribute("colspan"),10):1)+1).toString())}this.activeCell.style.width=u+"%",i.style.width=u+"%"}this.activeCell.parentNode.insertBefore(i,this.activeCell.nextSibling),e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})}},e.prototype.getSplitColWidth=function(e,t,n){for(var i=0,o=e;o<=t;o++)i+=n[o];return this.convertPixelToPercentage(i,this.curTable.offsetWidth)},e.prototype.getColSizes=function(e){for(var t=e.rows[0].cells,n=0,i=0;i<t.length;i++)n+=t[i].colSpan;for(var o=new Array(n),r=new Map,s=0;s<e.rows.length;s++)for(var a=0,l=0;l<e.rows[s].cells.length;l++){for(var d=1;d<e.rows[s].cells[l].rowSpan;d++){var c=""+(s+d)+a;r.set(c,e.rows[s].cells[l])}var h=this.getCellIndex(r,s,l);h>a&&(a=h);var p=e.rows[s].cells[l].offsetWidth;(!o[a]||p<o[a])&&(o[a]=p),a+=1+e.rows[s].cells[l].colSpan-1}return o},e.prototype.getCellIndex=function(e,t,n){var i=""+t+n,o=e.get(i);return o?this.getCellIndex(e,t,n+o.colSpan):n},e.prototype.convertPixelToPercentage=function(e,t){return e/t*100},e.prototype.getCorrespondingColumns=function(){for(var e=[],t=this.curTable.rows,n=0;n<=t.length-1;n++)for(var i=t[n],o=0,r=0;r<=i.children.length-1;r++){for(var s=i.children[r],a=s,l=parseInt(a.getAttribute("colspan"),10)||1,d=parseInt(a.getAttribute("rowspan"),10)||1,c=n;c<n+d;c++)for(var h=o;h<o+l;h++)e[c]||(e[c]=[]),e[c][h]?o++:e[c][h]=s;o+=0}return e},e.prototype.FindIndex=function(e,t,n){var i,o;for(i=e+1,o=t+1;i<n.length;){if(n[i][t]!==n[e][t]){i--;break}i++}for(i===n.length&&i--;o<n[e].length;){if(n[e][o]!==n[e][t]){o--;break}o++}return o===n[e].length&&o--,[i,o]},e.prototype.getCorrespondingIndex=function(e,t){for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)if(t[n][i]===e)return[n,i];return[]},e.prototype.highlightCells=function(e,t,n,i,o){var r,s,a,l,d=e,c=t,h=n,p=i,u=new Ka;for(r=d;r<=c;r++){for(a=this.getCorrespondingIndex(o[r][h],o),l=this.FindIndex(a[0],a[1],o),(1<(parseInt(o[r][h].getAttribute("rowspan"),10)||1)||1<(parseInt(o[r][h].getAttribute("colspan"),10)||1))&&l?(d=Math.min(a[0],d),c=Math.max(l[0],c),h=Math.min(a[1],h),p=Math.max(l[1],p)):(1<(parseInt(o[r][p].getAttribute("rowspan"),10)||1)||1<(parseInt(o[r][p].getAttribute("colspan"),10)||1))&&(a=this.getCorrespondingIndex(o[r][p],o),(l=this.FindIndex(a[0],a[1],o))&&(d=Math.min(a[0],d),c=Math.max(l[0],c),h=Math.min(a[1],h),p=Math.max(l[1],p))),s=h;s<=p;s++)a=this.getCorrespondingIndex(o[d][s],o),l=this.FindIndex(a[0],a[1],o),(1<(parseInt(o[d][s].getAttribute("rowspan"),10)||1)||1<(parseInt(o[d][s].getAttribute("colspan"),10)||1))&&l?(d=Math.min(a[0],d),c=Math.max(l[0],c),h=Math.min(a[1],h),p=Math.max(l[1],p)):(1<(parseInt(o[c][s].getAttribute("rowspan"),10)||1)||1<(parseInt(o[c][s].getAttribute("colspan"),10)||1))&&(a=this.getCorrespondingIndex(o[c][s],o),(l=this.FindIndex(a[0],a[1],o))&&(d=Math.min(a[0],d),c=Math.max(l[0],c),h=Math.min(a[1],h),p=Math.max(l[1],p)));u=d===e&&c===t&&h===n&&p===i?{startRow:e,endRow:t,startColumn:n,endColumn:i}:this.highlightCells(d,c,h,p,o)}return u},e.prototype.restoreRange=function(e){this.parent.userAgentData.isSafari()?this.parent.nodeSelection.Clear(this.parent.currentDocument):!this.parent.currentDocument.getSelection().rangeCount||"TD"!==e.nodeName&&"TH"!==e.nodeName||this.parent.nodeSelection.setCursorPoint(this.parent.currentDocument,e,0)},e.prototype.tableStyle=function(e){e.callBack&&e.callBack({requestType:e.item.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.tableMove=function(e){this.activeCell=e.selectNode[0];var t=e.event.target,n=this.activeCell.tagName,i=t.tagName;if(this.curTable=(0,o.closest)(t,"table"),"TD"===t.tagName||"TH"===t.tagName||n===i){var r=(0,o.closest)(this.activeCell,"table");if(!(0,o.isNullOrUndefined)(this.curTable)&&!(0,o.isNullOrUndefined)(r)&&r===this.curTable){for(var s=this.getCorrespondingColumns(),a=this.getCorrespondingIndex(this.activeCell,s),l=this.getCorrespondingIndex(t,s),d=this.curTable.querySelectorAll(".e-cell-select, .e-multi-cells-select, .e-cell-select-end"),c=d.length-1;c>=0;c--)this.activeCell!==d[c]&&Fs([d[c]],["e-cell-select"]),Fs([d[c]],["e-multi-cells-select"]),Fs([d[c]],["e-cell-select-end"]);if(a[0]!==l[0]||a[1]!==l[1]){for(var h=this.highlightCells(Math.min(a[0],l[0]),Math.max(a[0],l[0]),Math.min(a[1],l[1]),Math.max(a[1],l[1]),s),p=h.startRow;p<=h.endRow;p++)for(var u=h.startColumn;u<=h.endColumn;u++)s[p][u].classList.add("e-cell-select"),s[p][u].classList.add("e-multi-cells-select");t.classList.add("e-cell-select-end"),e.event.type&&e.event.preventDefault(),this.restoreRange(t)}else d.length>1&&this.restoreRange(t)}}},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.cellStyleCleanup=function(e){for(var t=e.split(";"),n=[],i=["background-color","vertical-align","text-align"],o=0;o<t.length;o++){for(var r=t[o],s=!0,a=0;a<i.length;a++){var l=i[a];r.indexOf(l)>-1&&(s=!1)}s&&n.push(r)}return n.join(";")},e}(),Ka=function(){},Ga=function(){function e(e,t){this.userAgent=e,this.isTesting=t}return e.prototype.getPlatform=function(){return!this.isTesting&&window.navigator.userAgentData?window.navigator.userAgentData.platform:/windows/i.test(this.userAgent)?"Windows":/macintosh|mac os/i.test(this.userAgent)&&!/iphone|ipad|ipod/i.test(this.userAgent)?"macOS":/linux/i.test(this.userAgent)&&!/android/i.test(this.userAgent)?"Linux":/iphone|ipad|ipod/i.test(this.userAgent)?"iOS":/android/i.test(this.userAgent)?"Android":"Unknown"},e.prototype.getBrowser=function(){if(!this.isTesting&&window.navigator.userAgentData)for(var e=0,t=window.navigator.userAgentData.brands;e<t.length;e++){var n=t[e];if("Google Chrome"===n.brand)return"Chrome";if("Microsoft Edge"===n.brand)return"Edge"}return/chrome|chromium|crios/i.test(this.userAgent)&&!/edg/i.test(this.userAgent)?"Chrome":/firefox|fxios/i.test(this.userAgent)&&!/edg/i.test(this.userAgent)?"Firefox":/safari/i.test(this.userAgent)&&!/chrome|chromium|crios/i.test(this.userAgent)?"Safari":/edg/i.test(this.userAgent)?"Edge":"Unknown"},e.prototype.isMobileDevice=function(){return!this.isTesting&&window.navigator.userAgentData?window.navigator.userAgentData.mobile:/(iphone|ipod|ipad|android|blackberry|bb|playbook|windows phone|webos|opera mini|mobile)/i.test(this.userAgent)},e.prototype.isSafari=function(){var e=this.getPlatform();return"Safari"===this.getBrowser()&&("macOS"===e||"iOS"===e)},e}(),Xa=function(){function e(){}return e.applyFormat=function(t,n,i,r,s,a,l,d){this.enterAction=r;if(["bold","italic","underline","strikethrough","superscript","subscript","uppercase","lowercase","fontcolor","fontname","fontsize","backgroundcolor","inlinecode"].indexOf(n)>-1||"formatPainter"===a){"backgroundcolor"===n&&""===a&&(a="transparent");var c=new sl(i),h=new Vs(i,t),p=new ha,u=new Kr,m=c.getRange(t),f=0,g=m.startContainer.parentElement;if(m.collapsed&&!(0,o.isNullOrUndefined)(g)&&"A"===g.tagName&&(m.startOffset===g.textContent.length||0===m.startOffset)){var b=document.createTextNode("");0===m.startOffset?g.parentNode.insertBefore(b,g):(0,o.isNullOrUndefined)(g.nextSibling)?g.parentNode.appendChild(b):g.parentElement.insertBefore(b,g.nextSibling);var v=t.createRange();m.setStart(b,0),m.setEnd(b,0),m.collapse(!0),c.setRange(t,v)}if(-1!==o.Browser.userAgent.indexOf("Firefox")&&m.startContainer===m.endContainer&&!(0,o.isNullOrUndefined)(i)&&m.startContainer===i){for(var y=m.startContainer.childNodes[m.startOffset>0?m.startOffset-1:m.startOffset]||m.startContainer,C=m.endContainer.childNodes[m.endOffset>0?m.endOffset-1:m.endOffset]||m.endContainer,N="BR"===C.lastChild.nodeName?(0,o.isNullOrUndefined)(C.lastChild.previousSibling)?C:C.lastChild.previousSibling:C.firstChild;!(0,o.isNullOrUndefined)(N)&&"#text"!==N.nodeName&&"IMG"!==N.nodeName&&"BR"!==N.nodeName&&"HR"!==N.nodeName;)N=N.lastChild;c.setSelectionText(t,y,N,0,0),m=c.getRange(t)}var E=c.save(m,t),S=void 0,T=!1;i&&s&&"#text"!==i.nodeName&&(S=s.getTextNodes()),S&&S.length>0?T=!0:S=m.collapsed?c.getSelectionNodeCollection(m):c.getSelectionNodeCollectionBr(m);var O,L=!1,k=!1,x=!1,w=["fontcolor","fontname","fontsize","backgroundcolor"].indexOf(n)>-1,D=!1;if(e.userAgentData.isSafari()&&(D="None"!==e.isMentionStartOrEnd(i,S[0],S[S.length-1])),!T&&m.collapsed){var M=u.getFormattedNode(m.startContainer,n,i),A=(0,o.isNullOrUndefined)(M)?null:null===M.getAttribute("style")?M.nodeName:M.nodeName+"[style='"+M.getAttribute("style")+"']";if(S.length>0)L=!0,m=p.GetCursorRange(t,m,S[0]);else if(3===m.startContainer.nodeType&&(m.startContainer.parentElement.childElementCount>0&&m.startOffset>0&&"br"!==m.startContainer.parentElement.firstElementChild.tagName.toLowerCase()||!(0,o.isNullOrUndefined)(M)&&M===m.startContainer.parentElement.closest(A)&&0!==m.startContainer.parentElement.closest(A).textContent.replace(new RegExp("​","g"),"").trim().length))L=!0,m=p.GetCursorRange(t,m,m.startContainer),S.push(m.startContainer);else{var B=this.insertCursorNode(t,c,m,u,p,n,a,i);c.endContainer=c.startContainer=c.getNodeArray(B,!0);var R="BR"===B.nodeName&&B.parentNode.childNodes;(0,o.isNullOrUndefined)(R)||1!==R.length||"BR"!==R[0].nodeName||0!==S.length?c.endOffset=c.startOffset=1:(c.setSelectionText(t,m.startContainer,m.endContainer,0,0),x=!0),"BR"===B.nodeName&&0===B.parentNode.textContent.length&&(x=!0)}}O=!T&&m.collapsed;for(var I=!1,U=0,P=0;P<S.length;P++){(u.getFormattedNode(S[P],n,i)||"BR"===S[P].nodeName)&&U++}var H=U===S.length;for(P=0;P<S.length;P++){var j=u.getFormattedNode(S[P],n,i);null===j&&("subscript"===n?I=null!==(j=u.getFormattedNode(S[P],"superscript",i)):"superscript"===n&&(I=null!==(j=u.getFormattedNode(S[P],"subscript",i)))),0===P&&null===j&&(k=!0),null===j||k&&!w||(S[P]=this.removeFormat(S,P,j,O,T,k,w,m,p,n,a,c,i,h)),null!==j||H||(S[P]=this.insertFormat(t,S,P,j,O,T,k,w,m,p,n,a,d,h,i),f++),S.length===f&&(this.isWrapped=!0),T||D||(c=this.applySelection(S,c,p,P,L))}Us()&&Ps(i,l),x||T||E.restore(),I&&this.applyFormat(t,n,i,r,s)}},e.insertCursorNode=function(e,t,n,i,r,s,a,l){var d=t.getNodeCollection(n),c=new Vs(l,e),h=d.length>0?d.length>1&&n.startContainer===n.endContainer?this.getCursorFormat(i,d,s,l):""===a&&"fontsize"===s&&null==i.getFormattedNode(d[0],s,l)&&"SPAN"===d[0].parentElement.nodeName?d[0].parentElement:i.getFormattedNode(d[0],s,l):null,p=null;if(h){if(p=d[0],8203===h.firstChild.textContent.charCodeAt(0)&&3===h.firstChild.nodeType){var u=new RegExp("​","g"),m=void 0;if("#text"!==p.nodeName)for(var f=0;f<d.length;f++)d[f].nodeType===Node.TEXT_NODE&&(p=d[f]);h.firstChild===p?(p.textContent=h.parentElement&&(c.isBlockNode(h.parentElement)&&h.parentElement.textContent.length<=1?h.parentElement.childElementCount>1:0===h.childElementCount)&&(h.parentElement.textContent.length>1||h.parentElement.firstChild&&1===h.parentElement.firstChild.nodeType)?p.textContent:p.textContent.replace(u,""),m=p):(h.firstChild.textContent=h.firstChild.textContent.replace(u,""),m=h.firstChild);var g=void 0;if(0===m.textContent.length)if((0,o.isNullOrUndefined)(m.previousSibling)){if(!(0,o.isNullOrUndefined)(m.parentElement)&&0===m.parentElement.textContent.length){var b=document.createElement("BR");m.parentElement.appendChild(b),(0,o.detach)(m),p=b,t.setCursorPoint(e,p.parentElement,0)}}else p=m.previousSibling,g=m.textContent.length-1,t.setCursorPoint(e,m,g)}["fontcolor","fontname","fontsize","backgroundcolor"].indexOf(s)>-1?("fontcolor"===s?h.style.color=a:"fontname"===s?h.style.fontFamily=a:"fontsize"===s?h.style.fontSize=a:h.style.backgroundColor=a,p=h):(ca.unwrap(h),t.setCursorPoint(e,p,0))}else{if(d.length>1&&n.startOffset>0&&d[0].firstElementChild&&"br"===d[0].firstElementChild.tagName.toLowerCase()&&(d[0].innerHTML=""),1!==d.length||0!==n.startOffset||"BR"!==d[0].nodeName&&((0,o.isNullOrUndefined)(d[0].nextSibling)||"BR"!==d[0].nextSibling.nodeName)||(0,o.detach)("#text"===d[0].nodeName?d[0].nextSibling:d[0]),!(0,o.isNullOrUndefined)(d[0]&&d[0].parentElement)&&-1!==Kr.inlineTags.indexOf(d[0].parentElement.tagName.toLowerCase())&&d[0].textContent.includes("​")){var v=this.GetFormatNode(s,a),y=d[0];if("fontsize"===s)for(var C=d[0];C;){var N=C.parentElement.textContent.trim()===d[0].textContent.trim(),E=C.parentElement;if(c.isBlockNode(E)||!N||"SPAN"===E.nodeName&&E.classList.contains("e-img-inner"))break;C=E,d[0]=C}return this.applyStyles(d,0,v),y}p=this.getInsertNode(e,n,s,a).firstChild}return p},e.getCursorFormat=function(e,t,n,i){for(var o,r=0;r<t.length;r++)o=t[r].lastElementChild?t[r].lastElementChild:t[r];return"fontsize"===n&&null==e.getFormattedNode(o,n,i)&&"SPAN"===o.parentElement.nodeName?o.parentElement:e.getFormattedNode(o,n,i)},e.removeFormat=function(t,n,i,r,s,a,l,d,c,h,p,u,m,f){var g,b,v=null,y="#text"===d.startContainer.nodeName?d.startContainer.textContent.substring(d.startOffset,d.startContainer.textContent.length):d.startContainer.textContent,C=t[n].textContent,N=t[0].parentElement.nodeName===t[0].parentElement.parentElement.nodeName;if(d.startContainer!==d.endContainer||0!==d.startOffset||d.endOffset!==d.startContainer.length||d.startContainer.textContent!==i.textContent&&!N){var E=[],S=t[n],T=S;do{E.push(u.getIndex(S)),S=S.parentNode}while(S&&S!==i);if("BR"!==t[n].nodeName&&("#text"===T.nodeName&&T.textContent.includes("​")&&T.remove(),s||(S=v=r&&i.textContent.length-1===d.startOffset?c.SplitNode(d,i,!0):c.GetSpliceNode(d,i))),r){for(var O=v;null!==O.firstChild&&3!==O.firstChild.nodeType;null)O=O.firstChild;O.innerHTML="&#8203;",t[n]=O.firstChild}else{for(;S&&S.childNodes.length>0&&E.length-1>=0&&S.childNodes.length>E[E.length-1];){if(S.childNodes.length>1&&E.length>1){S=S.childNodes[E[E.length-2]];break}S=S.childNodes[E[E.length-1]],E.pop()}if("BR"!==t[n].nodeName){for(;1===S.nodeType&&S.childNodes.length>0;)S=S.childNodes[0];if(3!==S.nodeType||r&&""===S.nodeValue){var L=document.createElement("div");L.innerHTML="&#8203;",3!==S.nodeType?(S.insertBefore(L.firstChild,S.firstChild),t[n]=S.firstChild):(S.parentNode.insertBefore(L.firstChild,S),t[n]=S.previousSibling,S.parentNode.removeChild(S))}else t[n]=S}}}else if(l&&!t[n].contains(i)&&3===t[n].nodeType&&t[n].textContent!==i.textContent){for(var k=t[n].textContent===t[n].wholeText,x=t[n],w=this.GetFormatNode(h,p);x&&x.textContent===x.parentElement.textContent;)x=x.parentElement;if(k&&i.textContent!==x.textContent){var D=[],M=this.getPriorityFormatNode(x,m);return M&&M.textContent===x.textContent&&(x=M),D.push(x),this.applyStyles(D,0,w),t[n]}}if("backgroundcolor"===h&&(g=i.style.fontSize),"fontsize"===h){var A=(0,o.closest)(t[n].parentElement,"span[style*=background-color]");(0,o.isNullOrUndefined)(A)||(b=A.style.backgroundColor)}var B,R=i.getAttribute("style"),I=i.tagName;if("A"===I&&"underline"===h)i.style.textDecoration="none",B=[i];else if(-1!==Kr.inlineTags.indexOf(I.toLowerCase())&&l&&"span"!==I.toLocaleLowerCase()){var U=i.style;U.color&&"fontcolor"===h?"A"===i.nodeName?U.color=p:U.color="":U.backgroundColor&&"backgroundcolor"===h?U.backgroundColor="":U.fontSize&&"fontsize"===h?U.fontSize="":U.fontFamily&&"fontname"===h&&(U.fontFamily=""),""===i.getAttribute("style")&&i.removeAttribute("style"),B=[i]}else{B=ca.unwrap(i),0===n&&(this.isUnwrapped=!0);var P=t[n].parentElement;(0,o.isNullOrUndefined)(P)||"li"===P.tagName.toLowerCase()||(P=(0,o.closest)(P,"li")),(0,o.isNullOrUndefined)(P)||"li"!==P.tagName.toLowerCase()||P.textContent.trim()!==t[n].textContent.trim()&&P.innerText.split("\n")[0]!==t[n].textContent.trim()?(0,o.isNullOrUndefined)(P)||"li"!==P.tagName.toLowerCase()||P.textContent.trim()===t[n].textContent.trim()||("bold"===h?P.style.fontWeight="":"italic"===h&&(P.style.fontStyle=""),e.conCatenateTextNode(P,h,"","normal",p)):"bold"===h?P.style.fontWeight="":"italic"===h?P.style.fontStyle="":"fontsize"===h&&(P.style.fontSize="")}if(B[0]&&!l)for(var H=x=B[n]?B[n]:B[0];x&&x.parentElement&&x.parentElement!==m;x){var j=void 0;if(j="SPAN"===i.nodeName?x.parentElement.tagName.toLocaleLowerCase()===i.tagName.toLocaleLowerCase()&&x.parentElement.getAttribute("style")===R:x.parentElement.tagName.toLocaleLowerCase()===i.tagName.toLocaleLowerCase(),x.parentElement&&j&&(x.parentElement.childElementCount>1||d.startOffset>1)){if(H.parentElement&&H.parentElement.tagName.toLocaleLowerCase()===i.tagName.toLocaleLowerCase()&&d.startOffset===d.endOffset&&1!==H.nodeType&&!(0,o.isNullOrUndefined)(H.textContent)&&H.parentElement.childElementCount>1&&(d.setStart(H,0),d.setEnd(H,H.textContent.length),c.SplitNode(d,H.parentElement,!1)),"span"===x.parentElement.tagName.toLocaleLowerCase()&&"underline"===i.style.textDecoration&&"underline"!==x.parentElement.style.textDecoration){x=x.parentElement;continue}ca.unwrap(x.parentElement),x=(0,o.isNullOrUndefined)(x.parentElement)||f.isBlockNode(x.parentElement)?x.parentElement:H}else x=x.parentElement}if(B.length>0&&l){for(var F=0;F<B.length;F++)if(3!==B[F].nodeType||B[F].textContent&&B[F].textContent.trim().length>0){""!==p&&"transparent"!==p&&(B[F]=ca.Wrap(B[F],this.GetFormatNode(h,p,I,R)));P=t[n].parentElement;(0,o.isNullOrUndefined)(P)||"li"===P.tagName.toLowerCase()||(P=(0,o.closest)(P,"li")),(0,o.isNullOrUndefined)(P)||"li"!==P.tagName.toLowerCase()||P.textContent.trim()!==t[n].textContent.trim()||"fontname"===h&&(P.style.fontFamily=p),(0,o.isNullOrUndefined)(P)||"li"!==P.tagName.toLowerCase()||P.textContent.trim()===t[n].textContent.trim()||P.removeAttribute("style"),B[F].textContent===y&&("#text"===d.startContainer.nodeName||"#text"!==d.startContainer.nodeName&&d.startContainer.classList&&!d.startContainer.classList.contains("e-multi-cells-select"))&&(0===F?d.setStartBefore(B[F]):F===B.length-1&&d.setEndAfter(B[F]))}var q=t[n].parentElement;if((0,o.isNullOrUndefined)(g)||""===g||(q.style.fontSize=g),(0,o.isNullOrUndefined)(b)||""===b||(q.style.backgroundColor=b),"fontsize"===h||"fontcolor"===h||"fontname"===h){P=t[n].parentElement;for(var z=t[n].parentElement;!(0,o.isNullOrUndefined)(z)&&"li"!==z.tagName.toLowerCase();)P=z=z.parentElement;F=n;for(var _="";F>=0&&!(0,o.isNullOrUndefined)(P)&&"li"===P.tagName.toLowerCase()&&P.contains(t[F])&&P.textContent.replace("/​/g","").trim().includes(t[F].textContent.trim());)_=t[F].textContent+_,F--;var V=!1,W=0,Q=!1;if(!(0,o.isNullOrUndefined)(P)&&P.childNodes)for(var K=0;K<P.childNodes.length;K++)"OL"!==P.childNodes[K].nodeName&&"UL"!==P.childNodes[K].nodeName||(W++,V=!0);if((0,o.isNullOrUndefined)(P)||"li"!==P.tagName.toLowerCase()||P.textContent.split("​").join("").trim()!==_.split("​").join("").trim()){if(!(0,o.isNullOrUndefined)(P)&&"li"===P.tagName.toLowerCase()&&V){if(V&&W>0)for(var G=0;G<P.childNodes.length;G++)t[n].textContent===P.childNodes[G].textContent&&t[n].textContent===C&&P.textContent.replace("/​/g","").trim().includes(_.split("​").join("").trim())&&(Q=!0);if(Q){for(var X=0;X<P.childNodes.length;X++)"OL"!==P.childNodes[X].nodeName&&"UL"!==P.childNodes[X].nodeName||P.childNodes[X].removeAttribute("style");"fontsize"===h?P.style.fontSize=p:"fontname"===h?P.removeAttribute("style"):(P.style.color=p,P.style.textDecoration="inherit")}}}else"fontsize"===h?P.style.fontSize=p:"fontname"===h?P.removeAttribute("style"):(P.style.color=p,P.style.textDecoration="inherit")}}return t[n]},e.insertFormat=function(t,n,i,r,s,a,l,d,c,h,p,u,m,f,g){if(s)if("uppercase"!==p&&"lowercase"!==p){b=this.getInsertNode(t,c,p,u);n[i]=b.firstChild,h.position=1}else h.position=c.startOffset;else if(null===r&&l||d){if(a||"BR"===n[i].nodeName||(n[i]=h.GetSpliceNode(c,n[i]),n[i].textContent=h.TrimLineBreak(n[i].textContent)),"uppercase"===p||"lowercase"===p)n[i].textContent="uppercase"===p?n[i].textContent.toLocaleUpperCase():n[i].textContent.toLocaleLowerCase();else if(!0!==d||""!==u){var b=this.GetFormatNode(p,u);if("formatPainter"===u||d){for(var v=n[i].parentElement,y=n[i].parentElement;!(0,o.isNullOrUndefined)(y)&&"li"!==y.tagName.toLowerCase();)v=y=y.parentElement;if("fontcolor"===p||"fontname"===p||"fontsize"===p){var C=n[i].parentElement;if(!(0,o.isNullOrUndefined)(C)&&C.childNodes)for(var N=0;N<C.childNodes.length;N++){if(this.concatenateTextExcludingList(n,i)===n[i].textContent){var E=void 0;if("LI"===C.tagName?E=C:C.closest("li")&&(E=C.closest("li")),!(0,o.isNullOrUndefined)(E))switch(p){case"fontcolor":E.style.color=u;break;case"fontname":E.style.fontFamily=u;break;case"fontsize":E.style.fontSize=u}}var S=C.childNodes[N];if("OL"===S.tagName||"UL"===S.tagName)switch(p){case"fontcolor":S.style.color="initial";break;case"fontname":S.style.fontFamily="initial";break;case"fontsize":S.style.fontSize="initial"}}}if((0,o.isNullOrUndefined)(v)||"li"!==v.tagName.toLowerCase()||v.textContent.trim()!==n[i].textContent.trim()||("fontsize"===p?v.style.fontSize=u:"fontcolor"===p?(v.style.color=u,v.style.textDecoration="inherit"):"fontname"===p&&(v.style.fontFamily=u)),"formatPainter"===u)return this.insertFormatPainterElem(n,i,c,h,m,f);var T=n[i],O=this.getPriorityFormatNode(T,g);if(!(0,o.isNullOrUndefined)(O)||d){var L=(0,o.isNullOrUndefined)(O)?T:O;if(L=(0,o.isNullOrUndefined)(O)||""===O.style.fontSize?L:L.firstChild,(0,o.isNullOrUndefined)(O)||"fontsize"===p)for(;L;){var k=L.parentElement.textContent.trim()===n[i].textContent.trim(),x=L.parentElement;if(f.isBlockNode(x)||!k||"SPAN"===x.nodeName&&x.classList.contains("e-img-inner"))break;L=x}var w=[];if(d){var D=(0,o.closest)(n[i].parentElement,"A");(0,o.isNullOrUndefined)(D)||D.firstChild.textContent.trim()!==n[i].textContent.trim()||(L=n[i])}n[i].textContent.trim()!==L.textContent.trim()&&(L=n[i]),w[0]=L,this.applyStyles(w,0,b),(0,o.isNullOrUndefined)(v)||"li"!==v.tagName.toLowerCase()||v.textContent.trim()===n[i].textContent.trim()||e.conCatenateTextNode(v,p,v.textContent,p,u)}else n[i]=this.applyStyles(n,i,b)}else{v=n[i].parentElement;n[i]=this.applyStyles(n,i,b),(0,o.isNullOrUndefined)(v)||"li"===v.tagName.toLowerCase()||(v=(0,o.closest)(v,"li")),(0,o.isNullOrUndefined)(v)||"li"!==v.tagName.toLowerCase()||v.textContent.trim()!==n[i].textContent.trim()&&v.innerText.split("\n")[0]!==n[i].textContent.trim()?(0,o.isNullOrUndefined)(v)||"li"!==v.tagName.toLowerCase()||v.textContent.trim()===n[i].textContent.trim()||e.conCatenateTextNode(v,p,v.textContent,p):"bold"===p?v.style.fontWeight="bold":"italic"===p&&(v.style.fontStyle="italic")}}}else!a&&n[i].isConnected&&(n[i]=h.GetSpliceNode(c,n[i]));return n[i]},e.applyStyles=function(e,t,n){return"BR"===e[t].nodeName&&"BR"===this.enterAction||(e[t]=t===e.length-1||"BR"===e[t].nodeName?ca.Wrap(e[t],n):ca.WrapBefore(e[t],n,!0),e[t]=this.getChildNode(e[t],n)),e[t]},e.getPriorityFormatNode=function(e,t){var n,i,r,s=new Kr,a=s.getFormattedNode(e,"fontsize",t);return(0,o.isNullOrUndefined)(a)?(i=s.getFormattedNode(e,"backgroundcolor",t),(0,o.isNullOrUndefined)(i)?(r=s.getFormattedNode(e,"fontname",t),(0,o.isNullOrUndefined)(r)?(n=s.getFormattedNode(e,"fontcolor",t),(0,o.isNullOrUndefined)(n)?null:n):r):i):a},e.getInsertNode=function(e,t,n,i){var r=this.GetFormatNode(n,i);if(r.innerHTML="&#8203;",o.Browser.isIE){var s=e.createDocumentFragment();s.appendChild(r),t.insertNode(s)}else t.insertNode(r);return r},e.getChildNode=function(e,t){return null==e&&(t.innerHTML="&#8203;",e=t.firstChild),e},e.applySelection=function(e,t,n,i,o){return 1!==e.length||o?1===e.length&&o?(t.startContainer=t.getNodeArray(e[i],!0),t.endContainer=t.startContainer,t.startOffset=n.position,t.endOffset=n.position):0===i?(t.startContainer=t.getNodeArray(e[i],!0),t.startOffset=0):i===e.length-1&&(t.endContainer=t.getNodeArray(e[i],!1),t.endOffset=e[i].textContent.length):(t.startContainer=t.getNodeArray(e[i],!0),t.endContainer=t.startContainer,t.startOffset=0,t.endOffset=e[i].textContent.length),t},e.GetFormatNode=function(e,t,n,i){var o;switch(e){case"bold":return document.createElement("strong");case"italic":return document.createElement("em");case"underline":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.textDecoration="underline",o;case"strikethrough":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.textDecoration="line-through",o;case"superscript":return document.createElement("sup");case"subscript":return document.createElement("sub");case"fontcolor":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.color=t,o.style.textDecoration="inherit",o;case"fontname":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.fontFamily=t,o;case"fontsize":return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.fontSize=t,o;case"inlinecode":return document.createElement("code");default:return o=document.createElement("span"),this.updateStyles(o,n,i),o.style.backgroundColor=t,o}},e.updateStyles=function(e,t,n){null!==n&&"SPAN"===t&&(e.style.cssText=n)},e.insertFormatPainterElem=function(e,t,n,i,r,s){var a=s.isBlockNode(e[t].parentElement)?e[t]:e[t].parentElement;if(!s.isBlockNode(a))for(;a.textContent.trim()===a.parentElement.textContent.trim()&&!s.isBlockNode(a.parentElement);)a=a.parentElement;(0,o.isNullOrUndefined)(a)||1!==a.nodeType||a.classList.contains("e-rte-img-caption")||a.classList.contains("e-img-inner")||this.formatPainterCleanup(t,e,a,n,i,s);var l=r.element;if(!(0,o.isNullOrUndefined)(l)){var d=l.cloneNode(!0),c=d.querySelectorAll(r.lastChild.nodeName),h=void 0;c.length>0?h=c[c.length-1]:(0,o.isNullOrUndefined)(d)||d.nodeName!==r.lastChild.nodeName||(h=d),h.textContent=e[t].textContent;var p=h.childNodes[0];e[t]=ca.Wrap(e[t],d),e[t].textContent="",e[t]=p}return e[t]},e.formatPainterCleanup=function(e,t,n,i,r,s){var a=["A","AUDIO","IMG","VIDEO","IFRAME"];if(0===e&&n.textContent.trim()!==t[e].textContent.trim()){r.SplitNode(i,n,!0);for(var l=t[e].parentElement.childNodes,d=0;d<l.length;d++)if(l[d].textContent.trim()===t[d].textContent.trim()){n.parentNode.insertBefore(l[d],n);break}for(var c=n.parentElement.childNodes,h=0;h<c.length;h++)""!==c[h].textContent.trim()&&0!==c[h].textContent.length||160===c[h].textContent.charCodeAt(0)||(0,o.detach)(c[h])}else if(n.textContent.trim()!==t[e].textContent.trim())n.parentElement.insertBefore(t[e],n);else for(;!(0,o.isNullOrUndefined)(n)&&3!==n.nodeType&&!s.isBlockNode(n);){var p=void 0;for(d=0;d<n.childNodes.length;d++){var u=n.childNodes[d];0!==u.textContent.trim().length&&3!==u.nodeType&&(p=n.childNodes[d])}-1===a.indexOf(n.tagName)&&ca.unwrap(n),n=p}},e.concatenateTextExcludingList=function(e,t){var n="",i="#text"===e[t].nodeName?(0,o.closest)(e[t].parentElement,"li"):(0,o.closest)(e[t],"li");if(!(0,o.isNullOrUndefined)(i))for(var r=0;r<i.childNodes.length;r++){var s=i.childNodes[r];(3===s.nodeType||1===s.nodeType&&"OL"!==s.tagName&&"UL"!==s.tagName)&&(n+=s.textContent)}return n},e.conCatenateTextNode=function(t,n,i,r,s){var a="",l="";switch(n){case"bold":t.querySelectorAll("strong").forEach((function(e){a+=e.textContent})),a===i&&(t.style.fontWeight=r);break;case"italic":t.querySelectorAll("em").forEach((function(e){a+=e.textContent})),a===i&&(t.style.fontStyle=r);break;case"fontcolor":t.querySelectorAll("span").forEach((function(t){l=t.style.color,e.hasColorsEqual(l,s)&&(a+=t.textContent)})),(0,o.isNullOrUndefined)(a)||(0,o.isNullOrUndefined)(i)||""===a||""===i||a.replace(/\s+/g,"")!==i.replace(/\s+/g,"")||(t.style.color=s,t.style.textDecoration="inherit");break;case"fontsize":t.querySelectorAll("span").forEach((function(e){e.style.getPropertyValue("font-size")===s&&(a+=e.textContent)})),(0,o.isNullOrUndefined)(a)||(0,o.isNullOrUndefined)(i)||""===a||""===i||a.replace(/\s+/g,"")!==i.replace(/\s+/g,"")||(t.style.fontSize=s);break;case"fontname":t.querySelectorAll("span").forEach((function(e){e.style.getPropertyValue("font-family").replace(/ /g,"")===s&&(a+=e.textContent)})),(0,o.isNullOrUndefined)(a)||(0,o.isNullOrUndefined)(i)||""===a||""===i||a.replace(/\s+/g,"")!==i.replace(/\s+/g,"")||(t.style.fontFamily=s)}},e.hasColorsEqual=function(e,t){return(0,o.isNullOrUndefined)(e)||(0,o.isNullOrUndefined)(t)||""===e.trim()||""===t.trim()?e===t:(e.startsWith("rgb(")&&(e=e.replace("rgb(","rgba(").slice(0,-1)+",1)"),t.startsWith("rgb(")&&(t=t.replace("rgb(","rgba(").slice(0,-1)+",1)"),e.replace(/\s+/g,"")===t.replace(/\s+/g,""))},e.isMentionStartOrEnd=function(e,t,n){var i="None",o=new ua(e),r=o.getTopMostNode(t),s=o.getTopMostNode(n);return r.nodeType!==Node.ELEMENT_NODE||r.isContentEditable||s.nodeType!==Node.ELEMENT_NODE||s.isContentEditable||(i="Both"),r.nodeType!==Node.ELEMENT_NODE||r.isContentEditable||(i="Start"),s.nodeType!==Node.ELEMENT_NODE||s.isContentEditable||(i="End"),i},e.enterAction="P",e.isUnwrapped=!1,e.isWrapped=!1,e.userAgentData=new Ga(o.Browser.userAgent,!1),e}(),Ya=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(ys,this.applySelection,this),this.parent.observer.on(Gs,this.keyDownHandler,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(ys,this.applySelection),this.parent.observer.off(Gs,this.keyDownHandler),this.parent.observer.off(da,this.destroy)},e.prototype.keyDownHandler=function(e){(e.event.ctrlKey||e.event.metaKey)&&["bold","italic","underline","strikethrough","superscript","subscript","uppercase","lowercase","inlinecode"].indexOf(e.event.action)>-1&&(e.event.preventDefault(),Xa.applyFormat(this.parent.currentDocument,e.event.action,this.parent.editableElement,e.enterAction,this.parent.tableCellSelection),this.callBack(e,e.event.action))},e.prototype.applySelection=function(e){Xa.applyFormat(this.parent.currentDocument,e.subCommand.toLocaleLowerCase(),this.parent.editableElement,e.enterAction,this.parent.tableCellSelection,e.value,e.selector),this.callBack(e,e.subCommand)},e.prototype.callBack=function(e,t){e.callBack&&e.callBack({requestType:t,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e}(),Ja=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Cs,this.applyHtml,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Cs,this.applyHtml),this.parent.observer.off(da,this.destroy)},e.prototype.applyHtml=function(e){if(pa.Insert(this.parent.currentDocument,e.value,this.parent.editableElement,!0,e.enterAction),"pasteCleanup"===e.subCommand){var t=this.parent.editableElement.querySelectorAll(".pasteContent_RTE"),n=[].slice.call(t),i=this.parent.editableElement.querySelectorAll(".pasteContent_Img"),o=[].slice.call(i);e.callBack({requestType:e.subCommand,editorMode:"HTML",elements:n,imgElem:o})}else e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e}(),$a=function(){function e(){}return e.clear=function(e,t,n,i,r){this.domNode=new Vs(t,e),this.defaultTag="P"===n?"p":"div";var s=new sl(t),a=new ha,l=s.getRange(e),d=l.collapsed?s.getSelectionNodeCollection(l):s.getSelectionNodeCollectionBr(l),c=s.save(l,e),h=!1;if(l.collapsed&&"ClearFormat"!==r&&(h=!0,l=a.GetCursorRange(e,l,d[0])),!l.collapsed){var p=void 0;if(p=d.length>0&&"BR"===d[0].nodeName&&(0,o.closest)(d[0],"table")?a.GetSpliceNode(l,(0,o.closest)(d[0],"table")):a.GetSpliceNode(l,d[d.length>1&&"IMG"===d[0].nodeName?1:0]),1===d.length)s.setSelectionContents(e,p),l=s.getRange(e);else if(d.length>1){for(var u=1,m=d[d.length-u];d.length<=u&&"BR"===d[d.length-u].nodeName;)u++,m=d[d.length-u];var f=a.GetSpliceNode(l,m);f&&s.setSelectionText(e,p,f,0,3===f.nodeType?f.textContent.length:f.childNodes.length),l=s.getRange(e)}var g=s.getNodeCollection(l),b=g.slice();this.clearInlines(s.getSelectionNodes(b),b,s.getRange(e),a,t),this.reSelection(e,c,g),l=s.getRange(e);var v=(g=s.getNodeCollection(l)).slice();this.clearBlocks(e,v,t,a,s),Us()&&Ps(t,i),this.reSelection(e,c,g)}h&&s.setCursorPoint(e,l.endContainer,l.endOffset)},e.reSelection=function(e,t,n){var i=t.getInsertNodes(n);t.startContainer=t.getNodeArray(i[0],!0,e),t.startOffset=0,t.endContainer=t.getNodeArray(i[i.length-1],!1,e);var o=i[i.length-1];t.endOffset=3===o.nodeType?o.textContent.length:o.childNodes.length,t.restore()},e.clearBlocks=function(e,t,n,i,o){for(var r=[],s=0;s<t.length;s++)this.BLOCK_TAGS.indexOf(t[s].nodeName.toLocaleLowerCase())>-1&&-1===r.indexOf(t[s])?r.push(t[s]):this.BLOCK_TAGS.indexOf(t[s].parentNode.nodeName.toLocaleLowerCase())>-1&&-1===r.indexOf(t[s].parentNode)&&n!==t[s].parentNode&&r.push(t[s].parentNode);r=this.spliceParent(r,t)[0],r=this.removeParent(r),this.unWrap(e,r,i,o)},e.spliceParent=function(e,t){for(var n=0;n<e.length;n++)for(var i=e[n].childNodes.length,o=0;o<i;o++)if(t.indexOf(e[n].childNodes[o])>0&&e[n].childNodes[o].childNodes.length>0&&(t=this.spliceParent([e[n].childNodes[o]],t)[1]),t.indexOf(e[n].childNodes[o])<=-1&&""!==e[n].childNodes[o].textContent.trim()){for(var r=0;r<i;r++)t.indexOf(e[n].childNodes[r])>-1&&t.splice(t.indexOf(e[n].childNodes[r]),1);o=e[n].childNodes.length;var s=e.indexOf(e[n].parentNode),a=t.indexOf(e[n].parentNode);s>-1&&e.splice(s,1),a>-1&&t.splice(a,1);var l=t.indexOf(e[n]);l>-1&&t.splice(l,1),e.splice(n,1),n--}return[e,t]},e.removeChild=function(e,t){var n=t.childNodes.length;if(n>0)for(var i=0;i<n;i++)e.indexOf(t.childNodes[i])>-1&&(e=this.removeChild(e,t.childNodes[i])).splice(e.indexOf(t.childNodes[i]),1);return e},e.removeParent=function(e){for(var t=0;t<e.length;t++)e.indexOf(e[t].parentNode)>-1&&((e=this.removeChild(e,e[t])).splice(t,1),t--);return e},e.unWrap=function(e,t,n,i){for(var r=0;r<t.length;r++){t[r]=(0,o.closest)(t[r],"li")&&"UL"!==t[r].nodeName&&"OL"!==t[r].nodeName?(0,o.closest)(t[r],"li"):t[r],this.NONVALID_TAGS.indexOf(t[r].nodeName.toLowerCase())>-1&&t[r].parentNode&&this.NONVALID_PARENT_TAGS.indexOf(t[r].parentNode.nodeName.toLowerCase())>-1&&(i.setSelectionText(e,t[r],t[r],0,t[r].childNodes.length),ca.unwrap(n.GetSpliceNode(i.getRange(e),t[r].parentNode)));var s=(0,o.closest)(t[r],"blockquote");if("blockquote"!==t[r].nodeName.toLocaleLowerCase()&&!(0,o.isNullOrUndefined)(s)&&s.textContent===t[r].textContent){var a=this.removeParent([s]);this.unWrap(e,a,n,i)}if("p"!==t[r].nodeName.toLocaleLowerCase()){!(this.NONVALID_PARENT_TAGS.indexOf(t[r].nodeName.toLowerCase())<0)||("blockquote"===t[r].nodeName.toLocaleLowerCase()||"li"===t[r].nodeName.toLocaleLowerCase())&&this.IGNORE_PARENT_TAGS.indexOf(t[r].childNodes[0].nodeName.toLocaleLowerCase())>-1||1===t[r].childNodes.length&&"p"===t[r].childNodes[0].nodeName.toLocaleLowerCase()||ca.Wrap(t[r],e.createElement(this.defaultTag));var l=ca.unwrap(t[r]);1===l.length&&"p"===l[0].parentNode.nodeName.toLocaleLowerCase()&&(ca.Wrap(t[r],e.createElement(this.defaultTag)),ca.unwrap(t[r]));for(var d=0;d<l.length;d++)if(this.NONVALID_TAGS.indexOf(l[d].nodeName.toLowerCase())>-1)this.unWrap(e,[l[d]],n,i);else if(this.BLOCK_TAGS.indexOf(l[d].nodeName.toLocaleLowerCase())>-1&&"p"!==l[d].nodeName.toLocaleLowerCase()){a=this.removeParent([l[d]]);this.unWrap(e,a,n,i)}else this.BLOCK_TAGS.indexOf(l[d].nodeName.toLocaleLowerCase())>-1&&"p"===l[d].nodeName.toLocaleLowerCase()?("p"===l[d].parentNode.nodeName.toLocaleLowerCase()&&ca.unwrap(l[d].parentNode),ca.Wrap(l[d],e.createElement(this.defaultTag)),ca.unwrap(l[d])):this.BLOCK_TAGS.indexOf(l[d].nodeName.toLocaleLowerCase())>-1&&l[d].parentNode.nodeName.toLocaleLowerCase()===l[d].nodeName.toLocaleLowerCase()&&ca.unwrap(l[d])}else ca.Wrap(t[r],e.createElement(this.defaultTag)),ca.unwrap(t[r])}},e.clearInlines=function(e,t,n,i,o){for(var r=0;r<e.length;r++){for(var s=e[r],a=void 0;!this.domNode.isBlockNode(s)&&s.parentElement&&!s.parentElement.classList.contains("e-img-inner");)a=s,s=s.parentElement;a&&Kr.inlineTags.indexOf(a.nodeName.toLocaleLowerCase())>-1&&(i.GetSpliceNode(n,a),this.removeInlineParent(a))}},e.removeInlineParent=function(e){for(var t=ca.unwrap(e),n=0;n<t.length;n++)1===t[n].parentNode.childNodes.length&&!t[n].parentNode.classList.contains("e-img-inner")&&Kr.inlineTags.indexOf(t[n].parentNode.nodeName.toLocaleLowerCase())>-1?this.removeInlineParent(t[n].parentNode):Kr.inlineTags.indexOf(t[n].nodeName.toLocaleLowerCase())>-1&&this.removeInlineParent(t[n])},e.BLOCK_TAGS=["address","article","aside","blockquote","details","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","li","main","nav","noscript","ol","p","pre","section","ul"],e.NONVALID_PARENT_TAGS=["thead","tbody","ul","ol","table","tfoot","tr"],e.IGNORE_PARENT_TAGS=["ul","ol","table"],e.NONVALID_TAGS=["thead","tbody","figcaption","td","tr","th","tfoot","figcaption","li"],e.defaultTag="p",e}(),Za=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Es,this.applyClear,this),this.parent.observer.on(Gs,this.onKeyDown,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Es,this.applyClear),this.parent.observer.off(Gs,this.onKeyDown),this.parent.observer.off(da,this.destroy)},e.prototype.onKeyDown=function(e){if("clear-format"===e.event.action)this.applyClear({subCommand:"ClearFormat",callBack:e.callBack,enterAction:e.enterAction}),e.event.preventDefault()},e.prototype.applyClear=function(e){"ClearFormat"===e.subCommand&&($a.clear(this.parent.currentDocument,this.parent.editableElement,e.enterAction,e.selector,e.subCommand),e.callBack&&e.callBack({requestType:e.subCommand,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)}))},e.prototype.destroy=function(){this.removeEventListener()},e}(),el=function(){function e(e,t){this.undoRedoStack=[],this.parent=e,this.undoRedoSteps=(0,o.isNullOrUndefined)(t)?30:t.undoRedoSteps,this.undoRedoTimer=(0,o.isNullOrUndefined)(t)?300:t.undoRedoTimer,this.addEventListener()}return e.prototype.addEventListener=function(){this.debounceListener=(0,o.debounce)(this.keyUp,this.undoRedoTimer),this.parent.observer.on(Ys,this.debounceListener,this),this.parent.observer.on(Gs,this.keyDown,this),this.parent.observer.on(Qs,this.onAction,this),this.parent.observer.on($s,this.onPropertyChanged,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.onPropertyChanged=function(e){for(var t=0,n=Object.keys(e.newProp);t<n.length;t++){switch(n[t]){case"undoRedoSteps":this.undoRedoSteps=e.newProp.undoRedoSteps;break;case"undoRedoTimer":this.undoRedoTimer=e.newProp.undoRedoTimer}}},e.prototype.removeEventListener=function(){this.parent.observer.off(Ys,this.keyUp),this.parent.observer.off(Gs,this.keyDown),this.parent.observer.off(Qs,this.onAction),this.parent.observer.off($s,this.onPropertyChanged),this.parent.observer.off(da,this.destroy),this.debounceListener=null},e.prototype.onAction=function(e){"Undo"===e.subCommand?this.undo(e):this.redo(e)},e.prototype.destroy=function(){this.removeEventListener(),this.element=null,this.steps=null,this.undoRedoStack=[],this.undoRedoSteps=null,this.undoRedoTimer=null},e.prototype.keyDown=function(e){var t=e.event;switch(t.action){case"undo":t.preventDefault(),this.undo(e);break;case"redo":t.preventDefault(),this.redo(e)}},e.prototype.keyUp=function(e){17===e.event.keyCode||e.event.ctrlKey||this.saveData(e)},e.prototype.getTextContentFromFragment=function(e){for(var t="",n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];i.nodeType===Node.TEXT_NODE?t+=i.textContent:i.nodeType===Node.ELEMENT_NODE&&(t+=this.getTextContentFromFragment(i))}return t},e.prototype.isElementStructureEqual=function(e,t){if(e.childNodes.length!==t.childNodes.length)return!1;for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes[n],o=t.childNodes[n];if(!i||!o)return!1;if(i.nodeType!==o.nodeType)return!1;if(i.outerHTML!==o.outerHTML)return!1}return!0},e.prototype.saveData=function(e){if(this.parent.currentDocument){for(var t=new sl(this.parent.editableElement).getRange(this.parent.currentDocument),n=this.parent.editableElement===t.startContainer.parentElement?t.startContainer.parentElement:t.startContainer,i=n.childNodes.length-1;i>=0;i--)!(0,o.isNullOrUndefined)(n.childNodes[i])&&"#text"===n.childNodes[i].nodeName&&0===n.childNodes[i].textContent.length&&"IMG"!==n.childNodes[i].nodeName&&"BR"!==n.childNodes[i].nodeName&&n.childNodes[i].nodeName&&(0,o.detach)(n.childNodes[i]);t=new sl(this.parent.editableElement).getRange(this.parent.currentDocument);for(var r=new sl(this.parent.editableElement).save(t,this.parent.currentDocument),s=this.parent.editableElement.cloneNode(!0),a=document.createDocumentFragment();s.firstChild;)a.appendChild(s.firstChild);var l={text:a,range:r};this.undoRedoStack.length>=this.steps&&(this.undoRedoStack=this.undoRedoStack.slice(0,this.steps+1)),this.undoRedoStack.length>1&&this.undoRedoStack[this.undoRedoStack.length-1].range.range.collapsed===t.collapsed&&this.undoRedoStack[this.undoRedoStack.length-1].range.startOffset===r.range.startOffset&&this.undoRedoStack[this.undoRedoStack.length-1].range.endOffset===r.range.endOffset&&this.undoRedoStack[this.undoRedoStack.length-1].range.range.startContainer===r.range.startContainer&&this.getTextContentFromFragment(this.undoRedoStack[this.undoRedoStack.length-1].text).trim()===this.getTextContentFromFragment(l.text).trim()&&this.isElementStructureEqual(this.undoRedoStack[this.undoRedoStack.length-1].text,l.text)||(this.undoRedoStack.push(l),this.steps=this.undoRedoStack.length-1,this.steps>this.undoRedoSteps&&(this.undoRedoStack.shift(),this.steps--),e&&e.callBack&&e.callBack())}},e.prototype.undo=function(e){if(this.steps>0){var t=this.undoRedoStack[this.steps-1].range,n=this.undoRedoStack[this.steps-1].text;this.parent.editableElement.innerHTML="",this.parent.editableElement.appendChild(n.cloneNode(!0)),this.parent.editableElement.focus(),Hs(this.parent.currentDocument,this.parent.editableElement),Us()&&Ps(this.parent.editableElement,e.selector),t.restore(),this.steps--,e.callBack&&e.callBack({requestType:"Undo",editorMode:"HTML",range:t,elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),event:e.event})}},e.prototype.redo=function(e){if(null!=this.undoRedoStack[this.steps+1]){var t=this.undoRedoStack[this.steps+1].range,n=this.undoRedoStack[this.steps+1].text;this.parent.editableElement.innerHTML="",this.parent.editableElement.appendChild(n.cloneNode(!0)),this.parent.editableElement.focus(),Hs(this.parent.currentDocument,this.parent.editableElement),Us()&&Ps(this.parent.editableElement,e.selector),t.restore(),this.steps++,e.callBack&&e.callBack({requestType:"Redo",editorMode:"HTML",range:t,elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument),event:e.event})}},e.prototype.getUndoStatus=function(){var e={undo:!1,redo:!1};return this.steps>0&&(e.undo=!0),null!=this.undoRedoStack[this.steps+1]&&(e.redo=!0),e},e.prototype.getCurrentStackIndex=function(){return this.steps},e}(),tl=function(){function e(e){this.olData=["decimal","decimal-leading-zero","lower-alpha","lower-roman","upper-alpha","upper-roman","lower-greek"],this.ulData=["disc","square","circle","disc","square","circle"],this.ignorableNodes=["A","APPLET","B","BLOCKQUOTE","BR","BUTTON","CENTER","CODE","COL","COLGROUP","DD","DEL","DFN","DIR","DIV","DL","DT","EM","FIELDSET","FONT","FORM","FRAME","FRAMESET","H1","H2","H3","H4","H5","H6","HR","I","IMG","IFRAME","INPUT","INS","LABEL","LI","OL","OPTION","P","PARAM","PRE","Q","S","SELECT","SPAN","STRIKE","STRONG","SUB","SUP","TABLE","TBODY","TD","TEXTAREA","TFOOT","TH","THEAD","TITLE","TR","TT","U","UL"],this.blockNode=["div","p","h1","h2","h3","h4","h5","h6","address","blockquote","button","center","dd","dir","dl","dt","fieldset","frameset","hr","iframe","isindex","li","map","menu","noframes","noscript","object","ol","pre","table","tbody","td","tfoot","th","thead","tr","ul","header","article","nav","footer","section","aside","main","figure","figcaption"],this.borderStyle=["border-top","border-right","border-bottom","border-left"],this.upperRomanNumber=["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX"],this.lowerRomanNumber=["i","ii","iii","iv","v","vi","vii","viii","ix","x","xi","xii","xiii","xiv","xv","xvi","xvii","xviii","xix","xx"],this.lowerGreekNumber=["α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],this.removableElements=["o:p","style","w:sdt"],this.listContents=[],this.cropImageDimensions=[],this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(ea,this.wordCleanup,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(ea,this.wordCleanup),this.parent.observer.off(da,this.destroy)},e.prototype.wordCleanup=function(e){var t=(0,o.isNullOrUndefined)(e.allowedStylePropertiesArray)?[]:e.allowedStylePropertiesArray,n=[],i=e.args.clipboardData.getData("text/HTML"),r=e.args.clipboardData.getData("text/rtf"),s=(0,o.createElement)("p");s.setAttribute("id","MSWord-Content"),s.innerHTML=i,this.addDoubleBr(s);var a=/style='mso-width-source:/i,l=this.findSource(s);/class='?Mso|style='[^ ]*\bmso-/i.test(i)||/class="?Mso|style="[^ ]*\bmso-/i.test(i)||/(class="?Mso|class='?Mso|class="?Xl|class='?Xl|class=Xl|style="[^"]*\bmso-|style='[^']*\bmso-|w:WordDocument)/gi.test(i)||a.test(i)?(i=i.replace(/<img[^>]+>/i,""),this.addListClass(s),n=this.cleanUp(s,n),(0,o.isNullOrUndefined)(n[0])||"UL"===n[0].parentElement.tagName||"OL"===n[0].parentElement.tagName||this.listConverter(n),this.imageConversion(s,r),this.cleanList(s,"UL"),this.cleanList(s,"OL"),this.styleCorrection(s,t),this.removingComments(s),this.removeUnwantedElements(s),this.removeEmptyElements(s),this.removeEmptyAnchorTag(s),this.breakLineAddition(s),this.processMargin(s),this.removeClassName(s),a.test(i)&&this.addTableBorderClass(s),e.callBack(s.innerHTML,this.cropImageDimensions,l)):(l===Ts[2]&&this.handleOneNoteContent(s),this.removeEmptyMetaTags(s),e.callBack(s.innerHTML,null,l))},e.prototype.addDoubleBr=function(e){var t=e.querySelector(".Apple-interchange-newline");if(!(0,o.isNullOrUndefined)(t)&&-1!==o.Browser.userAgent.indexOf("Chrome")&&"P"===t.parentElement.nodeName&&e!==t.parentElement)for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(i.nodeType===Node.COMMENT_NODE&&i.nodeValue.includes("StartFragment")){var r=document.createElement("p");r.innerHTML="<br>";var s=t.parentElement.style.cssText,a=(r.getAttribute("style")||"")+s;r.style.cssText=a,e.insertBefore(r,i.nextSibling),(0,o.detach)(t);break}}},e.prototype.cleanList=function(e,t){for(var n=e.querySelectorAll(t+" div"),i=n.length-1;i>=0;i--){for(var o=n[i].parentNode;n[i].firstChild;)o.insertBefore(n[i].firstChild,n[i]);var r=this.findClosestListElem(n[i]);r&&this.insertAfter(n[i],r)}},e.prototype.insertAfter=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},e.prototype.findClosestListElem=function(e){for(var t;!(0,o.isNullOrUndefined)(e);)e=(0,o.isNullOrUndefined)(e.closest("ul"))||"UL"===e.tagName?"OL"!==e.tagName?e.closest("ol"):null:e.closest("ul"),t=(0,o.isNullOrUndefined)(e)?t:e;return t},e.prototype.addListClass=function(e){for(var t=e.querySelectorAll("*"),n=0;n<t.length;n++)!(0,o.isNullOrUndefined)(t[n].getAttribute("style"))&&t[n].getAttribute("style").replace(/ /g,"").replace("\n","").indexOf("mso-list:l")>=0&&-1===t[n].className.toLowerCase().indexOf("msolistparagraph")&&"H"!==t[n].tagName.charAt(0)&&"LI"!==t[n].tagName&&"OL"!==t[n].tagName&&"UL"!==t[n].tagName&&t[n].classList.add("msolistparagraph")},e.prototype.addTableBorderClass=function(e){for(var t=e.querySelectorAll("table"),n=!1,i=0;i<t.length;i++){for(var o=0;o<this.borderStyle.length;o++)if(t[i].innerHTML.indexOf(this.borderStyle[o])>=0){n=!0;break}n&&(t[i].classList.add("e-rte-table-border"),n=!1)}},e.prototype.imageConversion=function(e,t){this.checkVShape(e);for(var n=e.querySelectorAll("img"),i=0;i<n.length;i++)!(0,o.isNullOrUndefined)(n[i].getAttribute("v:shapes"))&&n[i].getAttribute("v:shapes").indexOf("Picture")<0&&n[i].getAttribute("v:shapes").indexOf("Chart")<0&&n[i].getAttribute("v:shapes").indexOf("圖片")<0&&n[i].getAttribute("v:shapes").indexOf("Grafik")<0&&n[i].getAttribute("v:shapes").toLowerCase().indexOf("image")<0&&n[i].getAttribute("v:shapes").indexOf("Graphic")<0&&n[i].getAttribute("v:shapes").indexOf("_x0000_s")<0&&n[i].getAttribute("v:shapes").indexOf("_x0000_i")<0&&n[i].getAttribute("v:shapes").indexOf("img1")<0&&n[i].getAttribute("v:shapes").indexOf("Immagine")<0&&n[i].classList.add("e-rte-image-unsupported"),n[i].removeAttribute("v:shapes");n=e.querySelectorAll("img");var r=[],s=[],a=[],l=new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.)|(blob\:))(\S+))/gi);if(n.length>0){for(i=0;i<n.length;i++)if(!n[i].classList.contains("e-rte-image-unsupported")){r.push(n[i].getAttribute("src"));var d=n[i].getAttribute("src").split("/")[n[i].getAttribute("src").split("/").length-1].split(".")[0]+i;a.push(d)}var c=this.hexConversion(t);for(i=0;i<c.length;i++)s.push({base64Data:(0,o.isNullOrUndefined)(c[i].hex)?null:this.convertToBase64(c[i]),isCroppedImage:c[i].isCroppedImage}),c[i].isCroppedImage&&this.cropImageDimensions.push({goalWidth:c[i].goalWidth,goalHeight:c[i].goalHeight,cropLength:c[i].cropLength,cropTop:c[i].cropTop,cropR:c[i].cropR,cropB:c[i].cropB});n=e.querySelectorAll("img:not(.e-rte-image-unsupported");for(i=0;i<n.length;i++)r[i].match(l)?n[i].setAttribute("src",r[i]):((0,o.isNullOrUndefined)(s[i])||(0,o.isNullOrUndefined)(s[i].base64Data)?(n[i].removeAttribute("src"),n[i].classList.add("e-rte-image-unsupported")):n[i].setAttribute("src",s[i].base64Data),!(0,o.isNullOrUndefined)(s[i])&&s[i].isCroppedImage&&n[i].classList.add("e-img-cropped")),n[i].setAttribute("id","msWordImg-"+a[i]);n=e.querySelectorAll(".e-rte-image-unsupported");for(i=0;i<n.length;i++)n[i].removeAttribute("src")}},e.prototype.checkVShape=function(e){for(var t=e.querySelectorAll("*"),n=0;n<t.length;n++)switch(t[n].nodeName){case"V:SHAPETYPE":(0,o.detach)(t[n]);break;case"V:SHAPE":if("V:IMAGEDATA"===t[n].firstElementChild.nodeName){var i=t[n].firstElementChild.getAttribute("src"),r=(0,o.createElement)("img");r.setAttribute("src",i),t[n].parentElement.insertBefore(r,t[n]),(0,o.detach)(t[n])}}},e.prototype.convertToBase64=function(e){var t=this.conHexStringToBytes(e.hex),n=this.conBytesToBase64(t);return e.type?"data:"+e.type+";base64,"+n:null},e.prototype.conBytesToBase64=function(e){for(var t="",n=e.length,i=0;i<n;i+=3){var o=e.slice(i,i+3),r=o.length,s=[];if(r<3)for(var a=r;a<3;a++)o[a]=0;s[0]=(252&o[0])>>2,s[1]=(3&o[0])<<4|o[1]>>4,s[2]=(15&o[1])<<2|(192&o[2])>>6,s[3]=63&o[2];for(a=0;a<4;a++)t+=a<=r?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(s[a]):"="}return t},e.prototype.conHexStringToBytes=function(e){for(var t=[],n=e.length/2,i=0;i<n;i++)t.push(parseInt(e.substr(2*i,2),16));return t},e.prototype.hexConversion=function(e){var t,n=RegExp,i=new n("\\{\\\\pict[\\s\\S]+?\\\\bliptag-?\\d+(\\\\blipupi-?\\d+)?(\\{\\\\\\*\\\\blipuid\\s?[\\da-fA-F]+)?[\\s\\}]*?"),r=new n("(?:("+i.source+"))([\\da-fA-F\\s]+)\\}","g"),s=e.match(r),a=[];if(!(0,o.isNullOrUndefined)(s))for(var l=0;l<s.length;l++)if(-1===s[l].indexOf("fIsBullet")||-1!==s[l].indexOf("wzName")){var d=!1,c=0,h=0,p=0,u=0,m=0,f=0;if(i.test(s[l])){if(-1!==s[l].indexOf("\\pngblip"))t="image/png";else if(-1!==s[l].indexOf("\\jpegblip"))t="image/jpeg";else{if(-1===s[l].indexOf("\\emfblip"))continue;t=null}(d=!!(this.extractCropValue("cropl",s[l])>0&&this.extractCropValue("cropt",s[l])>0||this.extractCropValue("cropr",s[l])>0||this.extractCropValue("cropb",s[l])))&&(c=this.extractCropValue("wgoal",s[l]),h=this.extractCropValue("hgoal",s[l]),p=this.extractCropValue("cropl",s[l]),u=this.extractCropValue("cropt",s[l]),m=this.extractCropValue("cropr",s[l]),f=this.extractCropValue("cropb",s[l])),a.push({hex:t?s[l].replace(i,"").replace(/[^\da-fA-F]/g,""):null,type:t,isCroppedImage:d,goalWidth:c,goalHeight:h,cropLength:p,cropTop:u,cropR:m,cropB:f})}}return a},e.prototype.extractCropValue=function(e,t){var n=new RegExp("\\\\pic"+e+"(\\-?\\d+)\\\\").exec(t.replace(/\r\n\\/g,"\\").replace(/\n/g,"\\"))[1];return parseInt(n,10)},e.prototype.removeClassName=function(e){for(var t=e.querySelectorAll("*[class]:not(.e-img-cropped):not(.e-rte-image-unsupported)"),n=0;n<t.length;n++)t[n].removeAttribute("class")},e.prototype.breakLineAddition=function(e){for(var t=e.querySelectorAll("*"),n=0;n<t.length;n++)if(0===t[n].children.length&&"&nbsp;"===t[n].innerHTML&&"&nbsp;"===t[n].innerHTML&&!t[n].closest("li")&&!t[n].closest("td")&&("SPAN"!==t[n].nodeName||"SPAN"===t[n].nodeName&&(0,o.isNullOrUndefined)(t[n].previousElementSibling)&&(0,o.isNullOrUndefined)(t[n].nextElementSibling))){var i=this.findDetachElem(t[n]),r=(0,o.createElement)("br");i.textContent.length>0&&i.textContent.match(/\u00a0/g)&&i.textContent.match(/\u00a0/g).length>0||(0,o.isNullOrUndefined)(i.parentElement)||(i.parentElement.insertBefore(r,i),(0,o.detach)(i))}},e.prototype.findDetachElem=function(e){return!(0,o.isNullOrUndefined)(e.parentElement)&&""===e.parentElement.textContent.trim()&&"TD"!==e.parentElement.tagName&&(0,o.isNullOrUndefined)(e.parentElement.querySelector("img"))?this.findDetachElem(e.parentElement):e},e.prototype.removeUnwantedElements=function(e){var t=e.querySelector("style");(0,o.isNullOrUndefined)(t)||(0,o.detach)(t);for(var n=e.innerHTML,i=0;i<this.removableElements.length;i++){var r=RegExp,s=new r("<"+this.removableElements[i]+"\\s*[^>]*>","g"),a=new r("</"+this.removableElements[i]+">","g");n=(n=n.replace(s,"")).replace(a,"")}e.innerHTML=n,e.querySelectorAll(":empty")},e.prototype.findDetachEmptyElem=function(e){var t;(0,o.isNullOrUndefined)(e.parentElement)?t=null:t=e.parentElement.textContent.length>0&&e.parentElement.textContent.match(/\u00a0/g)&&e.parentElement.textContent.match(/\u00a0/g).length>0||""!==e.parentElement.textContent.trim()||"MSWord-Content"===e.parentElement.getAttribute("id")||this.hasParentWithClass(e,"MsoListParagraph")||!(0,o.isNullOrUndefined)(e.parentElement.querySelector("img"))?e:this.findDetachEmptyElem(e.parentElement);return t},e.prototype.hasParentWithClass=function(e,t){for(var n=e.parentElement;!(0,o.isNullOrUndefined)(n);){if(n.classList.contains(t))return!0;n=n.parentElement}return!1},e.prototype.removeEmptyElements=function(e){for(var t=e.querySelectorAll(":empty"),n=0;n<t.length;n++){(0,o.isNullOrUndefined)(t[n].closest("td"))||(0,o.isNullOrUndefined)(t[n].closest("td").querySelector(".MsoNormal"))||(t[n].innerHTML="-");var i=!0;if("DIV"===t[n].tagName&&(i="none"===t[n].style.borderBottom||""===t[n].style.borderBottom),"IMG"!==t[n].tagName&&"BR"!==t[n].tagName&&"IFRAME"!==t[n].tagName&&"TD"!==t[n].tagName&&"HR"!==t[n].tagName&&i){var r=this.findDetachEmptyElem(t[n]);(0,o.isNullOrUndefined)(r)||(0,o.detach)(r)}}},e.prototype.removeEmptyMetaTags=function(e){for(var t=e.querySelectorAll("meta:empty"),n=t.length-1;n>=0;n--){var i=t[n];""===i.textContent&&(0,o.detach)(i)}},e.prototype.styleCorrection=function(e,t){var n=e.querySelectorAll("style"),i=[];if(n.length>0){(0,o.isNullOrUndefined)(n[0].innerHTML.match(/[\S ]+\s+{[\s\S]+?}/gi))?n.length>1&&(i=n[1].innerHTML.match(/[\S ]+\s+{[\s\S]+?}/gi)):i=n[0].innerHTML.match(/[\S ]+\s+{[\s\S]+?}/gi);var r=(0,o.isNullOrUndefined)(i)?null:this.findStyleObject(i);if(!(0,o.isNullOrUndefined)(r)){var s=Object.keys(r),a=s.map((function(e){return r[""+e]}));a=this.removeUnwantedStyle(a,t),this.filterStyles(e,t);for(var l=void 0,d=!1,c=/^(p|div|li)\.(1|10|11)$/,h=0;h<s.length;h++){if(""===s[h].split(".")[0])l=e.getElementsByClassName(s[h].split(".")[1]),d=!0;else{if(1===s[h].split(".").length&&s[h].split(".")[0].indexOf("@")>=0||c.test(s[h]))continue;l=1===s[h].split(".").length&&s[h].split(".")[0].indexOf("@")<0?e.getElementsByTagName(s[h]):e.querySelectorAll(s[h])}for(var p=0;p<l.length;p++)if(!l[p].closest("li")||"p"!==s[h]){var u=l[p].getAttribute("style");if((0,o.isNullOrUndefined)(u)||""===u.trim())a[h]=a[h].replace(/text-indent:-.*?;?/g,"").replace(/border:\s*none;?/g,"").trim(),l[p].style.cssText=a[h];else{for(var m=a[h].split(";"),f=0;f<m.length;f++)"border"===m[f].split(":")[0]&&"none"===m[f].split(":")[1]&&(m.splice(f,1),f--);if(!d)for(var g=0;g<m.length;g++){var b=m[g].split(":")[0];u.includes(b+":")&&(m.splice(g,1),g--)}var v=m.join(";")+";"+u;l[p].style.cssText=v}}d=!1}var y=["MsoListParagraphCxSpFirst","MsoListParagraphCxSpMiddle","MsoListParagraphCxSpLast"];for(h=0;h<y.length;h++)if(s.indexOf("li."+y[h])>-1){var C=e.querySelectorAll("ol."+y[h]+", ul."+y[h]);for(p=0;p<C.length;p++){u=C[p].getAttribute("style");if(!(0,o.isNullOrUndefined)(u)&&""!==u.trim()&&""!==C[p].style.marginLeft)for(m=a[s.indexOf("li."+y[h])].split(";"),g=0;g<m.length;g++)if("margin-left".indexOf(m[g].split(":")[0])>=0&&!(0,o.isNullOrUndefined)(m[g].split(":")[1])&&m[g].split(":")[1].indexOf("in")>=0&&C[p].style.marginLeft.indexOf("in")>=0){var N=parseFloat(m[g].split(":")[1].split("in")[0]),E=parseFloat(C[p].style.marginLeft.split("in")[0]);C[p].style.marginLeft=E-N+"in"}}}}}},e.prototype.filterStyles=function(e,t){for(var n=e.querySelectorAll("*[style]"),i=0;i<n.length;i++){for(var o=n[i].getAttribute("style").split(";"),r="",s=0;s<o.length;s++)t.indexOf(o[s].split(":")[0].trim())>=0&&(r+=o[s]+";");n[i].style.cssText=r}},e.prototype.removeUnwantedStyle=function(e,t){for(var n=0;n<e.length;n++){var i=e[n].split(";");e[n]="";for(var o=0;o<i.length;o++)t.indexOf(i[o].split(":")[0])>=0&&(e[n]+=i[o]+";")}return e},e.prototype.findStyleObject=function(e){for(var t={},n=0;n<e.length;n++){var i=e[n],o=i.replace(/([\S ]+\s+){[\s\S]+?}/gi,"$1"),r=i.replace(/[\S ]+\s+{([\s\S]+?)}/gi,"$1");o=o.replace(/^[\s]|[\s]$/gm,""),r=r.replace(/^[\s]|[\s]$/gm,""),o=o.replace(/\n|\r|\n\r/g,""),r=r.replace(/\n|\r|\n\r/g,"");for(var s=o.split(", "),a=0;a<s.length;a++)t[s[a]]=r}return t},e.prototype.removingComments=function(e){var t=e.innerHTML;t=t.replace(/<!--[\s\S]*?-->/g,""),e.innerHTML=t},e.prototype.cleanUp=function(e,t){for(var n,i=[],r=e.querySelectorAll("*"),s=0;s<r.length;s++)-1===this.ignorableNodes.indexOf(r[s].nodeName)||3===r[s].nodeType&&""===r[s].textContent.trim()?i.push(r[s]):(r[s].className&&-1!==r[s].className.toLowerCase().indexOf("msolistparagraph")&&!(0,o.isNullOrUndefined)(r[s].getAttribute("style"))&&r[s].getAttribute("style").indexOf("mso-list:")>=0&&(r[s].className.indexOf("MsoListParagraphCxSpFirst")>=0&&t.length>0&&null!==t[t.length-1]&&t.push(null),t.push(r[s])),!n||-1===this.blockNode.indexOf(r[s].nodeName.toLowerCase())||r[s].className&&-1!==r[s].className.toLowerCase().indexOf("msolistparagraph")&&!(0,o.isNullOrUndefined)(r[s].getAttribute("style"))&&r[s].getAttribute("style").indexOf("mso-list:")>=0||t.push(null),-1!==this.blockNode.indexOf(r[s].nodeName.toLowerCase())&&(n=!!(r[s].className&&-1!==r[s].className.toLowerCase().indexOf("msolistparagraph")&&!(0,o.isNullOrUndefined)(r[s].getAttribute("style"))&&r[s].getAttribute("style").indexOf("mso-list:")>=0)));return t.length&&null!==t[t.length-1]&&t.push(null),t},e.prototype.listConverter=function(e){for(var t,n,i,r=[],s=[],a="",l="",d=0;d<e.length;d++)if(null!==e[d]){if(e[d].getAttribute("style")&&-1!==e[d].getAttribute("style").indexOf("mso-outline-level")&&(e[d].style.cssText=e[d].getAttribute("style").replace("mso-outline-level","mso-outline")),t=(a=e[d].getAttribute("style"))&&-1!==a.indexOf("level")?parseInt(a.charAt(a.indexOf("level")+5),null):1,a&&-1!==a.indexOf("mso-list:")){var c=void 0;if(a.match(/mso-list:[^;]+;?/))c=a.replace(new RegExp("\\n","g"),"").split(" ").join("").match(/mso-list:[^;]+;?/)[0].split(":l"),n=(0,o.isNullOrUndefined)(c)?null:parseInt(c[1].split("level")[0],10);else n=null}this.listContents=[],this.getListContent(e[d]);var h=void 0,p=void 0,u=void 0,m=void 0;if(!(0,o.isNullOrUndefined)(this.listContents[0])){if(h=this.listContents[0].trim().length>1?"ol":"ul",p=this.getlistStyleType(this.listContents[0],h),"ol"===h&&(0===d||null===e[d-1])){var f=this.listContents[0].split(".")[0];-1===["A","a","I","i","α","1","01","1-"].indexOf(f)&&("decimal"===p||"decimal-leading-zero"===p?isNaN(parseInt(f,10))||(u=parseInt(f,10)):"upper-alpha"===p?u=f.split(".")[0].charCodeAt(0)-64:"lower-alpha"===p?u=f.split(".")[0].charCodeAt(0)-96:"upper-roman"===p?u=this.upperRomanNumber.indexOf(this.listContents[0].split(".")[0])+1:"lower-roman"===p?u=this.lowerRomanNumber.indexOf(this.listContents[0].split(".")[0])+1:"lower-greek"===p&&(u=this.lowerGreekNumber.indexOf(this.listContents[0].split(".")[0])+1))}""!==e[d].style.marginLeft&&(m=e[d].style.marginLeft);for(var g=[],b=1;b<this.listContents.length;b++)g.push(this.listContents[b]);var v=void 0;(0,o.isNullOrUndefined)(e[d].className)||(v=e[d].className),(0,o.isNullOrUndefined)(e[d].getAttribute("style"))||(e[d].style.cssText=e[d].getAttribute("style").replace("text-align:start;",""),e[d].style.textIndent="",l=e[d].getAttribute("style")),s.push({listType:h,content:g,nestedLevel:t,listFormatOverride:n,class:v,listStyle:l,listStyleTypeName:p,start:u,styleMarginLeft:m})}}else r.push({content:this.makeConversion(s),node:e[d-1]}),s=[];for(i=e.shift();i;){for(var y=[],C=0;C<r.length;C++)if(r[C].node===i){for(var N=0;N<r[C].content.childNodes.length;N++)y.push(r[C].content.childNodes[N]);for(N=0;N<y.length;N++)i.parentElement.insertBefore(y[N],i);break}i.remove(),(i=e.shift())||(i=e.shift())}},e.prototype.getlistStyleType=function(e,t){var n;if("ol"===t){var i=e.split(".")[0].charCodeAt(0);switch(!0){case this.upperRomanNumber.indexOf(e.split(".")[0])>-1:n="upper-roman";break;case this.lowerRomanNumber.indexOf(e.split(".")[0])>-1:n="lower-roman";break;case this.lowerGreekNumber.indexOf(e.split(".")[0])>-1:n="lower-greek";break;case i>64&&i<91:n="upper-alpha";break;case i>96&&i<123:n="lower-alpha";break;case e.split(".")[0].length>1&&"0"===e.split(".")[0][0]&&!isNaN(Number(e.split(".")[0])):n="decimal-leading-zero";break;default:n="decimal"}}else switch(e.split(".")[0]){case"o":n="circle";break;case"§":n="square";break;default:n="disc"}return n},e.prototype.makeConversion=function(e){for(var t,n,i,r=(0,o.createElement)("div"),s=1,a=0,l=e[0].listFormatOverride,d=0;d<e.length;d++){for(var c=["MsoListParagraphCxSpFirst","MsoListParagraphCxSpMiddle","MsoListParagraphCxSpLast"],h=!1,p=0;p<c.length;p++)if(c[p].indexOf(e[d].class)>=0){h=!0;break}(0,o.isNullOrUndefined)(n)||0===d||e[d-1].listType===e[d].listType||h||(n=null);var u=(0,o.createElement)("p",{className:"MsoNoSpacing"});if(u.innerHTML=e[d].content.join(" "),1!==e[d].nestedLevel||0!==a&&l===e[d].listFormatOverride||!e[d].content){if(e[d].nestedLevel===s&&l===e[d].listFormatOverride)(0,o.isNullOrUndefined)(n)||(0,o.isNullOrUndefined)(n.parentElement)||n.parentElement.tagName.toLowerCase()!==e[d].listType?(0,o.isNullOrUndefined)(n)?((t=(0,o.createElement)(e[d].listType)).style.listStyleType=e[d].listStyleTypeName,(n=(0,o.createElement)("li")).appendChild(u),t.appendChild(n),t.setAttribute("level",e[d].nestedLevel.toString()),r.appendChild(t)):((t=(0,o.createElement)(e[d].listType)).style.listStyleType=e[d].listStyleTypeName,n.parentElement.parentElement.appendChild(t),(n=(0,o.createElement)("li")).appendChild(u),t.appendChild(n),t.setAttribute("level",e[d].nestedLevel.toString())):(n.parentElement.appendChild(n=(0,o.createElement)("li")),n.appendChild(u));else if(e[d].nestedLevel>s)if((0,o.isNullOrUndefined)(n))if(e[d].nestedLevel>s&&h){var m=(0,o.createElement)(e[d].listType);n=(0,o.createElement)("li"),m.appendChild(n),m.style.listStyleType="none";for(f=0;f<e[d].nestedLevel-1;f++)n.appendChild(t=(0,o.createElement)(e[d].listType)),n=(0,o.createElement)("li"),t.appendChild(n),t.style.listStyleType="none";n.appendChild(u),r.appendChild(m),t.setAttribute("level",e[d].nestedLevel.toString()),t.style.listStyleType=e[d].listStyleTypeName}else r.appendChild(t=(0,o.createElement)(e[d].listType)),(n=(0,o.createElement)("li")).appendChild(u),t.appendChild(n),t.setAttribute("level",e[d].nestedLevel.toString()),"msolistparagraph"!==e[d].class?t.style.marginLeft=e[d].styleMarginLeft:(0,o.addClass)([t],"marginLeftIgnore"),t.style.listStyleType=e[d].listStyleTypeName;else{for(var f=0;f<e[d].nestedLevel-s;f++)n.appendChild(t=(0,o.createElement)(e[d].listType)),n=(0,o.createElement)("li"),f!==e[d].nestedLevel-s-1&&e[d].nestedLevel-s>1&&(n.style.listStyleType="none"),t.appendChild(n);n.appendChild(u),t.setAttribute("level",e[d].nestedLevel.toString()),t.style.listStyleType=e[d].listStyleTypeName}else if(1===e[d].nestedLevel)r.lastChild.tagName.toLowerCase()===e[d].listType?t=r.lastChild:(r.appendChild(t=(0,o.createElement)(e[d].listType)),t.style.listStyleType=e[d].listStyleTypeName),(n=(0,o.createElement)("li")).appendChild(u),t.appendChild(n),t.setAttribute("level",e[d].nestedLevel.toString());else for(i=n;i.parentElement;)if((i=i.parentElement).attributes.getNamedItem("level")){if(parseInt(i.attributes.getNamedItem("level").textContent,10)===e[d].nestedLevel&&l===e[d].listFormatOverride){(n=(0,o.createElement)("li")).appendChild(u),i.appendChild(n);break}if(parseInt(i.attributes.getNamedItem("level").textContent,null)===e[d].nestedLevel&&l!==e[d].listFormatOverride){if(t=(0,o.createElement)(e[d].listType),n=(0,o.createElement)("li"),t.appendChild(n),e[d].nestedLevel>1)for(var g=0;g<e[d].nestedLevel-1;g++)n.appendChild(t=(0,o.createElement)(e[d].listType)),n=(0,o.createElement)("li"),t.appendChild(n),t.style.listStyleType="none";n.appendChild(u),i.appendChild(t),t.setAttribute("level",e[d].nestedLevel.toString()),t.style.listStyleType=e[d].listStyleTypeName;break}if(e[d].nestedLevel>parseInt(i.attributes.getNamedItem("level").textContent,10)){i.appendChild(t=(0,o.createElement)(e[d].listType)),(n=(0,o.createElement)("li")).appendChild(u),t.appendChild(n),t.setAttribute("level",e[d].nestedLevel.toString()),t.style.listStyleType=e[d].listStyleTypeName;break}}}else r.appendChild(t=(0,o.createElement)(e[d].listType,{className:e[d].class})),(n=(0,o.createElement)("li")).appendChild(u),t.appendChild(n),t.setAttribute("level",e[d].nestedLevel.toString()),"msolistparagraph"!==e[d].class?t.style.marginLeft=e[d].styleMarginLeft:(0,o.addClass)([t],"marginLeftIgnore"),t.style.listStyleType=e[d].listStyleTypeName;n.setAttribute("class",e[d].class),n.style.cssText=(0,o.isNullOrUndefined)(e[d].listStyle)?"":e[d].listStyle,s=e[d].nestedLevel,l=e[d].listFormatOverride,a++,(0,o.isNullOrUndefined)(e[d].start&&1!==e[d].start&&"ol"===e[d].listType)||t.setAttribute("start",e[d].start.toString())}return r},e.prototype.getListContent=function(e){var t="",n=e.firstElementChild;if(""!==n.textContent.trim()||(0,o.isNullOrUndefined)(n.firstElementChild)||"IMG"!==n.firstElementChild.nodeName){if(n.childNodes.length>0){for(var i=n.querySelectorAll('[style*="mso-list"]'),r=0;r<i.length;r++)i[r].setAttribute("style",i[r].getAttribute("style").replace(/\n/g,""));var s=n.querySelector('span[style*="mso-list"]');if(s){var a=s.getAttribute("style");a&&(a=a.replace(/\s*:\s*/g,":"),s.setAttribute("style",a))}var l=n.querySelector('span[style="mso-list:Ignore"]'),d=(0,o.isNullOrUndefined)(l);if(l=d?n:l,!(0,o.isNullOrUndefined)(l)){var c=l.textContent.trim();if(d){var h=c.match(/^(\d{1,2}|[a-zA-Z]|[*#~•○■])(\.|\)|-)\s*/);(0,o.isNullOrUndefined)(h)||(c=h[0].trim(),l.textContent=l.textContent.trim().substring(c.length).trim())}this.listContents.push(c),d||(0,o.detach)(l),this.removingComments(e),this.removeUnwantedElements(e)}}}else t=e.innerHTML.trim(),this.listContents.push(""),this.listContents.push(t);this.listContents.push(e.innerHTML)},e.prototype.processMargin=function(e){var t=e.querySelectorAll("li");if(t.length>0)for(var n=0;n<t.length;n++)(0,o.isNullOrUndefined)(t[n].style.marginLeft)||t[n].parentElement.classList.contains("marginLeftIgnore")||(t[n].style.marginLeft="");var i=e.querySelectorAll("table");if(i.length>0)for(n=0;n<i.length;n++)!(0,o.isNullOrUndefined)(i[n].style.marginLeft)&&i[n].style.marginLeft.indexOf("-")>=0&&(i[n].style.marginLeft="");var r=e.querySelectorAll(".marginLeftIgnore li");if(r.length>0)for(n=0;n<r.length;n++)if(!(0,o.isNullOrUndefined)(r[n].style.marginLeft)&&""!==r[n].style.marginLeft){var s=r[n].style.marginLeft,a=parseFloat(s.split("in")[0])-.5;r[n].style.marginLeft=a.toString()+"in"}},e.prototype.removeEmptyAnchorTag=function(e){for(var t=e.querySelectorAll("a:not([href])"),n=t.length-1;n>=0;n--){for(var i=t[n].parentNode;t[n].firstChild;)i.insertBefore(t[n].firstChild,t[n]);i.removeChild(t[n])}},e.prototype.findSource=function(e){for(var t=e.querySelectorAll("meta"),n=0;n<t.length;n++){var i=t[n],o=i.getAttribute("content"),r=i.getAttribute("name");if(r&&r.toLowerCase().indexOf("generator")>=0&&o&&o.toLowerCase().indexOf("microsoft")>=0)for(var s=0;s<Ts.length;s++)if(o.toLowerCase().indexOf(Ts[s])>=0)return Ts[s]}return"html"},e.prototype.handleOneNoteContent=function(e){var t=e.querySelectorAll("ul, ol");if(t.length>0)for(var n=0;n<t.length;n++){var i=t[n];0===i.querySelectorAll("li").length&&i.childNodes.length>0&&ca.unwrap(i)}},e.prototype.destroy=function(){this.removeEventListener()},e}(),nl=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Ns,this.insertText,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Ns,this.insertText),this.parent.observer.off(da,this.destroy)},e.prototype.insertText=function(e){var t=document.createTextNode(e.value);pa.Insert(this.parent.currentDocument,t,this.parent.editableElement),e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.destroy=function(){this.removeEventListener()},e}(),il=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(sa,this.emojiInsert,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(sa,this.emojiInsert),this.parent.observer.off(da,this.destroy)},e.prototype.emojiInsert=function(e){for(var t=document.createTextNode(e.value),n=this.parent.currentDocument.getSelection(),i=n.getRangeAt(0).startOffset,r=i-1;r>=i-15;r--){var s=n.focusNode.textContent.substring(r-1,r);if(/:$/.test(s)){this.beforeApplyFormat(!0);break}}var a=/:$/.test(n.focusNode.textContent.charAt(i-1)),l=n.focusNode.textContent.charAt(i-2),d=/\s/.test(l);a&&(d||1===n.focusOffset)&&this.beforeApplyFormat(!0);var c=n.focusNode,h=(0,o.closest)("#text"===c.nodeName?c.parentNode:c,"a");if(h){if(0===i)h.parentNode.insertBefore(t,h);else if(i===c.textContent.length){h.parentNode.insertBefore(t,h.nextSibling),new sl(h).setCursorPoint(this.parent.currentDocument,h.nextSibling,h.nextSibling.textContent.length)}}else pa.Insert(this.parent.currentDocument,t,this.parent.editableElement);e.callBack&&e.callBack({requestType:e.subCommand,editorMode:"HTML",event:e.event,range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.beforeApplyFormat=function(e){var t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection.getNodeCollection(t)[0],i=!(":"===n.parentElement.innerHTML.replace(/&nbsp;|<br>/g,"").trim()||0===n.textContent.trim().indexOf("/")),o=n;if(i&&e)for(;o!==this.parent.editableElement;)o=o.parentElement;for(var r=t.startOffset;-1===this.parent.nodeSelection.getRange(this.parent.editableElement.ownerDocument).toString().indexOf(":");)this.parent.nodeSelection.setSelectionText(this.parent.editableElement.ownerDocument,n,n,r,t.endOffset),r--;var s=this.parent.nodeSelection.getRange(this.parent.currentDocument),a=this.parent.nodeCutter.GetSpliceNode(s,n);a.parentNode.removeChild(a)},e.prototype.destroy=function(){this.removeEventListener()},e}(),ol=function(){function e(e,t){this.INVALID_TAGS=["A","AUDIO","IMG","VIDEO","IFRAME"],this.parent=e,this.settings=t,this.addEventListener(),this.setDeniedFormats()}return e.prototype.addEventListener=function(){this.parent.observer.on(oa,this.actionHandler,this),this.parent.observer.on($s,this.onPropertyChanged,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.onPropertyChanged=function(e){e&&"formatPainter"===e.module&&((0,o.isNullOrUndefined)(e.newProp.formatPainterSettings.allowedFormats)||(this.settings.allowedFormats=e.newProp.formatPainterSettings.allowedFormats),(0,o.isNullOrUndefined)(e.newProp.formatPainterSettings.deniedFormats)||(this.settings.deniedFormats=e.newProp.formatPainterSettings.deniedFormats,this.setDeniedFormats()))},e.prototype.removeEventListener=function(){this.parent.observer.off(oa,this.actionHandler),this.parent.observer.off($s,this.onPropertyChanged),this.parent.observer.off(da,this.destroy)},e.prototype.destroy=function(){this.removeEventListener(),this.INVALID_TAGS=null,this.copyCollection=null,this.deniedFormatsCollection=null,this.newElem=null,this.newElemLastChild=null,this.settings=null,this.parent=null},e.prototype.actionHandler=function(e){if(this.settings.allowedContext=["Text","List","Table"],!(0,o.isNullOrUndefined)(e)&&!(0,o.isNullOrUndefined)(e.item)&&!(0,o.isNullOrUndefined)(e.item.formatPainterAction)){switch(e.item.formatPainterAction){case"format-copy":this.copyAction();break;case"format-paste":this.pasteAction();break;case"escape":this.escapeAction()}this.callBack(e)}},e.prototype.callBack=function(e){e.callBack&&e.callBack({requestType:"FormatPainter",action:e.item.formatPainterAction,event:e.event,editorMode:"HTML",range:this.parent.nodeSelection.getRange(this.parent.currentDocument),elements:this.parent.nodeSelection.getSelectedNodes(this.parent.currentDocument)})},e.prototype.generateElement=function(){var e=this.copyCollection.slice();e.reverse();for(var t,n=e.length,i=(0,o.createElement)("div",{className:"e-format-paste-wrapper"}),r=0;r<n;r++){var s=e[r],a=s.attrs,l=s.className,d=s.styles,c=s.tagName,h=(0,o.createElement)(c);""!==l&&(h.className=l);for(var p=0;p<a.length;p++){var u=a[p].name,m=a[p].value;h.setAttribute(u,m)}for(var f=0;f<d.length;f++){u=d[f].property,m=d[f].value;var g=d[f].priority;h.style.setProperty(u,m,g)}0===i.childElementCount?(i.append(h),t=h):(t.append(h),t=h)}for(var b=this.removeDeniedFormats(i),v=b;v;)null===v.firstChild?(t=v,v=void 0):v=v.firstChild;this.newElem=b,this.newElemLastChild=t},e.prototype.pasteAction=function(){(0,o.isNullOrUndefined)(this.copyCollection)||0===this.copyCollection.length?this.paintPlainTextFormat():this.insertFormatNode(this.newElem,this.newElemLastChild)},e.prototype.removeDeniedFormats=function(e){if(!(0,o.isNullOrUndefined)(this.deniedFormatsCollection)&&this.deniedFormatsCollection.length>0)for(var t=this.deniedFormatsCollection,n=t.length,i=0;i<n;i++){var r=t[i].tag;if(t[i].tag)for(var s=e.querySelectorAll(r),a=0;a<s.length;a++){if(t[i].classes.length>0){for(var l=t[i].classes,d=l.length,c=0;c<d;c++)s[a].classList.contains(l[c])&&(0,o.removeClass)([s[a]],l[c].trim());0===s[a].classList.length&&s[a].removeAttribute("class")}if(t[i].styles.length>0){var h=t[i].styles,p=h.length;for(c=0;c<p;c++)s[a].style.removeProperty(h[c].trim());0===s[a].style.length&&s[a].removeAttribute("style")}if(t[i].attributes.length>0){var u=t[i].attributes,m=u.length;for(c=0;c<m;c++)s[a].removeAttribute(u[c].trim())}}}return e.firstElementChild},e.prototype.copyAction=function(){var e=[],t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection,i=t.collapsed?n.getSelectionNodeCollection(t):n.getSelectionNodeCollectionBr(t);if(0!==i.length||0!==n.getSelectionNodeCollectionBr(t).length){for(var r=(i=0===i.length?n.getSelectionNodeCollectionBr(t):i)[0].parentElement,s=this.findCurrentContext(r),a=this.settings.allowedFormats.indexOf(";")>-1?this.settings.allowedFormats.split(";"):[this.settings.allowedFormats],l=0;l<a.length;l++)a[l]=a[l].trim();var d=this.getRangeParentElem(s,r),c=d[0],h=d[1];if(null===s&&(s=h),!(0,o.isNullOrUndefined)(s)&&this.settings.allowedContext.indexOf(s)>-1){"#text"===t.startContainer.nodeName&&(r=t.startContainer.parentElement);var p=r;do{if(a.indexOf(r.nodeName.toLowerCase())>-1){var u=r.attributes,m=[];for(l=0;l<u.length;l++)"class"!==u[l].name&&"style"!==u[l].name&&m.push(u[l]);var f=r.className,g=r.style,b=[];for(l=0;l<g.length;l++){var v=g[l],y=g.getPropertyValue(v),C=g.getPropertyPriority(v);b.push({property:v,value:y,priority:C})}e.push({attrs:m,className:f,styles:b,tagName:r.nodeName})}if(c===r?r=void 0:(0,o.isNullOrUndefined)(r.parentElement)||(r=r.parentElement),p===r)break}while(!(0,o.isNullOrUndefined)(r)||r===this.parent.editableElement);this.copyCollection=e}this.generateElement()}},e.prototype.getRangeParentElem=function(e,t){var n,i=t;switch(3===i.nodeType&&(i=i.parentElement),e){case"Table":n=(0,o.closest)(i,"td"),(0,o.isNullOrUndefined)(n)&&(n=(0,o.closest)(i,"th"));break;case"List":n=(0,o.closest)(i,"li");break;case"Text":n=(0,o.closest)(i,"p")}if((0,o.isNullOrUndefined)(n)){var r=this.getNearestBlockParentElement(t);(0,o.isNullOrUndefined)(r)||"UL"===r||"OL"===r||"LI"===r||(n=(0,o.closest)(i,r),e="Text")}return"List"===e&&(n=n.parentElement),[n,e]},e.prototype.getNearestBlockParentElement=function(e){var t=e;for(3===t.nodeType&&(t=t.parentNode);t&&t!==this.parent.editableElement;){if(!(0,o.isNullOrUndefined)(t)&&this.isBlockElement(t))return t.nodeName;t=t.parentNode}return null},e.prototype.isBlockElement=function(e){return["P","DIV","UL","OL","LI","H1","H2","H3","H4","H5","H6","ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","FIGCAPTION","FIGURE","FOOTER","HEADER","HR","MAIN","NAV","SECTION","SUMMARY","PRE"].indexOf(e.nodeName)>-1},e.prototype.escapeAction=function(){this.copyCollection=[]},e.prototype.paintPlainTextFormat=function(){var e,t=this.parent.nodeSelection.getRange(this.parent.currentDocument),n=this.parent.nodeSelection,i=t.collapsed?n.getSelectionNodeCollection(t):n.getSelectionNodeCollectionBr(t);if(i.length>1)for(var o=0;o<i.length;o++)e=this.validateELementTag(i[o]);else e=this.validateELementTag(t.startContainer)&&this.validateELementTag(t.endContainer);e||this.parent.execCommand("Clear","ClearFormat",null,null)},e.prototype.validateELementTag=function(e){return 3===e.nodeType&&(e=e.parentElement),this.INVALID_TAGS.indexOf(e.tagName)>-1},e.prototype.findCurrentContext=function(e){var t=(0,o.closest)(e,"p"),n=(0,o.closest)(e,"li");return t&&!n?"Text":(0,o.closest)(e,"li")?(0,o.isNullOrUndefined)(t)||(0,o.isNullOrUndefined)(n)||t.textContent.trim()===n.textContent.trim()?"List":"Text":(0,o.closest)(e,"td")||(0,o.closest)(e,"tr")||(0,o.closest)(e,"th")?"Table":null},e.prototype.insertFormatNode=function(e,t){var n=e.cloneNode(!0);if(!this.isBlockElement(e)){var i=(0,o.createElement)("P");i.appendChild(e),n=i.cloneNode(!0)}for(var r,s=this.parent.editableElement,a=this.parent.currentDocument,l=n.firstChild;l;){if(!this.isBlockElement(l)){r=l.parentNode.removeChild(l);break}l=l.firstChild}var d={element:r,lastChild:t};Xa.applyFormat(a,null,s,"P",null,"formatPainter",null,d);var c=this.parent.nodeSelection.getRange(a),h=c.collapsed,p=this.parent.domNode.blockNodes();if(this.isListCopied())for(var u=0;u<p.length;u++)(0,o.closest)(p[u],"li")&&(p[u]=(0,o.closest)(p[u],"li"));var m=!1;1===p.length&&(m=p[0].textContent.trim()===c.toString().trim()),(this.isBlockElement(n)&&h||p.length>1||m)&&this.insertBlockNode(n,c,a,p)},e.prototype.isListCopied=function(){for(var e=!1,t=0;t<this.copyCollection.length;t++)if("OL"===this.copyCollection[t].tagName||"UL"===this.copyCollection[t].tagName){e=!0;break}return e},e.prototype.insertBlockNode=function(e,t,n,i){var r,s,a=this.parent.nodeSelection.save(t,n);this.parent.domNode.setMarker(a);var l=!1;"UL"!==e.nodeName&&"OL"!==e.nodeName||(r=(s=e.cloneNode(!0)).firstChild);for(var d=(0,o.isNullOrUndefined)(s)?e:e.firstChild,c=0;c<i.length;c++)if(!(this.INVALID_TAGS.indexOf(i[c].nodeName)>-1||i[c].querySelectorAll("img,audio,video,iframe").length>0)){for(var h=d.cloneNode(!1);i[c].firstChild;)0!==i[c].textContent.trim().length?h.appendChild(i[c].firstChild):i[c].removeChild(i[c].firstChild);if("TD"!==i[c].nodeName&&"TH"!==i[c].nodeName){if((0,o.isNullOrUndefined)(s)||(l=this.isSameListType(e,i[c])),"LI"!==h.nodeName||l?l?this.insertSameList(i,c,s,h):i[c].parentNode.replaceChild(h,i[c]):this.insertNewList(t,i,c,s,h),"LI"!==h.nodeName&&("OL"===h.parentElement.nodeName||"UL"===h.parentElement.nodeName)){var p=h.parentElement;if(this.parent.nodeCutter.SplitNode(t,p,!0),(0,o.isNullOrUndefined)(p.previousElementSibling))p.parentElement.prepend(h);else if(p.previousElementSibling.after(h),h.childNodes.length>1)for(var u=0;u<h.childNodes.length;u++){var m=h.childNodes[u];"OL"!==m.nodeName&&"UL"!==m.nodeName||h.after(m)}}}else{if((0,o.isNullOrUndefined)(s)){i[c].appendChild(h);continue}if(0!==c||(0,o.isNullOrUndefined)(s)){i[c].appendChild(h);continue}i[c].appendChild(s),s.appendChild(h)}}!(0,o.isNullOrUndefined)(r)&&(0,o.detach)(r),this.cleanEmptyLists(),this.parent.domNode.saveMarker(a).restore()},e.prototype.insertNewList=function(e,t,n,i,r){if(0===n){var s=t[n].nodeName;t[n]=t[n].parentNode.replaceChild(i,t[n]);var a="LI"===s?i.parentElement:i;if(this.parent.nodeCutter.SplitNode(e,a,!0),"LI"!==t[n].nodeName||(0,o.isNullOrUndefined)(a))if((0,o.isNullOrUndefined)(a))i.append(r);else if((0,o.isNullOrUndefined)(a.previousElementSibling)||a.previousElementSibling.nodeName!==i.nodeName)if((0,o.isNullOrUndefined)(a.nextElementSibling)||a.nextElementSibling.nodeName!==i.nodeName)i.append(r);else{var l;for((l=a.nextElementSibling).prepend(r);l.firstChild;)i.append(l.firstChild)}else for((l=a.previousElementSibling).append(r);l.firstChild;)i.append(l.firstChild);else i.append(r),(0,o.isNullOrUndefined)(a.parentNode)||a.parentNode.insertBefore(i,a)}else i.append(r);this.detachEmptyBlockNodes(t[n])},e.prototype.insertSameList=function(e,t,n,i){if(0===t){if(!(0,o.isNullOrUndefined)(e[t].parentNode)&&("UL"===e[t].parentNode.nodeName||"OL"===e[t].parentNode.nodeName)){if(1===e.length){for(;i.firstChild;)e[t].append(i.firstChild);for(var r=0;r<e[t].parentNode.childNodes.length;r++){var s=e[t].parentNode.childNodes[r];n.append(s.cloneNode(!0))}}else n.append(i);e[t].parentNode.parentNode.replaceChild(n,e[t].parentNode)}}else n.append(i);this.detachEmptyBlockNodes(e[t])},e.prototype.isSameListType=function(e,t){var n=!1,i=(0,o.closest)(t,"ol, ul");return!(0,o.isNullOrUndefined)(i)&&i.querySelectorAll("li").length>0&&(n=i.nodeName===e.nodeName),n},e.prototype.cleanEmptyLists=function(){for(var e=this.parent.editableElement.querySelectorAll("ol, ul"),t=0;t<e.length;t++)""===e[t].textContent.trim()&&(0,o.detach)(e[t])},e.prototype.setDeniedFormats=function(){var e=[];if(!(0,o.isNullOrUndefined)(this.settings)&&!(0,o.isNullOrUndefined)(this.settings.deniedFormats)){for(var t=this.settings.deniedFormats.indexOf(";")>-1?this.settings.deniedFormats.split(";"):[this.settings.deniedFormats],n=t.length,i=0;i<n;i++){var r=t[i];if(""!==r){r.trim();var s=this.makeDeniedFormatsCollection(r);(0,o.isNullOrUndefined)(s)||e.push(s)}}this.deniedFormatsCollection=e}},e.prototype.detachEmptyBlockNodes=function(e){(0,o.isNullOrUndefined)(e)||""!==e.textContent.trim()||(0,o.detach)(e)},e.prototype.makeDeniedFormatsCollection=function(e){var t=e.indexOf("("),n=e.indexOf(")"),i=e.indexOf("["),o=e.indexOf("]"),r=e.indexOf("{"),s=e.indexOf("}"),a=[],l=[],d=[];t>-1&&n>-1&&(a=e.substring(t+1,n).split(" ")[0].split(")")[0].split(",")),i>-1&&o>-1&&(l=e.substring(i+1,o).split(",")),r>-1&&s>-1&&(d=e.substring(r+1,s).split(","));var c,h=[t,i,r],p=(h=h.filter((function(e){return e>-1}))).length;return 1===p?c=h[0]:2===p?c=Math.min(h[0],h[1]):3===p&&(c=Math.min(h[0],h[1],h[2])),{tag:e.substring(0,c).trim(),styles:d,classes:a,attributes:l}},e}(),rl=function(){function e(e){this.clickCount=0,this.lastClickTime=0,this.currentDocument=e.document,this.editableElement=e.editableElement,this.nodeSelection=new sl(this.editableElement),this.nodeCutter=new ha,this.domNode=new Vs(this.editableElement,this.currentDocument),this.observer=new o.Observer(this),this.listObj=new ma(this),this.formatObj=new fa(this),this.alignmentObj=new ba(this),this.indentsObj=new va(this),this.linkObj=new ga(this),this.imgObj=new _a(this),this.audioObj=new Va(this),this.videoObj=new Wa(this),this.selectionObj=new Ya(this),this.inserthtmlObj=new Ja(this),this.insertTextObj=new nl(this),this.clearObj=new Za(this),this.tableObj=new Qa(this),this.undoRedoManager=new el(this,e.options),this.msWordPaste=new tl(this),this.formatPainterEditor=new ol(this,e.formatPainterSettings),this.emojiPickerObj=new il(this),this.tableCellSelection=new zs(this.editableElement,this.currentDocument),this.userAgentData=new Ga(o.Browser.userAgent,!1),this.wireEvents(),this.isDestroyed=!1}return e.prototype.wireEvents=function(){this.observer.on(Ws,this.editorKeyDown,this),this.observer.on(Js,this.editorKeyUp,this),this.observer.on(Js,this.editorKeyUp,this),this.observer.on(Zs,this.onPropertyChanged,this),this.observer.on(ta,this.onWordPaste,this),this.observer.on(na,this.onBegin,this),this.observer.on(aa,this.editorMouseDown,this),this.observer.on(la,this.destroy,this)},e.prototype.unwireEvents=function(){this.observer.off(Ws,this.editorKeyDown),this.observer.off(Js,this.editorKeyUp),this.observer.off(Js,this.editorKeyUp),this.observer.off(Zs,this.onPropertyChanged),this.observer.off(ta,this.onWordPaste),this.observer.off(na,this.onBegin),this.observer.off(aa,this.editorMouseDown),this.observer.off(la,this.destroy)},e.prototype.onWordPaste=function(e){this.observer.notify(ea,e)},e.prototype.onPropertyChanged=function(e){this.observer.notify($s,e)},e.prototype.editorKeyDown=function(e){this.observer.notify(Gs,e)},e.prototype.editorKeyUp=function(e){this.observer.notify(Ys,e)},e.prototype.onBegin=function(e){this.observer.notify(ia,e)},e.prototype.execCommand=function(e,t,n,i,o,r,s,a){switch(e.toLowerCase()){case"lists":this.observer.notify(Xs,{subCommand:t,event:n,callBack:i,selector:s,item:r,enterAction:a});break;case"formats":this.observer.notify(Ks,{subCommand:t,event:n,callBack:i,selector:s,exeValue:r,enterAction:a});break;case"alignments":this.observer.notify(us,{subCommand:t,event:n,callBack:i,selector:s,value:r,enterAction:a});break;case"indents":this.observer.notify(ms,{subCommand:t,event:n,callBack:i,selector:s,enterAction:a});break;case"links":this.observer.notify($r,{command:e,value:t,item:r,event:n,callBack:i,enterAction:a});break;case"files":this.observer.notify(Gr,{command:e,value:"Image",item:r,event:n,callBack:i,selector:s});break;case"images":this.observer.notify(Gr,{command:e,value:t,item:r,event:n,callBack:i,selector:s});break;case"audios":this.observer.notify(Xr,{command:e,value:t,item:r,event:n,callBack:i,selector:s});break;case"videos":this.observer.notify(Yr,{command:e,value:t,item:r,event:n,callBack:i,selector:s});break;case"table":switch(t.toString().toLocaleLowerCase()){case"createtable":this.observer.notify(Jr,{item:r,event:n,callBack:i,enterAction:a});break;case"insertrowbefore":case"insertrowafter":this.observer.notify(Zr,{item:r,event:n,callBack:i});break;case"insertcolumnleft":case"insertcolumnright":this.observer.notify(es,{item:r,event:n,callBack:i});break;case"deleterow":this.observer.notify(ts,{item:r,event:n,callBack:i});break;case"deletecolumn":this.observer.notify(ns,{item:r,event:n,callBack:i});break;case"tableremove":this.observer.notify(is,{item:r,event:n,callBack:i});break;case"tableheader":this.observer.notify(os,{item:r,event:n,callBack:i});break;case"aligntop":case"alignmiddle":case"alignbottom":this.observer.notify(rs,{item:r,event:n,callBack:i});break;case"merge":this.observer.notify(ss,{item:r,event:n,callBack:i});break;case"horizontalsplit":this.observer.notify(ls,{item:r,event:n,callBack:i});break;case"verticalsplit":this.observer.notify(as,{item:r,event:n,callBack:i});break;case"dashed":this.observer.notify(ds,{item:r,event:n,callBack:i});break;case"alternate":this.observer.notify(cs,{item:r,event:n,callBack:i});break;case"backgroundcolor":this.observer.notify(hs,{subCommand:t,value:r,event:n,callBack:i})}break;case"font":case"style":case"effects":case"casing":this.observer.notify(ys,{subCommand:t,event:n,callBack:i,value:o,selector:s,enterAction:a});break;case"inserthtml":this.observer.notify(Cs,{subCommand:t,callBack:i,value:o,enterAction:a});break;case"inserttext":this.observer.notify(Ns,{subCommand:t,callBack:i,value:o});break;case"clear":this.observer.notify(Es,{subCommand:t,event:n,callBack:i,selector:s,enterAction:a});break;case"actions":this.observer.notify(Qs,{subCommand:t,event:n,callBack:i,selector:s});break;case"formatpainter":this.observer.notify(oa,{item:r,subCommand:t,event:n,callBack:i});break;case"emojipicker":this.observer.notify(sa,{item:r,subCommand:t,value:o,event:n,callBack:i})}},e.prototype.editorMouseDown=function(e){if(3===e.args.detail&&this.tripleClickSelection(e.args),-1!==o.Browser.userAgent.indexOf("Safari")){var t=(new Date).getTime();t-this.lastClickTime>500&&(this.clickCount=0),this.clickCount++,this.lastClickTime=t,3===this.clickCount&&(this.tripleClickSelection(e.args),this.clickCount=0)}},e.prototype.tripleClickSelection=function(e){var t=this.nodeSelection.getRange(this.currentDocument),n=this.nodeSelection.get(this.currentDocument),i=new ua(this.editableElement);if(n.rangeCount>0&&""!==n.toString()){var o=this.getParentBlockNode(t.startContainer),r=this.getParentBlockNode(t.endContainer);if(o&&r&&o===r){var s=this.currentDocument.createRange(),a=i.getFirstTextNode(o),l=i.getLastTextNode(r);a&&l&&(s.setStart(a,0),s.setEnd(l,l.textContent.length),this.nodeSelection.setRange(this.currentDocument,s),e.preventDefault())}}},e.prototype.getParentBlockNode=function(e){var t=this.currentDocument.createTreeWalker(this.editableElement,NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return window.getComputedStyle(e).display.indexOf("inline")<0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});return t.currentNode=e,t.parentNode()},e.prototype.destroy=function(){this.isDestroyed||(this.unwireEvents(),this.observer.notify(da),this.editableElement&&(this.editableElement=null),this.currentDocument=null,this.nodeCutter&&(this.nodeCutter=null),this.domNode&&(this.domNode=null),this.listObj&&(this.listObj=null),this.formatObj&&(this.formatObj=null),this.alignmentObj&&(this.alignmentObj=null),this.indentsObj&&(this.indentsObj=null),this.linkObj&&(this.linkObj=null),this.imgObj&&(this.imgObj=null),this.audioObj&&(this.audioObj=null),this.videoObj&&(this.videoObj=null),this.selectionObj&&(this.selectionObj=null),this.inserthtmlObj&&(this.inserthtmlObj=null),this.insertTextObj&&(this.insertTextObj=null),this.clearObj&&(this.clearObj=null),this.tableObj&&(this.tableObj=null),this.msWordPaste&&(this.msWordPaste=null),this.formatPainterEditor&&(this.formatPainterEditor=null),this.emojiPickerObj&&(this.emojiPickerObj=null),this.tableCellSelection&&(this.tableCellSelection=null),this.userAgentData=null,this.isDestroyed=!0)},e.prototype.beforeSlashMenuApplyFormat=function(){for(var e=this.nodeSelection.getRange(this.currentDocument),t=this.nodeSelection.getNodeCollection(e)[0],n=e.startOffset;-1===this.nodeSelection.getRange(document).toString().indexOf("/");)this.nodeSelection.setSelectionText(document,t,t,n,e.endOffset),n--;var i=this.nodeSelection.getRange(this.currentDocument),o=this.nodeCutter.GetSpliceNode(i,t),r=o.previousSibling;o.parentElement&&1===o.parentElement.innerHTML.length&&o.parentElement.appendChild(document.createElement("br")),o.parentNode.removeChild(o),r&&this.nodeSelection.setCursorPoint(document,r,r.textContent.length)},e}(),sl=function(){function e(e){this.startNodeName=[],this.endNodeName=[],this.editableElement=e}return e.prototype.saveInstance=function(e,t){return this.range=e.cloneRange(),this.rootNode=this.documentFromRange(e),this.body=t,this.startContainer=this.getNodeArray(e.startContainer,!0),this.endContainer=this.getNodeArray(e.endContainer,!1),this.startOffset=e.startOffset,this.endOffset=e.endOffset,this.html=this.body.innerHTML,this},e.prototype.documentFromRange=function(e){return 9===e.startContainer.nodeType?e.startContainer:e.startContainer.ownerDocument},e.prototype.getRange=function(e){var t=this.get(e),n=t&&t.rangeCount>0?t.getRangeAt(t.rangeCount-1):e.createRange();return n.startContainer!==e||n.endContainer!==e||n.startOffset||n.endOffset||(n.setStart(e.body,0),n.collapse(!0)),n},e.prototype.get=function(e){return e.defaultView.getSelection()},e.prototype.save=function(e,t){return e=e?e.cloneRange():this.getRange(t),this.saveInstance(e,t.body)},e.prototype.getIndex=function(e){var t=0;if(e=e.previousSibling||"BR"!==e.tagName?e.previousSibling:e)for(e.nodeType;e;null)t++,e.nodeType,e=e.previousSibling;return t},e.prototype.isChildNode=function(e,t){for(var n=0;n<t.childNodes.length;n++)if(e.indexOf(t.childNodes[n])>-1)return!0;return!1},e.prototype.getNode=function(e,t,n){return(!this.editableElement||this.editableElement.contains(e)&&this.editableElement!==e)&&(t!==e||3!==e.nodeType&&e.firstChild&&-1===n.indexOf(e.firstChild)&&!this.isChildNode(n,e))?3===e.nodeType&&e.previousSibling===t&&"IMG"===t.nodeName?null:-1===n.indexOf(e.firstChild)&&e.firstChild&&!this.isChildNode(n,e)?e.firstChild:e.nextSibling?e.nextSibling:e.parentNode?e.parentNode:null:null},e.prototype.getNodeCollection=function(e){var t=e.startContainer.childNodes[e.startOffset]||e.startContainer,n=e.endContainer.childNodes[e.endOffset>0?e.endOffset-1:e.endOffset]||e.endContainer,i=this.processedTableImageCursor(e);if((i.start||i.end)&&("TABLE"===i.startName||"TABLE"===i.endName))return[i.start?i.startNode:i.endNode];if((t===n||"BR"===t.nodeName&&t===e.endContainer.childNodes[e.endOffset])&&0===t.childNodes.length)return[t];if(e.startOffset===e.endOffset&&0!==e.startOffset&&"PRE"===e.startContainer.nodeName)return["BR"===t.nodeName||"#text"===t.nodeName?t:t.childNodes[0]];var o=[];do{-1===o.indexOf(t)&&o.push(t),t=this.getNode(t,n,o)}while(t);return o},e.prototype.getParentNodeCollection=function(e){return this.getParentNodes(this.getNodeCollection(e),e)},e.prototype.getParentNodes=function(e,t){e=e.reverse();for(var n=0;n<e.length;n++)-1!==e.indexOf(e[n].parentNode)||3===e[n].nodeType&&t.startContainer!==t.endContainer&&t.startContainer.parentNode!==t.endContainer.parentNode&&t.startContainer.parentNode.tagName&&t.endContainer.parentNode.tagName&&-1!==gs.indexOf(t.startContainer.parentNode.tagName.toLowerCase())&&-1!==gs.indexOf(t.endContainer.parentNode.tagName.toLowerCase())?(e.splice(n,1),n--):3===e[n].nodeType&&(e[n]=e[n].parentNode);return e},e.prototype.getSelectionNodeCollection=function(e){return this.getSelectionNodes(this.getNodeCollection(e))},e.prototype.getSelectionNodeCollectionBr=function(e){return this.getSelectionNodesBr(this.getNodeCollection(e))},e.prototype.getSelectionNodes=function(e){e=e.reverse();for(var t=new RegExp("​","g"),n=0;n<e.length;n++)(3!==e[n].nodeType||""===e[n].textContent.trim()||1===e[n].textContent.length&&e[n].textContent.match(t))&&(e.splice(n,1),n--);return e.reverse()},e.prototype.getSelectionNodesBr=function(e){e=e.reverse();for(var t=0;t<e.length;t++)"BR"===e[t].nodeName||3===e[t].nodeType&&""!==e[t].textContent.trim()||(e.splice(t,1),t--);return e.reverse()},e.prototype.getInsertNodeCollection=function(e){return this.getInsertNodes(this.getNodeCollection(e))},e.prototype.getInsertNodes=function(e){e=e.reverse();for(var t=0;t<e.length;t++)(0!==e[t].childNodes.length&&3!==e[t].nodeType||3===e[t].nodeType&&""===e[t].textContent)&&(e.splice(t,1),t--);return e.reverse()},e.prototype.getNodeArray=function(e,t,n){var i=[];for(t?this.startNodeName=[]:this.endNodeName=[];e!==(n||this.rootNode)&&!(0,o.isNullOrUndefined)(e);null)t?this.startNodeName.push(e.nodeName.toLowerCase()):this.endNodeName.push(e.nodeName.toLowerCase()),i.push(this.getIndex(e)),e=e.parentNode;return i},e.prototype.setRangePoint=function(e,t,n,i){for(var o=this.rootNode,r=n.length,s=i;r--;null)o=o&&o.childNodes[n[r]];return o&&s>=0&&"html"!==o.nodeName&&(3===o.nodeType&&"&nbsp;"===o.nodeValue.replace(/\u00a0/g,"&nbsp;")&&(s=o.textContent.length),e[t?"setStart":"setEnd"](o,s)),e},e.prototype.restore=function(){var e=this.range.cloneRange();return e=this.setRangePoint(e,!0,this.startContainer,this.startOffset),e=this.setRangePoint(e,!1,this.endContainer,this.endOffset),this.selectRange(this.rootNode,e),e},e.prototype.selectRange=function(e,t){this.setRange(e,t),this.save(t,e)},e.prototype.setRange=function(e,t){var n=this.get(e);n.removeAllRanges(),n.addRange(t)},e.prototype.setSelectionText=function(e,t,n,i,o){var r=e.createRange();r.setStart(t,i),r.setEnd(n,o),this.setRange(e,r)},e.prototype.setSelectionContents=function(e,t){var n=e.createRange();n.selectNode(t),this.setRange(e,n)},e.prototype.setSelectionNode=function(e,t){var n=e.createRange();n.selectNodeContents(t),this.setRange(e,n)},e.prototype.getSelectedNodes=function(e){return this.getNodeCollection(this.getRange(e))},e.prototype.Clear=function(e){this.get(e).removeAllRanges()},e.prototype.insertParentNode=function(e,t,n){n.surroundContents(t),this.selectRange(e,n)},e.prototype.setCursorPoint=function(e,t,n){var i=e.createRange(),o=e.defaultView.getSelection();i.setStart(t,n),i.collapse(!0),o.removeAllRanges(),o.addRange(i)},e.prototype.isTableOrImageStart=function(e){var t=e.startContainer,n=e.startOffset,i=t.childNodes[n],o=e.collapsed&&1===t.nodeType&&t.isContentEditable&&i&&["TABLE"].indexOf(i.nodeName)>-1;return o?{start:o,startNodeName:i.nodeName,startNode:i}:{start:!1,startNodeName:"",startNode:void 0}},e.prototype.isTableOrImageEnd=function(e){var t=e.startContainer,n=e.startOffset,i=t.childNodes[n-1],o=e.collapsed&&1===t.nodeType&&t.isContentEditable&&i&&["TABLE"].indexOf(i.nodeName)>-1;return o?{end:o,endNodeName:i.nodeName,endNode:i}:{end:!1,endNodeName:"",endNode:void 0}},e.prototype.processedTableImageCursor=function(e){var t=this.isTableOrImageStart(e),n=t.start,i=t.startNodeName,o=t.startNode,r=this.isTableOrImageEnd(e);return{start:n,startName:i,end:r.end,endName:r.endNodeName,startNode:o,endNode:r.endNode}},e.prototype.findLastTextPosition=function(e){if(e.nodeType===Node.TEXT_NODE)return{node:e,offset:e.textContent?e.textContent.length:0};for(var t=e.childNodes.length-1;t>=0;t--){var n=this.findLastTextPosition(e.childNodes[t]);if(n)return n}return null},e}(),al={bold:!1,italic:!1,subscript:!1,superscript:!1,strikethrough:!1,orderedlist:!1,unorderedlist:!1,numberFormatList:!1,bulletFormatList:!1,underline:!1,alignments:null,backgroundcolor:null,fontcolor:null,fontname:null,fontsize:null,formats:null,createlink:!1,insertcode:!1,blockquote:!1,inlinecode:!1},ll=function(){function e(){}return e.get=function(e,t,n,i,o,r){for(var s=JSON.parse(JSON.stringify(al)),a=JSON.parse(JSON.stringify(al)),l=new sl(t),d=l.getRange(e),c=r?[r]:d.collapsed?l.getNodeCollection(d):l.getSelectionNodeCollectionBr(d),h=c.length,p=!1,u=0;u<c.length;u++){for(;3===c[u].nodeType&&3===d.startContainer.nodeType&&c[u].parentNode&&c[u].parentNode.lastElementChild&&"BR"!==c[u].parentNode.lastElementChild.nodeName&&this.getImmediateBlockNode(c[u].parentNode)&&0===this.getImmediateBlockNode(c[u].parentNode).textContent.replace(/\u200B/g,"").length&&0===d.startContainer.textContent.replace(/\u200B/g,"").length&&0===l.get(e).toString().replace(/\u200B/g,"").length;)c[u]=c[u].parentNode.lastElementChild.firstChild,p=!0;p&&c[u]&&(l.setCursorPoint(e,c[u],c[u].textContent.length),p=!1),("BR"!==c[u].nodeName&&3!==c[u].nodeType||h>1&&3===c[u].nodeType&&""===c[u].textContent.trim())&&(c.splice(u,1),u--)}for(u=0;u<c.length;u++)s=this.getFormatParent(e,s,c[u],t,n,i,o),(0===u&&s.bold||!s.bold)&&(a.bold=s.bold),(0===u&&s.insertcode||!s.insertcode)&&(a.insertcode=s.insertcode),(0===u&&s.blockquote||!s.blockquote)&&(a.blockquote=s.blockquote),(0===u&&s.italic||!s.italic)&&(a.italic=s.italic),(0===u&&s.underline||!s.underline)&&(a.underline=s.underline),(0===u&&s.strikethrough||!s.strikethrough)&&(a.strikethrough=s.strikethrough),(0===u&&s.superscript||!s.superscript)&&(a.superscript=s.superscript),(0===u&&s.subscript||!s.subscript)&&(a.subscript=s.subscript),(0===u&&s.fontcolor||!s.fontcolor)&&(a.fontcolor=s.fontcolor),0===u&&s.fontname?a.fontname=s.fontname:a.fontname=s.fontname===a.fontname?s.fontname:"empty",0===u&&s.fontsize?a.fontsize=s.fontsize:a.fontsize=s.fontsize===a.fontsize?s.fontsize:"empty",(0===u&&s.backgroundcolor||!s.backgroundcolor)&&(a.backgroundcolor=s.backgroundcolor),(0===u&&s.orderedlist||!s.orderedlist)&&(a.orderedlist=s.orderedlist),(0===u&&s.unorderedlist||!s.unorderedlist)&&(a.unorderedlist=s.unorderedlist),(0===u&&s.alignments||!s.alignments)&&(a.alignments=s.alignments),0===u&&s.formats?a.formats=s.formats:a.formats=s.formats===a.formats?s.formats:"empty",(0===u&&s.createlink||!s.createlink)&&(a.createlink=s.createlink),(0===u&&s.numberFormatList||!s.numberFormatList)&&(a.numberFormatList=s.numberFormatList),(0===u&&s.bulletFormatList||!s.bulletFormatList)&&(a.bulletFormatList=s.bulletFormatList),(0===u&&s.inlinecode||!s.inlinecode)&&(a.inlinecode=s.inlinecode),s=JSON.parse(JSON.stringify(al));return a},e.getImmediateBlockNode=function(e){do{e=e.parentNode}while(e&&gs.indexOf(e.nodeName.toLocaleLowerCase())<0);return e},e.getFormatParent=function(e,t,n,i,o,r,s){var a=!1,l=!1;if(i.contains(n)||3===n.nodeType&&3!==i.nodeType&&i.contains(n.parentNode))do{((t=this.isFormattedNode(e,t,n,a,l,o,r,s)).orderedlist||t.unorderedlist)&&(a=!0),(t.bulletFormatList||t.numberFormatList)&&(l=!0),n=n.parentNode}while(n&&n!==i);return t},e.isFormattedNode=function(e,t,n,i,r,s,a,l){if(t.bold||(t.bold=Kr.isBold(n)),t.italic||(t.italic=Kr.isItalic(n)),t.underline||(t.underline=Kr.isUnderline(n)),t.strikethrough||(t.strikethrough=Kr.isStrikethrough(n)),t.superscript||(t.superscript=Kr.isSuperscript(n)),t.subscript||(t.subscript=Kr.isSubscript(n)),t.fontcolor||(t.fontcolor=this.isFontColor(e,n)),t.fontname||(t.fontname=this.isFontName(e,n,l)),t.fontsize||(t.fontsize=this.isFontSize(e,n,a)),t.backgroundcolor||(t.backgroundcolor=this.isBackgroundColor(n)),t.orderedlist||i||(t.orderedlist=this.isOrderedList(n)),t.unorderedlist||i||(t.unorderedlist=this.isUnorderedList(n)),t.alignments||(t.alignments=this.isAlignment(n)),t.formats||(t.formats=this.isFormats(n,s),"pre"===t.formats&&(t.insertcode=!0)),!t.blockquote){var d=void 0;if(!(0,o.isNullOrUndefined)(s))if(s.indexOf("blockquote")>-1)t.formats=this.isFormats(n,s),d=t.formats;else{s.push("blockquote"),d=this.isFormats(n,s);for(var c=s.length-1;c>=0;c--)"blockquote"===s[c]&&s.splice(c,1)}"blockquote"===d&&(t.blockquote=!0)}return t.createlink||(t.createlink=this.isLink(n)),t.numberFormatList||r||(t.numberFormatList=this.isNumberFormatList(n)),t.bulletFormatList||r||(t.bulletFormatList=this.isBulletFormatList(n)),t.inlinecode||(t.inlinecode=Kr.isCode(n)),t},e.isFontColor=function(e,t){var n=t.style&&t.style.color;return null!=n&&""!==n||3===t.nodeType||(n=this.getComputedStyle(e,t,"color")),null!==n&&""!==n&&void 0!==n?n:null},e.isLink=function(e){return"a"===e.nodeName.toLocaleLowerCase()},e.isBackgroundColor=function(e){var t=e.style&&e.style.backgroundColor;return null!==t&&""!==t&&void 0!==t?t:null},e.isFontSize=function(e,t,n){var i=t.style&&t.style.fontSize;return null!=i&&""!==i||3===t.nodeType||!t.parentElement.classList.contains("e-content")||(i=this.getComputedStyle(e,t,"font-size")),null!==i&&""!==i&&void 0!==i&&(null==n||n.indexOf(i)>-1)?i:null},e.isFontName=function(e,t,n){var i=t.style&&t.style.fontFamily;null!=i&&""!==i||3===t.nodeType||(i=this.getComputedStyle(e,t,"font-family"));var r=null;return null!==i&&""!==i&&void 0!==i&&(null==n||n.filter((function(e,t){var n=new RegExp(i,"i");(e.replace(/"/g,"").replace(/ /g,"").toLowerCase()===i.replace(/"/g,"").replace(/ /g,"").toLowerCase()||e.split(",")[0]&&!(0,o.isNullOrUndefined)(e.split(",")[0].trim().match(n))&&e.split(",")[0].trim()===e.split(",")[0].trim().match(n)[0])&&(r=t)}))&&null!==r)?null!==r?n[r]:i.replace(/"/g,""):null},e.isOrderedList=function(e){return"ol"===e.nodeName.toLocaleLowerCase()},e.isUnorderedList=function(e){return"ul"===e.nodeName.toLocaleLowerCase()},e.isAlignment=function(e){var t=e.style&&e.style.textAlign;return"left"===t?"justifyleft":"center"===t?"justifycenter":"right"===t?"justifyright":"justify"===t?"justifyfull":null},e.isFormats=function(e,t){return null==t&&gs.indexOf(e.nodeName.toLocaleLowerCase())>-1||null!=t&&t.indexOf(e.nodeName.toLocaleLowerCase())>-1?e.nodeName.toLocaleLowerCase():null},e.getComputedStyle=function(e,t,n){return e.defaultView.getComputedStyle(t,null).getPropertyValue(n)},e.isNumberFormatList=function(e){var t=e.style&&e.style.listStyleType;return"lower-alpha"===t?"Lower Alpha":"number"===t?"Number":"upper-alpha"===t?"Upper Alpha":"lower-roman"===t?"Lower Roman":"upper-roman"===t?"Upper Roman":"lower-greek"===t?"Lower Greek":"none"===t&&this.isOrderedList(e)?"None":!!this.isOrderedList(e)||null},e.isBulletFormatList=function(e){var t=e.style&&e.style.listStyleType;return"circle"===t?"Circle":"square"===t?"Square":"none"===t&&this.isUnorderedList(e)?"None":"disc"===t?"Disc":!!this.isUnorderedList(e)||null},e}(),dl=function(){return dl=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},dl.apply(this,arguments)},cl=function(){function e(e,t){this.isEscapeKey=!1,this.parent=e,this.isDestroyed=!1,t&&(this.l10n=t.getService("rteLocale")),this.wireEvent()}return e.prototype.wireEvent=function(){this.parent.on(f,this.destroy,this),this.parent.on(Wt,this.destroyTooltip,this),this.parent.on($t,this.closeTooltip,this)},e.prototype.destroyTooltip=function(){var e=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().ownerDocument:this.parent.contentModule.getDocument();if(!(0,o.isNullOrUndefined)(e.querySelector(".e-tooltip-wrap"))&&!(0,o.isNullOrUndefined)(e.querySelector("[data-tooltip-id]"))){var t=e.querySelector("[data-tooltip-id]"),n=new MouseEvent("mouseleave",{bubbles:!0,cancelable:!0});t.dispatchEvent(n)}},e.prototype.unWireEvent=function(){this.parent.off(f,this.destroy),this.parent.off(Wt,this.destroyTooltip),this.parent.off($t,this.closeTooltip)},e.prototype.toolbarBeforeCreate=function(e){"Extended"===this.mode&&(e.enableCollision=!1)},e.prototype.toolbarCreated=function(){if(this.parent.notify(M,this),"Extended"===this.mode){var e=this.toolbarPanel.querySelector(".e-expended-nav");e&&o.EventHandler.add(e,"mousedown",this.extendedToolbarMouseDownHandler,this)}},e.prototype.extendedToolbarMouseDownHandler=function(){this.parent.userAgentData.isSafari()&&this.parent.notify(Te,{})},e.prototype.toolbarClicked=function(e){var t=this;if(this.parent.enabled){var n={item:e.item,originalEvent:e.originalEvent,cancel:!1};this.parent.trigger("toolbarClick",n,(function(n){t.parent.readonly&&!(0,o.isNullOrUndefined)(e.item)||n.cancel||t.parent.notify(g,n)}))}},e.prototype.dropDownSelected=function(e){this.parent.notify(I,{element:e.element,item:e.item,originalEvent:e.event}),this.destroyTooltip()},e.prototype.beforeDropDownItemRender=function(e){!this.parent.readonly&&this.parent.enabled&&this.parent.notify(U,e)},e.prototype.tooltipBeforeRender=function(e){if(!(0,o.isNullOrUndefined)(e.target.getAttribute("title"))){var t=void 0;switch(e.target.getAttribute("title")){case"Minimize":t=this.l10n.getConstant("minimize"),e.target.setAttribute("title",t+" (Esc)");break;case"Maximize":t=this.l10n.getConstant("maximize"),e.target.setAttribute("title",t+" (Ctrl+Shift+F)")}}e.target.querySelector(".e-active")&&(e.cancel=!0,(0,o.isNullOrUndefined)(e.target.getAttribute("title"))||this.closeTooltip({target:e.target,isTitle:!0}))},e.prototype.dropDownOpen=function(e){if(e.element.parentElement.getAttribute("id").indexOf("TableCell")>-1&&!(0,o.isNullOrUndefined)(e.element.parentElement.querySelector(".e-cell-merge"))){var t=e.element.querySelectorAll("li"),n=this.parent.inputElement.querySelectorAll(".e-cell-select");1===n.length?((0,o.addClass)([t[0]],"e-disabled"),(0,o.removeClass)([t[1],t[2]],"e-disabled")):n.length>1&&(Array.from(n).every((function(e){return e.tagName.toLowerCase()===n[0].tagName.toLowerCase()}))?(0,o.removeClass)([t[0]],"e-disabled"):(0,o.addClass)([t[0]],"e-disabled"),(0,o.addClass)([t[1],t[2]],"e-disabled"))}this.parent.notify(Te,e)},e.prototype.dropDownClose=function(e){this.isEscapeKey||this.parent.notify(Oe,e),this.isEscapeKey=!1},e.prototype.dropDownBeforeClose=function(e){(0,o.isNullOrUndefined)(e.event)||"Escape"!==e.event.key||27!==e.event.keyCode||(this.isEscapeKey=!0,this.parent.notify(sn,e))},e.prototype.renderToolbar=function(e){this.setPanel(e.target),this.renderPanel(),this.mode=e.overflowMode,e.rteToolbarObj.toolbarObj=new _r.Toolbar({items:e.items,width:"100%",overflowMode:e.overflowMode,beforeCreate:this.toolbarBeforeCreate.bind(this),created:this.toolbarCreated.bind(this),clicked:this.toolbarClicked.bind(this),enablePersistence:e.enablePersistence,enableRtl:e.enableRtl,cssClass:e.cssClass}),e.rteToolbarObj.toolbarObj.isStringTemplate=!0,e.rteToolbarObj.toolbarObj.createElement=this.parent.createElement,e.rteToolbarObj.toolbarObj.appendTo(e.target),this.parent.showTooltip&&"toolbar"===e.type&&(this.tooltip=new Wr.Tooltip({target:"#"+this.parent.getID()+"_toolbar_wrapper [title]",showTipPointer:!0,openDelay:400,opensOn:"Hover",beforeRender:this.tooltipBeforeRender.bind(this),beforeOpen:this.tooltipBeforeOpen.bind(this),cssClass:this.parent.getCssClass(),windowCollision:!0,position:"BottomCenter"}),this.tooltip.appendTo(e.target.parentElement))},e.prototype.tooltipBeforeOpen=function(e){e.element&&e.element.setAttribute("data-rte-id",this.parent.getID())},e.prototype.renderDropDownButton=function(e){var t,n=this,i=e.activeElement;e.element.classList.add(Rn),t=e.cssClass+" "+bi+" "+vi,this.parent.inlineMode.enable&&o.Browser.isDevice&&(t=t+" "+Dn);var r=this,s=new Vr.DropDownButton({items:e.items,iconCss:e.iconCss,cssClass:t,content:e.content,enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,select:this.dropDownSelected.bind(this),beforeOpen:function(e){if(!r.parent.readonly&&r.parent.enabled){if(n.parent.userAgentData.isSafari()&&"keydown"===e.event.type&&n.parent.formatter.editorManager.nodeSelection&&!n.parent.inputElement.contains(n.parent.getRange().startContainer)&&n.parent.notify(Oe,e),"Markdown"!==r.parent.editorMode){var t=r.parent.getRange().startContainer.parentElement,a=t.closest("table"),l=t.closest("tr");if(!(0,o.isNullOrUndefined)(a)&&a.classList.contains("e-dashed-border"))for(var d=0;d<e.element.childNodes.length;d++)e.element.childNodes[d].classList.contains("e-dashed-borders")&&(0,o.addClass)([e.element.childNodes[d]],"e-active");if(!(0,o.isNullOrUndefined)(a)&&a.classList.contains("e-alternate-rows")&&""!==window.getComputedStyle(l).backgroundColor)for(d=0;d<e.element.childNodes.length;d++)e.element.childNodes[d].classList.contains("e-alternate-rows")&&(0,o.addClass)([e.element.childNodes[d]],"e-active");for(var c=r.parent.getRange().startContainer;c!==r.parent.inputElement&&!(0,o.isNullOrUndefined)(c.parentElement);){"#text"===c.nodeName&&(c=c.parentElement);var h=window.getComputedStyle(c).textAlign;if(!(0,o.isNullOrUndefined)(e.items[0])&&"Alignments"===e.items[0].command){if("Align Left"===e.items[0].text&&"left"===h||"start"===h){(0,o.addClass)([e.element.childNodes[0]],"e-active");break}if("Align Center"===e.items[1].text&&"center"===h){(0,o.addClass)([e.element.childNodes[1]],"e-active");break}if("Align Right"===e.items[2].text&&"right"===h){(0,o.addClass)([e.element.childNodes[2]],"e-active");break}if("Align Justify"===e.items[3].text&&"justify"===h){(0,o.addClass)([e.element.childNodes[3]],"e-active");break}}c=c.parentElement}var p=t.closest("img"),u=p||(i||t.querySelector("img"));if(!(0,o.isNullOrUndefined)(e.items[0])&&"Images"===e.items[0].command&&!(0,o.isNullOrUndefined)(u)){d=void 0;u.classList.contains("e-imgleft")||u.classList.contains("e-imginline")?d=0:u.classList.contains("e-imgcenter")||u.classList.contains("e-imgbreak")?d=1:u.classList.contains("e-imgright")&&(d=2),(0,o.isNullOrUndefined)(e.element.childNodes[d])||(0,o.addClass)([e.element.childNodes[d]],"e-active")}var m=t.closest(".e-video-wrap"),f=m||(i||t.querySelector("video"));if(!(0,o.isNullOrUndefined)(e.items[0])&&"Videos"===e.items[0].command&&!(0,o.isNullOrUndefined)(f)){d=void 0;f.classList.contains("e-video-left")||f.classList.contains("e-video-inline")?d=0:f.classList.contains("e-video-center")||f.classList.contains("e-video-break")?d=1:f.classList.contains("e-video-right")&&(d=2),(0,o.isNullOrUndefined)(e.element.childNodes[d])||(0,o.addClass)([e.element.childNodes[d]],"e-active")}if(!(0,o.isNullOrUndefined)(e.items[0])&&("Formats"===e.items[0].command||"Font"===e.items[0].command)){var g=[],b=[],v=!1;n.parent.format.types.forEach((function(e){b.push(e.value.toLocaleLowerCase())})),n.parent.fontFamily.items.forEach((function(e){g.push(e.value)}));var y=ll.get(n.parent.contentModule.getDocument(),n.parent.contentModule.getEditPanel(),b,null,g);for(d=0;d<e.element.childNodes.length;d++){var C=s.content.trim(),N=C.match(/style="([^"]*)"/),E="";N&&(E=N[1]);var S=C.replace(/ style="([^"]*)"/,"");(L=n.parent.createElement("div")).innerHTML=S,L.querySelector("span").style.cssText=E,!v&&(""!==L.textContent.trim()&&e.element.childNodes[d].textContent.trim()===L.textContent.trim()||"Formats"===e.items[0].command&&!(0,o.isNullOrUndefined)(y.formats)&&n.parent.format.types[d].value.toLowerCase()===y.formats.toLowerCase()&&e.element.childNodes[d].classList.contains(n.parent.format.types[d].cssClass)||"FontName"===e.items[0].subCommand&&"Font"===e.items[0].command&&!(0,o.isNullOrUndefined)(y.fontname)&&!(0,o.isNullOrUndefined)(n.parent.fontFamily.items[d])&&n.parent.fontFamily.items[d].value.toLowerCase()===y.fontname.toLowerCase()&&e.element.childNodes[d].classList.contains(n.parent.fontFamily.items[d].cssClass)||"FontName"===e.items[0].subCommand&&""===n.parent.fontFamily.items[d].value&&(0,o.isNullOrUndefined)(y.fontname)&&e.element.childNodes[d].classList.contains(n.parent.fontFamily.items[d].cssClass)||"FontSize"===e.items[0].subCommand&&"Default"===e.element.childNodes[d].textContent&&"Font Size"===L.textContent&&""===n.parent.fontSize.items[d].value&&!(0,o.isNullOrUndefined)(y.fontsize))?e.element.childNodes[d].classList.contains("e-active")||((0,o.addClass)([e.element.childNodes[d]],"e-active"),v=!0):(0,o.removeClass)([e.element.childNodes[d]],"e-active")}}}else if("Markdown"===r.parent.editorMode&&"Formats"===e.items[0].command){var T=[];v=!1;n.parent.format.types.forEach((function(e){T.push(e.value.toLocaleLowerCase())}));var O=e.element.childNodes;for(d=0;d<O.length;d++){var L;(L=n.parent.createElement("div")).innerHTML=s.content.trim(),v||""===L.textContent.trim()||O[d].textContent.trim()!==L.textContent.trim()?(0,o.removeClass)([O[d]],"e-active"):O[d].classList.contains("e-active")||((0,o.addClass)([O[d]],"e-active"),v=!0)}}r.parent.notify(Se,e)}else e.cancel=!0},close:this.dropDownClose.bind(this),beforeClose:this.dropDownBeforeClose.bind(this),open:this.dropDownOpen.bind(this),beforeItemRender:this.beforeDropDownItemRender.bind(this)});return s.isStringTemplate=!0,s.createElement=r.parent.createElement,s.appendTo(e.element),e.element.tabIndex=-1,document.getElementById(s.element.id+"-popup").setAttribute("aria-owns",this.parent.getID()),s},e.prototype.mouseOutHandler=function(){if((0,o.isNullOrUndefined)(this.tooltipTargetEle)){var e=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().ownerDocument:this.parent.contentModule.getDocument();this.tooltipTargetEle=e.querySelector("[data-title]"),this.tooltipTargetEle.setAttribute("title",this.tooltipTargetEle.getAttribute("data-title"))}else this.tooltipTargetEle.setAttribute("title",this.tooltipTargetEle.getAttribute("data-title"));this.tooltipTargetEle.removeAttribute("data-title"),o.EventHandler.remove(this.tooltipTargetEle,"mouseout",this.mouseOutHandler)},e.prototype.closeTooltip=function(e){if(e.isTitle)this.tooltipTargetEle=e.target,this.tooltipTargetEle.setAttribute("data-title",this.tooltipTargetEle.getAttribute("title")),this.tooltipTargetEle.removeAttribute("title"),o.EventHandler.add(this.tooltipTargetEle,"mouseout",this.mouseOutHandler,this);else{var t=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().ownerDocument:this.parent.contentModule.getDocument();this.tooltipTargetEle=(0,o.closest)(e.target,"[data-tooltip-id]"),(0,o.isNullOrUndefined)(this.tooltipTargetEle)||!this.parent.showTooltip||(0,o.isNullOrUndefined)(t.querySelector(".e-tooltip-wrap"))||(this.destroyTooltip(),this.tooltipTargetEle.setAttribute("data-title",this.tooltipTargetEle.getAttribute("title")),this.tooltipTargetEle.removeAttribute("title"),o.EventHandler.add(this.tooltipTargetEle,"mouseout",this.mouseOutHandler,this))}},e.prototype.renderListDropDown=function(e){var t=this,n=this,i=bi+" "+vi+(this.parent.inlineMode?" "+Dn:"");i+=" "+("NumberFormatList"===e.itemName?Ei:Si);var r=n.parent.createElement("span",{className:Ni}),s=n.parent.createElement("span",{className:e.cssClass});r.appendChild(s);var a=new Vr.DropDownButton({items:e.items,cssClass:i,content:e.content,enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,select:this.dropDownSelected.bind(this),beforeOpen:function(e){if("safari"!==o.Browser.info.name||n.parent.inputElement.contains(n.parent.getRange().startContainer)||n.parent.notify(Oe,{}),"Markdown"!==n.parent.editorMode){var i=n.parent.getRange().startContainer.parentElement.closest("LI"),r=(0,o.isNullOrUndefined)(i)?null:i.parentElement,s=e.items[0].subCommand;if(!(0,o.isNullOrUndefined)(r)){var l="NumberFormatList"===s&&"OL"===r.nodeName,d="BulletFormatList"===s&&"UL"===r.nodeName;if(l||d){var c=r.style.listStyleType.split("-").join("").toLocaleLowerCase();c="decimal"===c?"number":c;for(var h=0;h<e.element.childNodes.length;h++){if(c===e.element.childNodes[h].innerHTML.split(" ").join("").toLocaleLowerCase()){(0,o.addClass)([e.element.childNodes[h]],"e-active");break}if(""===c&&"None"!==e.element.childNodes[h].innerHTML){(0,o.addClass)([e.element.childNodes[h]],"e-active");break}}}}}if(t.closeTooltip({target:e.event.target}),!n.parent.readonly&&n.parent.enabled){var p=e.event?e.event.target:null;n.currentElement=a.element,n.currentDropdown=a,e.event&&"click"===e.event.type&&(p.classList.contains(Ni)||p.parentElement.classList.contains(Ni))?e.cancel=!0:n.parent.notify(Se,e)}else e.cancel=!0},close:this.dropDownClose.bind(this),open:this.dropDownOpen.bind(this),beforeItemRender:this.beforeDropDownItemRender.bind(this)});return a.isStringTemplate=!0,a.createElement=n.parent.createElement,a.appendTo(e.element),e.element.tabIndex=-1,e.element.setAttribute("role","button"),document.getElementById(a.element.id+"-popup").setAttribute("aria-owns",this.parent.getID()),1===e.element.childElementCount&&a.element.insertBefore(r,a.element.querySelector(".e-caret")),e.element.tabIndex=-1,a.element.removeAttribute("type"),a.element.onmousedown=function(){"safari"===o.Browser.info.name&&n.parent.notify(Te,{})},a.element.onkeydown=function(){"safari"===o.Browser.info.name&&n.parent.notify(Te,{})},a},e.prototype.paletteSelection=function(e,t){var n=e.element.querySelector(".e-control.e-colorpicker"),i=[].slice.call((0,o.selectAll)(".e-tile",n.parentElement));(0,o.removeClass)(i,"e-selected");var r=t.querySelector("."+bi).style.borderBottomColor;i.filter((function(e){e.style.backgroundColor===r&&(0,o.addClass)([e],"e-selected")}))},e.prototype.renderColorPickerDropDown=function(e,t,n,i,r){var s=this,a=this,l=bi+" "+vi+(this.parent.inlineMode?" "+Dn:"");l+=" "+("backgroundcolor"===t?Ai:Mi),l+=this.parent.getCssClass(!0);var d,c=a.parent.createElement("span",{className:Di}),h=a.parent.createElement("span",{className:e.cssClass}),p=(0,o.isNullOrUndefined)(i)?a.parent.backgroundColor.default:i;h.style.borderBottomColor="backgroundcolor"===t?p:a.parent.fontColor.default,c.appendChild(h);var u=new Vr.DropDownButton({target:n.element.parentElement,cssClass:l,enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,beforeOpen:function(t){if(!a.parent.readonly&&a.parent.enabled){var n=t.event?t.event.target:null;if(a.currentElement=u.element,a.currentDropdown=u,a.paletteSelection(t,a.currentElement),t.event&&"click"===t.event.type&&(n.classList.contains(Di)||n.parentElement.classList.contains(Di))){t.cancel=!0;var i=n.classList.contains(bi)?n.style.borderBottomColor:n.querySelector("."+bi).style.borderBottomColor;a.parent.notify(Oe,{});var l=(d=a.parent.formatter.editorManager.nodeSelection.getRange(a.parent.contentModule.getDocument())).startContainer.parentNode,c=(0,o.closest)(d.startContainer.parentNode,"table"),h=!!("macOS"===s.parent.userAgentData.getPlatform()&&!d.collapsed)||d.collapsed;if(("TD"===d.startContainer.nodeName||"TH"===d.startContainer.nodeName||(0,o.closest)(d.startContainer.parentNode,"td,th")||a.parent.iframeSettings.enable&&!ur(l.ownerDocument.querySelector("body"),"e-lib"))&&h&&"BackgroundColor"===e.subCommand&&((0,o.closest)(c,"."+an)||a.parent.iframeSettings.enable)&&"quick"===r){var p=dl({name:"tableColorPickerChanged",item:{command:"Table",subCommand:"BackgroundColor",value:i}},e);a.parent.formatter.process(s.parent,p,null,i),a.parent.notify(Ze,{})}else a.parent.notify(Ie,{item:{command:e.command,subCommand:e.subCommand,value:i}})}else{var m=t.element.querySelector(".e-control.e-colorpicker"),f=(0,o.getInstance)(m,Qr.ColorPicker);f.showButtons=!t.element.querySelector(".e-color-palette"),f.dataBind(),t.element.onclick=function(e){e.target.classList.contains("e-cancel")&&u.toggle()}}}else t.cancel=!0},open:function(e){var t;s.setColorPickerContentWidth(n);var i=e.element.querySelector(".e-control.e-colorpicker");(t=e.element.querySelector(".e-color-palette")?i.parentElement.querySelector(".e-palette"):i.parentElement.querySelector("e-handler"))&&t.focus(),s.pickerRefresh(e)},beforeClose:function(t){var n=t.event?t.event.target:null;if(s.dropDownBeforeClose(t),t.event&&"click"===t.event.type&&(n.classList.contains(Di)||n.parentElement.classList.contains(Di))){var i=n.classList.contains(bi)?n.style.borderBottomColor:n.querySelector("."+bi).style.borderBottomColor;if(("TD"===(d=a.parent.formatter.editorManager.nodeSelection.getRange(a.parent.contentModule.getDocument())).startContainer.nodeName||"TH"===d.startContainer.nodeName||(0,o.closest)(d.startContainer.parentNode,"td,th"))&&d.collapsed&&"quick"===r){var l=dl({name:"tableColorPickerChanged",item:{command:"Table",subCommand:"BackgroundColor",value:i}},e);a.parent.formatter.process(s.parent,l,null,i),a.parent.notify(Ze,{})}else a.parent.notify(Ie,{item:{command:e.command,subCommand:e.subCommand,value:i}})}else;},close:function(){s.isEscapeKey||a.parent.notify(Oe,{})}});return u.isStringTemplate=!0,u.createElement=a.parent.createElement,e.element.setAttribute("role","button"),u.appendTo(e.element),document.getElementById(u.element.id+"-popup").setAttribute("aria-owns",this.parent.getID()),e.element.setAttribute("aria-label","backgroundcolor"===t?ir.backgroundColor:ir.fontColor),u.element.insertBefore(c,u.element.querySelector(".e-caret")),e.element.tabIndex=-1,u.element.removeAttribute("type"),u.element.onmousedown=function(){a.parent.notify(Te,{})},u.element.onkeydown=function(){(!s.parent.userAgentData.isSafari()||s.parent.userAgentData.isSafari()&&a.parent.inputElement.contains(a.parent.getRange().startContainer))&&a.parent.notify(Te,{})},u},e.prototype.pickerRefresh=function(e){if("Picker"===this.parent.backgroundColor.mode){var t=e.element.parentElement;t.style.width=(t.offsetWidth+5).toString()+"px",(0,o.getInstance)(t,Wr.Popup).refreshPosition(t),t.style.width=(t.offsetWidth-5).toString()+"px"}},e.prototype.setColorPickerContentWidth=function(e){var t=e.element.nextSibling;if("0px"===t.style.width){t.style.width="";var n=parseInt(getComputedStyle(t).borderBottomWidth,10);t.style.width=(0,o.formatUnit)(t.children[0].offsetWidth+n+n)}},e.prototype.renderColorPicker=function(e,t,n){var i=this,r=this,s=new Qr.ColorPicker({enableRtl:this.parent.enableRtl,inline:!0,value:null,cssClass:("backgroundcolor"===t?Ii:Ri)+" "+e.cssClass,created:function(){var e="backgroundcolor"===t?r.parent.backgroundColor.default:r.parent.fontColor.default;s.setProperties({value:e})},mode:"backgroundcolor"===t?r.parent.backgroundColor.mode:r.parent.fontColor.mode,modeSwitcher:"backgroundcolor"===t?r.parent.backgroundColor.modeSwitcher:r.parent.fontColor.modeSwitcher,presetColors:"backgroundcolor"===t?this.parent.backgroundColor.colorCode:this.parent.fontColor.colorCode,columns:"backgroundcolor"===t?this.parent.backgroundColor.columns:this.parent.fontColor.columns,beforeTileRender:function(e){if(e.element.classList.add(Bi),e.element.classList.add(fo),!(0,o.isNullOrUndefined)(i.parent.cssClass))for(var t=i.parent.getCssClass().split(" "),n=0;n<t.length;n++)""!==t[n].trim()&&e.element.classList.add(t[n]);""===e.value&&e.element.classList.add(go)},change:function(t){var s=t.currentValue.rgba;t.item={command:e.command,subCommand:e.subCommand,value:s},r.parent.notify(Oe,{}),r.currentElement&&(r.currentElement.querySelector("."+bi).style.borderBottomColor=s);var a=r.parent.formatter.editorManager.nodeSelection.getRange(r.parent.contentModule.getDocument()),l=(0,o.closest)(a.startContainer.parentNode,"table");("TD"===a.startContainer.nodeName||"TH"===a.startContainer.nodeName||"BODY"===a.startContainer.nodeName||a.startContainer.parentNode&&(0,o.closest)(a.startContainer.parentNode,"td,th"))&&a.collapsed&&"BackgroundColor"===e.subCommand&&(l&&(0,o.closest)(l,"."+an)||r.parent.iframeSettings.enable)&&"quick"===n?(t.name="tableColorPickerChanged",t.item.command="Table",r.parent.formatter.process(i.parent,t,t.event,t.item.value),r.parent.notify(Ze,{})):r.parent.notify(Ie,t),r.currentDropdown&&r.currentDropdown.toggle()},beforeModeSwitch:function(e){""===s.value&&s.setProperties({value:"Picker"===e.mode?"#008000ff":""},!0),s.showButtons="Palette"!==e.mode}});return s.isStringTemplate=!0,s.createElement=this.parent.createElement,s.appendTo(document.getElementById(e.target)),s},e.prototype.renderPanel=function(){this.getPanel().classList.add(mn)},e.prototype.getPanel=function(){return this.toolbarPanel},e.prototype.setPanel=function(e){this.toolbarPanel=e},e.prototype.destroy=function(){if(!this.isDestroyed){if(this.tooltip&&!this.tooltip.isDestroyed){this.tooltip.destroy();for(var e=document.querySelectorAll('[data-rte-id="'+this.parent.getID()+'"]'),t=0;t<e.length;t++){var n=e[t];this.parent.getID()===n.getAttribute("data-rte-id")&&(0,o.detach)(n)}}this.unWireEvent(),this.mode=null,this.toolbarPanel=null,this.currentElement=null,this.currentDropdown=null,this.tooltip=null,this.tooltipTargetEle=null,this.isDestroyed=!0}},e}(),hl=c(741),pl=function(){function t(e,t){this.parent=e,this.rteID=e.element.id,this.i10n=t.getService("rteLocale"),this.addEventListener(),this.serviceLocator=t,this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.isDestroyed=!1,this.mouseDown=this.onDocumentClick.bind(this)}return t.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(G,this.linkDialog,this),this.parent.on(Mt,this.showDialog,this),this.parent.on(At,this.closeDialog,this),this.parent.on(k,this.onKeyDown,this),this.parent.on(se,this.showLinkQuickToolbar,this),this.parent.on($e,this.clearDialogObj,this),this.parent.on(q,this.onToolbarAction,this),this.parent.on(m,this.onIframeMouseDown,this),this.parent.on(X,this.removeLink,this),this.parent.on(Y,this.editLink,this),this.parent.on(J,this.openLink,this),this.parent.on(Ae,this.editAreaClickHandler,this),this.parent.on(qt,this.setCssClass,this),this.parent.on(f,this.destroy,this))},t.prototype.onToolbarAction=function(e){switch(e.args.item.subCommand){case"OpenLink":this.parent.notify(J,e);break;case"EditLink":this.parent.notify(Y,e);break;case"RemoveLink":this.parent.notify(X,e)}},t.prototype.removeEventListener=function(){this.parent.off(G,this.linkDialog),this.parent.off(Mt,this.showDialog),this.parent.off(At,this.closeDialog),this.parent.off(k,this.onKeyDown),this.parent.off(se,this.showLinkQuickToolbar),this.parent.off($e,this.clearDialogObj),this.parent.off(q,this.onToolbarAction),this.parent.off(X,this.removeLink),this.parent.off(m,this.onIframeMouseDown),this.parent.off(Y,this.editLink),this.parent.off(J,this.openLink),this.parent.off(Ae,this.editAreaClickHandler),this.parent.off(qt,this.setCssClass),this.parent.off(f,this.destroy),(0,o.isNullOrUndefined)(this.contentModule)||(this.parent.element.ownerDocument.removeEventListener("mousedown",this.mouseDown),this.mouseDown=null)},t.prototype.onIframeMouseDown=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},t.prototype.updateCss=function(e,t){e&&t.cssClass&&((0,o.isNullOrUndefined)(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},t.prototype.setCssClass=function(e){this.updateCss(this.checkBoxObj,e),this.updateCss(this.dialogObj,e)},t.prototype.showLinkQuickToolbar=function(e){var t=this;if(!(0,o.isNullOrUndefined)(e.args)&&"enter"!==e.args.action&&"space"!==e.args.action){var n,i;if("Links"!==e.type||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule)||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule.linkQTBar))return;this.quickToolObj=this.parent.quickToolbarModule;var r,s=this.parent.element.getBoundingClientRect().top,a=this.parent.element.getBoundingClientRect().left,l=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());if([].forEach.call(e.elements,(function(e,t){0===t&&(r="#text"===e.nodeName?e.parentNode:e)})),e.isNotify){var d=this.parent.toolbarModule.getToolbarElement(),c=r.getBoundingClientRect().top,h=r.getBoundingClientRect().left,p=c-s,u=d?d.offsetHeight+this.parent.toolbarModule.getExpandTBarPopHeight():0;n=this.parent.iframeSettings.enable?a+h:r.getBoundingClientRect().left,i=window.pageYOffset+(this.parent.iframeSettings.enable?s+u+c:s+p),this.linkQTPopupTime=setTimeout((function(){t.showLinkPopup(n,i,l)}),400)}else{var m=void 0;m=e.args.touches?e.args.changedTouches[0]:m=e.args,n=this.parent.iframeSettings.enable?window.pageXOffset+a+m.clientX:m.pageX,i=this.parent.iframeSettings.enable?window.pageYOffset+s+m.clientY:m.pageY,this.showLinkPopup(n,i,l)}this.quickToolObj.linkQTBar&&this.quickToolObj.linkQTBar.showPopup(n,i,l.endContainer,"link")}},t.prototype.showLinkPopup=function(e,t,n){this.quickToolObj.linkQTBar&&this.quickToolObj.linkQTBar.showPopup(e,t,n.endContainer,"link")},t.prototype.hideLinkQuickToolbar=function(){this.quickToolObj&&this.quickToolObj.linkQTBar&&document.body.contains(this.quickToolObj.linkQTBar.element)&&this.quickToolObj.linkQTBar.hidePopup()},t.prototype.editAreaClickHandler=function(t){if(this.parent.readonly)this.hideLinkQuickToolbar();else{var n=t.args,i=this.parent.quickToolbarSettings.showOnRightClick,r=this.parent.userAgentData.isSafari()&&3===n.which;if(!(2===n.which||i&&1===n.which||!i&&3===n.which)&&"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.linkQTBar){this.quickToolObj=this.parent.quickToolbarModule;var s=n.target;s=this.getAnchorNode([s]),this.contentModule=this.rendererFactory.getRenderer(e.Content);var a=this.quickToolObj.linkQTBar.element.classList.contains("e-rte-pop");if("A"===s.nodeName&&s.childNodes.length>0&&"IMG"!==s.childNodes[0].nodeName&&"IMG"!==t.args.target.nodeName&&!(0,o.isNullOrUndefined)((0,o.closest)(this.parent.getRange().startContainer.parentElement,"A"))&&(!(0,o.isNullOrUndefined)((0,o.closest)(this.parent.getRange().endContainer.parentElement,"A"))||r)){if(a)return;if(!1===t.args.ctrlKey)this.showLinkQuickToolbar({args:n,isNotify:!1,type:"Links",elements:[n.target]});else{var l=this.parent.formatter.editorManager.nodeSelection,d=l.getRange(this.parent.contentModule.getDocument()),c={args:{item:{subCommand:"OpenLink",command:"Links",name:""},originalEvent:t.args},selectNode:l.getNodeCollection(d),selectParent:l.getParentNodeCollection(d),selection:l.save(d,this.parent.contentModule.getDocument())};this.parent.notify(J,c)}}else this.hideLinkQuickToolbar()}}},t.prototype.onKeyDown=function(e){var t=e.args;switch(t.action){case"escape":(0,o.isNullOrUndefined)(this.dialogObj)||this.dialogObj.close();break;case"insert-link":this.openDialog(!0,e),t.preventDefault()}},t.prototype.openDialog=function(e,t){if(e||this.parent.contentModule.getEditPanel().focus(),"HTML"===this.parent.editorMode){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.contentModule.getDocument()),o=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),r=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n),s={args:t?t.args:{item:{command:"Links",subCommand:"CreateLink"},originalEvent:void 0,name:e?null:"showDialog"},selectNode:o,selection:i,selectParent:r};this.linkDialog(s)}else{var a=this.parent.contentModule.getEditPanel();this.parent.formatter.editorManager.markdownSelection.save(a.selectionStart,a.selectionEnd),this.linkDialog({args:{item:{command:"Links",subCommand:"Link"},originalEvent:t&&t.args},member:"link",text:this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),module:"Markdown",name:"insertLink"})}},t.prototype.showDialog=function(){this.openDialog(!1),this.setCssClass({cssClass:this.parent.getCssClass()})},t.prototype.closeDialog=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},t.prototype.clearDialogObj=function(){this.dialogObj&&(this.dialogObj.destroy(),(0,o.detach)(this.dialogObj.element),this.dialogObj=null)},t.prototype.linkDialog=function(e,t){var n=this;if(this.dialogObj)this.dialogObj.hide({returnValue:!0});else{var i="HTML"===this.parent.editorMode?e.selection.getRange(this.parent.contentModule.getDocument()).toString():e.text;if(!(0,o.isNullOrUndefined)(t)&&(!(0,o.isNullOrUndefined)(e.selectParent)&&e.selectParent.length>1||!(0,o.isNullOrUndefined)(e.selectNode)&&e.selectNode.length>1)&&(t.text=i),"HTML"===this.parent.editorMode&&(this.hasAnchorNodePresent(e.selectParent)||this.hasAnchorNodePresent(e.selectNode))&&(0,o.isNullOrUndefined)(t))this.editLink(e);else{var r=this.i10n.getConstant("linkWebUrl"),s=this.i10n.getConstant("linkText"),a=this.i10n.getConstant("linkTooltipLabel"),l=this.i10n.getConstant("linkurl"),d=this.i10n.getConstant("textPlaceholder"),c=this.i10n.getConstant("linkTitle"),h=this.parent.createElement("div",{className:"e-rte-link-dialog"+this.parent.getCssClass(!0),id:this.rteID+"_rtelink"});this.parent.rootContainer.appendChild(h);var p=this.parent.createElement("div",{className:"e-rte-linkcontent"+this.parent.getCssClass(!0),id:this.rteID+"_linkContent"}),u="HTML"===this.parent.editorMode?"<label>"+a+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" spellcheck="false" placeholder = "'+c+'"aria-label="'+this.i10n.getConstant("linkTitle")+'" class="e-input e-rte-linkTitle'+this.parent.getCssClass(!0)+'"></div><div class="e-rte-label'+this.parent.getCssClass(!0)+'"></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="checkbox" class="e-rte-linkTarget'+this.parent.getCssClass(!0)+'"  data-role ="none"></div>':"",m=Or('<div class="e-rte-label'+this.parent.getCssClass(!0)+'"><label>'+r+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" spellcheck="false" placeholder="'+l+'"aria-label="'+this.i10n.getConstant("linkWebUrl")+'" class="e-input e-rte-linkurl'+this.parent.getCssClass(!0)+'"/></div><div class="e-rte-label'+this.parent.getCssClass(!0)+'"><label>'+s+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"> <input type="text" data-role ="none" spellcheck="false" class="e-input e-rte-linkText'+this.parent.getCssClass(!0)+'"aria-label="'+this.i10n.getConstant("linkText")+'" placeholder="'+d+'"></div><div class="e-rte-label'+this.parent.getCssClass(!0)+'">'+u);p.appendChild(m);var f=p.querySelector(".e-rte-linkTarget"),g=p.querySelector(".e-rte-linkurl"),b=p.querySelector(".e-rte-linkText"),v=p.querySelector(".e-rte-linkTitle"),y=this.i10n.getConstant("linkOpenInNewWindow");this.checkBoxObj=new hl.CheckBox({label:y,checked:!0,enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass()}),this.checkBoxObj.isStringTemplate=!0,this.checkBoxObj.createElement=this.parent.createElement,this.checkBoxObj.appendTo(f);var C=this.i10n.getConstant("dialogInsert"),N=this.i10n.getConstant("dialogCancel"),E=e.selection,S={selfLink:this,selection:e.selection,selectParent:e.selectParent,args:e.args},T={header:this.i10n.getConstant("linkHeader"),content:p,cssClass:bi+this.parent.getCssClass(!0),enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:o.Browser.isDevice?"290px":"310px",isModal:o.Browser.isDevice,buttons:[{click:this.insertlink.bind(S),buttonModel:{content:C,cssClass:"e-flat e-insertLink"+this.parent.getCssClass(!0),isPrimary:!0}},{click:this.cancelDialog.bind(S),buttonModel:{cssClass:"e-flat"+this.parent.getCssClass(!0),content:N}}],target:o.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){n.parent.isBlur=!1,e&&e.event.returnValue&&("HTML"===n.parent.editorMode?E.restore():n.parent.formatter.editorManager.markdownSelection.restore(n.parent.contentModule.getEditPanel())),n.dialogObj.element&&n.dialogObj.element.querySelector(".e-rte-linkurl")&&null!==n.dialogObj.element.querySelector(".e-rte-linkurl")&&o.EventHandler.remove(n.dialogObj.element.querySelector(".e-rte-linkurl"),"input",n.handleKeyDown),n.dialogObj.destroy(),(0,o.detach)(n.dialogObj.element);var t=n.dialogObj;n.dialogRenderObj.close(t),n.dialogObj=null}};this.dialogObj=this.dialogRenderObj.render(T),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(h),h.style.maxHeight="inherit",(0,o.isNullOrUndefined)(this.dialogObj)||((0,o.isNullOrUndefined)(t)||(g.value=t.url,b.value=t.text,v.value=t.title,t.target?this.checkBoxObj.checked=!0:this.checkBoxObj.checked=!1,this.dialogObj.header=t.header,this.dialogObj.element.querySelector(".e-insertLink").textContent=t.btnText),this.checkUrl(!1),("HTML"===this.parent.editorMode&&(0,o.isNullOrUndefined)(t)&&(!(0,o.isNullOrUndefined)(i)&&""!==i&&0===e.selection.range.startOffset||e.selection.range.startOffset!==e.selection.range.endOffset)||"Markdown"===e.module)&&(b.value=i),this.parent.element.ownerDocument.addEventListener("mousedown",this.mouseDown),this.quickToolObj&&(this.hideLinkQuickToolbar(),this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj.textQTBar&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup()))}}},t.prototype.hasAnchorNodePresent=function(e){return!(0,o.isNullOrUndefined)(e)&&e.length>0&&e.some((function(e){return e&&null!==(0,o.closest)(e,"a")}))},t.prototype.insertlink=function(e){var t,n=this.selfLink.dialogObj.element,i=n.querySelector(".e-rte-linkurl").value.trim(),r=n.querySelector(".e-rte-linkText").value;"HTML"===this.selfLink.parent.editorMode&&(t=n.querySelector(".e-rte-linkTitle").value);var s=this.selfLink.checkBoxObj.checked?"_blank":null,a=this.selfLink.checkBoxObj.checked?this.selfLink.i10n.getConstant("linkAriaLabel"):null;if("Markdown"===this.selfLink.parent.editorMode&&""===i&&(i="https://"),""!==i){r="Markdown"===this.selfLink.parent.editorMode?""!==r.trim()?r:"":""===r.trim()?i:r,this.selfLink.isUrl(i)?this.selfLink.checkUrl(!1):this.selfLink.parent.enableAutoUrl||(i=i.indexOf("https")>-1?i:"https://"+i);var l=this.selfLink;if("HTML"===l.parent.editorMode&&(0,o.isNullOrUndefined)((0,o.closest)(this.selection.range.startContainer.parentNode,"[id='"+l.parent.contentModule.getPanel().id+"']"))){l.parent.contentModule.getEditPanel().focus(),o.Browser.isIE&&l.parent.iframeSettings.enable&&this.selection.restore();var d=l.parent.formatter.editorManager.nodeSelection.getRange(l.parent.contentModule.getDocument());this.selection=l.parent.formatter.editorManager.nodeSelection.save(d,l.parent.contentModule.getDocument()),this.selectParent=l.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(d)}var c={url:i,text:r,title:t,target:s,ariaLabel:a,selection:this.selection,selectParent:this.selectParent};if(document.body.contains(l.dialogObj.element)&&this.selfLink.dialogObj.hide({returnValue:!1}),null===this.selfLink.dialogObj){var h;if(Us()&&l.parent.iframeSettings.enable&&(0,o.select)("iframe",l.parent.element).contentWindow.focus(),"HTML"===l.parent.editorMode&&this.selection.restore(),0===l.parent.formatter.getUndoRedoStack().length&&l.parent.formatter.saveData(),(0,o.isNullOrUndefined)(this.args)||"KeyK"!==this.args.code)h=this.args;else{var p=this.args;(0,o.extend)(this.args,{item:{command:"Links",subCommand:"CreateLink"},originalEvent:p},!0),h={item:{command:"Links",subCommand:"CreateLink"},originalEvent:p}}this.selfLink.parent.formatter.process(this.selfLink.parent,h,!(0,o.isNullOrUndefined)(this.args)&&this.args.originalEvent,c),this.selfLink.parent.contentModule.getEditPanel().focus()}}else this.selfLink.checkUrl(!0)},t.prototype.isUrl=function(e){return new RegExp("(ftp|http|https)://(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(/|/([\\w#!:.?+=&%@\\-\\/]))?","gi").test(e)},t.prototype.handleKeyDown=function(){var e=this.parent.element.querySelector("#"+this.rteID+"_rtelink_dialog-content").querySelector(".e-rte-linkurl");e.classList.contains("e-error")&&e.value.length>=1&&" "!==e.value.trim()&&(0,o.removeClass)([e],"e-error")},t.prototype.checkUrl=function(e){var t=this.dialogObj.element.querySelector(".e-rte-linkurl");e?((0,o.addClass)([t],"e-error"),t.setSelectionRange(0,t.value.length),t.focus(),o.EventHandler.add(t,"input",this.handleKeyDown,this)):((0,o.removeClass)([t],"e-error"),o.EventHandler.remove(t,"input",this.handleKeyDown))},t.prototype.removeLink=function(e){0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData();var t=this.getAnchorNode(e.selectParent);this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,selectParent:e.selectParent,selection:e.selection,text:t.innerText,subCommand:e.args.item.subCommand}),Us()&&this.parent.iframeSettings.enable?(0,o.select)("iframe",this.parent.element).contentWindow.focus():this.parent.contentModule.getEditPanel().focus(),this.hideLinkQuickToolbar()},t.prototype.openLink=function(e){var t=this.getAnchorNode(e.selectParent);if(t.classList.contains("e-rte-anchor")||"A"===t.tagName){var n=this.parent.htmlEditorModule.sanitizeHelper(t.outerHTML),i=document.createElement("div");i.innerHTML=n,this.parent.formatter.process(this.parent,e.args,e.args,{url:i.firstChild.href,text:t.innerText,target:""===t.target?"_self":"_blank",selectNode:e.selectNode,subCommand:e.args.item.subCommand}),i.remove()}},t.prototype.getAnchorNode=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t],r=(0,o.closest)(i,"a");if(r)return r}return e[0]},t.prototype.editLink=function(e){var t=this.getAnchorNode(e.selectNode),n=this.getAnchorNode(e.selectParent);if((n="A"===t.nodeName?t:n).classList.contains("e-rte-anchor")||"A"===n.tagName){var i=this.i10n.getConstant("dialogUpdate"),o={url:n.getAttribute("href"),text:n.innerText,title:n.title,target:n.target,header:this.i10n.getConstant("editLink"),btnText:i};this.linkDialog(e,o)}},t.prototype.cancelDialog=function(e){if(this.selfLink.parent.isBlur=!1,this.selfLink.dialogObj.hide({returnValue:!0}),Us())this.selection.restore();else{var t=window.scrollX,n=window.scrollY;this.selfLink.parent.contentModule.getEditPanel().focus(),window.scrollTo(t,n)}},t.prototype.onDocumentClick=function(e){var t=e.target;!(0,o.isNullOrUndefined)(this.dialogObj)&&(!(0,o.closest)(t,"[id='"+this.dialogObj.element.id+"']")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||(this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)||this.parent.inlineMode.enable&&!(0,o.closest)(t,"#"+this.dialogObj.element.id))&&!(0,o.closest)(t,"#"+this.parent.getID()+"_toolbar_CreateLink")&&!t.querySelector("#"+this.parent.getID()+"_toolbar_CreateLink"))&&(this.parent.notify(Yt,{closedBy:"outside click"}),this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,Tr(this.parent.element,"focusout"))},t.prototype.destroy=function(){this.isDestroyed||((0,o.isNullOrUndefined)(this.linkQTPopupTime)||(clearTimeout(this.linkQTPopupTime),this.linkQTPopupTime=null),this.removeEventListener(),this.isDestroyed=!0)},t.prototype.getModuleName=function(){return"link"},t}(),ul=function(){function t(e,t){this.isImgUploaded=!1,this.isAllowedTypes=!0,this.pageX=null,this.pageY=null,this.deletedImg=[],this.parent=e,this.rteID=e.element.id,this.i10n=t.getService("rteLocale"),this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.drop=this.dragDrop.bind(this),this.drag=this.dragOver.bind(this),this.enter=this.dragEnter.bind(this),this.start=this.dragStart.bind(this),this.docClick=this.onDocumentClick.bind(this),this.isDestroyed=!1}return t.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(k,this.onKeyDown,this),this.parent.on(L,this.onKeyUp,this),this.parent.on(ie,this.insertImage,this),this.parent.on(Bt,this.showDialog,this),this.parent.on(Ut,this.closeDialog,this),this.parent.on(z,this.onWindowResize,this),this.parent.on(se,this.showImageQuickToolbar,this),this.parent.on($e,this.clearDialogObj,this),this.parent.on(H,this.onToolbarAction,this),this.parent.on(be,this.caption,this),this.parent.on(me,this.deleteImg,this),this.parent.on(pe,this.insertImgLink,this),this.parent.on(ue,this.insertAltText,this),this.parent.on(Ae,this.editAreaClickHandler,this),this.parent.on(m,this.onIframeMouseDown,this),this.parent.on(ve,this.imageSize,this),this.parent.on(I,this.alignmentSelect,this),this.parent.on(u,this.afterRender,this),this.parent.on(kt,this.afterRender,this),this.parent.on(qe,this.imagePaste,this),this.parent.on(qt,this.setCssClass,this),this.parent.on(f,this.destroy,this))},t.prototype.removeEventListener=function(){if(!this.parent.isDestroyed){this.parent.off(k,this.onKeyDown),this.parent.off(L,this.onKeyUp),this.parent.off(z,this.onWindowResize),this.parent.off(ie,this.insertImage),this.parent.off(Bt,this.showDialog),this.parent.off(Ut,this.closeDialog),this.parent.off(se,this.showImageQuickToolbar),this.parent.off($e,this.clearDialogObj),this.parent.off(be,this.caption),this.parent.off(H,this.onToolbarAction),this.parent.off(me,this.deleteImg),this.parent.off(pe,this.insertImgLink),this.parent.off(ue,this.insertAltText),this.parent.off(Ae,this.editAreaClickHandler),this.parent.off(m,this.onIframeMouseDown),this.parent.off(ve,this.imageSize),this.parent.off(I,this.alignmentSelect),this.parent.off(u,this.afterRender),this.parent.off(kt,this.afterRender),this.parent.off(qe,this.imagePaste),this.parent.off(qt,this.setCssClass),this.parent.off(f,this.destroy);var e=this.parent.iframeSettings.enable?this.parent.inputElement.ownerDocument:this.parent.inputElement;e.removeEventListener("drop",this.drop,!0),e.removeEventListener("dragstart",this.drag,!0),e.removeEventListener("dragenter",this.enter,!0),e.removeEventListener("dragover",this.start,!0),this.drop=null,this.drag=null,this.enter=null,this.start=null,(0,o.isNullOrUndefined)(this.contentModule)||(o.EventHandler.remove(this.contentModule.getEditPanel(),o.Browser.touchEndEvent,this.imageClick),this.parent.formatter.editorManager.observer.off(Ke,this.undoStack),this.parent.insertImageSettings.resize&&(o.EventHandler.remove(this.parent.contentModule.getEditPanel(),o.Browser.touchStartEvent,this.resizeStart),this.parent.element.ownerDocument.removeEventListener("mousedown",this.docClick),this.docClick=null,o.EventHandler.remove(this.contentModule.getEditPanel(),"cut",this.onCutHandler),o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchMoveEvent,this.resizing)))}},t.prototype.updateCss=function(e,t){e&&t.cssClass&&((0,o.isNullOrUndefined)(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},t.prototype.setCssClass=function(e){this.popupObj&&e.cssClass&&((0,o.isNullOrUndefined)(e.oldCssClass)||(0,o.removeClass)([this.popupObj.element],e.oldCssClass),(0,o.addClass)([this.popupObj.element],e.cssClass)),this.updateCss(this.checkBoxObj,e),this.updateCss(this.widthNum,e),this.updateCss(this.heightNum,e),this.updateCss(this.uploadObj,e),this.updateCss(this.dialogObj,e)},t.prototype.onIframeMouseDown=function(e){var t=e.target;this.dialogObj&&this.dialogObj.hide({returnValue:!0}),((0,o.isNullOrUndefined)(this.parent.currentTarget)||"IMG"!==this.parent.currentTarget.nodeName)&&this.imgEle&&this.imgResizeDiv&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&this.cancelResizeAction(),this.contentModule.getEditPanel().querySelector(".e-img-resize")&&"IMG"===this.parent.currentTarget.nodeName&&((0,o.isNullOrUndefined)(this.prevSelectedImgEle)||this.prevSelectedImgEle===t||(this.prevSelectedImgEle.style.outline=""))},t.prototype.afterRender=function(){this.contentModule=this.rendererFactory.getRenderer(e.Content),o.EventHandler.add(this.contentModule.getEditPanel(),o.Browser.touchEndEvent,this.imageClick,this),this.parent.insertImageSettings.resize&&(o.EventHandler.add(this.parent.contentModule.getEditPanel(),o.Browser.touchStartEvent,this.resizeStart,this),this.parent.element.ownerDocument.addEventListener("mousedown",this.docClick),o.EventHandler.add(this.contentModule.getEditPanel(),"cut",this.onCutHandler,this));var t=this.parent.iframeSettings.enable?this.parent.inputElement.ownerDocument:this.parent.inputElement;t.addEventListener("drop",this.drop,!0),t.addEventListener("dragstart",this.drag,!0),t.addEventListener("dragenter",this.enter,!0),t.addEventListener("dragover",this.start,!0)},t.prototype.undoStack=function(e){if(("undo"===e.subCommand.toLowerCase()||"redo"===e.subCommand.toLowerCase())&&"HTML"===this.parent.editorMode)for(var t=0;t<this.parent.formatter.getUndoRedoStack().length;t++){var n=this.parent.createElement("div"),i=this.parent.formatter.getUndoRedoStack()[t].text;n.appendChild(i.cloneNode(!0));var r=n.querySelectorAll("img");if(n.querySelector(".e-img-resize")&&r.length>0){for(var s=0;s<r.length;s++)r[s].style.outline="";(0,o.detach)(n.querySelector(".e-img-resize"));for(var a=n.cloneNode(!0),l=document.createDocumentFragment();a.firstChild;)l.appendChild(a.firstChild);this.parent.formatter.getUndoRedoStack()[t].text=l}}},t.prototype.resizeEnd=function(e){this.resizeBtnInit(),this.imgEle.parentElement&&(this.imgEle.parentElement.style.cursor="auto"),o.Browser.isDevice&&(0,o.removeClass)([e.target.parentElement],"e-mob-span");var t={event:e,requestType:"images"};this.parent.trigger(W,t),this.parent.formatter.editorManager.observer.on(Ke,this.undoStack,this),this.parent.formatter.saveData(),o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchMoveEvent,this.resizing),o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchEndEvent,this.resizeEnd)},t.prototype.resizeStart=function(e,t){var n=this;if(!this.parent.readonly){var i=t||e.target;if(this.prevSelectedImgEle=this.imgEle,"IMG"===i.tagName){this.parent.preventDefaultResize(e);var r=i;this.imgResizeDiv&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&(0,o.detach)(this.imgResizeDiv),this.imageResize(r)}if(i.classList.contains("e-rte-imageboxmark")){0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.pageX=this.getPointX(e),this.pageY=this.getPointY(e),e.preventDefault(),e.stopImmediatePropagation(),this.resizeBtnInit(),this.quickToolObj&&this.quickToolObj.imageQTBar.hidePopup();for(var s=["topLeft","topRight","botLeft","botRight"],a=0;a<s.length;a++){var l=s[a];if(i.classList.contains("e-rte-"+l)){this.resizeBtnStat[l]=!0,this.currentResizeHandler=l,this.aspectRatio=this.findAspectRatio(this.imgEle);break}}if(o.Browser.isDevice&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&!this.imgResizeDiv.classList.contains("e-mob-span"))(0,o.addClass)([this.imgResizeDiv],"e-mob-span");else{var d={event:e,requestType:"images"};this.parent.trigger(_,d,(function(e){e.cancel&&n.cancelResizeAction()}))}o.EventHandler.add(this.contentModule.getDocument(),o.Browser.touchMoveEvent,this.resizing,this),o.EventHandler.add(this.contentModule.getDocument(),o.Browser.touchEndEvent,this.resizeEnd,this)}}},t.prototype.imageClick=function(e){o.Browser.isDevice&&("IMG"===e.target.tagName&&"A"===e.target.parentElement.tagName||"IMG"===e.target.tagName?(this.contentModule.getEditPanel().setAttribute("contenteditable","false"),e.target.focus()):this.parent.readonly||this.contentModule.getEditPanel().setAttribute("contenteditable","true")),"IMG"===e.target.tagName&&"A"===e.target.parentElement.tagName&&e.preventDefault()},t.prototype.onCutHandler=function(){this.imgResizeDiv&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&this.cancelResizeAction()},t.prototype.imageResize=function(e){this.resizeBtnInit(),this.imgEle=e,(0,o.addClass)([this.imgEle],"e-resize"),this.imgResizeDiv=this.parent.createElement("span",{className:"e-img-resize"+this.parent.getCssClass(!0),id:this.rteID+"_imgResize"}),this.imgResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-imageboxmark e-rte-topLeft"+this.parent.getCssClass(!0),styles:"cursor: nwse-resize"})),this.imgResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-imageboxmark e-rte-topRight"+this.parent.getCssClass(!0),styles:"cursor: nesw-resize"})),this.imgResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-imageboxmark e-rte-botLeft"+this.parent.getCssClass(!0),styles:"cursor: nesw-resize"})),this.imgResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-imageboxmark e-rte-botRight"+this.parent.getCssClass(!0),styles:"cursor: nwse-resize"})),o.Browser.isDevice&&(0,o.addClass)([this.imgResizeDiv],"e-mob-rte"),e.style.outline="2px solid #4a90e2",this.imgResizePos(e,this.imgResizeDiv),this.resizeImgDupPos(e),this.contentModule.getEditPanel().appendChild(this.imgResizeDiv),"auto"===this.parent.element.style.height&&this.imgResizePos(e,this.imgResizeDiv)},t.prototype.getPointX=function(e){return this.parent.iframeSettings.enable?e.touches&&e.touches.length?e.touches[0].screenX:e.screenX:e.touches&&e.touches.length?e.touches[0].pageX:e.pageX},t.prototype.getPointY=function(e){return this.parent.iframeSettings.enable?e.touches&&e.touches.length?e.touches[0].screenY:e.screenY:e.touches&&e.touches.length?e.touches[0].pageY:e.pageY},t.prototype.imgResizePos=function(e,t){var n=this.calcPos(e),i=n.top,r=n.left,s=e.getBoundingClientRect().width,a=e.getBoundingClientRect().height,l=o.Browser.isDevice?4*parseInt(e.style.outline.slice(-3),10)+2:2*parseInt(e.style.outline.slice(-3),10)+2,d=o.Browser.isDevice?0:2;t.querySelector(".e-rte-botLeft").style.left=r-l+"px",t.querySelector(".e-rte-botLeft").style.top=a-l+i+"px",t.querySelector(".e-rte-botRight").style.left=s-(l-d)+r+"px",t.querySelector(".e-rte-botRight").style.top=a-l+i+"px",t.querySelector(".e-rte-topRight").style.left=s-(l-d)+r+"px",t.querySelector(".e-rte-topRight").style.top=i-l+"px",t.querySelector(".e-rte-topLeft").style.left=r-l+"px",t.querySelector(".e-rte-topLeft").style.top=i-l+"px"},t.prototype.calcPos=function(e){for(var t,n={top:0,left:0},i=e.ownerDocument,r=(e.offsetParent&&(e.offsetParent.classList.contains("e-img-caption")||["TD","TH","TABLE","A"].indexOf(e.offsetParent.tagName)>-1)?(0,o.closest)(e,"#"+this.parent.getID()+"_rte-edit-view"):e.offsetParent)||i.documentElement;r&&(r===i.body||r===i.documentElement)&&"static"===r.style.position;)r=r.parentNode;return r&&r!==e&&1===r.nodeType&&(n=r.getBoundingClientRect()),e.offsetParent&&e.offsetParent.classList.contains("e-img-caption")?{top:(t=e.getBoundingClientRect()).top-n.top,left:t.left-n.left}:{top:e.offsetTop,left:e.offsetLeft}},t.prototype.setAspectRatio=function(e,t,n){if(!(0,o.isNullOrUndefined)(e.width)){var i=e.width===e.height,r=this.parent.insertImageSettings.resizeByPercent?"%":"px",s=""===e.style.width&&""===e.style.height;i||s?(this.setImageWidth(e,t,r),this.parent.insertImageSettings.resizeByPercent?this.removeImageHeight(e):this.setImageHeight(e,n,r)):""!==e.style.width&&""!==e.style.height?this.parent.insertImageSettings.resizeByPercent?(this.setImageWidth(e,t,r),this.removeImageHeight(e)):(this.setImageWidth(e,t,r),this.setImageHeight(e,n,r)):""!==e.style.width?this.parent.insertImageSettings.resizeByPercent?(this.setImageWidth(e,t,r),this.removeImageHeight(e)):this.setImageWidth(e,t,r):""!==e.style.height&&(this.parent.insertImageSettings.resizeByPercent?(this.setImageWidth(e,t,r),this.removeImageHeight(e)):this.setImageHeight(e,n,r))}},t.prototype.setImageWidth=function(e,t,n){e.style.width=this.getImageDimension(t,e)+n,this.parent.insertImageSettings.resizeByPercent||e.setAttribute("width",t.toString())},t.prototype.setImageHeight=function(e,t,n){e.style.height=this.getImageDimension(t,e)+n,this.parent.insertImageSettings.resizeByPercent||e.setAttribute("height",t.toString())},t.prototype.removeImageHeight=function(e){e.style.height="",e.removeAttribute("height")},t.prototype.getImageDimension=function(e,t){if(this.parent.insertImageSettings.resizeByPercent){var n=t.parentElement;return this.pixToPerc(e,n)}return e},t.prototype.adjustDimensionsByAspectRatio=function(e,t,n){return t=Math.round(e/n),{width:e=Math.round(t*n),height:t}},t.prototype.pixToPerc=function(e,t){return e/parseFloat(getComputedStyle(t).width)*100},t.prototype.imgDupMouseMove=function(e,t,n){var i=this,r={event:n,requestType:"images"};this.parent.trigger(V,r,(function(n){if(n.cancel)i.cancelResizeAction();else{if(parseInt(i.parent.insertImageSettings.minWidth,10)>=parseInt(e,10)||parseInt(i.parent.getInsertImgMaxWidth(),10)<=parseInt(e,10)&&(0,o.isNullOrUndefined)(i.imgEle.style.width))return;if(!i.parent.insertImageSettings.resizeByPercent&&(parseInt(i.parent.insertImageSettings.minHeight,10)>=parseInt(t,10)||parseInt(i.parent.insertImageSettings.maxHeight,10)<=parseInt(t,10)))return;i.imgEle.parentElement.style.cursor="pointer",i.setAspectRatio(i.imgEle,parseInt(e,10),parseInt(t,10)),i.resizeImgDupPos(i.imgEle),i.imgResizePos(i.imgEle,i.imgResizeDiv)}}))},t.prototype.resizing=function(e){if(this.parent){if(this.resizeBtnStat.botRight||this.resizeBtnStat.botLeft||this.resizeBtnStat.topRight||this.resizeBtnStat.topLeft)if(this.parent.iframeSettings.enable){var t=this.getResizeFactor(this.currentResizeHandler),n=this.getPointX(e),i=this.getPointY(e),o=this.imgEle.clientWidth,r=this.imgEle.clientHeight,s=n-this.pageX,a=i-this.pageY,l=s*t[0]+o,d=a*t[1]+r,c=this.adjustDimensions(l,d,s,a,this.aspectRatio);this.pageX=n,this.pageY=i,this.imgDupMouseMove(c.width+"px",c.height+"px",e),this.parent.autoResize()}else{var h=this.getPointX(e),p=this.getPointY(e),u=(t=this.getResizeFactor(this.currentResizeHandler),h-this.pageX),m=p-this.pageY;o=this.imgEle.clientWidth,r=this.imgEle.clientHeight,l=u*t[0]+o,d=m*t[1]+r,c=this.adjustDimensions(l,d,u,m,this.aspectRatio);this.pageX=h,this.pageY=p,this.imgDupMouseMove(c.width+"px",c.height+"px",e)}}else this.cancelResizeAction()},t.prototype.adjustDimensions=function(e,t,n,i,o){return e=e<16?16:e,t=t<16?16:t,this.adjustDimensionsByAspectRatio(e,t,o)},t.prototype.getResizeFactor=function(e){return Rs[e]},t.prototype.findAspectRatio=function(e){return e.clientWidth/e.clientHeight},t.prototype.cancelResizeAction=function(){o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchMoveEvent,this.resizing),o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchEndEvent,this.resizeEnd),this.imgEle&&this.imgResizeDiv&&this.contentModule.getEditPanel().contains(this.imgResizeDiv)&&((0,o.detach)(this.imgResizeDiv),this.imgEle.style.outline="",this.imgResizeDiv=null,this.pageX=null,this.pageY=null,this.currentResizeHandler=null,this.aspectRatio=null)},t.prototype.resizeImgDupPos=function(e){this.imgDupPos={width:""!==e.style.width&&this.parent.insertImageSettings&&!this.parent.insertImageSettings.resizeByPercent?this.imgEle.style.width:e.width+"px",height:""!==e.style.height?this.imgEle.style.height:e.height+"px"}},t.prototype.resizeBtnInit=function(){return this.aspectRatio=null,this.currentResizeHandler=null,this.resizeBtnStat={botLeft:!1,botRight:!1,topRight:!1,topLeft:!1}},t.prototype.onToolbarAction=function(e){switch(Us()&&this.parent.notify(Oe,{}),e.args.item.subCommand){case"Replace":this.parent.fileManagerSettings.enable?this.parent.notify(Ot,e):this.parent.notify(ie,e);break;case"Caption":this.parent.notify(be,e);break;case"InsertLink":this.parent.notify(pe,e);break;case"AltText":this.parent.notify(ue,e);break;case"Remove":this.parent.notify(me,e);break;case"Dimension":this.parent.notify(ve,e);break;case"OpenImageLink":this.openImgLink(e);break;case"EditImageLink":this.editImgLink(e);break;case"RemoveImageLink":this.removeImgLink(e)}},t.prototype.openImgLink=function(e){var t=this.parent.htmlEditorModule.sanitizeHelper(e.selectParent[0].parentNode.outerHTML),n=document.createElement("div");n.innerHTML=t;var i=""===e.selectParent[0].parentNode.target?"_self":"_blank";this.parent.formatter.process(this.parent,e.args,e.args,{url:n.firstChild.href,target:i,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),n.remove()},t.prototype.editImgLink=function(e){var t=e.selectParent[0].parentNode,n=this.i10n.getConstant("dialogUpdate"),i={url:t.href,target:t.target,header:"Edit Link",btnText:n};this.insertImgLink(e,i)},t.prototype.removeImgLink=function(e){o.Browser.isIE&&this.contentModule.getEditPanel().focus(),e.selection.restore();var t=!(!this.contentModule.getEditPanel().contains(this.captionEle)||!(0,o.select)("a",this.captionEle)),n=t?[this.captionEle]:[e.selectNode[0].parentElement];this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:e.selectNode[0],selectParent:n,selection:e.selection,subCommand:e.args.item.subCommand}),this.quickToolObj&&document.body.contains(this.quickToolObj.imageQTBar.element)&&(this.quickToolObj.imageQTBar.hidePopup(),(0,o.isNullOrUndefined)(e.selectParent)||(0,o.removeClass)([e.selectParent[0]],"e-img-focus")),t&&(0,o.select)(".e-img-inner",this.captionEle).focus()},t.prototype.onKeyDown=function(e){var t,n,i,r,s,a=e.args;this.deletedImg=[];if("HTML"===this.parent.editorMode&&(s=(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())).startContainer===t.endContainer&&t.startOffset===t.endOffset),!s&&"HTML"===this.parent.editorMode&&[27,112,113,114,115,116,117,118,119,120,121,122,123,44,45,9,16,17,18,19,20,33,34,35,36,37,38,39,40,91,92,93,144,145,182,183].indexOf(a.which)<0)for(var l=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),d=0;d<l.length;d++)"IMG"===l[d].nodeName&&this.deletedImg.push(l[d]);if("HTML"===this.parent.editorMode&&(8===a.which&&"Backspace"===a.code||46===a.which&&"Delete"===a.code)){var c=t.startContainer===t.endContainer&&t.startOffset===t.endOffset;8===a.which&&"Backspace"===a.code&&c?this.checkImageBack(t):46===a.which&&"Delete"===a.code&&c&&this.checkImageDel(t)}if((0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)||"KeyK"===a.code||(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),r=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t),a.ctrlKey||!a.key||1!==a.key.length&&"enter"!==a.action||(0,o.isNullOrUndefined)(r[0])||"IMG"!==r[0].tagName||!r[0].parentElement||(this.contentModule.getEditPanel().querySelector(".e-img-resize")&&this.removeResizeEle(),(0,o.removeClass)([r[0]],"e-img-focus"),this.quickToolObj&&this.quickToolObj.imageQTBar&&this.quickToolObj.imageQTBar.hidePopup())),!a.ctrlKey||89!==a.keyCode&&90!==a.keyCode||"Markdown"!==this.parent.editorMode&&this.undoStack({subCommand:90===a.keyCode?"undo":"redo"}),8===a.keyCode||46===a.keyCode){if(i&&i[0]&&"IMG"===i[0].nodeName&&i.length<1){(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)||(n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument())),a.preventDefault();var h={selectNode:i,selection:n,selectParent:r,args:{item:{command:"Images",subCommand:"Remove"},originalEvent:a}};this.deleteImg(h,a.keyCode)}this.parent.contentModule.getEditPanel().querySelector(".e-img-resize")&&this.removeResizeEle()}switch("Backspace"===a.code&&(a.action="backspace"),a.action){case"escape":(0,o.isNullOrUndefined)(this.dialogObj)||this.dialogObj.close();break;case"backspace":case"delete":if("Markdown"!==this.parent.editorMode)if(3===t.startContainer.nodeType)"Backspace"===a.code?t.startContainer.previousElementSibling&&0===t.startOffset&&t.startContainer.previousElementSibling.classList.contains(ri)&&t.startContainer.previousElementSibling.classList.contains(ai)&&(0,o.detach)(t.startContainer.previousElementSibling):t.startContainer.nextElementSibling&&t.endContainer.textContent.length===t.endOffset&&t.startContainer.nextElementSibling.classList.contains(ri)&&t.startContainer.nextElementSibling.classList.contains(ai)&&(0,o.detach)(t.startContainer.nextElementSibling);else if(1===t.startContainer.nodeType)if(t.startContainer.querySelector("."+ri+"."+ai))(0,o.detach)(t.startContainer.querySelector("."+ri+"."+ai));else if(t.startContainer.querySelector("."+ri+"."+$n))(0,o.detach)(t.startContainer.querySelector("."+ri+"."+$n));else if(t.startContainer.classList.contains("e-img-wrap")&&(0,o.closest)(t.startContainer,"."+ri)){var p=t.startContainer.parentElement.parentElement;if((0,o.detach)((0,o.closest)(t.startContainer,"."+ri)),p&&""===p.textContent.trim()){var u=this.parent.createElement("br");u.classList.add("e-rte-image-remove-focus"),p.appendChild(u)}}break;case"insert-image":(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)||(n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument())),this.openDialog(!0,a,n,i,r),a.preventDefault()}a.ctrlKey&&"a"===a.key&&this.handleSelectAll()},t.prototype.handleSelectAll=function(){this.cancelResizeAction();var e=this.parent.inputElement.querySelectorAll("."+no);(0,o.removeClass)(e,no)},t.prototype.openDialog=function(e,t,n,i,r){var s,a,l,d;e||(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)?(a=n,l=i,d=r):(s=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),a=this.parent.formatter.editorManager.nodeSelection.save(s,this.parent.contentModule.getDocument()),l=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(s),d=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(s)),"HTML"===this.parent.editorMode?this.insertImage({args:{item:{command:"Images",subCommand:"Image"},originalEvent:t,name:e?null:"showDialog"},selectNode:l,selection:a,selectParent:d}):this.insertImage({args:{item:{command:"Images",subCommand:"Image"},originalEvent:t,name:e?null:"showDialog"},member:"image",text:this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()),module:"Markdown",name:"insertImage"})},t.prototype.showDialog=function(e){(0,o.isNullOrUndefined)(e.originalEvent)?this.openDialog(!1):this.openDialog(!1,e.originalEvent),this.setCssClass({cssClass:this.parent.getCssClass()})},t.prototype.closeDialog=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},t.prototype.onKeyUp=function(){if(!(0,o.isNullOrUndefined)(this.deletedImg)&&this.deletedImg.length>0)for(var e=Array.from(this.deletedImg).length-1;e>=0;e--){var t={element:this.deletedImg[e],src:this.deletedImg[e].getAttribute("src")};this.parent.trigger(bt,t),this.deletedImg.splice(e,1)}},t.prototype.checkImageBack=function(e){"#text"!==e.startContainer.nodeName||0!==e.startOffset||(0,o.isNullOrUndefined)(e.startContainer.previousSibling)||"IMG"!==e.startContainer.previousSibling.nodeName?"#text"===e.startContainer.nodeName||(0,o.isNullOrUndefined)(e.startContainer.childNodes[e.startOffset-1])||"IMG"!==e.startContainer.childNodes[e.startOffset-1].nodeName||this.deletedImg.push(e.startContainer.childNodes[e.startOffset-1]):this.deletedImg.push(e.startContainer.previousSibling)},t.prototype.checkImageDel=function(e){"#text"!==e.startContainer.nodeName||e.startOffset!==e.startContainer.textContent.length||(0,o.isNullOrUndefined)(e.startContainer.nextSibling)||"IMG"!==e.startContainer.nextSibling.nodeName?"#text"===e.startContainer.nodeName||(0,o.isNullOrUndefined)(e.startContainer.childNodes[e.startOffset])||"IMG"!==e.startContainer.childNodes[e.startOffset].nodeName||this.deletedImg.push(e.startContainer.childNodes[e.startOffset]):this.deletedImg.push(e.startContainer.nextSibling)},t.prototype.alignmentSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Images"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),r={args:e,selectNode:i="IMG"===i[0].nodeName?i:[this.imgEle]};switch(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.subCommand){case"JustifyLeft":case"JustifyCenter":case"JustifyRight":this.alignImage(r);break;case"Inline":this.inline(r);break;case"Break":this.break(r)}this.quickToolObj&&document.body.contains(this.quickToolObj.imageQTBar.element)&&(this.quickToolObj.imageQTBar.hidePopup(),(0,o.removeClass)([i[0]],"e-img-focus")),this.cancelResizeAction()}},t.prototype.imageWithLinkQTBarItemUpdate=function(){for(var e=this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll(".e-toolbar-item"),t=0;t<e.length;t++)e[t].getAttribute("title")===this.i10n.getConstant("openLink")||e[t].getAttribute("title")===this.i10n.getConstant("editLink")||e[t].getAttribute("title")===this.i10n.getConstant("removeLink")?((0,o.addClass)([e[t]],"e-link-groups"),e[t].style.display="none"):"Insert Link"===e[t].getAttribute("title")?e[t].style.display="":e[t].classList.contains("e-rte-horizontal-separator")&&(0,o.detach)(e[t]);var n=this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll(".e-toolbar-item:not(.e-link-groups)");this.quickToolObj.imageQTBar.addQTBarItem(["-"],Math.round(n.length/2))},t.prototype.showImageQuickToolbar=function(e){var t=this;if(!("Images"!==e.type&&"Replace"!==e.type||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule)||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule.imageQTBar)||(0,o.isNullOrUndefined)(e.args))){this.quickToolObj=this.parent.quickToolbarModule;var n=e.args,i=e.elements;[].forEach.call(e.elements,(function(e,t){0===t&&(i=e)})),i&&!(0,o.closest)(i,"a")&&this.imageWithLinkQTBarItemUpdate(),"IMG"===i.nodeName&&(0,o.addClass)([i],["e-img-focus"]);var r=this.parent.iframeSettings.enable?window.pageYOffset+this.parent.element.getBoundingClientRect().top+n.clientY:n.pageY;if(this.parent.quickToolbarModule.imageQTBar)if(e.isNotify)this.imageQTPopupTime=setTimeout((function(){t.parent.formatter.editorManager.nodeSelection.Clear(t.contentModule.getDocument()),t.parent.formatter.editorManager.nodeSelection.setSelectionContents(t.contentModule.getDocument(),i),t.quickToolObj.imageQTBar.showPopup(n.pageX,r,i),!0===t.parent.insertImageSettings.resize&&t.resizeStart(e.args,i)}),400);else{var s=i.getBoundingClientRect();this.quickToolObj.imageQTBar.showPopup(s.left,s.top,i,"Image")}}},t.prototype.hideImageQuickToolbar=function(){(0,o.isNullOrUndefined)(this.contentModule.getEditPanel().querySelector(".e-img-focus"))||((0,o.removeClass)([this.contentModule.getEditPanel().querySelector(".e-img-focus")],"e-img-focus"),this.quickToolObj&&this.quickToolObj.imageQTBar&&document.body.contains(this.quickToolObj.imageQTBar.element)&&this.quickToolObj.imageQTBar.hidePopup())},t.prototype.editAreaClickHandler=function(t){if(this.parent.readonly)this.hideImageQuickToolbar();else{var n=t.args,i=this.parent.quickToolbarSettings.showOnRightClick;if(2===n.which||i&&1===n.which||!i&&3===n.which)i&&1===n.which&&!(0,o.isNullOrUndefined)(n.target)&&"IMG"===n.target.tagName&&(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),n.target));else if("HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.imageQTBar){this.quickToolObj=this.parent.quickToolbarModule;var r=n.target;this.contentModule=this.rendererFactory.getRenderer(e.Content);var s=this.quickToolObj.imageQTBar.element.classList.contains("e-rte-pop");if("IMG"===r.nodeName&&this.parent.quickToolbarModule){if(s)return;this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),r),Us()&&this.parent.notify(Te,t),(0,o.addClass)([r],"e-img-focus");var a=this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll(".e-toolbar-item");if((0,o.closest)(r,"a")){for(var l=0;l<a.length;l++)a[l].getAttribute("title")===this.i10n.getConstant("openLink")||a[l].getAttribute("title")===this.i10n.getConstant("editLink")||a[l].getAttribute("title")===this.i10n.getConstant("removeLink")?(a[l].style.display="",(0,o.removeClass)([a[l]],"e-link-groups")):"Insert Link"===a[l].getAttribute("title")?a[l].style.display="none":a[l].classList.contains("e-rte-horizontal-separator")&&(a[l],(0,o.detach)(a[l]));var d=this.quickToolObj.imageQTBar.toolbarElement.querySelectorAll(".e-toolbar-item:not(.e-link-groups)");this.quickToolObj.imageQTBar.addQTBarItem(["-"],Math.round(d.length/2))}else(0,o.closest)(r,"a")||this.imageWithLinkQTBarItemUpdate();this.showImageQuickToolbar({args:n,type:"Images",elements:[n.target]})}else this.hideImageQuickToolbar()}}},t.prototype.insertImgLink=function(e,t){var n=this;if("IMG"===e.selectNode[0].nodeName&&(this.imagDialog(e),!(0,o.isNullOrUndefined)(this.dialogObj))){var i=this.parent.createElement("div",{className:"e-img-linkwrap"+this.parent.getCssClass(!0)}),r=this.i10n.getConstant("linkurl"),s=Or('<div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" class="e-input e-img-link'+this.parent.getCssClass(!0)+'" spellcheck="false" placeholder="'+r+'"/></div><div class="e-rte-label"></div><div class="e-rte-field"><input type="checkbox" class="e-rte-linkTarget'+this.parent.getCssClass(!0)+'"  data-role ="none"></div>');i.appendChild(s);var a=i.querySelector(".e-rte-linkTarget"),l=i.querySelector(".e-img-link"),d=this.i10n.getConstant("linkOpenInNewWindow");this.checkBoxObj=new hl.CheckBox({label:d,checked:!0,enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass(),change:function(e){c=e.checked?"_blank":null}}),this.checkBoxObj.isStringTemplate=!0,this.checkBoxObj.createElement=this.parent.createElement,this.checkBoxObj.appendTo(a);var c="_blank",h=this.i10n.getConstant("imageLinkAriaLabel"),p=this.i10n.getConstant("dialogUpdate"),u={args:e.args,selfImage:this,selection:e.selection,selectNode:e.selectNode,selectParent:e.selectParent,link:l,target:c,ariaLabel:h};this.dialogObj.setProperties({width:"290px",header:this.parent.localeObj.getConstant("imageInsertLinkHeader"),content:i,buttons:[{click:function(e){n.insertlink(u)},buttonModel:{content:p,cssClass:"e-flat e-update-link"+this.parent.getCssClass(!0),isPrimary:!0}}],cssClass:this.dialogObj.cssClass+" e-rte-img-link-dialog"}),(0,o.isNullOrUndefined)(this.parent.cssClass)||this.dialogObj.setProperties({cssClass:this.parent.cssClass}),(0,o.isNullOrUndefined)(t)||(l.value=t.url,this.checkBoxObj.checked=!!t.target,this.dialogObj.header=t.header),this.dialogObj.element.style.maxHeight="inherit",this.dialogObj.content.querySelector("input").focus()}},t.prototype.insertAltText=function(e){var t=this;if("IMG"===e.selectNode[0].nodeName){this.imagDialog(e);var n=this.i10n.getConstant("altText");if(!(0,o.isNullOrUndefined)(this.dialogObj)){var i=this.parent.createElement("div",{className:"e-img-altwrap"+this.parent.getCssClass(!0)}),r=this.i10n.getConstant("alternateHeader"),s=this.i10n.getConstant("dialogUpdate"),a=null===e.selectNode[0].getAttribute("alt")?"":e.selectNode[0].getAttribute("alt"),l=Or('<div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" spellcheck="false"  class="e-input e-img-alt'+this.parent.getCssClass(!0)+'" placeholder="'+n+'"/></div>');l.querySelector("input").setAttribute("value",a),i.appendChild(l);var d=i.querySelector(".e-img-alt"),c={args:e.args,selfImage:this,selection:e.selection,selectNode:e.selectNode,alt:d};this.dialogObj.setProperties({width:"290px",header:r,content:i,buttons:[{click:function(e){t.insertAlt(c)},buttonModel:{content:s,cssClass:"e-flat e-update-alt"+this.parent.getCssClass(!0),isPrimary:!0}}],cssClass:this.dialogObj.cssClass+" e-rte-img-alt-dialog"}),(0,o.isNullOrUndefined)(this.parent.cssClass)||this.dialogObj.setProperties({cssClass:this.parent.cssClass}),this.dialogObj.element.style.maxHeight="inherit",this.dialogObj.content.querySelector("input").focus()}}},t.prototype.insertAlt=function(e){if(!(0,o.isNullOrUndefined)(e.alt)){e.selection.restore(),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData();var t=e.alt.value;this.parent.formatter.process(this.parent,e.args,e.args,{altText:t,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.dialogObj.hide({returnValue:!1}),this.parent.iframeSettings.enable?this.parent.inputElement.focus({preventScroll:!0}):e.selectNode[0].focus({preventScroll:!0}),e.selection.restore()}},t.prototype.handleKeyDown=function(){var e=this.parent.element.querySelector("#"+this.rteID+"_image_dialog-content").querySelector(".e-img-link");e.classList.contains("e-error")&&e.value.length>=1&&" "!==e.value.trim()&&(0,o.removeClass)([e],"e-error")},t.prototype.insertlink=function(e){if("IMG"===e.selectNode[0].nodeName){var t=e.link.value;if(""===t.trim())return(0,o.addClass)([e.link],"e-error"),e.link.setSelectionRange(0,t.length),e.link.focus(),void o.EventHandler.add(e.link,"input",this.handleKeyDown,this);o.EventHandler.remove(e.link,"input",this.handleKeyDown),(0,o.removeClass)([e.link],"e-error"),this.isUrl(t)?(0,o.removeClass)([e.link],"e-error"):this.parent.enableAutoUrl||(t=t.indexOf("http")>-1?t:"http://"+t);var n=e.selfImage;if("HTML"===n.parent.editorMode&&e.selection.restore(),0===n.parent.formatter.getUndoRedoStack().length&&n.parent.formatter.saveData(),"A"===e.selectNode[0].parentElement.nodeName)return n.parent.formatter.process(n.parent,e.args,e.args,{url:t,target:n.checkBoxObj.checked?"_blank":null,ariaLabel:n.checkBoxObj.checked?this.i10n.getConstant("imageLinkAriaLabel"):null,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),void n.dialogObj.hide({returnValue:!0});n.parent.formatter.process(n.parent,e.args,e.args,{url:t,target:n.checkBoxObj.checked?"_blank":null,ariaLabel:n.checkBoxObj.checked?this.i10n.getConstant("imageLinkAriaLabel"):null,selectNode:e.selectNode,subCommand:e.args.item.subCommand,selection:e.selection});var i=(0,o.closest)(e.selectNode[0],".e-img-caption");if(i){var r=(0,o.select)("."+ho,i);i&&r.focus()}n.dialogObj.hide({returnValue:!1})}},t.prototype.isUrl=function(e){return new RegExp("(ftp|http|https)://(\\w+:{0,1}\\w*@)?(\\S+)(:[0-9]+)?(/|/([\\w#!:.?+=&%@\\-\\/]))?","gi").test(e)},t.prototype.deleteImg=function(e,t){if("IMG"===e.selectNode[0].nodeName){var n={element:e.selectNode[0],src:e.selectNode[0].getAttribute("src")};0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData();var i=e.selection.range.startContainer;if("SPAN"===e.selection.range.startContainer.nodeName&&i.classList.contains("e-img-wrap")&&i.parentElement.classList.contains("e-img-caption"))if(i=i.parentElement,(0,o.isNullOrUndefined)(i.previousSibling)){if(!(0,o.isNullOrUndefined)(i.nextSibling)){for(var r=i.nextSibling;"#text"!==r.nodeName&&"BR"!==r.nodeName;)r=r.firstChild;this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),r,0)}}else{for(var s=i.previousSibling;"#text"!==s.nodeName&&"BR"!==s.nodeName;)s=s.lastChild;this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),s,"BR"!==s.nodeName?s.textContent.length:0)}else e.selection.restore();this.contentModule.getEditPanel().querySelector(".e-img-resize")&&this.removeResizeEle(),this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,captionClass:ri,subCommand:e.args.item.subCommand}),this.quickToolObj&&document.body.contains(this.quickToolObj.imageQTBar.element)&&this.quickToolObj.imageQTBar.hidePopup(),this.cancelResizeAction(),(0,o.isNullOrUndefined)(t)&&this.parent.trigger(bt,n)}},t.prototype.caption=function(e){var t=e.selectNode[0];if("IMG"===t.nodeName){e.selection.restore(),0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.cancelResizeAction(),(0,o.addClass)([t],"e-rte-image");var n=e.args.item?e.args.item.subCommand:"Caption";if((0,o.isNullOrUndefined)((0,o.closest)(t,"."+ri))){this.captionEle=this.parent.createElement("span",{className:ri+" "+si+this.parent.getCssClass(!0),attrs:{contenteditable:"false",draggable:"false",style:"width:"+this.parent.insertImageSettings.width}});var i=this.parent.createElement("span",{className:"e-img-wrap"+this.parent.getCssClass(!0)}),r=this.parent.createElement("span",{className:"e-img-inner"+this.parent.getCssClass(!0),attrs:{contenteditable:"true"}}),s=e.selectNode[0].parentElement;"A"===s.tagName&&s.setAttribute("contenteditable","true"),i.appendChild("A"===s.tagName?s:e.selectNode[0]),i.appendChild(r);var a=this.i10n.getConstant("imageCaption");r.innerHTML=a,this.captionEle.appendChild(i),t.classList.contains(li)&&(0,o.addClass)([this.captionEle],ai),t.classList.contains($n)&&(0,o.addClass)([this.captionEle],$n),t.classList.contains(Yn)&&(0,o.addClass)([this.captionEle],Yn),t.classList.contains(Xn)&&(0,o.addClass)([this.captionEle],Xn),t.classList.contains(Jn)&&(0,o.addClass)([this.captionEle],Jn),this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:this.captionEle,selectNode:e.selectNode,subCommand:n}),this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),r.childNodes[0],r.childNodes[0],0,r.childNodes[0].textContent.length)}else(0,o.detach)((0,o.closest)(t,"."+ri)),o.Browser.isIE&&(this.contentModule.getEditPanel().focus(),e.selection.restore()),"A"===t.parentElement.tagName?this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:t.parentElement,selectNode:e.selectNode,subCommand:n}):this.parent.formatter.process(this.parent,e.args,e.args,{insertElement:t,selectNode:e.selectNode,subCommand:n});this.quickToolObj&&document.body.contains(this.quickToolObj.imageQTBar.element)&&(this.quickToolObj.imageQTBar.hidePopup(),(0,o.removeClass)([t],"e-img-focus"))}},t.prototype.imageSize=function(e){var t=this;if("IMG"===e.selectNode[0].nodeName&&(this.imagDialog(e),!(0,o.isNullOrUndefined)(this.dialogObj))){var n=this.i10n.getConstant("imageSizeHeader"),i=this.i10n.getConstant("dialogUpdate");this.changedHeightValue=null,this.changedWidthValue=null;var r=this.imgsizeInput(e),s={args:e.args,selfImage:this,selection:e.selection,selectNode:e.selectNode};this.dialogObj.setProperties({width:"290px",header:n,content:r,buttons:[{click:function(e){t.insertSize(s)},buttonModel:{content:i,cssClass:"e-flat e-update-size"+this.parent.getCssClass(!0),isPrimary:!0}}],cssClass:this.dialogObj.cssClass+" e-rte-img-size-dialog"}),(0,o.isNullOrUndefined)(this.parent.cssClass)||this.dialogObj.setProperties({cssClass:this.parent.cssClass}),this.dialogObj.element.style.maxHeight="inherit",this.dialogObj.content.querySelector("input").focus()}},t.prototype.break=function(e){if("IMG"===e.selectNode[0].nodeName){var t=e.args.item.subCommand;this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t})}},t.prototype.inline=function(e){if("IMG"===e.selectNode[0].nodeName){var t=e.args.item.subCommand;this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t})}},t.prototype.alignImage=function(e){var t=e.args.item.subCommand;this.parent.formatter.process(this.parent,e.args,e.args,{selectNode:e.selectNode,subCommand:t})},t.prototype.clearDialogObj=function(){this.uploadObj&&!this.uploadObj.isDestroyed&&(this.uploadObj.destroy(),(0,o.detach)(this.uploadObj.element),this.uploadObj=null),this.checkBoxObj&&!this.checkBoxObj.isDestroyed&&(this.checkBoxObj.destroy(),(0,o.detach)(this.checkBoxObj.element),this.checkBoxObj=null),this.popupObj&&!this.popupObj.isDestroyed&&(this.popupObj.destroy(),(0,o.detach)(this.popupObj.element),this.popupObj=null),this.widthNum&&!this.widthNum.isDestroyed&&(this.widthNum.destroy(),(0,o.detach)(this.widthNum.element),this.widthNum=null),this.heightNum&&!this.heightNum.isDestroyed&&(this.heightNum.destroy(),(0,o.detach)(this.heightNum.element),this.heightNum=null),this.browseButton&&!this.browseButton.isDestroyed&&(this.browseButton.destroy(),(0,o.detach)(this.browseButton.element),this.browseButton=null),this.dialogObj&&!this.dialogObj.isDestroyed&&(this.dialogObj.element&&this.dialogObj.element.querySelector(".e-img-link")&&null!==this.dialogObj.element.querySelector(".e-img-link")&&o.EventHandler.remove(this.dialogObj.element.querySelector(".e-img-link"),"input",this.handleKeyDown),this.dialogObj.destroy(),(0,o.detach)(this.dialogObj.element),this.dialogObj=null)},t.prototype.imagDialog=function(e){var t=this;if(this.dialogObj)this.dialogObj.hide({returnValue:!0});else{var n=this.parent.createElement("div",{className:"e-rte-img-dialog"+this.parent.getCssClass(!0),id:this.rteID+"_image"});this.parent.rootContainer.appendChild(n);var i=this.i10n.getConstant("dialogInsert"),r=this.i10n.getConstant("dialogCancel"),s=this.i10n.getConstant("imageHeader"),a=e.selection,l={selfImage:this,selection:e.selection,args:e.args,selectParent:e.selectParent},d={header:s,cssClass:bi+this.parent.getCssClass(!0),enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:o.Browser.isDevice?"290px":"340px",isModal:o.Browser.isDevice,buttons:[{click:this.insertImageUrl.bind(l),buttonModel:{content:i,cssClass:"e-flat e-insertImage"+this.parent.getCssClass(!0),isPrimary:!0,disabled:"Markdown"!==this.parent.editorMode}},{click:this.cancelDialog.bind(this),buttonModel:{cssClass:"e-flat e-cancel"+this.parent.getCssClass(!0),content:r}}],target:o.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){e&&"user action"!==e.closedBy&&t.uploadObj&&t.uploadObj.filesData.length>0&&t.uploadObj.remove(),t.parent.isBlur=!1,e&&!(0,o.isNullOrUndefined)(e.event)&&e.event.returnValue&&("HTML"===t.parent.editorMode?a.restore():t.parent.formatter.editorManager.markdownSelection.restore(t.parent.contentModule.getEditPanel())),t.clearDialogObj(),t.dialogRenderObj.close(e)}},c=this.parent.createElement("div",{className:"e-img-content"+this.parent.getCssClass(!0)});(!(0,o.isNullOrUndefined)(this.parent.insertImageSettings.path)&&"Markdown"===this.parent.editorMode||"HTML"===this.parent.editorMode)&&c.appendChild(this.imgUpload(e));var h=this.parent.createElement("div",{className:"e-linkheader"+this.parent.getCssClass(!0)}),p=this.i10n.getConstant("imageLinkHeader");"HTML"===this.parent.editorMode?h.innerHTML=p:h.innerHTML=this.i10n.getConstant("mdimageLink"),c.appendChild(h),c.appendChild(this.imageUrlPopup(e)),e.selectNode&&"IMG"===e.selectNode[0].nodeName?(d.header=this.parent.localeObj.getConstant("editImageHeader"),d.content=c,d.buttons[0].buttonModel.cssClass=d.buttons[0].buttonModel.cssClass+" e-updateImage"):d.content=c,this.dialogObj=this.dialogRenderObj.render(d),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(n),(0,o.isNullOrUndefined)(this.dialogObj)||(e.selectNode&&"IMG"===e.selectNode[0].nodeName&&"insertImage"===e.name&&(this.dialogObj.element.querySelector(".e-insertImage").textContent=this.parent.localeObj.getConstant("dialogUpdate")),n.style.maxHeight="inherit",this.quickToolObj&&(this.quickToolObj.imageQTBar&&document.body.contains(this.quickToolObj.imageQTBar.element)&&(this.quickToolObj.imageQTBar.hidePopup(),(0,o.isNullOrUndefined)(e.selectParent)||(0,o.removeClass)([e.selectParent[0]],"e-img-focus")),this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj.textQTBar&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup()))}},t.prototype.cancelDialog=function(){this.parent.isBlur=!1,!(0,o.isNullOrUndefined)(this.uploadObj)&&this.uploadObj.filesData.length>0&&this.uploadObj.remove(),this.dialogObj.hide({returnValue:!0})},t.prototype.onDocumentClick=function(e){var t=e.target;if(!(0,o.isNullOrUndefined)(this.contentModule.getEditPanel())&&("IMG"===t.nodeName&&(this.imgEle=t),this.parent)){if("#document"!==t.nodeName&&(this.parent.currentTarget=e.target),!(0,o.isNullOrUndefined)(this.dialogObj)&&(!(0,o.closest)(t,"[id='"+this.dialogObj.element.id+"']")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!(0,o.closest)(t,"#"+this.parent.getID()+"_toolbar_Image")&&!t.querySelector("#"+this.parent.getID()+"_toolbar_Image"))&&(e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.notify(Yt,{closedBy:"outside click"}),this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,Tr(this.parent.element,"focusout"))),this.parent.iframeSettings.enable&&!(0,o.isNullOrUndefined)(this.parent.currentTarget)&&"IMG"===this.parent.currentTarget.nodeName||"IMG"===e.target.tagName||!this.imgResizeDiv||this.quickToolObj&&this.quickToolObj.imageQTBar&&this.quickToolObj.imageQTBar.element.contains(e.target)||!this.contentModule.getEditPanel().contains(this.imgResizeDiv)||this.cancelResizeAction(),!this.contentModule.getEditPanel().querySelector(".e-img-resize")||this.parent.iframeSettings.enable&&"IMG"===this.parent.currentTarget.nodeName||("IMG"!==t.tagName&&this.removeResizeEle(),"IMG"===t.tagName||(0,o.isNullOrUndefined)(this.imgEle)?(0,o.isNullOrUndefined)(this.prevSelectedImgEle)||this.prevSelectedImgEle===t||(this.prevSelectedImgEle.style.outline=""):this.imgEle.style.outline=""),"IMG"!==t.tagName)for(var n=this.contentModule.getEditPanel().querySelectorAll("img"),i=0;i<n.length;i++)(0,o.removeClass)([n[i]],"e-img-focus"),(0,o.removeClass)([n[i]],"e-resize");this.parent.inlineMode.enable&&t&&this.dialogObj&&!(0,o.closest)(t,"#"+this.dialogObj.element.id)&&this.dialogObj.hide()}},t.prototype.removeResizeEle=function(){o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchMoveEvent,this.resizing),o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchEndEvent,this.resizeEnd),(0,o.detach)(this.contentModule.getEditPanel().querySelector(".e-img-resize"))},t.prototype.onWindowResize=function(){(0,o.isNullOrUndefined)(this.contentModule)||(0,o.isNullOrUndefined)(this.contentModule.getEditPanel().querySelector(".e-img-resize"))||this.cancelResizeAction()},t.prototype.imageUrlPopup=function(e){var t=this,n=this.parent.createElement("div",{className:"imgUrl"+this.parent.getCssClass(!0)}),i=this.i10n.getConstant("imageUrl");if(this.inputUrl=this.parent.createElement("input",{className:"e-input e-img-url"+this.parent.getCssClass(!0),attrs:{placeholder:i,spellcheck:"false","aria-label":this.i10n.getConstant("imageLinkHeader")}}),this.inputUrl.addEventListener("input",(function(){(0,o.isNullOrUndefined)(t.inputUrl)||(0===t.inputUrl.value.length?t.dialogObj.getButtons(0).element.disabled=!0:t.dialogObj.getButtons(0).element.removeAttribute("disabled"))})),e.selectNode&&"IMG"===e.selectNode[0].nodeName){var r=new RegExp(/([^\S]|^)(((https?:\/\/)|(www\.))(\S+))/gi);this.inputUrl.value=e.selectNode[0].src.match(r)?e.selectNode[0].src:""}return n.appendChild(this.inputUrl),n},t.prototype.insertImageUrl=function(e){var t=this.selfImage;t.isImgUploaded=!1;var n=t.inputUrl.value;if(e.target&&"BUTTON"===e.target.nodeName&&e.target.classList.contains("e-updateImage")){var i={element:this.selectNode&&this.selectNode[0]&&"IMG"===this.selectNode[0].nodeName?this.selectNode[0]:null,src:n};t.parent.trigger(bt,i)}"Markdown"===t.parent.editorMode&&""===n&&(n="http://"),0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData();var r=this.args.item.subCommand;if(this.args.item.subCommand="Update"===e.target.innerHTML?"Replace":this.args.item.subCommand,(0,o.isNullOrUndefined)(t.uploadUrl)||""===t.uploadUrl.url){if(""!==n){if("HTML"===t.parent.editorMode&&(0,o.isNullOrUndefined)((0,o.closest)(this.selection.range.startContainer.parentNode,"[id='"+t.contentModule.getPanel().id+"']"))){"IFRAME"===t.contentModule.getPanel().tagName&&"Replace"===this.args.item.subCommand?t.contentModule.getPanel():t.contentModule.getEditPanel();var s=t.parent.formatter.editorManager.nodeSelection.getRange(t.contentModule.getDocument());this.selection=t.parent.formatter.editorManager.nodeSelection.save(s,t.contentModule.getDocument()),this.selectParent=t.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(s)}var a=/[\w-]+.(jpg|png|jpeg|gif)/g,l=(0,o.isNullOrUndefined)(n.match(a))||"HTML"!==t.parent.editorMode?"":n.match(a)[0],d={cssClass:this.selectParent&&this.selectParent[0].classList&&!0===this.selectParent[0].classList.contains("e-imgbreak")?$n:"inline"===t.parent.insertImageSettings.display?li:$n,url:n,selection:this.selection,altText:l,selectParent:this.selectParent,width:{width:t.parent.insertImageSettings.width,minWidth:t.parent.insertImageSettings.minWidth,maxWidth:t.parent.getInsertImgMaxWidth()},height:{height:t.parent.insertImageSettings.height,minHeight:t.parent.insertImageSettings.minHeight,maxHeight:t.parent.insertImageSettings.maxHeight}};if(t.dialogObj.hide({returnValue:!1}),null!==t.dialogObj)return;t.parent.formatter.process(t.parent,this.args,this.args.originalEvent,d)}}else{if(t.uploadUrl.cssClass=this.selectParent&&this.selectParent[0].classList&&!0===this.selectParent[0].classList.contains("e-imgbreak")?$n:"inline"===t.parent.insertImageSettings.display?li:$n,t.dialogObj.hide({returnValue:!1}),null!==t.dialogObj)return;t.parent.formatter.process(t.parent,this.args,this.args.originalEvent,t.uploadUrl),t.uploadUrl.url="",t.contentModule.getEditPanel().querySelector(".e-img-resize")&&(t.imgEle.style.outline="",t.removeResizeEle())}this.args.item.subCommand=r},t.prototype.imgsizeInput=function(e){var t=this,n=e.selectNode[0],i=this.i10n.getConstant("imageHeight"),r=this.i10n.getConstant("imageWidth"),s=this.parent.createElement("div",{className:"e-img-sizewrap"+this.parent.getCssClass(!0)}),a=!(0,o.isNullOrUndefined)(this.changedWidthValue)||"auto"!==n.style.width.toString()&&""===n.style.width?(0,o.isNullOrUndefined)(this.changedWidthValue)?parseInt(n.getClientRects()[0].width.toString(),10).toString():this.changedWidthValue:n.style.width,l=!(0,o.isNullOrUndefined)(this.changedHeightValue)||"auto"!==n.style.height.toString()&&""===n.style.height?(0,o.isNullOrUndefined)(this.changedHeightValue)?parseInt(n.getClientRects()[0].height.toString(),10).toString():this.changedHeightValue:n.style.height;""===n.style.width&&(a="auto"),""===n.style.height&&(l="auto"),this.changedWidthValue=null,this.changedHeightValue=null;var d=Or('<div class="e-rte-label'+this.parent.getCssClass(!0)+'"><label>'+r+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" id="imgwidth" class="e-img-width'+this.parent.getCssClass(!0)+'"/></div><div class="e-rte-label'+this.parent.getCssClass(!0)+'"><label>'+i+'</label></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"> <input type="text" id="imgheight" class="e-img-height'+this.parent.getCssClass(!0)+'"/></div>');return d.getElementById("imgwidth").setAttribute("value",a),d.getElementById("imgheight").setAttribute("value",l),s.appendChild(d),this.widthNum=new Qr.TextBox({value:(0,o.formatUnit)(a),enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass(),input:function(e){t.inputWidthValue=(0,o.formatUnit)(t.inputValue(e.value))}}),this.widthNum.createElement=this.parent.createElement,this.widthNum.appendTo(s.querySelector("#imgwidth")),this.heightNum=new Qr.TextBox({value:(0,o.formatUnit)(l),enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass(),input:function(e){t.inputHeightValue=(0,o.formatUnit)(t.inputValue(e.value))}}),this.heightNum.createElement=this.parent.createElement,this.heightNum.appendTo(s.querySelector("#imgheight")),s},t.prototype.inputValue=function(e){return"auto"===e||-1!==e.indexOf("%")||-1!==e.indexOf("px")||e.match(/(\d+)/)?e:"auto"},t.prototype.insertSize=function(e){e.selection.restore();var t=e.selfImage;0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData();var n=t.dialogObj.element;this.changedWidthValue=this.inputWidthValue,this.changedHeightValue=this.inputHeightValue;var i=n.querySelector(".e-img-width").value,o=n.parentElement.querySelector(".e-img-height").value;t.parent.formatter.process(this.parent,e.args,e.args,{width:i,height:o,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.imgResizeDiv&&t.imgResizePos(e.selectNode[0],this.imgResizeDiv),t.dialogObj.hide({returnValue:!0}),t.parent.inputElement.focus({preventScroll:!0})},t.prototype.insertImage=function(e){if(this.imagDialog(e),!(0,o.isNullOrUndefined)(this.dialogObj)){this.dialogObj.element.style.maxHeight="inherit";var t=this.dialogObj.element.querySelector(".e-img-content");!(0,o.isNullOrUndefined)(this.parent.insertImageSettings.path)&&"Markdown"===this.parent.editorMode||"HTML"===this.parent.editorMode?document.getElementById(this.rteID+"_insertImage").focus():t.querySelector(".e-img-url").focus()}},t.prototype.imgUpload=function(e){var t,n,r=this,s=this,a=s.parent.iframeSettings.enable;if("HTML"===s.parent.editorMode&&(!a&&(0,o.isNullOrUndefined)((0,o.closest)(e.selection.range.startContainer.parentNode,"[id='"+this.parent.contentModule.getPanel().id+"']"))||a&&!ur(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body"),"e-lib"))){this.contentModule.getEditPanel().focus();var l=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());t=this.parent.formatter.editorManager.nodeSelection.save(l,this.parent.contentModule.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(l)}else t=e.selection,n=e.selectParent;var d=this.parent.createElement("div",{className:"e-img-uploadwrap e-droparea"+this.parent.getCssClass(!0)}),c=this.i10n.getConstant("imageDeviceUploadMessage"),h=this.i10n.getConstant("imageUploadMessage"),p=this.parent.createElement("span",{className:"e-droptext"+this.parent.getCssClass(!0)}),u=this.parent.createElement("span",{className:"e-rte-upload-text"+this.parent.getCssClass(!0),innerHTML:o.Browser.isDevice?c:h});p.appendChild(u);var m=this.parent.createElement("button",{className:"e-browsebtn"+this.parent.getCssClass(!0),id:this.rteID+"_insertImage",attrs:{autofocus:"true",type:"button"}});p.appendChild(m),d.appendChild(p);var f=this.i10n.getConstant("browse");this.browseButton=new hl.Button({content:f,enableRtl:this.parent.enableRtl}),this.browseButton.isStringTemplate=!0,this.browseButton.createElement=this.parent.createElement,this.browseButton.appendTo(m);var g=o.Browser.isDevice?p:m;o.EventHandler.add(g,"click",this.fileSelect,this);var b,v,y=this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"},className:this.parent.getCssClass()});d.appendChild(y);var C=null;return this.uploadObj=new Qr.Uploader({asyncSettings:{saveUrl:this.parent.insertImageSettings.saveUrl,removeUrl:this.parent.insertImageSettings.removeUrl},dropArea:p,multiple:!1,enableRtl:this.parent.enableRtl,cssClass:this.parent.getCssClass(),allowedExtensions:this.parent.insertImageSettings.allowedTypes.toString(),selected:function(e){s.isImgUploaded=!0,v=e,e.filesData,r.parent.trigger(at,v,(function(e){if(!e.cancel){if((0,o.isNullOrUndefined)(e.filesData[0]))return;if(r.checkExtension(e.filesData[0]),b=e.filesData[0].name.replace(/\.[a-zA-Z0-9]+$/,""),"HTML"===r.parent.editorMode&&(0,o.isNullOrUndefined)(r.parent.insertImageSettings.path)){var i=new FileReader;i.addEventListener("load",(function(a){var l="Base64"===r.parent.insertImageSettings.saveFormat?i.result:URL.createObjectURL(Ir(i.result));if(s.uploadUrl={url:l,selection:t,altText:b,selectParent:n,width:{width:s.parent.insertImageSettings.width,minWidth:s.parent.insertImageSettings.minWidth,maxWidth:s.parent.getInsertImgMaxWidth()},height:{height:s.parent.insertImageSettings.height,minHeight:s.parent.insertImageSettings.minHeight,maxHeight:s.parent.insertImageSettings.maxHeight}},s.inputUrl.setAttribute("disabled","true"),!(0,o.isNullOrUndefined)(r.dialogObj)){var d=r.dialogObj.getButtons(0);(0,o.isNullOrUndefined)(d)||((0,o.isNullOrUndefined)(s.parent.insertImageSettings.saveUrl)&&r.isAllowedTypes&&e.filesData[0].size<=r.uploadObj.maxFileSize?d.element.removeAttribute("disabled"):d.element.setAttribute("disabled","true"))}})),i.readAsDataURL(e.filesData[0].rawFile)}}}))},beforeUpload:function(e){r.parent.trigger(Et,e)},uploading:function(e){r.parent.isServerRendered||r.parent.trigger(lt,e)},success:function(e){e.detectImageSource=i.Uploaded,r.parent.trigger(dt,e,(function(e){var i=!1;if((0,o.isNullOrUndefined)(C)||C.name===e.file.name||"remove"!==e.operation.toLocaleLowerCase()||(i=!0),!(0,o.isNullOrUndefined)(r.parent.insertImageSettings.path)&&!i){var a=r.parent.insertImageSettings.path+e.file.name;(0,o.isNullOrUndefined)(C)||"upload"!==e.operation||r.uploadObj.remove(C);s.uploadUrl={url:a,selection:t,altText:b,selectParent:n,width:{width:s.parent.insertImageSettings.width,minWidth:s.parent.insertImageSettings.minWidth,maxWidth:s.parent.getInsertImgMaxWidth()},height:{height:s.parent.insertImageSettings.height,minHeight:s.parent.insertImageSettings.minHeight,maxHeight:s.parent.insertImageSettings.maxHeight}},e&&e.operation&&"REMOVE"!==e.operation.toLocaleUpperCase()&&s.inputUrl.setAttribute("disabled","true"),C=e.file}"upload"!==e.operation||(0,o.isNullOrUndefined)(r.dialogObj)||r.dialogObj.getButtons(0).element.removeAttribute("disabled")}))},failure:function(e){r.parent.trigger(ct,e)},removing:function(e){r.parent.trigger(ht,e,(function(e){s.isImgUploaded=!1,r.dialogObj.getButtons(0).element.disabled=!0,s.inputUrl.removeAttribute("disabled"),s.uploadUrl&&(s.uploadUrl.url="")}))}}),this.uploadObj.isStringTemplate=!0,this.uploadObj.createElement=this.parent.createElement,this.uploadObj.appendTo(y),d},t.prototype.checkExtension=function(e){this.uploadObj.allowedExtensions&&e.type&&(-1===this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(("."+e.type).toLocaleLowerCase())?(this.dialogObj.getButtons(0).element.setAttribute("disabled","disabled"),this.isAllowedTypes=!1):this.isAllowedTypes=!0)},t.prototype.fileSelect=function(){return this.dialogObj.element.getElementsByClassName("e-file-select-wrap")[0].querySelector("button").click(),!1},t.prototype.dragStart=function(e){if("IMG"!==e.target.nodeName)return!0;e.dataTransfer.effectAllowed="copyMove",e.target.classList.add(ro)},t.prototype.dragEnter=function(e){e.dataTransfer.dropEffect="copy",e.preventDefault()},t.prototype.dragOver=function(e){if(!("edge"===o.Browser.info.name&&e.dataTransfer.items[0].type.split("/")[0].indexOf("image")>-1||o.Browser.isIE&&"Files"===e.dataTransfer.types[0]))return!0;e.preventDefault()},t.prototype.dragDrop=function(e){var t=this;this.parent.trigger(Lt,e,(function(e){var n=t.parent.inputElement.ownerDocument.querySelector("."+ro),i=n&&"IMG"===n.tagName||e.dataTransfer.files.length>0;if(!e.cancel&&i){if((0,o.closest)(e.target,"#"+t.parent.getID()+"_toolbar")||"false"===t.parent.inputElement.contentEditable)return void e.preventDefault();t.parent.element.querySelector("."+lo)&&(0,o.detach)(t.imgResizeDiv),e.preventDefault();var r=void 0;if(t.contentModule.getDocument().caretRangeFromPoint?r=t.contentModule.getDocument().caretRangeFromPoint(e.clientX,e.clientY):e.rangeParent?(r=t.contentModule.getDocument().createRange()).setStart(e.rangeParent,e.rangeOffset):r=t.getDropRange(e.clientX,e.clientY),t.parent.notify(He,{range:r}),t.parent.element.querySelector("."+co))return;t.insertDragImage(e)}else i&&e.preventDefault()}))},t.prototype.getDropRange=function(e,t){var n=this.contentModule.getDocument().createRange();this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(),n);var i=this.contentModule.getDocument().elementFromPoint(e,t),o=i.childNodes.length>0?i.childNodes[0]:i,r=0;if("<br>"===this.parent.inputElement.firstChild.innerHTML)n.setStart(o,r),n.setEnd(o,r);else{var s=void 0;do{r++,n.setStart(o,r),n.setEnd(o,r+1),s=n.getBoundingClientRect()}while(s.left<e&&r<o.length-1)}return n},t.prototype.insertDragImage=function(e){var t=this;e.preventDefault();var n=this.parent.element.querySelector(""+ao);this.parent.notify(yt,{args:e}),n&&n.classList.add(Wn);var i=this.parent.inputElement.ownerDocument.querySelector("."+ro),r={requestType:"Images",name:"ImageDragAndDrop",cancel:!1,originalEvent:e};if(e.dataTransfer.files.length>0&&null===i){if(e.dataTransfer.files.length>1)return;for(var s=e.dataTransfer.files,a=s[0].name,l=a.substring(a.lastIndexOf(".")),d=this.parent.insertImageSettings.allowedTypes,c=0;c<d.length;c++)l.toLocaleLowerCase()===d[c].toLowerCase()&&(this.parent.insertImageSettings.saveUrl?this.onSelect(e):this.parent.trigger($,r,(function(n){if(n.cancel)n.originalEvent.preventDefault();else{var i={args:e,text:"",file:s[0]};e.preventDefault(),t.imagePaste(i)}})))}else this.parent.trigger($,r,(function(n){if(n.cancel)n.originalEvent.preventDefault();else{var r=t.parent.formatter.editorManager.nodeSelection.getRange(t.parent.contentModule.getDocument());if(i&&"IMG"===i.tagName){var s=i.closest(".e-rte-img-caption");if((0,o.isNullOrUndefined)(s)){var a=i.closest("a");a&&"A"===a.tagName&&t.hasOnlyImage(a)?r.insertNode(a):r.insertNode(i)}else r.insertNode(s);i.classList.remove(ro);var l={elements:[i]};i.addEventListener("load",(function(){t.parent.trigger(Z,l)})),t.parent.formatter.editorManager.nodeSelection.Clear(t.contentModule.getDocument());var d=e;t.parent.insertImageSettings.resize&&t.resizeStart(d,i),t.hideImageQuickToolbar()}}}))},t.prototype.hasOnlyImage=function(e){for(var t=!1,n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(i.nodeType===Node.TEXT_NODE){if(""!==i.textContent.replace(/[\u200B\u200C\u200D]/g,"").trim())return!1}else if(i.nodeType===Node.ELEMENT_NODE){if("IMG"!==i.tagName)return!1;if(t)return!1;t=!0}}return t},t.prototype.onSelect=function(e){var t=this,n=this,i=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),r=this.parent.createElement("ul",{className:po});this.parent.rootContainer.appendChild(r);var s={name:e.dataTransfer.files[0].name,size:e.dataTransfer.files[0].size,status:"",statusCode:"",type:e.dataTransfer.files[0].type,rawFile:e.dataTransfer.files[0],validationMessages:{}},a=this.parent.createElement("IMG");a.style.opacity="0.5",a.classList.add(eo),a.classList.add(li),a.classList.add(to);var l=s.rawFile,d=new FileReader;d.addEventListener("load",(function(){var e=URL.createObjectURL(Ir(d.result));a.src="Blob"===n.parent.insertImageSettings.saveFormat?e:d.result})),l&&d.readAsDataURL(l);var c=this.parent.formatter.editorManager.nodeSelection.save(i,this.parent.contentModule.getDocument()),h={cssClass:"inline"===this.parent.insertImageSettings.display?li:$n,url:this.parent.insertImageSettings.path+l.name,selection:c,altText:l.name.replace(/\.[a-zA-Z0-9]+$/,""),width:{width:this.parent.insertImageSettings.width,minWidth:this.parent.insertImageSettings.minWidth,maxWidth:this.parent.getInsertImgMaxWidth()},height:{height:this.parent.insertImageSettings.height,minHeight:this.parent.insertImageSettings.minHeight,maxHeight:this.parent.insertImageSettings.maxHeight}},p={requestType:"Image",name:"ImageDragAndDrop",cancel:!1,originalEvent:e,itemCollection:h};this.parent.trigger($,p,(function(n){if(n.cancel)n.originalEvent.preventDefault();else{var s=n.itemCollection,a=(0,o.createElement)("img",{className:s.cssClass,attrs:{src:s.url,alt:s.altText}});a.style.opacity="0.5",a.classList.add(eo),a.classList.add(li),a.classList.add(to),i.insertNode(a),t.uploadMethod(e,a),a.addEventListener("load",(function(e){var n={requestType:"Image",name:"InsertDropImage",elements:[a],event:e,editorMode:"HTML"};t.parent.trigger(Z,n)})),(0,o.detach)(r)}}))},t.prototype.uploadMethod=function(e,t){var n=this,i=!1,r=this,s=this.parent.createElement("div");this.parent.rootContainer.appendChild(s);var a=this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"}});this.popupObj=new Wr.Popup(s,{relateTo:t,height:"85px",width:"300px",collision:{X:"fit",Y:"fit"},content:a,viewPortElement:this.parent.contentModule.getPanel(),position:{X:"center",Y:"top"},enableRtl:this.parent.enableRtl,zIndex:10001,close:function(e){n.parent.isBlur=!1,n.popupObj.destroy(),(0,o.detach)(n.popupObj.element),n.popupObj=null,n.parent.inlineMode.enable||n.parent.toolbarModule.baseToolbar.toolbarObj.disable(!1)}}),this.popupObj.element.style.display="none",(0,o.addClass)([this.popupObj.element],ao),(0,o.addClass)([this.popupObj.element],so),(0,o.isNullOrUndefined)(this.parent.cssClass)||(0,o.addClass)([this.popupObj.element],this.parent.cssClass.replace(/\s+/g," ").trim().split(" "));var l=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),d=e.dataTransfer.files[0].size>1e6?300:100;this.imageDragPopupTime=setTimeout((function(){r.refreshPopup(t)}),d),this.uploadObj=new Qr.Uploader({asyncSettings:{saveUrl:this.parent.insertImageSettings.saveUrl,removeUrl:this.parent.insertImageSettings.removeUrl},cssClass:uo+this.parent.getCssClass(!0),dropArea:this.parent.element,allowedExtensions:this.parent.insertImageSettings.allowedTypes.toString(),removing:function(){n.parent.inputElement.contentEditable="true",i=!1,(0,o.detach)(t),n.popupObj.close()},canceling:function(){n.parent.inputElement.contentEditable="true",i=!1,(0,o.detach)(t),n.popupObj.close(),n.quickToolObj.imageQTBar.hidePopup(),n.uploadCancelTime=setTimeout((function(){n.uploadObj.destroy()}),900)},beforeUpload:function(e){n.parent.trigger(Et,e),n.parent.inlineMode.enable||n.parent.toolbarModule.baseToolbar.toolbarObj.disable(!0)},uploading:function(e){n.parent.isServerRendered||(i=!0,n.parent.trigger(lt,e,(function(e){e.cancel?((0,o.isNullOrUndefined)(t)||(0,o.detach)(t),(0,o.isNullOrUndefined)(n.popupObj.element)||(0,o.detach)(n.popupObj.element)):n.parent.inputElement.contentEditable="false"})))},selected:function(e){i&&(e.cancel=!0)},failure:function(o){i=!1,n.parent.inputElement.contentEditable="true";var r={args:e,type:"Images",isNotify:void 0,elements:t};n.uploadFailureTime=setTimeout((function(){n.uploadFailure(t,r,o)}),900)},success:function(o){if("cancel"!==o.operation){i=!1,n.parent.inputElement.contentEditable="true";var r={args:e,type:"Images",isNotify:void 0,elements:t};n.uploadSuccessTime=setTimeout((function(){n.uploadSuccess(t,e,r,o)}),900)}}}),this.uploadObj.appendTo(this.popupObj.element.childNodes[0]),this.popupObj.element.querySelector(".e-rte-dialog-upload .e-file-select-wrap").style.display="none",l.selectNodeContents(t),this.parent.formatter.editorManager.nodeSelection.setRange(this.contentModule.getDocument(),l)},t.prototype.refreshPopup=function(e){(this.parent.iframeSettings.enable?this.parent.element.offsetTop+e.offsetTop:e.offsetTop)>this.parent.element.offsetTop+this.parent.element.offsetHeight?(this.popupObj.relateTo=this.parent.inputElement,this.popupObj.offsetY=this.parent.iframeSettings.enable?-30:-65,this.popupObj.element.style.display="block"):this.popupObj&&(this.popupObj.refreshPosition(e),this.popupObj.element.style.display="block")},t.prototype.uploadFailure=function(e,t,n){(0,o.detach)(e),this.popupObj&&this.popupObj.close(),this.parent.trigger(ct,n),this.uploadObj.destroy()},t.prototype.uploadSuccess=function(e,t,n,r){var s=this;e.style.opacity="1",e.classList.add(no),r.element=e,r.detectImageSource=i.Dropped,this.parent.trigger(dt,r,(function(t){if(!(0,o.isNullOrUndefined)(s.parent.insertImageSettings.path)){var n=s.parent.insertImageSettings.path+t.file.name;e.src=n,e.setAttribute("alt",t.file.name)}})),this.popupObj&&(this.popupObj.close(),this.uploadObj.destroy()),this.showImageQuickToolbar(n),this.resizeStart(t,e)},t.prototype.imagePaste=function(e){var t=this;if(0===e.text.length&&!(0,o.isNullOrUndefined)(e.file)){var n=this,i=new FileReader;e.args.preventDefault(),i.addEventListener("load",(function(r){var s={cssClass:"inline"===n.parent.insertImageSettings.display?li:$n,url:"Base64"!==t.parent.insertImageSettings.saveFormat&&(0,o.isNullOrUndefined)(e.callBack)?URL.createObjectURL(Ir(i.result)):i.result,width:{width:n.parent.insertImageSettings.width,minWidth:n.parent.insertImageSettings.minWidth,maxWidth:n.parent.getInsertImgMaxWidth()},height:{height:n.parent.insertImageSettings.height,minHeight:n.parent.insertImageSettings.minHeight,maxHeight:n.parent.insertImageSettings.maxHeight}};(0,o.isNullOrUndefined)(e.callBack)?(n.parent.formatter.process(n.parent,{item:{command:"Images",subCommand:"Image"}},e.args,s),t.showPopupToolBar(e,s)):e.callBack(s)})),i.readAsDataURL(e.file)}},t.prototype.showPopupToolBar=function(t,n){var i=this,o='img[src="'+n.url+'"]',r=this.parent.inputElement.querySelector(o);this.parent.quickToolbarModule.createQTBar("Image","MultiRow",this.parent.quickToolbarSettings.image,e.ImageToolbar);var s={args:t.args,type:"Images",isNotify:void 0,elements:r};r&&(this.showImageQTbarTime=setTimeout((function(){i.showImageQuickToolbar(s),i.parent.insertImageSettings.resize&&i.resizeStart(t.args,r)}),0))},t.prototype.destroy=function(){this.isDestroyed||(this.prevSelectedImgEle=void 0,(0,o.isNullOrUndefined)(this.imageQTPopupTime)||(clearTimeout(this.imageQTPopupTime),this.imageQTPopupTime=null),(0,o.isNullOrUndefined)(this.imageDragPopupTime)||(clearTimeout(this.imageDragPopupTime),this.imageDragPopupTime=null),(0,o.isNullOrUndefined)(this.uploadCancelTime)||(clearTimeout(this.uploadCancelTime),this.uploadCancelTime=null),(0,o.isNullOrUndefined)(this.uploadFailureTime)||(clearTimeout(this.uploadFailureTime),this.uploadFailureTime=null),(0,o.isNullOrUndefined)(this.showImageQTbarTime)||(clearTimeout(this.showImageQTbarTime),this.showImageQTbarTime=null),(0,o.isNullOrUndefined)(this.uploadSuccessTime)||(clearTimeout(this.uploadSuccessTime),this.uploadSuccessTime=null),this.removeEventListener(),this.clearDialogObj(),this.cancelResizeAction(),this.isDestroyed=!0)},t.prototype.getModuleName=function(){return"image"},t}(),ml=function(){function t(e,t){this.isAudioUploaded=!1,this.isAllowedTypes=!0,this.deletedAudio=[],this.parent=e,this.rteID=e.element.id,this.i10n=t.getService("rteLocale"),this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.docClick=this.onDocumentClick.bind(this),this.isDestroyed=!1}return t.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(k,this.onKeyDown,this),this.parent.on(L,this.onKeyUp,this),this.parent.on(oe,this.insertingAudio,this),this.parent.on(u,this.afterRender,this),this.parent.on(kt,this.afterRender,this),this.parent.on(Rt,this.showDialog,this),this.parent.on(Pt,this.closeDialog,this),this.parent.on(j,this.onToolbarAction,this),this.parent.on(I,this.alignmentSelect,this),this.parent.on(fe,this.deleteAudio,this),this.parent.on(Ae,this.editAreaClickHandler,this),this.parent.on(se,this.showAudioQuickToolbar,this),this.parent.on(f,this.destroy,this),this.parent.on(m,this.closeDialog,this))},t.prototype.removeEventListener=function(){this.parent.off(k,this.onKeyDown),this.parent.off(L,this.onKeyUp),this.parent.off(oe,this.insertingAudio),this.parent.off(u,this.afterRender),this.parent.off(kt,this.afterRender),this.parent.off(Rt,this.showDialog),this.parent.off(Pt,this.closeDialog),this.parent.off(j,this.onToolbarAction),this.parent.off(I,this.alignmentSelect),this.parent.off(fe,this.deleteAudio),this.parent.off(Ae,this.editAreaClickHandler),this.parent.off(se,this.showAudioQuickToolbar),this.parent.off(f,this.destroy),this.parent.off(m,this.closeDialog),(0,o.isNullOrUndefined)(this.contentModule)||(o.EventHandler.remove(this.parent.contentModule.getEditPanel(),o.Browser.touchStartEvent,this.touchStart),o.EventHandler.remove(this.contentModule.getEditPanel(),o.Browser.touchEndEvent,this.audioClick),this.parent.element.ownerDocument.removeEventListener("mousedown",this.docClick),this.docClick=null)},t.prototype.afterRender=function(){this.contentModule=this.rendererFactory.getRenderer(e.Content),o.EventHandler.add(this.parent.contentModule.getEditPanel(),o.Browser.touchStartEvent,this.touchStart,this),o.EventHandler.add(this.contentModule.getEditPanel(),o.Browser.touchEndEvent,this.audioClick,this),this.parent.element.ownerDocument.addEventListener("mousedown",this.docClick)},t.prototype.checkAudioBack=function(e){"#text"===e.startContainer.nodeName&&0===e.startOffset&&!(0,o.isNullOrUndefined)(e.startContainer.previousSibling)&&this.isAudioElem(e.startContainer.previousSibling)?this.deletedAudio.push(e.startContainer.previousSibling):"#text"!==e.startContainer.nodeName&&!(0,o.isNullOrUndefined)(e.startContainer.childNodes[e.startOffset-1])&&this.isAudioElem(e.startContainer.childNodes[e.startOffset-1])&&this.deletedAudio.push(e.startContainer.childNodes[e.startOffset-1])},t.prototype.checkAudioDel=function(e){"#text"!==e.startContainer.nodeName||e.startOffset!==e.startContainer.textContent.length||(0,o.isNullOrUndefined)(e.startContainer.nextSibling)||"AUDIO"!==e.startContainer.nextSibling.nodeName?"#text"!==e.startContainer.nodeName&&!(0,o.isNullOrUndefined)(e.startContainer.childNodes[e.startOffset])&&this.isAudioElem(e.startContainer.childNodes[e.startOffset])&&this.deletedAudio.push(e.startContainer.childNodes[e.startOffset]):this.deletedAudio.push(e.startContainer.nextSibling)},t.prototype.undoStack=function(e){if(("undo"===e.subCommand.toLowerCase()||"redo"===e.subCommand.toLowerCase())&&"HTML"===this.parent.editorMode)for(var t=0;t<this.parent.formatter.getUndoRedoStack().length;t++){var n=this.parent.createElement("div"),i=this.parent.formatter.getUndoRedoStack()[t].text;n.appendChild(i.cloneNode(!0))}},t.prototype.touchStart=function(e,t){this.parent.readonly||(this.prevSelectedAudEle=this.audEle)},t.prototype.onToolbarAction=function(e){switch(Us()&&this.parent.notify(Oe,{}),e.args.item.subCommand){case"AudioReplace":this.parent.notify(oe,e);break;case"AudioRemove":this.parent.notify(fe,e)}},t.prototype.onKeyUp=function(e){if(!(0,o.isNullOrUndefined)(this.deletedAudio)&&this.deletedAudio.length>0)for(var t=0;t<this.deletedAudio.length;t++){var n=this.deletedAudio[t],i="SOURCE"===n.tagName?n:n.querySelector("source"),r={element:this.deletedAudio[t].querySelector("audio"),src:i.getAttribute("src")};this.parent.trigger(vt,r)}},t.prototype.onKeyDown=function(e){var t,n,i,r,s,a=e.args;this.deletedAudio=[];if("HTML"===this.parent.editorMode&&(s=(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())).startContainer===t.endContainer&&t.startOffset===t.endOffset),!s&&"HTML"===this.parent.editorMode&&[27,112,113,114,115,116,117,118,119,120,121,122,123,44,45,9,16,17,18,19,20,33,34,35,36,37,38,39,40,91,92,93,144,145,182,183].indexOf(a.which)<0)for(var l=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),d=0;d<l.length;d++)this.isAudioElem(l[d])&&this.deletedAudio.push(l[d]);if("HTML"===this.parent.editorMode&&(8===a.which&&"Backspace"===a.code||46===a.which&&"Delete"===a.code)){var c=t.startContainer===t.endContainer&&t.startOffset===t.endOffset;8===a.which&&"Backspace"===a.code&&c?this.checkAudioBack(t):46===a.which&&"Delete"===a.code&&c&&this.checkAudioDel(t)}if(!(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)&&"KeyK"!==a.code&&(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),r=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t),!a.ctrlKey&&a.key&&(1===a.key.length||"enter"===a.action)&&this.isAudioElem(r[0])&&r[0].parentElement)){var h=r[0].parentElement.childNodes[0];this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),h,h,h.textContent.length,h.textContent.length),(0,o.removeClass)([r[0]],io),this.quickToolObj.audioQTBar.hidePopup()}if(!a.ctrlKey||89!==a.keyCode&&90!==a.keyCode||this.undoStack({subCommand:90===a.keyCode?"undo":"redo"}),(8===a.keyCode||46===a.keyCode)&&i&&(this.isAudioElem(i[0])||46===a.keyCode&&i[0].nextSibling&&this.isAudioElem(i[0].nextSibling)||8===a.keyCode&&i[0].previousSibling&&this.isAudioElem(i[0].previousSibling))&&i.length<=2){(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)||(n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument())),a.preventDefault();var p={selectNode:i,selection:n,selectParent:r,args:{item:{command:"Audios",subCommand:"AudioRemove"},originalEvent:a}};this.deleteAudio(p,a.keyCode)}switch(a.action){case"escape":(0,o.isNullOrUndefined)(this.dialogObj)||this.dialogObj.close();break;case"backspace":case"delete":for(d=0;d<this.deletedAudio.length;d++){var u=this.deletedAudio[d].src;this.audioRemovePost(u)}"Markdown"!==this.parent.editorMode&&(3===t.startContainer.nodeType?"Backspace"===a.code?t.startContainer.previousElementSibling&&0===t.startOffset&&t.startContainer.previousElementSibling.classList.contains(ni)&&(0,o.detach)(t.startContainer.previousElementSibling):t.startContainer.nextElementSibling&&t.endContainer.textContent.length===t.endOffset&&t.startContainer.nextElementSibling.classList.contains(ni)&&(0,o.detach)(t.startContainer.nextElementSibling):1===t.startContainer.nodeType&&t.startContainer.classList&&(t.startContainer.classList.contains(ni)||t.startContainer.classList.contains(ei)||t.startContainer.classList.contains(ti))&&(0,o.detach)(t.startContainer));break;case"insert-audio":(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)||(n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument())),this.openDialog(!0,a,n,i,r),a.preventDefault()}a.ctrlKey&&"a"===a.key&&this.handleSelectAll()},t.prototype.handleSelectAll=function(){var e=this.parent.inputElement.querySelectorAll("."+io);(0,o.removeClass)(e,io)},t.prototype.openDialog=function(e,t,n,i,r){var s,a,l,d;e||(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)?(a=n,l=i,d=r):(s=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),a=this.parent.formatter.editorManager.nodeSelection.save(s,this.parent.contentModule.getDocument()),l=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(s),d=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(s)),"HTML"===this.parent.editorMode&&this.insertAudio({args:{item:{command:"Audios",subCommand:"Audio"},originalEvent:t,name:e?null:"showDialog"},selectNode:l,selection:a,selectParent:d})},t.prototype.showDialog=function(e){(0,o.isNullOrUndefined)(e.originalEvent)?this.openDialog(!1):this.openDialog(!1,e.originalEvent)},t.prototype.closeDialog=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},t.prototype.deleteAudio=function(e,t){if(this.isAudioElem(e.selectNode[0])){this.audEle&&(3===e.selectNode[0].nodeType?e.selectNode[0]=this.audEle:this.isAudioElem(e.selectNode[0])&&(e.selectNode[0]=e.selectNode[0].classList.contains(ni)?e.selectNode[0]:e.selectNode[0].parentElement));var n={element:e.selectNode[0].querySelector("audio"),src:e.selectNode[0].querySelector("source").getAttribute("src")};0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),e.selection.restore(),this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.audioRemovePost(n.src),this.quickToolObj&&document.body.contains(this.quickToolObj.audioQTBar.element)&&this.quickToolObj.audioQTBar.hidePopup(),(0,o.isNullOrUndefined)(t)&&this.parent.trigger(vt,n)}},t.prototype.audioRemovePost=function(e){var t=this,n="";if(!(0,o.isNullOrUndefined)(this.parent.insertAudioSettings.removeUrl)&&""!==this.parent.insertAudioSettings.removeUrl){n=e.indexOf("http://")>-1||e.indexOf("https://")>-1?e:new URL(e,document.baseURI).href,this.removingAudioName=n.replace(/^.*[\\/]/,"");var i=new XMLHttpRequest;i.addEventListener("readystatechange",(function(){4===this.readyState&&200===this.status&&t.triggerPost(this.response)})),i.open("GET",n),i.responseType="blob",i.send()}},t.prototype.triggerPost=function(e){var t=this.parent.insertAudioSettings.removeUrl;if(!(0,o.isNullOrUndefined)(t)&&""!==t){var n=new File([e],this.removingAudioName),i=new o.Ajax(t,"POST",!0,null),r=new FormData;r.append("UploadFiles",n),i.send(r)}},t.prototype.audioClick=function(e){o.Browser.isDevice&&(this.isAudioElem(e.target)?(this.contentModule.getEditPanel().setAttribute("contenteditable","false"),e.target.focus()):this.parent.readonly||this.contentModule.getEditPanel().setAttribute("contenteditable","true")),this.isAudioElem(e.target)&&!this.parent.userAgentData.isSafari()&&(this.audEle=e.target.querySelector("audio"),e.preventDefault())},t.prototype.onDocumentClick=function(e){var t=e.target;(0,o.isNullOrUndefined)(this.contentModule.getEditPanel())||(this.isAudioElem(t)&&(this.audEle=t.querySelector("audio")),!(0,o.isNullOrUndefined)(this.dialogObj)&&(!(0,o.closest)(t,"[id='"+this.dialogObj.element.id+"']")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!(0,o.closest)(t,"#"+this.parent.getID()+"_toolbar_Audio")&&!t.querySelector("#"+this.parent.getID()+"_toolbar_Audio"))&&(e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.notify(Yt,{closedBy:"outside click"}),this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,Tr(this.parent.element,"focusout"))),this.contentModule.getEditPanel().querySelector("."+io)&&(this.isAudioElem(e.target)||(0,o.isNullOrUndefined)(this.audEle)?(0,o.isNullOrUndefined)(this.prevSelectedAudEle)||this.prevSelectedAudEle===t||(this.prevSelectedAudEle.style.outline=""):this.audEle.style.outline=""),this.parent.inlineMode.enable&&t&&this.dialogObj&&!(0,o.closest)(t,"#"+this.dialogObj.element.id)&&this.dialogObj.hide())},t.prototype.alignmentSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Audios"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n);this.audEle&&(i=[this.audEle]);var r={args:e,selectNode:i};switch(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.subCommand){case"Inline":this.inline(r);break;case"Break":this.break(r)}this.quickToolObj&&document.body.contains(this.quickToolObj.audioQTBar.element)&&(this.quickToolObj.audioQTBar.hidePopup(),(0,o.removeClass)([i[0]],io))}},t.prototype.break=function(e){if("AUDIO"===e.selectNode[0].nodeName){var t=e.args.item&&e.args.item.subCommand?e.args.item.subCommand:"Break";this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t})}},t.prototype.inline=function(e){if("AUDIO"===e.selectNode[0].nodeName){var t=e.args.item&&e.args.item.subCommand?e.args.item.subCommand:"Inline";this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t})}},t.prototype.editAreaClickHandler=function(t){if(this.parent.readonly)this.hideAudioQuickToolbar();else{var n=t.args,i=this.parent.quickToolbarSettings.showOnRightClick;if(2===n.which||i&&1===n.which||!i&&3===n.which)i&&1===n.which&&!(0,o.isNullOrUndefined)(n.target)&&this.isAudioElem(n.target)&&(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),n.target));else if("HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.audioQTBar){this.quickToolObj=this.parent.quickToolbarModule;var r=n.target;this.contentModule=this.rendererFactory.getRenderer(e.Content);var s=this.quickToolObj.audioQTBar.element.classList.contains("e-rte-pop");if(this.isAudioElem(r)&&this.parent.quickToolbarModule){if(s)return;this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),r),Us()&&this.parent.notify(Te,t),r.querySelector("audio")&&(r.querySelector("audio").style.outline="2px solid #4a90e2"),this.showAudioQuickToolbar({args:n,type:"Audios",elements:[n.target]})}else this.hideAudioQuickToolbar()}}},t.prototype.isAudioElem=function(e){return!!(e&&3!==e.nodeType&&"BR"!==e.nodeName&&e.classList&&(e.classList.contains(ni)||e.classList.contains("e-rte-audio")||e.classList.contains(ei)))},t.prototype.showAudioQuickToolbar=function(e){var t=this;if(!("Audios"!==e.type||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule)||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule.audioQTBar)||(0,o.isNullOrUndefined)(e.args))){this.quickToolObj=this.parent.quickToolbarModule;var n=e.args,i=e.elements;if([].forEach.call(e.elements,(function(e,t){0===t&&(i=e)})),this.isAudioElem(i)){var r="AUDIO"===i.tagName?i:i.querySelector("audio");(0,o.addClass)([r],[io]),r.style.outline="2px solid #4a90e2"}this.parent.quickToolbarModule.audioQTBar&&(e.isNotify?this.showPopupTime=setTimeout((function(){t.parent.formatter.editorManager.nodeSelection.Clear(t.contentModule.getDocument()),t.parent.formatter.editorManager.nodeSelection.setSelectionContents(t.contentModule.getDocument(),i),t.quickToolObj.audioQTBar.showPopup(n.pageX-50,i.getBoundingClientRect().top+34,i)}),400):this.quickToolObj.audioQTBar.showPopup(n.pageX-50,i.getBoundingClientRect().top+34,i))}},t.prototype.hideAudioQuickToolbar=function(){(0,o.isNullOrUndefined)(this.contentModule.getEditPanel().querySelector("."+io))||((0,o.removeClass)([this.contentModule.getEditPanel().querySelector("."+io)],io),(0,o.isNullOrUndefined)(this.audEle)||(this.audEle.style.outline=""),this.quickToolObj&&this.quickToolObj.audioQTBar&&document.body.contains(this.quickToolObj.audioQTBar.element)&&this.quickToolObj.audioQTBar.hidePopup())},t.prototype.insertingAudio=function(e){if(this.insertAudio(e),!(0,o.isNullOrUndefined)(this.dialogObj)){this.dialogObj.element.style.maxHeight="inherit";var t=this.dialogObj.element.querySelector(".e-audio-content");(0,o.isNullOrUndefined)(this.parent.insertAudioSettings.path)&&"HTML"!==this.parent.editorMode?t.querySelector(".e-audio-url").focus():document.getElementById(this.rteID+"_insertAudio").focus()}},t.prototype.clearDialogObj=function(){this.uploadObj&&!this.uploadObj.isDestroyed&&(this.uploadObj.destroy(),(0,o.detach)(this.uploadObj.element),this.uploadObj=null),this.button&&!this.button.isDestroyed&&(this.button.destroy(),(0,o.detach)(this.button.element),this.button=null),this.dialogObj&&!this.dialogObj.isDestroyed&&(this.dialogObj.destroy(),(0,o.detach)(this.dialogObj.element),this.dialogObj=null)},t.prototype.insertAudio=function(e){var t=this;if(this.dialogObj)this.dialogObj.hide({returnValue:!0});else{var n=this.parent.createElement("div",{className:"e-rte-audio-dialog",id:this.rteID+"_audio"});this.parent.rootContainer.appendChild(n);var i=this.i10n.getConstant("dialogInsert"),r=this.i10n.getConstant("dialogCancel"),s=this.i10n.getConstant("audioHeader"),a=e.selection,l={selfAudio:this,selection:e.selection,args:e.args,selectParent:e.selectParent},d={header:s,cssClass:bi,enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:o.Browser.isDevice?"290px":"340px",isModal:o.Browser.isDevice,buttons:[{click:this.insertAudioUrl.bind(l),buttonModel:{content:i,cssClass:"e-flat e-insertAudio",isPrimary:!0,disabled:!0}},{click:function(e){t.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel",content:r}}],target:o.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){t.isAudioUploaded&&(t.dialogObj.element.querySelector(".e-file-abort-btn")?t.dialogObj.element.querySelector(".e-file-abort-btn").click():t.uploadObj.remove()),t.parent.isBlur=!1,e&&!(0,o.isNullOrUndefined)(e.event)&&e.event.returnValue&&"HTML"===t.parent.editorMode&&a.restore(),t.clearDialogObj(),t.dialogRenderObj.close(e)}},c=this.parent.createElement("div",{className:"e-audio-content"});(0,o.isNullOrUndefined)(this.parent.insertAudioSettings.path)&&"HTML"!==this.parent.editorMode||c.appendChild(this.audioUpload(e));var h=this.parent.createElement("div",{className:"e-audioheader"}),p=this.i10n.getConstant("audioLinkHeader");"HTML"===this.parent.editorMode&&(h.innerHTML=p),c.appendChild(h),c.appendChild(this.audioUrlPopup(e)),e.selectNode&&1===e.selectNode[0].nodeType&&this.isAudioElem(e.selectNode[0])?(d.header=this.parent.localeObj.getConstant("editAudioHeader"),d.content=c):d.content=c,this.dialogObj=this.dialogRenderObj.render(d),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(n),e.selectNode&&1===e.selectNode[0].nodeType&&this.isAudioElem(e.selectNode[0])&&"insertAudio"===e.name&&(this.dialogObj.element.querySelector(".e-insertAudio").textContent=this.parent.localeObj.getConstant("dialogUpdate")),n.style.maxHeight="inherit",this.quickToolObj&&(this.quickToolObj.audioQTBar&&document.body.contains(this.quickToolObj.audioQTBar.element)&&this.quickToolObj.audioQTBar.hidePopup(),this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj.textQTBar&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup())}},t.prototype.audioUrlPopup=function(e){var t=this,n=this.parent.createElement("div",{className:"audioUrl"}),i=this.i10n.getConstant("audioUrl");if(this.inputUrl=this.parent.createElement("input",{className:"e-input e-audio-url",attrs:{placeholder:i,spellcheck:"false","aria-label":this.i10n.getConstant("audioLinkHeader")}}),this.inputUrl.addEventListener("input",(function(){(0,o.isNullOrUndefined)(t.inputUrl)||(0===t.inputUrl.value.length?t.dialogObj.getButtons(0).element.disabled=!0:t.dialogObj.getButtons(0).element.removeAttribute("disabled"))})),e.selectNode&&this.isAudioElem(e.selectNode[0])){var r=new RegExp(/([^\S]|^)(((https?:\/\/)|(www\.))(\S+))/gi),s=e.selectNode[0].querySelector("source");this.inputUrl.value=s.src.match(r)?s.src:""}return n.appendChild(this.inputUrl),n},t.prototype.audioUpload=function(e){var t,n,i=this,r=this,s=r.parent.iframeSettings.enable;if("HTML"===r.parent.editorMode&&(!s&&(0,o.isNullOrUndefined)((0,o.closest)(e.selection.range.startContainer.parentNode,"[id='"+this.parent.contentModule.getPanel().id+"']"))||s&&!ur(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body"),"e-lib"))){this.contentModule.getEditPanel().focus();var a=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());t=this.parent.formatter.editorManager.nodeSelection.save(a,this.parent.contentModule.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(a)}else t=e.selection,n=e.selectParent;var l=this.parent.createElement("div",{className:"e-aud-uploadwrap e-droparea"}),d=this.i10n.getConstant("audioDeviceUploadMessage"),c=this.i10n.getConstant("audioUploadMessage"),h=this.parent.createElement("span",{className:"e-droptext"}),p=this.parent.createElement("span",{className:"e-rte-upload-text",innerHTML:o.Browser.isDevice?d:c});h.appendChild(p);var u=this.parent.createElement("button",{className:"e-browsebtn",id:this.rteID+"_insertAudio",attrs:{autofocus:"true",type:"button"}});h.appendChild(u),l.appendChild(h);var m=this.i10n.getConstant("browse");this.button=new hl.Button({content:m,enableRtl:this.parent.enableRtl}),this.button.isStringTemplate=!0,this.button.createElement=this.parent.createElement,this.button.appendTo(u);var f=o.Browser.isDevice?h:u;o.EventHandler.add(f,"click",this.fileSelect,this);var g,b,v=this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"}});return l.appendChild(v),this.uploadObj=new Qr.Uploader({asyncSettings:{saveUrl:this.parent.insertAudioSettings.saveUrl,removeUrl:this.parent.insertAudioSettings.removeUrl},dropArea:h,multiple:!1,enableRtl:this.parent.enableRtl,allowedExtensions:this.parent.insertAudioSettings.allowedTypes.toString(),selected:function(e){r.isAudioUploaded=!0,b=e,e.filesData,i.parent.trigger(pt,b,(function(e){if(!e.cancel){if((0,o.isNullOrUndefined)(e.filesData[0]))return;if(i.checkExtension(e.filesData[0]),g=e.filesData[0].name,"HTML"===i.parent.editorMode&&(0,o.isNullOrUndefined)(i.parent.insertAudioSettings.path)){var s=new FileReader;s.addEventListener("load",(function(e){var a="Base64"===i.parent.insertAudioSettings.saveFormat?s.result:URL.createObjectURL(Ir(s.result));r.uploadUrl={url:a,selection:t,fileName:g,selectParent:n},r.inputUrl.setAttribute("disabled","true"),(0,o.isNullOrUndefined)(r.parent.insertAudioSettings.saveUrl)&&i.isAllowedTypes&&!(0,o.isNullOrUndefined)(i.dialogObj)&&i.dialogObj.getButtons(0).element.removeAttribute("disabled")})),s.readAsDataURL(e.filesData[0].rawFile)}}}))},beforeUpload:function(e){i.parent.trigger(St,e)},uploading:function(e){i.parent.isServerRendered||i.parent.trigger(ut,e)},success:function(e){i.parent.trigger(mt,e,(function(e){if(!(0,o.isNullOrUndefined)(i.parent.insertAudioSettings.path)){var s=i.parent.insertAudioSettings.path+e.file.name;r.uploadUrl={url:s,selection:t,fileName:g,selectParent:n},r.inputUrl.setAttribute("disabled","true")}"upload"!==e.operation||(0,o.isNullOrUndefined)(i.dialogObj)||i.dialogObj.getButtons(0).element.removeAttribute("disabled")}))},failure:function(e){i.parent.trigger(ft,e)},removing:function(){i.parent.trigger(gt,e,(function(e){r.isAudioUploaded=!1,i.dialogObj.getButtons(0).element.disabled=!0,r.inputUrl.removeAttribute("disabled"),r.uploadUrl&&(r.uploadUrl.url="")}))}}),this.uploadObj.isStringTemplate=!0,this.uploadObj.createElement=this.parent.createElement,this.uploadObj.appendTo(v),l},t.prototype.checkExtension=function(e){this.uploadObj.allowedExtensions&&(-1===this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(("."+e.type).toLocaleLowerCase())?(this.dialogObj.getButtons(0).element.setAttribute("disabled","disabled"),this.isAllowedTypes=!1):this.isAllowedTypes=!0)},t.prototype.fileSelect=function(){return this.dialogObj.element.getElementsByClassName("e-file-select-wrap")[0].querySelector("button").click(),!1},t.prototype.cancelDialog=function(e){this.parent.isBlur=!1,this.dialogObj.hide({returnValue:!0}),this.isAudioUploaded&&this.uploadObj.removing()},t.prototype.insertAudioUrl=function(e){var t=this.selfAudio;t.isAudioUploaded=!1;var n=t.inputUrl.value;if(0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData(),(0,o.isNullOrUndefined)(t.uploadUrl)||""===t.uploadUrl.url){if(""!==n){if("HTML"===t.parent.editorMode&&(0,o.isNullOrUndefined)((0,o.closest)(this.selection.range.startContainer.parentNode,"[id='"+t.contentModule.getPanel().id+"']"))&&!t.parent.iframeSettings.enable){t.contentModule.getEditPanel().focus();var i=t.parent.formatter.editorManager.nodeSelection.getRange(t.contentModule.getDocument());this.selection=t.parent.formatter.editorManager.nodeSelection.save(i,t.contentModule.getDocument()),this.selectParent=t.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(i)}var r="HTML"===t.parent.editorMode?n.split("/")[n.split("/").length-1]:"",s={cssClass:"Inline"===t.parent.insertAudioSettings.layoutOption?di:Zn,url:n,selection:this.selection,fileName:r,selectParent:this.selectParent};if(t.dialogObj.hide({returnValue:!1}),null!==t.dialogObj)return;t.parent.formatter.process(t.parent,this.args,this.args.originalEvent,s)}}else{if(t.uploadUrl.cssClass="Inline"===t.parent.insertAudioSettings.layoutOption?di:Zn,t.dialogObj.hide({returnValue:!1}),null!==t.dialogObj)return;t.parent.formatter.process(t.parent,this.args,this.args.originalEvent,t.uploadUrl),t.uploadUrl.url=""}},t.prototype.destroy=function(){this.isDestroyed||(this.prevSelectedAudEle=void 0,this.showPopupTime&&(clearTimeout(this.showPopupTime),this.showPopupTime=null),this.removeEventListener(),this.clearDialogObj(),this.isDestroyed=!0)},t.prototype.getModuleName=function(){return"audio"},t}(),fl=function(){function t(e,t){this.isVideoUploaded=!1,this.isAllowedTypes=!0,this.pageX=null,this.pageY=null,this.mouseX=null,this.deletedVid=[],this.isResizeBind=!0,this.parent=e,this.rteID=e.element.id,this.i10n=t.getService("rteLocale"),this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.isDestroyed=!1,this.docClick=this.onDocumentClick.bind(this)}return t.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(k,this.onKeyDown,this),this.parent.on(L,this.onKeyUp,this),this.parent.on(re,this.insertingVideo,this),this.parent.on(u,this.afterRender,this),this.parent.on(kt,this.afterRender,this),this.parent.on(z,this.onWindowResize,this),this.parent.on(It,this.showDialog,this),this.parent.on(Ht,this.closeDialog,this),this.parent.on(I,this.alignmentSelect,this),this.parent.on(ge,this.deleteVideo,this),this.parent.on(F,this.onToolbarAction,this),this.parent.on(Ae,this.editAreaClickHandler,this),this.parent.on(m,this.onIframeMouseDown,this),this.parent.on(ye,this.videoSize,this),this.parent.on(se,this.showVideoQuickToolbar,this),this.parent.on($e,this.clearDialogObj,this),this.parent.on(f,this.destroy,this))},t.prototype.removeEventListener=function(){this.parent.off(k,this.onKeyDown),this.parent.off(L,this.onKeyUp),this.parent.off(re,this.insertingVideo),this.parent.off(z,this.onWindowResize),this.parent.off(u,this.afterRender),this.parent.off(kt,this.afterRender),this.parent.off(It,this.showDialog),this.parent.off(Ht,this.closeDialog),this.parent.off(I,this.alignmentSelect),this.parent.off(ge,this.deleteVideo),this.parent.off(F,this.onToolbarAction),this.parent.off(Ae,this.editAreaClickHandler),this.parent.off(m,this.onIframeMouseDown),this.parent.off(ye,this.videoSize),this.parent.off(se,this.showVideoQuickToolbar),this.parent.off($e,this.clearDialogObj),this.parent.off(f,this.destroy),(0,o.isNullOrUndefined)(this.contentModule)||(o.EventHandler.remove(this.contentModule.getEditPanel(),o.Browser.touchEndEvent,this.videoClick),this.parent.formatter.editorManager.observer.off(Ke,this.undoStack),this.parent.insertVideoSettings.resize&&(o.EventHandler.remove(this.parent.contentModule.getEditPanel(),o.Browser.touchStartEvent,this.resizeStart),this.parent.element.ownerDocument.removeEventListener("mousedown",this.docClick),this.docClick=null,o.EventHandler.remove(this.contentModule.getEditPanel(),"cut",this.onCutHandler),o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchMoveEvent,this.resizing)))},t.prototype.afterRender=function(){this.contentModule=this.rendererFactory.getRenderer(e.Content),o.EventHandler.add(this.contentModule.getEditPanel(),o.Browser.touchEndEvent,this.videoClick,this),this.parent.insertVideoSettings.resize&&(o.EventHandler.add(this.parent.contentModule.getEditPanel(),o.Browser.touchStartEvent,this.resizeStart,this),this.parent.element.ownerDocument.addEventListener("mousedown",this.docClick),o.EventHandler.add(this.contentModule.getEditPanel(),"cut",this.onCutHandler,this))},t.prototype.clearDialogObj=function(){this.uploadObj&&!this.uploadObj.isDestroyed&&(this.uploadObj.destroy(),(0,o.detach)(this.uploadObj.element),this.uploadObj=null),this.webUrlBtn&&!this.webUrlBtn.isDestroyed&&(this.webUrlBtn.destroy(),(0,o.detach)(this.webUrlBtn.element),this.webUrlBtn=null),this.embedUrlBtn&&!this.embedUrlBtn.isDestroyed&&(this.embedUrlBtn.destroy(),(0,o.detach)(this.embedUrlBtn.element),this.embedUrlBtn=null),this.widthNum&&!this.widthNum.isDestroyed&&(this.widthNum.destroy(),(0,o.detach)(this.widthNum.element),this.widthNum=null),this.heightNum&&!this.heightNum.isDestroyed&&(this.heightNum.destroy(),(0,o.detach)(this.heightNum.element),this.heightNum=null),this.button&&!this.button.isDestroyed&&(this.button.destroy(),(0,o.detach)(this.button.element),this.heightNum=null),this.dialogObj&&this.dialogObj.element&&(this.dialogObj.destroy(),(0,o.detach)(this.dialogObj.element),this.dialogObj=null)},t.prototype.onKeyUp=function(e){if(!(0,o.isNullOrUndefined)(this.deletedVid)&&this.deletedVid.length>0)for(var t=0;t<this.deletedVid.length;t++){var n={element:this.deletedVid[t],src:"IFRAME"!==this.deletedVid[t].tagName?this.deletedVid[t].querySelector("source").getAttribute("src"):this.deletedVid[t].src};this.parent.trigger(vt,n)}},t.prototype.undoStack=function(e){if(("undo"===e.subCommand.toLowerCase()||"redo"===e.subCommand.toLowerCase())&&"HTML"===this.parent.editorMode)for(var t=0;t<this.parent.formatter.getUndoRedoStack().length;t++){var n=this.parent.createElement("div"),i=this.parent.formatter.getUndoRedoStack()[t].text;n.appendChild(i.cloneNode(!0));var r=n.querySelectorAll("video");if(n.querySelector(".e-vid-resize")&&r.length>0){for(var s=0;s<r.length;s++)r[s].style.outline="";(0,o.detach)(n.querySelector(".e-vid-resize"));for(var a=n.cloneNode(!0),l=document.createDocumentFragment();a.firstChild;)l.appendChild(a.firstChild);this.parent.formatter.getUndoRedoStack()[t].text=l}}},t.prototype.onIframeMouseDown=function(e){var t=e.target;this.dialogObj&&this.dialogObj.hide({returnValue:!0}),((0,o.isNullOrUndefined)(this.parent.currentTarget)||"VIDEO"!==this.parent.currentTarget.nodeName)&&this.videoEle&&this.vidResizeDiv&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&this.cancelResizeAction(),this.contentModule.getEditPanel().querySelector(".e-vid-resize")&&"VIDEO"===this.parent.currentTarget.nodeName&&((0,o.isNullOrUndefined)(this.prevSelectedVidEle)||this.prevSelectedVidEle===("IFRAME"===t.tagName||"VIDEO"===t.tagName?t:t.querySelector("iframe"))||(this.prevSelectedVidEle.style.outline=""))},t.prototype.videoSize=function(e){var t=this;if(("VIDEO"===e.selectNode[0].nodeName||this.isEmbedVidElem(e.selectNode[0]))&&(this.insertVideo(e),!(0,o.isNullOrUndefined)(this.dialogObj))){var n=this.i10n.getConstant("videoSizeHeader"),i=this.i10n.getConstant("dialogUpdate"),r=this.vidsizeInput(e),s={args:e.args,selfVideo:this,selection:e.selection,selectNode:e.selectNode};this.dialogObj.setProperties({width:"290px",header:n,content:r,buttons:[{click:function(e){t.insertSize(s)},buttonModel:{content:i,cssClass:"e-flat e-update-size",isPrimary:!0}}]}),this.dialogObj.element.style.maxHeight="inherit",this.dialogObj.content.querySelector("input").focus()}},t.prototype.vidsizeInput=function(e){var t=this,n=e.selectNode[0],i=this.i10n.getConstant("videoHeight"),r=this.i10n.getConstant("videoWidth"),s=this.parent.createElement("div",{className:"e-video-sizewrap"}),a=!(0,o.isNullOrUndefined)(this.changedWidthValue)||"auto"!==n.style.width.toString()&&""===n.style.width?(0,o.isNullOrUndefined)(this.changedWidthValue)?parseInt(n.getClientRects()[0].width.toString(),10).toString():this.changedWidthValue:n.style.width,l=!(0,o.isNullOrUndefined)(this.changedHeightValue)||"auto"!==n.style.height.toString()&&""===n.style.height?(0,o.isNullOrUndefined)(this.changedHeightValue)?parseInt(n.getClientRects()[0].height.toString(),10).toString():this.changedHeightValue:n.style.height;""===n.style.width&&(0,o.isNullOrUndefined)(this.changedWidthValue)&&(a="auto"),""===n.style.height&&(0,o.isNullOrUndefined)(this.changedHeightValue)&&(l="auto"),this.changedWidthValue=null,this.changedHeightValue=null;var d=Or('<div class="e-rte-label"><label>'+r+'</label></div><div class="e-rte-field"><input type="text" id="vidwidth" class="e-vid-width" value='+a+' /></div><div class="e-rte-label"><label>'+i+'</label></div><div class="e-rte-field"> <input type="text" id="vidheight" class="e-vid-height" value='+l+" /></div>");return s.appendChild(d),this.widthNum=new Qr.TextBox({value:(0,o.formatUnit)(a),enableRtl:this.parent.enableRtl,input:function(e){t.inputWidthValue=(0,o.formatUnit)(e.value)}}),this.widthNum.createElement=this.parent.createElement,this.widthNum.appendTo(s.querySelector("#vidwidth")),this.heightNum=new Qr.TextBox({value:(0,o.formatUnit)(l),enableRtl:this.parent.enableRtl,input:function(e){t.inputHeightValue=(0,o.formatUnit)(e.value)}}),this.heightNum.createElement=this.parent.createElement,this.heightNum.appendTo(s.querySelector("#vidheight")),s},t.prototype.insertSize=function(e){e.selection.restore();var t=e.selfVideo;0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData();var n=t.dialogObj.element;this.changedWidthValue="px"===this.inputWidthValue?null:this.inputWidthValue,this.changedHeightValue="px"===this.inputHeightValue?null:this.inputHeightValue;var i=n.querySelector(".e-vid-width").value,o=n.parentElement.querySelector(".e-vid-height").value;t.parent.formatter.process(this.parent,e.args,e.args,{width:i,height:o,selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.vidResizeDiv&&(e.selectNode[0]="VIDEO"===e.selectNode[0].tagName||"IFRAME"===e.selectNode[0].tagName?e.selectNode[0]:e.selectNode[0].querySelector("iframe"),t.vidResizePos(e.selectNode[0],this.vidResizeDiv)),t.dialogObj.hide({returnValue:!0})},t.prototype.resizeEnd=function(e){this.resizeBtnInit(),this.videoEle.parentElement.style.cursor="auto",o.Browser.isDevice&&(0,o.removeClass)([e.target.parentElement],"e-mob-span");var t={event:e,requestType:"videos"};this.parent.trigger(W,t);this.getPointX(e),this.parent.iframeSettings.enable?(window.pageYOffset,this.parent.element.getBoundingClientRect().top,e.clientY):e.pageY;this.parent.formatter.editorManager.observer.on(Ke,this.undoStack,this),this.parent.formatter.saveData()},t.prototype.resizeStart=function(e,t){var n=this;if(!this.parent.readonly){var i=t||(this.isEmbedVidElem(e.target)?e.target.querySelector("iframe"):e.target);if(!(0,o.isNullOrUndefined)(i)){if(this.prevSelectedVidEle=this.videoEle,"VIDEO"===i.tagName||"IFRAME"===i.tagName){this.parent.preventDefaultResize(e);var r=i;this.vidResizeDiv&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&(0,o.detach)(this.vidResizeDiv),this.videoResize(r)}if(i.classList.contains("e-rte-videoboxmark")){if(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),this.pageX=this.getPointX(e),this.pageY=this.getPointY(e),e.preventDefault(),e.stopImmediatePropagation(),this.resizeBtnInit(),this.quickToolObj&&this.quickToolObj.videoQTBar.hidePopup(),i.classList.contains("e-rte-topLeft")&&(this.resizeBtnStat.topLeft=!0),i.classList.contains("e-rte-topRight")&&(this.resizeBtnStat.topRight=!0),i.classList.contains("e-rte-botLeft")&&(this.resizeBtnStat.botLeft=!0),i.classList.contains("e-rte-botRight")&&(this.resizeBtnStat.botRight=!0),o.Browser.isDevice&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&!this.vidResizeDiv.classList.contains("e-mob-span"))(0,o.addClass)([this.vidResizeDiv],"e-mob-span");else{var s={event:e,requestType:"videos"};this.parent.trigger(_,s,(function(e){e.cancel&&n.cancelResizeAction()}))}this.isResizeBind&&(o.EventHandler.add(this.contentModule.getDocument(),o.Browser.touchMoveEvent,this.resizing,this),o.EventHandler.add(this.contentModule.getDocument(),o.Browser.touchEndEvent,this.resizeEnd,this),this.isResizeBind=!1)}}}},t.prototype.videoClick=function(e){o.Browser.isDevice&&("VIDEO"===e.target.tagName||this.isEmbedVidElem(e.target)?(this.contentModule.getEditPanel().setAttribute("contenteditable","false"),e.target.focus()):this.parent.readonly||this.contentModule.getEditPanel().setAttribute("contenteditable","true")),("VIDEO"===e.target.tagName||this.isEmbedVidElem(e.target)&&!this.parent.userAgentData.isSafari())&&e.preventDefault()},t.prototype.onCutHandler=function(){this.vidResizeDiv&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&this.cancelResizeAction()},t.prototype.videoResize=function(e){this.resizeBtnInit(),this.videoEle=e,(0,o.addClass)([this.videoEle],"e-resize"),this.vidResizeDiv=this.parent.createElement("span",{className:"e-vid-resize",id:this.rteID+"_vidResize"}),this.vidResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-videoboxmark e-rte-topLeft",styles:"cursor: nwse-resize"})),this.vidResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-videoboxmark e-rte-topRight",styles:"cursor: nesw-resize"})),this.vidResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-videoboxmark e-rte-botLeft",styles:"cursor: nesw-resize"})),this.vidResizeDiv.appendChild(this.parent.createElement("span",{className:"e-rte-videoboxmark e-rte-botRight",styles:"cursor: nwse-resize"})),o.Browser.isDevice&&(0,o.addClass)([this.vidResizeDiv],"e-mob-rte"),e.style.outline="2px solid #4a90e2",this.vidResizePos(e,this.vidResizeDiv),this.resizeVidDupPos(e),this.contentModule.getEditPanel().appendChild(this.vidResizeDiv),"auto"===this.parent.element.style.height&&this.vidResizePos(e,this.vidResizeDiv)},t.prototype.getPointX=function(e){return e.touches&&e.touches.length?e.touches[0].pageX:e.pageX},t.prototype.getPointY=function(e){return e.touches&&e.touches.length?e.touches[0].pageY:e.pageY},t.prototype.vidResizePos=function(e,t){if(!(0,o.isNullOrUndefined)(t)){var n=this.calcPos(e),i=n.top,r=n.left,s=0!==e.width&&"auto"!==e.width&&"NaN"!==e.width?e.width:e.getBoundingClientRect().width,a=0!==e.height&&"auto"!==e.height&&"NaN"!==e.height?e.height:e.getBoundingClientRect().height,l=o.Browser.isDevice?4*parseInt(e.style.outline.slice(-3),10)+2:2*parseInt(e.style.outline.slice(-3),10)+2,d=o.Browser.isDevice?0:2;t.querySelector(".e-rte-botLeft").style.left=r-l+"px",t.querySelector(".e-rte-botLeft").style.top=parseInt(a.toString(),10)-l+i+"px",t.querySelector(".e-rte-botRight").style.left=parseInt(s.toString(),10)-(l-d)+r+"px",t.querySelector(".e-rte-botRight").style.top=parseInt(a.toString(),10)-l+i+"px",t.querySelector(".e-rte-topRight").style.left=parseInt(s.toString(),10)-(l-d)+r+"px",t.querySelector(".e-rte-topRight").style.top=i-l+"px",t.querySelector(".e-rte-topLeft").style.left=r-l+"px",t.querySelector(".e-rte-topLeft").style.top=i-l+"px"}},t.prototype.calcPos=function(e){for(var t,n={top:0,left:0},i=e.ownerDocument,r=(e.offsetParent&&(e.offsetParent.classList.contains("e-video-clickelem")||["TD","TH","TABLE","A"].indexOf(e.offsetParent.tagName)>-1)?(0,o.closest)(e,"#"+this.parent.getID()+"_rte-edit-view"):e.offsetParent)||i.documentElement;r&&(r===i.body||r===i.documentElement)&&"static"===r.style.position;)r=r.parentNode;return r&&r!==e&&1===r.nodeType&&(n=r.getBoundingClientRect()),e&&1===e.nodeType&&"IFRAME"===e.tagName?{top:(t=e.getBoundingClientRect()).top-n.top,left:t.left-n.left}:{top:e.offsetTop,left:e.offsetLeft}},t.prototype.setAspectRatio=function(e,t,n,i){var r=getComputedStyle(e);if(!(0,o.isNullOrUndefined)(r)){var s=RegExp,a=""!==r.width?r.width.match(new s("^\\d+(\\.\\d*)?%$","g"))?parseFloat(r.width):parseInt(r.width,10):""!==e.style.width?e.style.width:e.width,l=""!==r.height?parseInt(r.height,10):""!==e.style.height?e.style.height:e.height;if((a=a.toString().match(new s("\\b\\d+(\\.\\d*)?(%|$)\\b","g"))?parseFloat(a.toString()):parseInt(a.toString(),10))>(l=l.toString().match(new s("\\b\\d+(\\.\\d*)?(%|$)\\b","g"))?parseFloat(l.toString()):parseInt(l.toString(),10)))if(e.style.minWidth=0===this.parent.insertVideoSettings.minWidth?"200px":(0,o.formatUnit)(this.parent.insertVideoSettings.minWidth),e.style.minHeight=0===this.parent.insertVideoSettings.minHeight?"90px":(0,o.formatUnit)(this.parent.insertVideoSettings.minHeight),this.parent.insertVideoSettings.resizeByPercent)this.updateVidEleWidth(e,a,l,t,n);else if(""===e.style.width&&""!==e.style.height||""===r.width&&""!==r.height)e.style.height=n+"px";else if(""!==e.style.width&&""===e.style.height||""!==r.width&&""===r.height){var d=a/l*n+a/l<this.parent.inputElement.getBoundingClientRect().right-32?a/l*n+a/l:this.parent.inputElement.getBoundingClientRect().right-32;e.style.width=d.toString()+"px"}else if(""!==e.style.width||""!==r.width){d=a/l*n<this.parent.inputElement.getBoundingClientRect().right-32?a/l*n:this.parent.inputElement.getBoundingClientRect().right-32;e.style.width=d+"px",e.style.height=n+"px"}else e.setAttribute("width",parseInt((a/l*n+a/l).toString(),10).toString());else l>a?this.parent.insertVideoSettings.resizeByPercent?this.updateVidEleWidth(e,a,l,t,n):""!==r.width||""!==e.style.width?(e.style.width=t+"px",e.style.height=l/a*t+"px"):e.setAttribute("width",this.resizeBtnStat.botRight?(this.getPointX(i.event)-e.getBoundingClientRect().left).toString():t.toString()):this.parent.insertVideoSettings.resizeByPercent?(e.style.width=this.pixToPerc(t,e.previousElementSibling||e.parentElement)+"%",e.style.height=null,e.removeAttribute("height")):(e.style.width=t+"px",e.style.height=t+"px")}},t.prototype.updateVidEleWidth=function(e,t,n,i,o){if(0!==parseInt(""+e.getBoundingClientRect().width,10)&&0!==parseInt(""+t,10)){var r=(e.offsetWidth+this.mouseX)/e.offsetWidth*("NaN"===parseFloat(e.style.width).toString()?e.offsetWidth/parseFloat(getComputedStyle(this.parent.element).width)*100:parseFloat(e.style.width));e.style.width=(r>3?r:3)+"%"}else e.style.width=t>n?this.pixToPerc(t/n*o,e.previousElementSibling||e.parentElement)+"%":this.pixToPerc(i/n*o,e.previousElementSibling||e.parentElement)+"%";e.style.height=null,e.removeAttribute("height")},t.prototype.pixToPerc=function(e,t){return e/parseFloat(getComputedStyle(t).width)*100},t.prototype.vidDupMouseMove=function(e,t,n){var i=this,r={event:n,requestType:"videos"};this.parent.trigger(V,r,(function(n){if(n.cancel)i.cancelResizeAction();else{if(parseInt(i.parent.insertVideoSettings.minWidth,10)>=parseInt(e,10)||parseInt(i.parent.getInsertVidMaxWidth(),10)<=parseInt(e,10)&&(0,o.isNullOrUndefined)(i.videoEle.style.width))return;if(!i.parent.insertVideoSettings.resizeByPercent&&(parseInt(i.parent.insertVideoSettings.minHeight,10)>=parseInt(t,10)||parseInt(i.parent.insertVideoSettings.maxHeight,10)<=parseInt(t,10)))return;i.videoEle.parentElement.style.cursor="pointer",i.setAspectRatio(i.videoEle,parseInt(e,10),parseInt(t,10),r),i.resizeVidDupPos(i.videoEle),i.vidResizePos(i.videoEle,i.vidResizeDiv)}}))},t.prototype.resizing=function(e){this.videoEle.offsetWidth>=this.parent.getInsertVidMaxWidth()&&(this.videoEle.style.maxHeight=this.videoEle.offsetHeight+"px");var t=this.getPointX(e),n=this.getPointY(e),i=this.resizeBtnStat.botLeft||this.resizeBtnStat.topLeft?-(t-this.pageX):t-this.pageX,o=this.resizeBtnStat.topLeft||this.resizeBtnStat.topRight?-(n-this.pageY):n-this.pageY,r=parseInt(this.vidDupPos.width,10)+i,s=parseInt(this.vidDupPos.height,10)+o;this.pageX=t,this.pageY=n,this.mouseX=i,(this.resizeBtnStat.botRight||this.resizeBtnStat.botLeft||this.resizeBtnStat.topRight||this.resizeBtnStat.topLeft)&&this.vidDupMouseMove(r+"px",s+"px",e)},t.prototype.cancelResizeAction=function(){this.isResizeBind=!0,o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchMoveEvent,this.resizing),o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchEndEvent,this.resizeEnd),this.videoEle&&this.vidResizeDiv&&this.contentModule.getEditPanel().contains(this.vidResizeDiv)&&((0,o.detach)(this.vidResizeDiv),this.videoEle.style.outline="",this.vidResizeDiv=null,this.pageX=null,this.pageY=null)},t.prototype.resizeVidDupPos=function(e){this.vidDupPos={width:""!==e.style.width&&this.parent.insertVideoSettings&&!this.parent.insertVideoSettings.resizeByPercent?this.videoEle.style.width:"auto"!==e.width&&0!==e.width&&"NaN"!==e.width?e.width+"px":parseInt(getComputedStyle(e).width,10)+"px",height:""!==e.style.height?this.videoEle.style.height:"auto"!==e.height&&0!==e.height&&"NaN"!==e.height?e.height+"px":parseInt(getComputedStyle(e).height,10)+"px"}},t.prototype.resizeBtnInit=function(){return this.resizeBtnStat={botLeft:!1,botRight:!1,topRight:!1,topLeft:!1}},t.prototype.onToolbarAction=function(e){switch(Us()&&this.parent.notify(Oe,{}),e.args.item.subCommand){case"VideoReplace":this.parent.notify(re,e);break;case"VideoRemove":this.parent.notify(ge,e);break;case"VideoDimension":this.parent.notify(ye,e)}},t.prototype.onKeyDown=function(e){var t,n,i,r,s,a=e.args;this.deletedVid=[];if("HTML"===this.parent.editorMode&&(s=(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())).startContainer===t.endContainer&&t.startOffset===t.endOffset),!s&&"HTML"===this.parent.editorMode&&[27,112,113,114,115,116,117,118,119,120,121,122,123,44,45,9,16,17,18,19,20,33,34,35,36,37,38,39,40,91,92,93,144,145,182,183].indexOf(a.which)<0)for(var l=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),d=0;d<l.length;d++)"VIDEO"!==l[d].nodeName&&"IFRAME"!==l[d].nodeName||this.deletedVid.push(l[d]);if("HTML"===this.parent.editorMode&&(8===a.which&&"Backspace"===a.code||46===a.which&&"Delete"===a.code)){var c=t.startContainer===t.endContainer&&t.startOffset===t.endOffset;8===a.which&&"Backspace"===a.code&&c?this.checkVideoBack(t):46===a.which&&"Delete"===a.code&&c&&this.checkVideoDel(t)}if(!(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)&&"KeyK"!==a.code&&(t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(t),r=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t),!a.ctrlKey&&a.key&&(1===a.key.length||"enter"===a.action)&&(!(0,o.isNullOrUndefined)(r[0])&&"VIDEO"===r[0].tagName||this.isEmbedVidElem(r[0]))&&r[0].parentElement)){r[0].parentElement;this.contentModule.getEditPanel().querySelector(".e-vid-resize")&&this.removeResizeEle(),(0,o.removeClass)([r[0]],oo),this.quickToolObj&&this.quickToolObj.videoQTBar&&this.quickToolObj.videoQTBar.hidePopup()}if(!a.ctrlKey||89!==a.keyCode&&90!==a.keyCode||this.undoStack({subCommand:90===a.keyCode?"undo":"redo"}),8===a.keyCode||46===a.keyCode){if(i&&i[0]&&("VIDEO"===i[0].nodeName||this.isEmbedVidElem(i[0])||46===a.keyCode&&i[0].nextSibling&&("e-video-wrap"===i[0].nextSibling.className||this.isEmbedVidElem(i[0].nextSibling))||8===a.keyCode&&i[0].previousSibling&&("e-video-wrap"===i[0].previousSibling.className||this.isEmbedVidElem(i[0].previousSibling)))&&i.length<=2){(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)||(n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument())),a.preventDefault();var h={selectNode:i,selection:n,selectParent:r,args:{item:{command:"Videos",subCommand:"VideoRemove"},originalEvent:a}};this.deleteVideo(h,a.keyCode)}this.parent.contentModule.getEditPanel().querySelector(".e-vid-resize")&&this.removeResizeEle()}switch("Backspace"===a.code&&(a.action="backspace"),a.action){case"escape":(0,o.isNullOrUndefined)(this.dialogObj)||this.dialogObj.close();break;case"backspace":case"delete":for(d=0;d<this.deletedVid.length;d++){var p=this.deletedVid[d].src;this.videoRemovePost(p)}"Markdown"!==this.parent.editorMode&&(3===t.startContainer.nodeType?"Backspace"===a.code?t.startContainer.previousElementSibling&&0===t.startOffset&&t.startContainer.previousElementSibling.classList.contains(ii)&&(0,o.detach)(t.startContainer.previousElementSibling):t.startContainer.nextElementSibling&&t.endContainer.textContent.length===t.endOffset&&t.startContainer.nextElementSibling.classList.contains(ii)&&(0,o.detach)(t.startContainer.nextElementSibling):1===t.startContainer.nodeType&&t.startContainer.classList&&t.startContainer.classList.contains(ii)?(0,o.detach)(t.startContainer):1!==t.startContainer.nodeType||(0,o.isNullOrUndefined)(t.startContainer.querySelector(".e-video-wrap"))||"Delete"!==a.code||(0,o.detach)(t.startContainer.querySelector(".e-video-wrap")));break;case"insert-video":(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)||(n=this.parent.formatter.editorManager.nodeSelection.save(t,this.parent.contentModule.getDocument())),this.openDialog(!0,a,n,i,r),a.preventDefault()}a.ctrlKey&&"a"===a.key&&this.handleSelectAll()},t.prototype.handleSelectAll=function(){this.cancelResizeAction();var e=this.parent.inputElement.querySelectorAll("."+oo);(0,o.removeClass)(e,oo)},t.prototype.openDialog=function(e,t,n,i,r){var s,a,l,d;e||(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)?(a=n,l=i,d=r):(s=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),a=this.parent.formatter.editorManager.nodeSelection.save(s,this.parent.contentModule.getDocument()),l=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(s),d=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(s)),"HTML"===this.parent.editorMode&&this.insertVideo({args:{item:{command:"Videos",subCommand:"Video"},originalEvent:t,name:e?null:"showDialog"},selectNode:l,selection:a,selectParent:d})},t.prototype.showDialog=function(e){(0,o.isNullOrUndefined)(e.originalEvent)?this.openDialog(!1):this.openDialog(!1,e.originalEvent)},t.prototype.closeDialog=function(){this.dialogObj&&this.dialogObj.hide({returnValue:!0})},t.prototype.checkVideoBack=function(e){"#text"!==e.startContainer.nodeName||0!==e.startOffset||(0,o.isNullOrUndefined)(e.startContainer.previousSibling)||"VIDEO"!==e.startContainer.previousSibling.nodeName&&!this.isEmbedVidElem(e.startContainer.previousSibling)?"#text"===e.startContainer.nodeName||(0,o.isNullOrUndefined)(e.startContainer.childNodes[e.startOffset-1])||"VIDEO"!==e.startContainer.childNodes[e.startOffset-1].nodeName&&!this.isEmbedVidElem(e.startContainer.childNodes[e.startOffset-1])||this.deletedVid.push(e.startContainer.childNodes[e.startOffset-1]):this.deletedVid.push(e.startContainer.previousSibling)},t.prototype.checkVideoDel=function(e){"#text"!==e.startContainer.nodeName||e.startOffset!==e.startContainer.textContent.length||(0,o.isNullOrUndefined)(e.startContainer.nextSibling)||"VIDEO"!==e.startContainer.nextSibling.nodeName&&!this.isEmbedVidElem(e.startContainer.nextSibling)?"#text"===e.startContainer.nodeName||(0,o.isNullOrUndefined)(e.startContainer.childNodes[e.startOffset])||"VIDEO"!==e.startContainer.childNodes[e.startOffset].nodeName&&!this.isEmbedVidElem(e.startContainer.childNodes[e.startOffset])||this.deletedVid.push(e.startContainer.childNodes[e.startOffset]):this.deletedVid.push(e.startContainer.nextSibling)},t.prototype.alignmentSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Videos"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(n),r={args:e,selectNode:i="VIDEO"===i[0].nodeName?i:[this.videoEle]};switch(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),t.subCommand){case"JustifyLeft":case"JustifyCenter":case"JustifyRight":this.alignVideo(r,t.subCommand);break;case"Inline":this.inline(r);break;case"Break":this.break(r)}this.quickToolObj&&document.body.contains(this.quickToolObj.videoQTBar.element)&&(this.quickToolObj.videoQTBar.hidePopup(),(0,o.removeClass)([i[0]],oo)),this.cancelResizeAction()}},t.prototype.deleteVideo=function(e,t){if("VIDEO"===e.selectNode[0].nodeName||this.isEmbedVidElem(e.selectNode[0])){this.isEmbedVidElem(e.selectNode[0])&&(e.selectNode[0]=e.selectNode[0].classList.contains(ti)?e.selectNode[0]:e.selectNode[0].parentElement);var n={element:this.isEmbedVidElem(e.selectNode[0])?e.selectNode[0]:e.selectNode[0].querySelector("iframe"),src:this.isEmbedVidElem(e.selectNode[0])?e.selectNode[0].querySelector("iframe").getAttribute("src"):e.selectNode[0].querySelector("source").getAttribute("src")};0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),e.selection.restore(),this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:e.args.item.subCommand}),this.videoRemovePost(n.src),this.quickToolObj&&document.body.contains(this.quickToolObj.videoQTBar.element)&&this.quickToolObj.videoQTBar.hidePopup(),this.cancelResizeAction(),(0,o.isNullOrUndefined)(t)&&this.parent.trigger(vt,n)}},t.prototype.videoRemovePost=function(e){var t=this,n="";if(!(0,o.isNullOrUndefined)(this.parent.insertVideoSettings.removeUrl)&&""!==this.parent.insertVideoSettings.removeUrl){n=e.indexOf("http://")>-1||e.indexOf("https://")>-1?e:new URL(e,document.baseURI).href,this.removingVideoName=n.replace(/^.*[\\\/]/,"");var i=new XMLHttpRequest;i.addEventListener("readystatechange",(function(){4===this.readyState&&200===this.status&&t.triggerPost(this.response)})),i.open("GET",n),i.responseType="blob",i.send()}},t.prototype.triggerPost=function(e){var t=this.parent.insertVideoSettings.removeUrl;if(!(0,o.isNullOrUndefined)(t)&&""!==t){var n=new File([e],this.removingVideoName),i=new o.Ajax(t,"POST",!0,null),r=new FormData;r.append("UploadFiles",n),i.send(r)}},t.prototype.onDocumentClick=function(e){var t=e.target;(0,o.isNullOrUndefined)(this.contentModule.getEditPanel())||(("VIDEO"===t.nodeName||this.isEmbedVidElem(t))&&(this.videoEle=this.isEmbedVidElem(t)?t.querySelector("iframe"):t),!(0,o.isNullOrUndefined)(this.dialogObj)&&(!(0,o.closest)(t,"[id='"+this.dialogObj.element.id+"']")&&this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()&&!this.parent.getToolbarElement().contains(e.target)||this.parent.getToolbarElement()&&this.parent.getToolbarElement().contains(e.target)&&!(0,o.closest)(t,"#"+this.parent.getID()+"_toolbar_Video")&&!t.querySelector("#"+this.parent.getID()+"_toolbar_Video"))&&(e.offsetX>e.target.clientWidth||e.offsetY>e.target.clientHeight||(this.parent.notify(Yt,{closedBy:"outside click"}),this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,Tr(this.parent.element,"focusout"))),this.contentModule.getEditPanel().querySelector(".e-vid-resize")&&("VIDEO"===t.tagName||this.isEmbedVidElem(t)||this.removeResizeEle(),"VIDEO"===t.tagName||this.isEmbedVidElem(t)||(0,o.isNullOrUndefined)(this.videoEle)?(0,o.isNullOrUndefined)(this.prevSelectedVidEle)||this.prevSelectedVidEle===("IFRAME"===t.tagName||"VIDEO"===t.tagName?t:t.querySelector("iframe"))||(this.prevSelectedVidEle.style.outline=""):this.videoEle.style.outline=""),this.parent.inlineMode.enable&&t&&this.dialogObj&&!(0,o.closest)(t,"#"+this.dialogObj.element.id)&&this.dialogObj.hide())},t.prototype.removeResizeEle=function(){this.isResizeBind=!0,o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchMoveEvent,this.resizing),o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchEndEvent,this.resizeEnd),(0,o.detach)(this.contentModule.getEditPanel().querySelector(".e-vid-resize"))},t.prototype.onWindowResize=function(){(0,o.isNullOrUndefined)(this.contentModule)||(0,o.isNullOrUndefined)(this.contentModule.getEditPanel().querySelector(".e-vid-resize"))||this.cancelResizeAction()},t.prototype.break=function(e){if("VIDEO"===e.selectNode[0].nodeName||this.isEmbedVidElem(e.selectNode[0])){var t=e.args.item?e.args.item.subCommand:"Break";this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t})}},t.prototype.inline=function(e){if("VIDEO"===e.selectNode[0].nodeName||this.isEmbedVidElem(e.selectNode[0])){var t=e.args.item?e.args.item.subCommand:"Inline";this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:t})}},t.prototype.alignVideo=function(e,t){var n=e.args.item?e.args.item.subCommand:t;this.parent.formatter.process(this.parent,e.args,e.args.originalEvent,{selectNode:e.selectNode,subCommand:n})},t.prototype.editAreaClickHandler=function(t){if(this.parent.readonly)this.hideVideoQuickToolbar();else{var n=t.args,i=this.parent.quickToolbarSettings.showOnRightClick;if(2===n.which||i&&1===n.which||!i&&3===n.which)!i||1!==n.which||(0,o.isNullOrUndefined)(n.target)||"VIDEO"!==n.target.tagName&&!this.isEmbedVidElem(n.target)||(this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),n.target));else if("HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.videoQTBar){this.quickToolObj=this.parent.quickToolbarModule;var r=n.target;this.contentModule=this.rendererFactory.getRenderer(e.Content);var s=this.quickToolObj.videoQTBar.element.classList.contains("e-rte-pop");if(("VIDEO"===r.nodeName||this.isEmbedVidElem(r))&&this.parent.quickToolbarModule){if(s)return;this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionContents(this.contentModule.getDocument(),r),Us()&&this.parent.notify(Te,t),(0,o.addClass)([this.isEmbedVidElem(r)?r.querySelector("iframe"):r],oo),this.showVideoQuickToolbar({args:n,type:"Videos",elements:[n.target]})}else this.hideVideoQuickToolbar()}}},t.prototype.showVideoQuickToolbar=function(e){var t=this;if(!("Videos"!==e.type||!(0,o.isNullOrUndefined)(e.args)&&2===e.args.detail||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule)||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule.videoQTBar)||(0,o.isNullOrUndefined)(e.args))){this.quickToolObj=this.parent.quickToolbarModule;var n=e.args,i=e.elements;[].forEach.call(e.elements,(function(e,t){0===t&&(i=e)})),("VIDEO"===i.tagName||this.isEmbedVidElem(i))&&(0,o.addClass)([this.isEmbedVidElem(i)&&"IFRAME"!==i.tagName?i.querySelector("iframe"):i],[oo]);var r=this.parent.iframeSettings.enable?window.pageYOffset+this.parent.element.getBoundingClientRect().top+n.clientY:n.pageY;this.parent.quickToolbarModule.videoQTBar&&(e.isNotify?this.showPopupTime=setTimeout((function(){t.parent.formatter.editorManager.nodeSelection.Clear(t.contentModule.getDocument()),t.parent.formatter.editorManager.nodeSelection.setSelectionContents(t.contentModule.getDocument(),i),t.quickToolObj.videoQTBar.showPopup(n.pageX-50,r+i.getBoundingClientRect().height/2-i.offsetTop,i),!0===t.parent.insertVideoSettings.resize&&t.resizeStart(e.args,i)}),400):this.quickToolObj.videoQTBar.showPopup(n.pageX-50,r+i.getBoundingClientRect().height/2-i.offsetTop,i))}},t.prototype.hideVideoQuickToolbar=function(){(0,o.isNullOrUndefined)(this.contentModule.getEditPanel().querySelector("."+oo))||((0,o.removeClass)([this.contentModule.getEditPanel().querySelector("."+oo)],oo),(0,o.isNullOrUndefined)(this.videoEle)||(this.videoEle.style.outline=""),(0,o.isNullOrUndefined)(this.contentModule.getEditPanel().querySelector(".e-vid-resize"))||(0,o.detach)(this.contentModule.getEditPanel().querySelector(".e-vid-resize")),this.quickToolObj&&this.quickToolObj.videoQTBar&&document.body.contains(this.quickToolObj.videoQTBar.element)&&this.quickToolObj.videoQTBar.hidePopup())},t.prototype.isEmbedVidElem=function(e){return!!(e&&3!==e.nodeType&&"BR"!==e.nodeName&&e.classList&&(e.classList.contains(ii)||e.classList.contains(ti)||e.classList.contains("e-embed-video-wrap"))||e&&"IFRAME"===e.nodeName)},t.prototype.insertingVideo=function(e){if(this.insertVideo(e),!(0,o.isNullOrUndefined)(this.dialogObj)){this.dialogObj.element.style.maxHeight="inherit";var t=this.dialogObj.element.querySelector(".e-video-content");(0,o.isNullOrUndefined)(this.parent.insertVideoSettings.path)&&"HTML"!==this.parent.editorMode?t.querySelector(".e-video-url").focus():document.getElementById(this.rteID+"_insertVideo").focus()}},t.prototype.insertVideo=function(e){var t=this;if(this.dialogObj)this.dialogObj.hide({returnValue:!0});else{var n=this.parent.createElement("div",{className:"e-rte-video-dialog",id:this.rteID+"_video"});this.parent.rootContainer.appendChild(n);var i=this.i10n.getConstant("dialogInsert"),r=this.i10n.getConstant("dialogCancel"),s=this.i10n.getConstant("videoHeader"),a=e.selection,l={selfVideo:this,selection:e.selection,args:e.args,selectParent:e.selectParent},d={header:s,cssClass:bi,enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:o.Browser.isDevice?"290px":"340px",isModal:o.Browser.isDevice,buttons:[{click:this.insertVideoUrl.bind(l),buttonModel:{content:i,cssClass:"e-flat e-insertVideo",isPrimary:!0,disabled:!0}},{click:function(e){t.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel",content:r}}],target:o.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){t.isVideoUploaded&&(t.dialogObj.element.querySelector(".e-file-abort-btn")?t.dialogObj.element.querySelector(".e-file-abort-btn").click():t.uploadObj.remove()),t.parent.isBlur=!1,e&&!(0,o.isNullOrUndefined)(e.event)&&e.event.returnValue&&"HTML"===t.parent.editorMode&&a.restore(),t.clearDialogObj(),t.dialogRenderObj.close(e)}},c=this.parent.createElement("div",{className:"e-video-content"});(0,o.isNullOrUndefined)(this.parent.insertVideoSettings.path)&&"HTML"!==this.parent.editorMode||c.appendChild(this.videoUpload(e));var h=this.parent.createElement("div",{className:"e-videoheader"}),p=this.parent.createElement("div",{className:"e-embed-videoheader"}),u=this.i10n.getConstant("videoLinkHeader"),m=this.i10n.getConstant("embedVideoLinkHeader");"HTML"===this.parent.editorMode&&(h.innerHTML=u,p.innerHTML=m),c.appendChild(this.urlPopup(e)),e.selectNode&&1===e.selectNode[0].nodeType&&("VIDEO"===e.selectNode[0].tagName||this.isEmbedVidElem(e.selectNode[0]))?(d.header=this.parent.localeObj.getConstant("editVideoHeader"),d.content=c):d.content=c,this.dialogObj=this.dialogRenderObj.render(d),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(n),e.selectNode&&1===e.selectNode[0].nodeType&&("VIDEO"===e.selectNode[0].tagName||this.isEmbedVidElem(e.selectNode[0]))&&"insertVideo"===e.name&&(this.dialogObj.element.querySelector(".e-insertVideo").textContent=this.parent.localeObj.getConstant("dialogUpdate")),n.style.maxHeight="inherit",this.quickToolObj&&(this.quickToolObj.videoQTBar&&document.body.contains(this.quickToolObj.videoQTBar.element)&&(this.quickToolObj.videoQTBar.hidePopup(),(0,o.isNullOrUndefined)(e.selectParent)||(0,o.removeClass)([e.selectParent[0]],oo)),this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj.textQTBar&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup())}},t.prototype.urlPopup=function(e){var t=this,n=this.parent.createElement("div",{className:"e-video-url-wrap"}),i=this.parent.createElement("div",{id:"urlcontent"}),r=this.i10n.getConstant("videoUrl"),s=Or('<input id="embedURL" type="radio"><input id="webURL" type="radio" >');if(n.appendChild(s),n.appendChild(i),this.embedInputUrl=this.parent.createElement("textarea",{className:"e-input e-embed-video-url",attrs:{placeholder:this.i10n.getConstant("pasteEmbeddedCodeHere"),type:"text",tabindex:"-1","aria-label":this.i10n.getConstant("embedVideoLinkHeader")}}),this.embedInputUrl.addEventListener("input",(function(){(0,o.isNullOrUndefined)(t.embedInputUrl)||(0===t.embedInputUrl.value.length?t.dialogObj.getButtons(0).element.disabled=!0:t.dialogObj.getButtons(0).element.removeAttribute("disabled"))})),this.inputUrl=this.parent.createElement("input",{className:"e-input e-video-url",attrs:{placeholder:r,spellcheck:"false"}}),this.inputUrl.addEventListener("input",(function(){(0,o.isNullOrUndefined)(t.inputUrl)||(0===t.inputUrl.value.length?t.dialogObj.getButtons(0).element.disabled=!0:t.dialogObj.getButtons(0).element.removeAttribute("disabled"))})),e.selectNode&&e.selectNode[0]&&("VIDEO"===e.selectNode[0].nodeName||this.isEmbedVidElem(e.selectNode[0])))if("VIDEO"===e.selectNode[0].nodeName||e.selectNode[0].classList.contains("e-video-wrap")){var a=new RegExp(/([^\S]|^)(((https?:\/\/)|(www\.))(\S+))/gi),l=e.selectNode[0].querySelector("source");this.inputUrl.value=l&&l.src&&l.src.match(a)?l.src:""}else this.embedInputUrl.value="IFRAME"===e.selectNode[0].nodeName?e.selectNode[0].outerHTML:e.selectNode[0].querySelector("iframe").outerHTML;var d=!!this.inputUrl.value;return this.embedUrlBtn=new hl.RadioButton({label:this.i10n.getConstant("embeddedCode"),checked:!d,name:"URL",created:function(){d||i.appendChild(t.embedInputUrl)},change:function(){i.innerHTML="",i.appendChild(t.embedInputUrl)}}),this.embedUrlBtn.appendTo(n.querySelector("#embedURL")),this.webUrlBtn=new hl.RadioButton({label:this.i10n.getConstant("webUrl"),checked:d,name:"URL",created:function(){d&&i.appendChild(t.inputUrl)},change:function(){i.innerHTML="",i.appendChild(t.inputUrl)}}),this.webUrlBtn.appendTo(n.querySelector("#webURL")),n},t.prototype.videoUpload=function(e){var t,n,i=this,r=this,s=r.parent.iframeSettings.enable;if("HTML"===r.parent.editorMode&&(!s&&(0,o.isNullOrUndefined)((0,o.closest)(e.selection.range.startContainer.parentNode,"[id='"+this.parent.contentModule.getPanel().id+"']"))||s&&!ur(e.selection.range.startContainer.parentNode.ownerDocument.querySelector("body"),"e-lib"))){this.contentModule.getEditPanel().focus();var a=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());t=this.parent.formatter.editorManager.nodeSelection.save(a,this.parent.contentModule.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(a)}else t=e.selection,n=e.selectParent;var l=this.parent.createElement("div",{className:"e-vid-uploadwrap e-droparea"}),d=this.i10n.getConstant("videoDeviceUploadMessage"),c=this.i10n.getConstant("videoUploadMessage"),h=this.parent.createElement("span",{className:"e-droptext"}),p=this.parent.createElement("span",{className:"e-rte-upload-text",innerHTML:o.Browser.isDevice?d:c});h.appendChild(p);var u=this.parent.createElement("button",{className:"e-browsebtn",id:this.rteID+"_insertVideo",attrs:{autofocus:"true",type:"button"}});h.appendChild(u),l.appendChild(h);var m=this.i10n.getConstant("browse");this.button=new hl.Button({content:m,enableRtl:this.parent.enableRtl}),this.button.isStringTemplate=!0,this.button.createElement=this.parent.createElement,this.button.appendTo(u);var f=o.Browser.isDevice?h:u;o.EventHandler.add(f,"click",this.fileSelect,this);var g,b,v=this.parent.createElement("input",{id:this.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"}});return l.appendChild(v),this.uploadObj=new Qr.Uploader({asyncSettings:{saveUrl:this.parent.insertVideoSettings.saveUrl,removeUrl:this.parent.insertVideoSettings.removeUrl},dropArea:h,multiple:!1,enableRtl:this.parent.enableRtl,allowedExtensions:this.parent.insertVideoSettings.allowedTypes.toString(),selected:function(e){r.isVideoUploaded=!0,b=e,e.filesData,i.parent.trigger(pt,b,(function(e){if(!e.cancel){if((0,o.isNullOrUndefined)(e.filesData[0]))return;if(i.checkExtension(e.filesData[0]),g=e.filesData[0].name,"HTML"===i.parent.editorMode&&(0,o.isNullOrUndefined)(i.parent.insertVideoSettings.path)){var s=new FileReader;s.addEventListener("load",(function(e){var a="Base64"===i.parent.insertVideoSettings.saveFormat?s.result:URL.createObjectURL(Ir(s.result));r.uploadUrl={url:a,selection:t,fileName:g,selectParent:n},r.inputUrl.setAttribute("disabled","true"),r.embedInputUrl.setAttribute("disabled","true"),(0,o.isNullOrUndefined)(r.parent.insertVideoSettings.saveUrl)&&i.isAllowedTypes&&!(0,o.isNullOrUndefined)(i.dialogObj)&&i.dialogObj.getButtons(0).element.removeAttribute("disabled")})),s.readAsDataURL(e.filesData[0].rawFile)}}}))},beforeUpload:function(e){i.parent.trigger(St,e)},uploading:function(e){i.parent.isServerRendered||i.parent.trigger(ut,e)},success:function(e){i.parent.trigger(mt,e,(function(e){if(!(0,o.isNullOrUndefined)(i.parent.insertVideoSettings.path)){var s=i.parent.insertVideoSettings.path+e.file.name;r.uploadUrl={url:s,selection:t,fileName:g,selectParent:n,width:{width:r.parent.insertVideoSettings.width,minWidth:r.parent.insertVideoSettings.minWidth,maxWidth:r.parent.getInsertImgMaxWidth()},height:{height:r.parent.insertVideoSettings.height,minHeight:r.parent.insertVideoSettings.minHeight,maxHeight:r.parent.insertVideoSettings.maxHeight}},r.embedInputUrl.setAttribute("disabled","true")}"upload"!==e.operation||(0,o.isNullOrUndefined)(i.dialogObj)||i.dialogObj.getButtons(0).element.removeAttribute("disabled")}))},failure:function(e){i.parent.trigger(ft,e)},removing:function(){i.parent.trigger(gt,e,(function(e){r.isVideoUploaded=!1,i.dialogObj.getButtons(0).element.disabled=!0,r.inputUrl.getAttribute("disabled")&&r.inputUrl.removeAttribute("disabled"),r.embedInputUrl.getAttribute("disabled")&&r.embedInputUrl.removeAttribute("disabled"),r.uploadUrl&&(r.uploadUrl.url="")}))}}),this.uploadObj.isStringTemplate=!0,this.uploadObj.createElement=this.parent.createElement,this.uploadObj.appendTo(v),l},t.prototype.checkExtension=function(e){this.uploadObj.allowedExtensions&&(-1===this.uploadObj.allowedExtensions.toLocaleLowerCase().indexOf(("."+e.type).toLocaleLowerCase())?(this.dialogObj.getButtons(0).element.setAttribute("disabled","disabled"),this.isAllowedTypes=!1):this.isAllowedTypes=!0)},t.prototype.fileSelect=function(){return this.dialogObj.element.getElementsByClassName("e-file-select-wrap")[0].querySelector("button").click(),!1},t.prototype.cancelDialog=function(e){this.parent.isBlur=!1,this.dialogObj.hide({returnValue:!0}),this.isVideoUploaded&&this.uploadObj.removing()},t.prototype.insertVideoUrl=function(e){var t=this.selfVideo;t.isVideoUploaded=!1;var n=t.inputUrl.value,i=t.embedInputUrl.value;if(0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData(),(0,o.isNullOrUndefined)(t.uploadUrl)||""===t.uploadUrl.url){if("HTML"===t.parent.editorMode&&(""!==n||""!==i)){var r=document.getElementById("webURL"),s=r.checked?n.split("/")[n.split("/").length-1]:i,a={cssClass:"Inline"===t.parent.insertVideoSettings.layoutOption?ci:oi,url:n,selection:this.selection,fileName:s,isEmbedUrl:!r.checked,selectParent:this.selectParent,width:{width:t.parent.insertVideoSettings.width,minWidth:t.parent.insertVideoSettings.minWidth,maxWidth:t.parent.getInsertImgMaxWidth()},height:{height:t.parent.insertVideoSettings.height,minHeight:t.parent.insertVideoSettings.minHeight,maxHeight:t.parent.insertVideoSettings.maxHeight}};if(t.dialogObj.hide({returnValue:!1}),null!==t.dialogObj)return;t.parent.formatter.process(t.parent,this.args,this.args.originalEvent,a)}}else{if(t.uploadUrl.cssClass="Inline"===t.parent.insertVideoSettings.layoutOption?ci:oi,t.uploadUrl.width={width:t.parent.insertVideoSettings.width,minWidth:t.parent.insertVideoSettings.minWidth,maxWidth:t.parent.getInsertImgMaxWidth()},t.uploadUrl.height={height:t.parent.insertVideoSettings.height,minHeight:t.parent.insertVideoSettings.minHeight,maxHeight:t.parent.insertVideoSettings.maxHeight},t.dialogObj.hide({returnValue:!1}),null!==t.dialogObj)return;t.parent.formatter.process(t.parent,this.args,this.args.originalEvent,t.uploadUrl),t.uploadUrl.url=""}},t.prototype.destroy=function(){this.isDestroyed||(this.prevSelectedVidEle=void 0,this.removeEventListener(),this.showPopupTime&&(clearTimeout(this.showPopupTime),this.showPopupTime=null),this.clearDialogObj(),this.isDestroyed=!0)},t.prototype.getModuleName=function(){return"video"},t}(),gl=(qs=function(e,t){return qs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},qs(e,t)},function(e,t){function n(){this.constructor=e}qs(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),bl=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},vl={backspace:8,tab:9,enter:13,shift:16,control:17,alt:18,pause:19,capslock:20,space:32,escape:27,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,insert:45,delete:46,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,semicolon:186,plus:187,comma:188,minus:189,dot:190,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222,"]":221,"[":219,"=":187,"<":188,">":190,"`":192},yl=function(e){function t(t,i){var o=e.call(this,i,t)||this;return o.keyPressHandler=function(e){for(var t=e.altKey,i=e.ctrlKey,r=e.shiftKey,s=e.metaKey,a=e.which,l=0,d=Object.keys(o.keyConfigs);l<d.length;l++)for(var c=d[l],h=0,p=o.keyConfigs[""+c].split(",");h<p.length;h++){var u=p[h],m=n.getKeyConfigData(u.trim());t!==m.altKey||i!==m.ctrlKey&&!s||r!==m.shiftKey||a!==m.keyCode||(e.action=c)}o.keyAction&&o.keyAction(e)},o.bind(),o}var n;return gl(t,e),n=t,t.prototype.destroy=function(){this.unwireEvents(),e.prototype.destroy.call(this)},t.prototype.onPropertyChanged=function(e,t){},t.prototype.bind=function(){this.wireEvents()},t.prototype.getModuleName=function(){return"keyboard"},t.prototype.wireEvents=function(){this.element.addEventListener(this.eventName,this.keyPressHandler)},t.prototype.unwireEvents=function(){this.element.removeEventListener(this.eventName,this.keyPressHandler)},t.getKeyConfigData=function(e){if(e in this.configCache)return this.configCache[""+e];var t=e.toLowerCase().split("+"),i={altKey:-1!==t.indexOf("alt"),ctrlKey:-1!==t.indexOf("ctrl"),shiftKey:-1!==t.indexOf("shift"),keyCode:null};return t[t.length-1].length>1&&Number(t[t.length-1])?i.keyCode=Number(t[t.length-1]):i.keyCode=n.getKeyCode(t[t.length-1]),n.configCache[""+e]=i,i},t.getKeyCode=function(e){return vl[""+e]||e.toUpperCase().charCodeAt(0)},t.configCache={},bl([(0,o.Property)({})],t.prototype,"keyConfigs",void 0),bl([(0,o.Property)("keyup")],t.prototype,"eventName",void 0),bl([(0,o.Event)()],t.prototype,"keyAction",void 0),t=n=bl([o.NotifyPropertyChanges],t)}(o.Base),Cl=function(){function t(e,t){this.parent=e;var n=t;this.rendererFactory=n.getService("rendererFactory"),this.addEventListener()}return t.prototype.addEventListener=function(){this.parent.on(Ce,this.sourceCode,this),this.parent.on(u,this.onInitialEnd,this),this.parent.on(Ne,this.updateSourceCode,this),this.parent.on(f,this.destroy,this)},t.prototype.onInitialEnd=function(){this.parent.formatter.editorManager.observer.on(Gs,this.onKeyDown,this)},t.prototype.removeEventListener=function(){this.unWireEvent(),this.parent.off(Ce,this.sourceCode),this.parent.off(Ne,this.updateSourceCode),this.parent.off(u,this.onInitialEnd),this.parent.off(f,this.destroy),this.parent.formatter.editorManager.observer.off(Gs,this.onKeyDown)},t.prototype.getSourceCode=function(){return this.parent.createElement("textarea",{className:So+this.parent.getCssClass(!0)})},t.prototype.wireEvent=function(e){this.keyboardModule=new yl(e,{keyAction:this.previewKeyDown.bind(this),keyConfigs:this.parent.formatter.keyConfig,eventName:"keydown"}),o.EventHandler.add(this.previewElement,"mousedown",this.mouseDownHandler,this)},t.prototype.unWireEvent=function(){this.previewElement&&o.EventHandler.remove(this.previewElement,"mousedown",this.mouseDownHandler),this.keyboardModule&&!this.keyboardModule.isDestroyed&&this.keyboardModule.destroy()},t.prototype.wireBaseKeyDown=function(){this.parent.keyboardModule=new yl(this.contentModule.getEditPanel(),{keyAction:this.parent.keyDown.bind(this.parent),keyConfigs:this.parent.formatter.keyConfig,eventName:"keydown"})},t.prototype.unWireBaseKeyDown=function(){this.parent.keyboardModule.destroy()},t.prototype.mouseDownHandler=function(e){this.parent.notify(Me,{args:e})},t.prototype.previewKeyDown=function(e){switch(e.action){case"html-source":this.updateSourceCode(e),e.preventDefault();break;case"toolbar-focus":if(this.parent.toolbarSettings.enable&&this.parent.getToolbarElement()){var t=this.parent.getToolbarElement().querySelector(".e-toolbar-item:not(.e-overlay)[title]");t.firstElementChild.removeAttribute("tabindex"),t.firstElementChild.focus()}}},t.prototype.onKeyDown=function(e){if("html-source"===e.event.action)e.event.preventDefault(),this.sourceCode(e),e.callBack({requestType:"SourceCode",editorMode:"HTML",event:e.event})},t.prototype.sourceCode=function(t){var n=this;this.parent.notify(Qt,{}),this.parent.isBlur=!1,this.parent.trigger($,{requestType:"SourceCode",targetItem:"SourceCode",args:t,cancel:!1},(function(i){if(!i.cancel){var r=(0,o.selectAll)("."+Un,n.parent.element);n.contentModule=n.rendererFactory.getRenderer(e.Content);var s=n.parent.inputElement.getBoundingClientRect().height;n.parent.rootContainer.classList.add("e-source-code-enabled"),n.parent.notify(ne,{targetItem:"SourceCode",updateItem:"Preview",baseToolbar:n.parent.getBaseToolbarObject()}),(0,o.isNullOrUndefined)(n.previewElement)&&(n.previewElement=n.getSourceCode()),n.parent.inputElement.innerHTML=Hr(n.replaceAmpersand(n.parent.inputElement.innerHTML),n.parent.editorMode),n.parent.updateValueData();var a=void 0;(0,o.isNullOrUndefined)(n.parent.element.querySelector("#"+n.parent.getID()+"_source-view"))?a=n.parent.createElement("div",{className:"e-source-content",id:n.parent.getID()+"_source-view",attrs:{style:"height:"+s+"px"}}):(a=n.parent.element.querySelector("#"+n.parent.getID()+"_source-view")).style.height=s+"px",a.appendChild(n.previewElement),n.parent.rootContainer.appendChild(a),n.getPanel().value=Hr(n.getTextAreaValue(),n.parent.editorMode),n.parent.isBlur=!1,n.parent.disableToolbarItem(n.parent.toolbarSettings.items),n.parent.enableToolbarItem("SourceCode"),n.parent.getToolbar()&&(0,o.removeClass)([n.parent.getToolbar()],[gi]),(0,o.removeClass)(r,[fi]),n.wireEvent(n.previewElement),n.unWireBaseKeyDown(),n.previewElement.focus(),n.parent.inputElement.innerHTML=Hr(n.replaceAmpersand(n.parent.inputElement.innerHTML),n.parent.editorMode),n.parent.updateValue(),n.parent.trigger(Z,{requestType:"SourceCode",targetItem:"SourceCode",args:t}),n.parent.invokeChangeEvent(),!(0,o.isNullOrUndefined)(n.parent.saveInterval)&&n.parent.saveInterval>0&&n.parent.autoSaveOnIdle&&(n.codeViewTimeInterval=setInterval((function(){n.parent.notify(Xt,{})}),n.parent.saveInterval))}}))},t.prototype.updateSourceCode=function(e){var t=this;this.parent.isBlur=!1,this.parent.trigger($,{requestType:"Preview",targetItem:"Preview",args:e,cancel:!1},(function(n){if(!n.cancel){t.parent.rootContainer.classList.remove("e-source-code-enabled");var i=t.getPanel();t.parent.notify(ne,{targetItem:"Preview",updateItem:"SourceCode",baseToolbar:t.parent.getBaseToolbarObject()}),(0,o.isNullOrUndefined)(i)||(i.value=Pr(t.replaceAmpersand(i.value),t.parent.editorMode));var r=t.parent.serializeValue(i.value),s=void 0;s=null===r||""===r?"DIV"===t.parent.enterKey?"<div><br/></div>":"BR"===t.parent.enterKey?"<br/>":"<p><br/></p>":r,t.contentModule.getEditPanel().innerHTML=Pr(t.replaceAmpersand(s),t.parent.editorMode),t.parent.isBlur=!1,t.parent.enableToolbarItem(t.parent.toolbarSettings.items),t.parent.getToolbar()&&(0,o.removeClass)([t.parent.getToolbar()],[gi]),t.unWireEvent(),t.wireBaseKeyDown(),t.contentModule.getEditPanel().focus(),t.parent.updateValue(),t.parent.trigger(Z,{requestType:"Preview",targetItem:"Preview",args:e}),t.parent.formatter.enableUndo(t.parent),t.parent.addAudioVideoWrapper(),clearTimeout(t.codeViewTimeInterval),t.parent.invokeChangeEvent(),t.parent.notify(a,{})}}))},t.prototype.replaceAmpersand=function(e){var t=this;if("HTML"===this.parent.editorMode){["times","divide","ne"].forEach((function(n){var i=new RegExp("&(amp;)*("+n+")","g");if(t.parent.enableHtmlSanitizer){var o=t.parent.enableHtmlEncode?"&amp;amp;amp;amp;"+n:"&amp;amp;"+n;e=e.replace(i,o)}else e=e.replace(i,"&amp;"+n)}))}return e},t.prototype.getTextAreaValue=function(){return"<p><br></p>"===this.contentModule.getEditPanel().innerHTML||"<div><br></div>"===this.contentModule.getEditPanel().innerHTML||"<br>"===this.contentModule.getEditPanel().innerHTML||1===this.contentModule.getEditPanel().childNodes.length&&"P"===this.contentModule.getEditPanel().childNodes[0].tagName&&7===this.contentModule.getEditPanel().innerHTML.length||"DIV"===this.contentModule.getEditPanel().childNodes[0].tagName&&11===this.contentModule.getEditPanel().innerHTML.length?"":this.parent.value},t.prototype.getPanel=function(){return this.parent.element&&this.parent.element.querySelector(".e-rte-srctextarea")},t.prototype.destroy=function(){(0,o.isNullOrUndefined)(this.parent)||this.removeEventListener()},t}(),Nl=function(){function t(e,t){this.ensureInsideTableList=!0,this.pageX=null,this.pageY=null,this.moveEle=null,this.currentColumnResize="",this.resizeEndTime=0,this.isTableMoveActive=!1,this.isResizeBind=!0,this.parent=e,this.rteID=e.element.id,this.l10n=t.getService("rteLocale"),this.rendererFactory=t.getService("rendererFactory"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.isDestroyed=!1}return t.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(Ve,this.renderDlgContent,this),this.parent.on(u,this.afterRender,this),this.parent.on(kt,this.afterRender,this),this.parent.on(jt,this.showDialog,this),this.parent.on(Ft,this.closeDialog,this),this.parent.on(We,this.docClick,this),this.parent.on(m,this.onIframeMouseDown,this),this.parent.on(Ae,this.editAreaClickHandler,this),this.parent.on($e,this.clearDialogObj,this),this.parent.on(Qe,this.onToolbarAction,this),this.parent.on(I,this.dropdownSelect,this),this.parent.on(k,this.keyDown,this),this.parent.on(O,this.tableModulekeyUp,this),this.parent.on(qt,this.setCssClass,this),this.parent.on(f,this.destroy,this),this.parent.on(Gt,this.afterKeyDown,this),this.parent.on(Ze,this.hideTableQuickToolbar,this))},t.prototype.removeEventListener=function(){this.parent.off(Ve,this.renderDlgContent),this.parent.off(u,this.afterRender),this.parent.off(kt,this.afterRender),this.parent.off(We,this.docClick),this.parent.off(m,this.onIframeMouseDown),this.parent.off(jt,this.showDialog),this.parent.off(Ft,this.closeDialog),this.parent.off(Ae,this.editAreaClickHandler),this.parent.off($e,this.clearDialogObj),this.parent.off(Qe,this.onToolbarAction),this.parent.off(I,this.dropdownSelect),this.parent.off(De,this.cellSelect),this.parent.off(Ze,this.hideTableQuickToolbar),this.parent.off(k,this.keyDown),this.parent.off(O,this.tableModulekeyUp),this.parent.off(qt,this.setCssClass),this.parent.off(f,this.destroy),this.parent.off(Gt,this.afterKeyDown),!o.Browser.isDevice&&this.parent.tableSettings.resize&&(o.EventHandler.remove(this.contentModule.getEditPanel(),"mouseover",this.resizeHelper),o.EventHandler.remove(this.contentModule.getEditPanel(),o.Browser.touchStartEvent,this.resizeStart))},t.prototype.updateCss=function(e,t){e&&t.cssClass&&((0,o.isNullOrUndefined)(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},t.prototype.setCssClass=function(e){this.popupObj&&e.cssClass&&((0,o.isNullOrUndefined)(e.oldCssClass)||Fs([this.popupObj.element],e.oldCssClass),(0,o.addClass)([this.popupObj.element],e.cssClass)),this.updateCss(this.createTableButton,e),this.updateCss(this.editdlgObj,e);for(var t=[this.columnTextBox,this.rowTextBox,this.tableWidthNum,this.tableCellPadding,this.tableCellSpacing],n=0;n<t.length;n++)this.updateCss(t[n],e)},t.prototype.afterRender=function(){(0,o.isNullOrUndefined)(this.contentModule)&&(this.contentModule=this.rendererFactory.getRenderer(e.Content),this.parent.on(De,this.cellSelect,this),this.parent.tableSettings.resize&&o.EventHandler.add(this.parent.contentModule.getEditPanel(),o.Browser.touchStartEvent,this.resizeStart,this),!o.Browser.isDevice&&this.parent.tableSettings.resize&&o.EventHandler.add(this.contentModule.getEditPanel(),"mouseover",this.resizeHelper,this))},t.prototype.dropdownSelect=function(e){var t=e.item;if(document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))&&"Table"===t.command){var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i={args:e,selection:this.parent.formatter.editorManager.nodeSelection.save(n,this.contentModule.getDocument()),selectParent:this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n)};switch(t.subCommand){case"InsertRowBefore":case"InsertRowAfter":this.addRow(i.selection,e);break;case"InsertColumnLeft":case"InsertColumnRight":this.addColumn(i.selection,e);break;case"DeleteColumn":case"DeleteRow":this.removeRowColumn(i.selection,e);break;case"AlignTop":case"AlignMiddle":case"AlignBottom":this.verticalAlign(i,e);break;case"Dashed":case"Alternate":case"Custom":this.tableStyles(i,e);break;case"Merge":case"VerticalSplit":case"HorizontalSplit":this.UpdateCells(i.selection,e)}}},t.prototype.UpdateCells=function(e,t){this.parent.formatter.process(this.parent,t,t,{selection:e,subCommand:t.item.subCommand}),this.hideTableQuickToolbar()},t.prototype.keyDown=function(e){var t=e.args,n=this;switch(t.action){case"escape":break;case"insert-table":"HTML"===this.parent.editorMode?this.openDialog(!0,e):"Markdown"===this.parent.editorMode&&this.parent.formatter.process(this.parent,null,t),t.preventDefault()}if(!(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)&&this.contentModule&&"KeyK"!==t.code){var i=void 0,r=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),s=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(r)[0];if(s=s&&"TD"!==s.tagName&&"TH"!==s.tagName?s.parentElement:s,(8===t.keyCode||46===t.keyCode||t.ctrlKey&&88===t.keyCode)&&(s&&"TBODY"===s.tagName?(!(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)&&this.contentModule&&(i=this.parent.formatter.editorManager.nodeSelection.save(r,this.contentModule.getDocument())),t.preventDefault(),n.removeTable(i,t,!0)):s&&s.querySelectorAll("table").length>0&&(this.removeResizeElement(),this.hideTableQuickToolbar())),s&&"TD"!==s.tagName&&"TH"!==s.tagName){var a=(0,o.closest)(s,"td");s=!(0,o.isNullOrUndefined)(a)&&this.parent.inputElement.contains(a)?a:s}if(s&&("TD"===s.tagName||"TH"===s.tagName)){var l=this.contentModule.getEditPanel().querySelectorAll(".e-cell-select-end");if(!(0,o.isNullOrUndefined)(this.activeCell)&&this.activeCell===s||(0,o.isNullOrUndefined)(l)||0!==l.length||(this.activeCell=s),!(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)&&this.contentModule&&(i=this.parent.formatter.editorManager.nodeSelection.save(r,this.contentModule.getDocument())),!t.shiftKey||t.shiftKey&&9===t.keyCode)switch(t.keyCode){case 9:case 37:case 39:n.tabSelection(t,i,s);break;case 40:case 38:n.tableArrowNavigation(t,i,s)}}}if("HTML"!==this.parent.editorMode||!t.shiftKey||39!==t.keyCode&&37!==t.keyCode&&38!==t.keyCode&&40!==t.keyCode||(this.keyDownEventInstance=t,o.EventHandler.add(this.parent.contentModule.getDocument(),"selectionchange",this.tableCellsKeyboardSelection,this)),t.ctrlKey&&"a"===t.key&&this.handleSelectAll(),("Delete"===t.code&&46===t.which||"Backspace"===t.code&&8===t.which)&&"HTML"===this.parent.editorMode){if((r=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument())).startContainer.nodeType===Node.ELEMENT_NODE&&"DIV"===r.startContainer.nodeName&&r.startContainer.classList.contains("e-table-fake-selection"))this.deleteTable(),t.preventDefault();else(h="Delete"===t.code&&46===t.which?this.getAdjacentTableElement(r,!0):this.getAdjacentTableElement(r,!1))&&(this.updateTableSelection(h),t.preventDefault())}else{var d=t.shiftKey&&"Enter"===t.key,c=-1!==To.indexOf(t.key);if(d||c||t.key&&1===t.key.length){var h;if(h=this.parent.contentModule.getEditPanel().querySelector("table.e-cell-select"))if(39===t.keyCode||37===t.keyCode)this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),h,0);else{var p=h.querySelector("tr").cells[0];this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),p,p,0,0)}this.removeTableSelection()}}},t.prototype.tableCellsKeyboardSelection=function(e){o.EventHandler.remove(this.parent.contentModule.getDocument(),"selectionchange",this.tableCellsKeyboardSelection);var t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),n=this.keyDownEventInstance,i=!((0,o.isNullOrUndefined)(t)||(0,o.isNullOrUndefined)(t.commonAncestorContainer)||t.commonAncestorContainer.nodeType!==Node.ELEMENT_NODE||"TR"!==t.commonAncestorContainer.tagName&&"TBODY"!==t.commonAncestorContainer.tagName||(0,o.isNullOrUndefined)(this.activeCell)),r=this.contentModule.getEditPanel().querySelectorAll(".e-cell-select-end");if(!(0,o.isNullOrUndefined)(r)&&r.length>0&&(this.parent.formatter.editorManager.nodeSelection.Clear(this.parent.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(),r[0],r[0],0,0),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),r[0],0)),i||!(0,o.isNullOrUndefined)(r)&&r.length>0){var s=this.getCorrespondingColumns(),a=!(0,o.isNullOrUndefined)(r)&&r.length>0?r[0]:this.activeCell,l=this.getCorrespondingIndex(a,s),d=l[0],c=l[1],h=void 0;39===n.keyCode?c<s[0].length-1?h=s[d][c+1]:d<s.length-1?(h=s[d+1][c],0===r.length&&d<s.length-1&&(this.activeCell=s[d][0])):this.resetTableSelection():37===n.keyCode?0<c?h=s[d][c-1]:0<d?(h=s[d-1][c],0===r.length&&0<d&&(this.activeCell=s[d][s[d].length-1])):this.resetTableSelection():38===n.keyCode?0<d?h=s[d-1][c]:this.resetTableSelection():40===n.keyCode&&(d<s.length-1?h=s[d+1][c]:this.resetTableSelection()),h&&this.parent.formatter.editorManager.observer.notify("TABLE_MOVE",{event:{target:h},selectNode:[this.activeCell]})}r.length>0&&(n.preventDefault(),e.preventDefault())},t.prototype.resetTableSelection=function(){var e=this.contentModule.getEditPanel().querySelectorAll(".e-cell-select-end");!(0,o.isNullOrUndefined)(e)&&e.length>0&&this.parent.formatter.editorManager.nodeSelection.setSelectionNode(this.parent.contentModule.getDocument(),this.curTable),this.activeCell=null,this.removeCellSelectClasses(),this.removeTableSelection()},t.prototype.getCorrespondingColumns=function(){for(var e=[],t=this.curTable.rows,n=0;n<=t.length-1;n++)for(var i=t[n],o=0,r=0;r<=i.children.length-1;r++){for(var s=i.children[r],a=s,l=parseInt(a.getAttribute("colspan"),10)||1,d=parseInt(a.getAttribute("rowspan"),10)||1,c=n;c<n+d;c++)for(var h=o;h<o+l;h++)e[c]||(e[c]=[]),e[c][h]?o++:e[c][h]=s;o+=0}return e},t.prototype.getCorrespondingIndex=function(e,t){for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)if(t[n][i]===e)return[n,i];return[]},t.prototype.getAdjacentTableElement=function(e,t){if(!e.collapsed||!t&&this.quickToolObj&&this.quickToolObj.tableQTBar&&document.body.contains(this.quickToolObj.tableQTBar.element))return null;var n=this.getNodeCollection(e),i=e.collapsed&&this.parent.contentModule.getEditPanel()===e.startContainer&&n&&n.length>0&&n[0]?n[0]:e.startContainer,o=this.getSelectedTableEle(n),r=this.getBrElement(e,n);if(i&&i.nodeType===Node.ELEMENT_NODE&&("IMG"===i.tagName||i.querySelector("img")||"AUDIO"===i.tagName||i.querySelector("audio")||"VIDEO"===i.tagName||i.querySelector("video")||i.querySelector(".e-video-clickelem"))){var s=this.contentModule.getDocument().createRange();s.collapse(!0),s.selectNodeContents(i);var a=this.parent.formatter.editorManager.nodeSelection.getIndex(i);if(t&&s.startOffset>=e.startOffset||!t&&("IMG"!==i.tagName&&s.startOffset!==e.startOffset||"IMG"===i.tagName&&a!==e.startOffset))return null}if(i&&i.nodeType===Node.TEXT_NODE)if(t){if(e.endOffset!==e.endContainer.textContent.length&&e.endOffset!==e.endContainer.textContent.trim().length)return null}else if(0!==e.startOffset)return null;if(i&&i.nodeType===Node.ELEMENT_NODE&&"TABLE"===i.tagName&&(o=i),o){var l=this.parent.formatter.editorManager.nodeSelection.getIndex(o);e.startOffset===l&&t||e.startOffset!==l&&!t||(o=null)}return!o&&i&&(o=this.getAdjacentElementFromDom(i,r,t)),o&&o.nodeType===Node.ELEMENT_NODE&&"TABLE"===o.tagName?(this.setSelection(o,r),o):null},t.prototype.getAdjacentElementFromDom=function(e,t,n){for(var i,r=t||e.parentNode,s=e;r&&!i&&r.parentNode;){var a=Array.from(r.childNodes),l=a.indexOf(s);if(-1!==l&&(n&&l<a.length-1||!n&&l>0)?i=a[n?l+1:l-1]:(i=n?r.nextSibling:r.previousSibling,s=r),!t&&e.nodeType===Node.TEXT_NODE&&i&&i.tagName&&"BR"===i.tagName.toUpperCase()&&(t=s=r=i,i=null),t||!i||i.nodeType===Node.ELEMENT_NODE&&"TABLE"===i.tagName||(0,o.isNullOrUndefined)(i.textContent)||i.textContent.trim()||(s=r=i.parentNode,i=null),i&&i.tagName&&-1!==["UL","OL","LI"].indexOf(i.tagName.toUpperCase())&&!(i=this.getAdjacentElementFromList(i,n)))return null;r&&r.tagName&&"LI"===r.tagName.toUpperCase()&&!n&&(i=r),r=r.parentNode}return i},t.prototype.getAdjacentElementFromList=function(e,t){for(;e;){if(e.tagName&&-1===["UL","OL","LI"].indexOf(e.tagName.toUpperCase())){e.nodeType===Node.ELEMENT_NODE&&"TABLE"===e.tagName||(e=t?e.firstChild:e.lastChild);break}e=t?e.firstChild:e.lastChild}return e},t.prototype.getNodeCollection=function(e){var t=[];if(e.collapsed&&this.parent.contentModule.getEditPanel()===e.startContainer&&e.startContainer.childNodes.length>0){var n=Math.max(0,Math.min(e.startContainer.childNodes.length-1,e.endOffset-1));t.push(e.startContainer.childNodes[n])}else t=this.parent.formatter.editorManager.nodeSelection.getNodeCollection(e);return t},t.prototype.getSelectedTableEle=function(e){if(e&&e.length>0)for(var t=0,n=Array.from(e);t<n.length;t++){var i=n[t];if(i&&"TABLE"===i.tagName)return i}return null},t.prototype.getBrElement=function(e,t){return"BR"===e.endContainer.tagName?e.endContainer:1===t.length&&t[0]&&"BR"===t[0].tagName?t[0]:null},t.prototype.setSelection=function(e,t){if(!e.classList.contains("e-cell-select")){this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument()),t&&(t.parentNode&&1===t.parentNode.childNodes.length&&"BR"===t.parentNode.firstChild.nodeName?(0,o.detach)(t.parentNode):(0,o.detach)(t));var n=this.parent.createElement("div",{className:"e-table-fake-selection"});n.setAttribute("contenteditable","false"),this.contentModule.getEditPanel().appendChild(n),this.parent.formatter.editorManager.nodeSelection.setSelectionNode(this.contentModule.getDocument(),n)}},t.prototype.removeAllFakeSelectionEles=function(){var e=this.parent.contentModule.getEditPanel().querySelectorAll(".e-table-fake-selection");e&&e.length>0&&e.forEach((function(e){(0,o.detach)(e)}))},t.prototype.deleteTable=function(){var e=this.parent.contentModule.getEditPanel().querySelector("table.e-cell-select");if(this.removeResizeElement(),e){var t=document.createElement("br"),n=t;"DIV"===this.parent.enterKey?(n=document.createElement("div")).appendChild(t):"P"===this.parent.enterKey&&(n=document.createElement("p")).appendChild(t),e.parentNode.replaceChild(n,e),this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),n,n,0,0),this.removeTableSelection()}},t.prototype.removeTableSelection=function(){var e=this.parent.contentModule.getEditPanel().querySelector("table.e-cell-select");e&&Fs([e],Pi),this.removeAllFakeSelectionEles()},t.prototype.updateTableSelection=function(e){(0,o.addClass)([e],"e-cell-select")},t.prototype.handleSelectAll=function(){this.cancelResizeAction(),Fs(this.parent.inputElement.querySelectorAll("."+Pi),Pi),this.removeTableSelection()},t.prototype.tableModulekeyUp=function(e){if(!(0,o.isNullOrUndefined)(this.parent.formatter.editorManager.nodeSelection)&&this.contentModule){var t=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),n=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t)[0];if((n=n&&"TD"!==n.tagName&&"TH"!==n.tagName?n.parentElement:n)&&"TD"!==n.tagName&&"TH"!==n.tagName){var i=(0,o.closest)(n,"td");n=!(0,o.isNullOrUndefined)(i)&&this.parent.inputElement.contains(i)?i:n}(n&&"TD"===n.tagName||"TH"===n.tagName)&&!n.classList.contains(Pi)&&n.classList.add(Pi);var r=e.args;this.previousTableElement===n||(0,o.isNullOrUndefined)(this.previousTableElement)||r.shiftKey||39!==r.keyCode&&37!==r.keyCode&&38!==r.keyCode&&40!==r.keyCode||(Fs([this.previousTableElement],Pi),this.removeTableSelection())}},t.prototype.openDialog=function(e,t){if(e||this.parent.contentModule.getEditPanel().focus(),"HTML"===this.parent.editorMode){var n=this.parent.contentModule.getDocument(),i=this.parent.formatter.editorManager.nodeSelection.getRange(n),o=this.parent.formatter.editorManager.nodeSelection.save(i,n),r={originalEvent:t?t.args:{action:"insert-table"},item:{command:"Table",subCommand:"CreateTable"},name:e?null:"showDialog"};this.insertTableDialog({self:this,args:r,selection:o})}},t.prototype.showDialog=function(){this.openDialog(!1),this.setCssClass({cssClass:this.parent.getCssClass()})},t.prototype.closeDialog=function(){this.editdlgObj&&this.editdlgObj.hide({returnValue:!0})},t.prototype.onToolbarAction=function(e){switch(e.args.item.subCommand){case"TableHeader":this.tableHeader(e.selection,e.args);break;case"TableRemove":this.removeTable(e.selection,e.args);break;case"TableEditProperties":this.editTable(e)}},t.prototype.verticalAlign=function(e,t){var n=(0,o.closest)(e.selectParent[0],"th")||(0,o.closest)(e.selectParent[0],"td");n&&this.parent.formatter.process(this.parent,t,t,{tableCell:n,subCommand:t.item.subCommand})},t.prototype.tableStyles=function(e,t){var n=t.item.subCommand,i=(0,o.closest)(e.selectParent[0],"table");if("Dashed"===n&&(this.parent.element.classList.contains(Fi)?Fs([this.parent.element],Fi):this.parent.element.classList.add(Fi),i.classList.contains(Fi)?Fs([i],Fi):i.classList.add(Fi)),"Alternate"===n&&(this.parent.element.classList.contains(qi)?Fs([this.parent.element],qi):this.parent.element.classList.add(qi),i.classList.contains(qi)?Fs([i],qi):i.classList.add(qi)),e.args&&e.args.item.cssClass)for(var r=e.args.item.cssClass.split(" "),s=0;s<r.length;s++)i.classList.contains(r[s])?Fs([i],r[s]):i.classList.add(r[s]);this.parent.formatter.process(this.parent,t,t,{subCommand:t.item.subCommand}),this.parent.formatter.saveData(),this.hideTableQuickToolbar(),this.parent.formatter.editorManager.nodeSelection.restore()},t.prototype.insideList=function(e){for(var t=this.getBlockNodesInSelection(e),n=[],i=0;i<t.length;i++)"LI"===t[i].parentNode.tagName?n.push(t[i].parentNode):"LI"===t[i].tagName&&"P"!==t[i].childNodes[0].tagName&&"OL"!==t[i].childNodes[0].tagName&&"UL"!==t[i].childNodes[0].tagName&&n.push(t[i]);return n.length>1||n.length&&0===e.startOffset&&0===e.endOffset?(this.ensureInsideTableList=!0,!0):(this.ensureInsideTableList=!1,!1)},t.prototype.getBlockNodesInSelection=function(e){var t=["DIV","SECTION","HEADER","FOOTER","ARTICLE","NAV","P","H1","H2","H3","BLOCKQUOTE","LI","PRE","TD","TH","FORM","FIELDSET","LEGEND","LABEL","TEXTAREA"],n=new Set,i=this.contentModule.getDocument().createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,{acceptNode:function(t){return e.intersectsNode(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});if(e.collapsed)(o=this.getImmediateBlockNode(e.startContainer,t))&&n.add(o);else for(;i.nextNode();){var o;(o=this.getImmediateBlockNode(i.currentNode,t))&&n.add(o)}return Array.from(n)},t.prototype.getImmediateBlockNode=function(e,t){for(var n=e.nodeType===Node.TEXT_NODE?e.parentNode:e;n&&n.nodeType===Node.ELEMENT_NODE;){var i=n;if(t.indexOf(i.tagName)>-1)return i;n=n.parentNode}return null},t.prototype.removeEmptyTextNodes=function(e){for(var t=e.childNodes,n=t.length-1;n>=0;n--){var i=t[n];i.nodeType===Node.TEXT_NODE&&""===i.nodeValue.trim()&&e.removeChild(i)}},t.prototype.tabSelection=function(e,t,n){for(var i=n.closest("table").querySelectorAll("thead, tbody, tr"),r=0;r<i.length;r++)this.removeEmptyTextNodes(i[r]);this.previousTableElement=n;var s=this.insideList(t.range);if(37!==e.keyCode&&39!==e.keyCode&&!s)if(e.preventDefault(),Fs([n],Pi),this.removeTableSelection(),e.shiftKey||37===e.keyCode){var a=(0,o.isNullOrUndefined)(n.previousSibling)?(0,o.isNullOrUndefined)((0,o.closest)(n,"tr").previousSibling)?(0,o.isNullOrUndefined)((0,o.closest)(n,"table").previousSibling)?n:"td"===(0,o.closest)(n,"table").previousSibling.nodeName.toLowerCase()?(0,o.closest)(n,"table").previousSibling:n:(0,o.closest)(n,"tr").previousSibling.childNodes[(0,o.closest)(n,"tr").previousSibling.childNodes.length-1]:n.previousSibling;if(n===a&&0===n.cellIndex&&(0,o.closest)(n,"table").tHead&&"TH"!==n.nodeName){var l=(0,o.closest)(n,"table");a=l.rows[0].cells[l.rows[0].cells.length-1]}if(37===e.keyCode&&n===a&&(a=(0,o.closest)(n,"table").previousSibling),!(0,o.isNullOrUndefined)(a)&&"TABLE"===a.firstChild.nodeName){for(var d=a;!(0,o.isNullOrUndefined)(d.firstChild)&&"TABLE"===d.firstChild.nodeName&&d.firstChild.rows.length>0&&d.firstChild.rows[0].cells.length>0;)d=d.firstChild.rows[0].cells[0];a=d}a&&(""!==a.textContent.trim()&&(0,o.closest)(a,"td")?t.setSelectionNode(this.contentModule.getDocument(),a):t.setSelectionText(this.contentModule.getDocument(),a,a,0,0))}else{var c=(0,o.isNullOrUndefined)(n.nextSibling)?(0,o.isNullOrUndefined)((0,o.closest)(n,"tr").nextSibling)?(0,o.isNullOrUndefined)((0,o.closest)(n,"table").nextSibling)?n:"td"===(0,o.closest)(n,"table").nextSibling.nodeName.toLowerCase()?(0,o.closest)(n,"table").nextSibling:n:(0,o.closest)(n,"tr").nextSibling.childNodes[0]:n.nextSibling;n===c&&"TH"===n.nodeName&&(c=(0,o.closest)(n,"table").rows[1].cells[0]),39===e.keyCode&&n===c&&(c=(0,o.closest)(n,"table").nextSibling),c&&(""!==c.textContent.trim()&&(0,o.closest)(c,"td")?t.setSelectionNode(this.contentModule.getDocument(),c):t.setSelectionText(this.contentModule.getDocument(),c,c,0,0)),n===c&&39!==e.keyCode&&c&&(n.classList.add(Pi),this.addRow(t,e,!0),Fs([n],Pi),this.removeTableSelection(),""!==(c=c.parentElement.nextSibling?c.parentElement.nextSibling.firstChild:c.parentElement.firstChild).textContent.trim()&&(0,o.closest)(c,"td")?t.setSelectionNode(this.contentModule.getDocument(),c):t.setSelectionText(this.contentModule.getDocument(),c,c,0,0))}},t.prototype.tableArrowNavigation=function(e,t,n){var i=t.range.startContainer;this.previousTableElement=n,40===e.keyCode&&3===i.nodeType&&(i.nextSibling&&"BR"===i.nextSibling.nodeName||i.parentNode&&"TD"!==i.parentNode.nodeName)||38===e.keyCode&&3===i.nodeType&&(i.previousSibling&&"BR"===i.previousSibling.nodeName||i.parentNode&&"TD"!==i.parentNode.nodeName)||(e.preventDefault(),Fs([n],Pi),this.removeTableSelection(),(n=40===e.keyCode?(0,o.isNullOrUndefined)((0,o.closest)(n,"tr").nextElementSibling)?(0,o.closest)(n,"table").tHead&&"TH"===n.nodeName?(0,o.closest)(n,"table").rows[1].cells[n.cellIndex]:(0,o.isNullOrUndefined)((0,o.closest)(n,"table").nextSibling)?n:(0,o.closest)(n,"table").nextSibling:(0,o.closest)(n,"tr").nextElementSibling.children[n.cellIndex]:(0,o.isNullOrUndefined)((0,o.closest)(n,"tr").previousElementSibling)?(0,o.closest)(n,"table").tHead&&"TH"!==n.nodeName?(0,o.closest)(n,"table").tHead.rows[0].cells[n.cellIndex]:(0,o.isNullOrUndefined)((0,o.closest)(n,"table").previousSibling)?n:(0,o.closest)(n,"table").previousSibling:(0,o.closest)(n,"tr").previousElementSibling.children[n.cellIndex])&&t.setSelectionText(this.contentModule.getDocument(),n,n,0,0))},t.prototype.hideTableQuickToolbar=function(){this.quickToolObj&&this.quickToolObj.tableQTBar&&document.body.contains(this.quickToolObj.tableQTBar.element)&&this.quickToolObj.tableQTBar.hidePopup()},t.prototype.tableHeader=function(e,t){this.parent.formatter.process(this.parent,t,t.originalEvent,{selection:e,subCommand:t.item.subCommand})},t.prototype.getAnchorNode=function(e){var t=(0,o.closest)(e,"a");return t||e},t.prototype.editAreaClickHandler=function(t){if(!this.parent.readonly&&(0,o.isNullOrUndefined)((0,o.closest)(t.args.target,".e-img-caption"))){var n=t.args,i=this.parent.quickToolbarSettings.showOnRightClick;if(!(2===n.which||i&&1===n.which||!i&&3===n.which)&&"HTML"===this.parent.editorMode&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.tableQTBar){this.quickToolObj=this.parent.quickToolbarModule;var r=n.target;if(this.contentModule=this.rendererFactory.getRenderer(e.Content),this.quickToolObj.tableQTBar.element.classList.contains("e-rte-pop"))return;var s=this.parent.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument()),a=(0,o.closest)(r,"table"),l=this.parent.getRange().startContainer.parentElement,d=this.parent.getRange().endContainer.parentElement,c=this.getAnchorNode(r),h=(new Date).getTime(),p="macOS"===this.parent.userAgentData.getPlatform()&&3===n.which;if(!(r&&"A"!==r.nodeName&&"A"!==c.nodeName&&"IMG"!==r.nodeName&&"VIDEO"!==r.nodeName&&!r.classList.contains(ei)&&"AUDIO"!==r.nodeName&&(l===d||p)&&("TD"===r.nodeName||"TH"===r.nodeName||"TABLE"===r.nodeName||a&&this.parent.contentModule.getEditPanel().contains(a))&&(3!==s.startContainer.nodeType||s.collapsed||p)&&h-this.resizeEndTime>100)||p&&s.collapsed&&0!==s.startOffset||p&&"#text"===s.endContainer.nodeName)this.hideTableQuickToolbar();else{var u=this.parent.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument());this.parent.formatter.editorManager.nodeSelection.save(u,this.contentModule.getDocument()),this.parent.formatter.editorManager.nodeSelection.Clear(this.contentModule.getDocument());var m=void 0,f=void 0;o.Browser.isDevice&&t.args.touches?(m=this.parent.iframeSettings.enable?window.pageXOffset+this.parent.element.getBoundingClientRect().left+t.args.changedTouches[0].clientX:t.args.changedTouches[0].pageX,f=this.parent.iframeSettings.enable?window.pageYOffset+this.parent.element.getBoundingClientRect().top+(this.parent.inlineMode.enable?0:this.parent.toolbarModule.getToolbarHeight())+t.args.changedTouches[0].clientY:t.args.changedTouches[0].pageY):(m=this.parent.iframeSettings.enable?window.pageXOffset+this.parent.element.getBoundingClientRect().left+n.clientX:n.pageX,f=this.parent.iframeSettings.enable?window.pageYOffset+this.parent.element.getBoundingClientRect().top+this.parent.toolbarModule.getToolbarHeight()+n.clientY:n.pageY),this.quickToolObj.tableQTBar.showPopup(m,f,r),this.parent.formatter.editorManager.nodeSelection.restore()}}}},t.prototype.tableCellSelect=function(e){var t=e.target,n=Array.prototype.slice.call(t.parentElement.parentElement.children).indexOf(t.parentElement),i=Array.prototype.slice.call(t.parentElement.children).indexOf(t),r=this.dlgDiv.querySelectorAll(".e-rte-tablecell");Array.prototype.forEach.call(r,(function(e){var t=Array.prototype.slice.call(e.parentElement.parentElement.children).indexOf(e.parentElement),r=Array.prototype.slice.call(e.parentElement.children).indexOf(e);Fs([e],"e-active"),t<=n&&r<=i&&(0,o.addClass)([e],"e-active")})),this.tblHeader.innerHTML=i+1+"x"+(n+1)},t.prototype.tableMouseUp=function(){this.unwireTableSelectionEvents(),this.isTableMoveActive=!1},t.prototype.tableMouseLeave=function(){o.Browser.isDevice||(this.unwireTableSelectionEvents(),this.isTableMoveActive=!1,this.resetTableSelection())},t.prototype.tableCellLeave=function(e){Fs(this.dlgDiv.querySelectorAll(".e-rte-tablecell"),"e-active"),(0,o.addClass)([this.dlgDiv.querySelector(".e-rte-tablecell")],"e-active"),this.tblHeader.innerHTML="1x1"},t.prototype.tableCellClick=function(e){var t=e.target,n=Array.prototype.slice.call(t.parentElement.parentElement.children).indexOf(t.parentElement)+1,i=Array.prototype.slice.call(t.parentElement.children).indexOf(t)+1;this.self.tableInsert(n,i,e,this)},t.prototype.tableInsert=function(e,t,n,i){var r=i.self?i.self:this,s=i.selection.range.startContainer;"P"!==s.nodeName||""!==s.textContent.trim()||s.childNodes.length>0||(s.innerHTML="<br />");var a=s.parentNode;if("HTML"===r.parent.editorMode&&(r.parent.iframeSettings.enable&&!ur(a.ownerDocument.querySelector("body"),"e-lib")||!r.parent.iframeSettings.enable&&(0,o.isNullOrUndefined)((0,o.closest)(a,"[id='"+r.contentModule.getPanel().id+"']")))){r.contentModule.getEditPanel().focus();var l=r.parent.formatter.editorManager.nodeSelection.getRange(r.contentModule.getDocument());i.selection=r.parent.formatter.editorManager.nodeSelection.save(l,r.contentModule.getDocument())}var d={rows:e,columns:t,width:{minWidth:r.parent.tableSettings.minWidth,maxWidth:r.parent.tableSettings.maxWidth,width:r.parent.tableSettings.width},selection:i.selection};if(r.popupObj){for(var c=Array.prototype.slice.call(n.target.parentElement.parentElement.children),h=0;h<c.length;h++){o.EventHandler.remove(c[h],"mouseleave",this.tableCellLeave);for(var p=Array.prototype.slice.call(c[h].children),u=0;u<p.length;u++)o.EventHandler.remove(p[u],"mousemove",this.tableCellSelect),o.EventHandler.remove(p[u],"mouseup",this.tableCellClick)}r.popupObj.hide()}r.editdlgObj&&r.editdlgObj.hide();var m=window.scrollX,f=window.scrollY;r.parent.formatter.process(r.parent,i.args,i.args.originalEvent,d),r.contentModule.getEditPanel().focus(),window.scrollTo(m,f),r.parent.on(De,r.cellSelect,r);var g=r.parent.formatter.editorManager.nodeSelection.get(r.contentModule.getDocument());(0,o.isNullOrUndefined)(g)||(0,o.isNullOrUndefined)(g.anchorNode)||g.anchorNode.nodeType!==Node.ELEMENT_NODE||"TD"!==g.anchorNode.tagName&&"TH"!==g.anchorNode.tagName||(r.curTable=(0,o.closest)(g.anchorNode,"table"),r.activeCell=g.anchorNode)},t.prototype.cellSelect=function(e){var t=e.args.target,n=(0,o.closest)(t,"td,th");if(t="TD"!==t.nodeName&&n&&this.parent.contentModule.getEditPanel().contains(n)?n:t,!(0,o.isNullOrUndefined)(this.activeCell)&&e.args.shiftKey&&!(0,o.isNullOrUndefined)(t)&&!(0,o.isNullOrUndefined)(t.tagName)&&("TD"===t.tagName||"TH"===t.tagName)&&this.activeCell!==t)return this.parent.formatter.editorManager.observer.notify("TABLE_MOVE",{event:e.args,selectNode:[this.activeCell]}),void e.args.preventDefault();this.parent.quickToolbarSettings.showOnRightClick&&3===e.args.which&&t.classList.contains(Pi)||(this.isTableMoveActive&&(this.unwireTableSelectionEvents(),this.isTableMoveActive=!1),this.activeCell=null,this.heightcheck(),this.removeCellSelectClasses(),this.removeTableSelection()),!t||"TD"!==t.tagName&&"TH"!==t.tagName||((0,o.addClass)([t],Pi),this.activeCell=t,this.curTable=this.curTable?this.curTable:(0,o.closest)(t,"table"),this.wireTableSelectionEvents(),this.isTableMoveActive=!0,this.removeResizeElement(),this.helper&&this.contentModule.getEditPanel().contains(this.helper)&&(0,o.detach)(this.helper))},t.prototype.heightcheck=function(){var e=this.parent.contentModule.getEditPanel().querySelector("td.e-cell-select");e&&e.querySelector("img")&&e.querySelector("img").style.height.includes("%")&&(e.style.height="inherit")},t.prototype.wireTableSelectionEvents=function(){o.EventHandler.add(this.curTable,"mousemove",this.tableMove,this),o.EventHandler.add(this.curTable,"mouseup",this.tableMouseUp,this),o.EventHandler.add(this.curTable,"mouseleave",this.tableMouseLeave,this)},t.prototype.unwireTableSelectionEvents=function(){o.EventHandler.remove(this.curTable,"mousemove",this.tableMove),o.EventHandler.remove(this.curTable,"mouseup",this.tableMouseUp),o.EventHandler.remove(this.curTable,"mouseleave",this.tableMouseLeave)},t.prototype.removeCellSelectClasses=function(){Fs(this.contentModule.getEditPanel().querySelectorAll("table td, table th"),Hi),Fs(this.contentModule.getEditPanel().querySelectorAll("table td, table th"),ji),Fs(this.contentModule.getEditPanel().querySelectorAll("table td, table th"),Pi)},t.prototype.tableMove=function(e){this.parent.formatter.editorManager.observer.notify("TABLE_MOVE",{event:e,selectNode:[this.activeCell]})},t.prototype.resizeHelper=function(e){if(!this.parent.readonly&&!(this.isTableMoveActive||e&&e.buttons&&e.buttons>0)){var t=e.target||e.targetTouches[0].target,n=(0,o.closest)(t,"table.e-rte-table, table.e-rte-paste-table, table.e-rte-custom-table"),i=this.parent.contentModule.getEditPanel().querySelectorAll(".e-table-box.e-rbox-select, .e-table-rhelper.e-column-helper, .e-table-rhelper.e-row-helper").length>0;i||(0,o.isNullOrUndefined)(this.curTable)||(0,o.isNullOrUndefined)(n)||n===this.curTable||!this.parent.contentModule.getEditPanel().contains(n)||(this.removeResizeElement(),this.removeHelper(e),this.cancelResizeAction()),i||"TABLE"!==t.nodeName&&"TD"!==t.nodeName&&"TH"!==t.nodeName||(this.curTable=n&&this.parent.contentModule.getEditPanel().contains(n)&&("TD"===t.nodeName||"TH"===t.nodeName)?n:t,this.removeResizeElement(),this.tableResizeEleCreation(this.curTable,e))}},t.prototype.tableResizeEleCreation=function(e,t){this.parent.preventDefaultResize(t);for(var n=this.calMaxCol(this.curTable),i=[],r=0;r<e.rows.length;r++)for(var s=0;s<e.rows[r].cells.length;s++)if(!e.rows[r].cells[s].hasAttribute("rowspan")){i.push(Array.prototype.slice.call(e.rows[r].cells,0,e.rows[r].cells.length)[s]);break}var a=parseInt(getComputedStyle(e).height,10),l=parseInt(getComputedStyle(e).width,10),d=this.calcPos(e);for(r=0;n.length>=r;r++){var c=this.parent.createElement("span",{attrs:{"data-col":r.toString(),unselectable:"on",contenteditable:"false"}});c.classList.add(yo,zi),n.length===r?c.style.cssText="height: "+a+"px; width: 4px; top: "+d.top+"px; left:"+((n[r-1].classList.contains("e-multi-cells-select")?0:d.left)+this.calcPos(n[r-1]).left+n[r-1].offsetWidth-2)+"px;":c.style.cssText="height: "+a+"px; width: 4px; top: "+d.top+"px; left:"+((n[r].classList.contains("e-multi-cells-select")?0:d.left)+this.calcPos(n[r]).left-2)+"px;",this.contentModule.getEditPanel().appendChild(c)}for(r=0;i.length>r;r++){var h=this.parent.createElement("span",{attrs:{"data-row":r.toString(),unselectable:"on",contenteditable:"false"}});h.classList.add(yo,_i);var p=(0,o.isNullOrUndefined)(e.getAttribute("cellspacing"))&&""===e.getAttribute("cellspacing")?this.calcPos(i[r]).left:0;h.style.cssText="width: "+l+"px; height: 4px; top: "+(this.calcPos(i[r]).top+(i[r].classList.contains("e-multi-cells-select")?0:d.top)+i[r].offsetHeight-2)+"px; left:"+(p+d.left)+"px;",this.contentModule.getEditPanel().appendChild(h)}var u=this.parent.createElement("span",{className:Vi+this.parent.getCssClass(!0),attrs:{"data-col":n.length.toString(),unselectable:"on",contenteditable:"false"}});u.style.cssText="top: "+(d.top+a-4)+"px; left:"+(d.left+l-4)+"px;",o.Browser.isDevice&&u.classList.add("e-rmob"),this.contentModule.getEditPanel().appendChild(u)},t.prototype.removeResizeElement=function(){var e=this.parent.contentModule.getEditPanel().querySelectorAll(".e-column-resize, .e-row-resize, .e-table-box");if(e.length>0)for(var t=0;t<e.length;t++)(0,o.detach)(e[t])},t.prototype.calcPos=function(e){for(var t={top:0,left:0},n=e.getBoundingClientRect(),i=e.ownerDocument,r=e.offsetParent||i.documentElement,s=!1;r&&(r===i.body||r===i.documentElement)&&"static"===r.style.position;)r=r.parentNode;return"TD"===r.nodeName&&"TABLE"===e.nodeName&&(r=(0,o.closest)(r,".e-rte-content"),s=!0),r&&r!==e&&1===r.nodeType&&(t=r.getBoundingClientRect()),s?(s=!1,{top:this.parent.inputElement&&this.parent.inputElement.scrollTop>0?this.parent.inputElement.scrollTop+n.top-t.top:n.top-t.top,left:this.parent.inputElement&&this.parent.inputElement.scrollLeft>0?this.parent.inputElement.scrollLeft+n.left-t.left:n.left-t.left}):{top:e.offsetTop,left:e.offsetLeft}},t.prototype.getPointX=function(e){return e.touches&&e.touches.length?e.touches[0].pageX:e.pageX},t.prototype.getPointY=function(e){return e.touches&&e.touches.length?e.touches[0].pageY:e.pageY},t.prototype.resizeStart=function(e){var t=this;if(!this.parent.readonly){o.Browser.isDevice&&this.resizeHelper(e);var n=e.target;if(n.classList.contains(zi)||n.classList.contains(_i)||n.classList.contains(Vi)){if(this.resetResizeHelper(this.curTable),e.preventDefault(),this.parent.preventDefaultResize(e),Fs(this.curTable.querySelectorAll("td,th"),Pi),this.removeTableSelection(),this.pageX=this.getPointX(e),this.pageY=this.getPointY(e),this.resizeBtnInit(),this.hideTableQuickToolbar(),n.classList.contains(zi)){if(this.resizeBtnStat.column=!0,parseInt(n.getAttribute("data-col"),10)===this.calMaxCol(this.curTable).length)this.currentColumnResize="last",this.colIndex=parseInt(n.getAttribute("data-col"),10)-1,this.columnEle=this.calMaxCol(this.curTable)[this.colIndex];else{if(0===parseInt(n.getAttribute("data-col"),10))this.currentColumnResize="first";else{this.currentColumnResize="middle";for(var i=this.curTable.rows[0].cells,r=0,s=0;s<i.length;s++)r+=i[s].colSpan;for(var a=new Array(r),l=(0,o.createElement)("colgroup"),d=new Map,c=0;c<this.curTable.rows.length;c++)for(var h=0,p=0;p<this.curTable.rows[c].cells.length;p++){for(var u=1;u<this.curTable.rows[c].cells[p].rowSpan;u++){var m=""+(c+u)+h;d.set(m,this.curTable.rows[c].cells[p])}var f=this.getCellIndex(d,c,p);f>h&&(h=f);var g=this.curTable.rows[c].cells[p].offsetWidth;(!a[h]||g<a[h])&&(a[h]=g),h+=1+this.curTable.rows[c].cells[p].colSpan-1}for(var b=0;b<a.length;b++){(s=(0,o.createElement)("col")).appendChild((0,o.createElement)("br")),s.style.width=this.convertPixelToPercentage(a[b],parseInt(getComputedStyle(this.curTable).width,10))+"%",l.appendChild(s)}this.curTable.insertBefore(l,this.curTable.firstChild);for(c=0;c<this.curTable.rows.length;c++)for(p=0;p<this.curTable.rows[c].cells.length;p++)this.curTable.rows[c].cells[p].style.width=""}this.colIndex=parseInt(n.getAttribute("data-col"),10),this.columnEle=this.calMaxCol(this.curTable)[this.colIndex]}this.moveEle=e.target,this.appendHelper()}if(n.classList.contains(_i)&&(this.rowEle=this.curTable.rows[parseInt(n.getAttribute("data-row"),10)],this.resizeBtnStat.row=!0,this.appendHelper()),n.classList.contains(Vi)&&(this.resizeBtnStat.tableBox=!0),o.Browser.isDevice&&this.helper&&!this.helper.classList.contains("e-reicon"))this.helper.classList.add("e-reicon"),o.EventHandler.add(document,o.Browser.touchStartEvent,this.removeHelper,this),o.EventHandler.add(this.helper,o.Browser.touchStartEvent,this.resizeStart,this);else{var v={event:e,requestType:"Table"};this.parent.trigger(_,v,(function(e){e.cancel&&t.cancelResizeAction()}))}this.isResizeBind&&(o.EventHandler.add(this.contentModule.getDocument(),o.Browser.touchMoveEvent,this.resizing,this),o.EventHandler.add(this.contentModule.getDocument(),o.Browser.touchEndEvent,this.resizeEnd,this),this.isResizeBind=!1)}}},t.prototype.getCellIndex=function(e,t,n){var i=""+t+n,o=e.get(i);return o?this.getCellIndex(e,t,n+o.colSpan):n},t.prototype.removeHelper=function(e){!e.target.classList.contains("e-reicon")&&this.helper&&(o.EventHandler.remove(document,o.Browser.touchStartEvent,this.removeHelper),o.EventHandler.remove(this.helper,o.Browser.touchStartEvent,this.resizeStart),this.helper&&this.contentModule.getEditPanel().contains(this.helper)&&(0,o.detach)(this.helper),this.pageX=null,this.helper=null)},t.prototype.appendHelper=function(){this.helper=this.parent.createElement("div",{className:"e-table-rhelper"+this.parent.getCssClass(!0)}),o.Browser.isDevice&&this.helper.classList.add("e-reicon"),this.contentModule.getEditPanel().appendChild(this.helper),this.setHelperHeight()},t.prototype.setHelperHeight=function(){var e=this.calcPos(this.curTable);this.resizeBtnStat.column?(this.helper.classList.add("e-column-helper"),this.helper.style.cssText="height: "+getComputedStyle(this.curTable).height+"; top: "+e.top+"px; left:"+(e.left+this.calcPos(this.columnEle).left+("last"===this.currentColumnResize?this.columnEle.offsetWidth:0)-1)+"px;"):(this.helper.classList.add("e-row-helper"),this.helper.style.cssText="width: "+getComputedStyle(this.curTable).width+"; top: "+(this.calcPos(this.rowEle).top+e.top+this.rowEle.offsetHeight-1)+"px; left:"+(this.calcPos(this.rowEle).left+e.left)+"px;")},t.prototype.updateHelper=function(){var e=this.calcPos(this.curTable);if(this.resizeBtnStat.column){var t=e.left+this.calcPos(this.columnEle).left+("last"===this.currentColumnResize?this.columnEle.offsetWidth:0)-1;this.helper.style.left=t+"px",this.helper.style.height=this.curTable.offsetHeight+"px"}else{var n=this.calcPos(this.rowEle).top+e.top+this.rowEle.offsetHeight-1;this.helper.style.top=n+"px"}},t.prototype.calMaxCol=function(e){for(var t=e.rows[0].cells,n=0,i=0;i<t.length;i++)n+=t[i].colSpan;for(var o=new Array(n),r=new Map,s=0;s<e.rows.length;s++)for(var a=0,l=0;l<e.rows[s].cells.length;l++){for(var d=1;d<e.rows[s].cells[l].rowSpan;d++){var c=""+(s+d)+a;r.set(c,e.rows[s].cells[l])}var h=this.getCellIndex(r,s,l);h>a&&(a=h);var p=e.rows[s].cells[l].offsetWidth;(!o[a]||p<o[a].offsetWidth)&&(o[a]=e.rows[s].cells[l]),a+=1+e.rows[s].cells[l].colSpan-1}return o},t.prototype.resizing=function(e){var t,n=this,i=this.getPointX(e),r=this.getPointY(e),s=this.parent.enableRtl?-(i-this.pageX):i-this.pageX,a=this.parent.enableRtl?-(r-this.pageY):r-this.pageY;this.pageX=i,this.pageY=r;var l=this.curTable.closest("td"),d={event:e,requestType:"table"};this.parent.trigger(V,d,(function(i){if(i.cancel)n.cancelResizeAction();else{var r=n.contentModule.getEditPanel().querySelector(".e-table-box"),d=parseInt(getComputedStyle(n.curTable).width,10),c=isNaN(parseInt(n.curTable.style.height,10))?parseInt(getComputedStyle(n.curTable).height,10):parseInt(n.curTable.style.height,10),h=+getComputedStyle(n.contentModule.getEditPanel()).paddingRight.match(/\d/g).join(""),p=n.contentModule.getEditPanel().offsetWidth-(n.contentModule.getEditPanel().offsetWidth-n.contentModule.getEditPanel().clientWidth)-2*h,u=void 0;if((0,o.isNullOrUndefined)(n.curTable.parentElement.closest("table"))||(0,o.isNullOrUndefined)(n.curTable.closest("td"))||!n.contentModule.getEditPanel().contains(n.curTable.closest("td")))u=p;else{var m=n.curTable.closest("td"),f=+getComputedStyle(m).paddingRight.match(/\d/g).join("");u=m.offsetWidth-(m.offsetWidth-m.clientWidth)-2*f}if(n.resizeBtnStat.column){n.curTable.closest("li")&&(u=n.curTable.closest("li").offsetWidth);var g=n.curTable.querySelectorAll("colgroup > col"),b=void 0;b=""!==n.curTable.style.width&&n.curTable.style.width.includes("%")?parseFloat(n.curTable.style.width.split("%")[0]):n.getCurrentTableWidth(n.curTable.offsetWidth,n.parent.inputElement.offsetWidth);var v=n.calMaxCol(n.curTable)[n.colIndex],y=n.getCurrentColWidth(v,d);if("first"===n.currentColumnResize){if(s-=.75,n.removeResizeElement(),l&&(t=n.curTable.getBoundingClientRect().right-n.calcPos(l).left,n.curTable.style.maxWidth=t+"px"),(0!==s&&5<y||s<0)&&b<=100&&n.convertPixelToPercentage(d-s,u)<=100){var C=n.findFirstLastColCells(n.curTable,!0);n.curTable.style.width=n.convertPixelToPercentage(d-s,u)>100?"100%":n.convertPixelToPercentage(d-s,u)+"%";var N=b-n.convertPixelToPercentage(d-s,u),E=0;if(!(I=n.curTable.style.width.indexOf("%")>-1)&&n.curTable.offsetWidth>n.contentModule.getEditPanel().offsetWidth)return void(n.curTable.style.width=p+"px");if(I&&parseFloat(n.curTable.style.width.split("%")[0])>100)return void(n.curTable.style.width="100%");if(!(0,o.isNullOrUndefined)(n.curTable.style.marginLeft)&&""!==n.curTable.style.marginLeft){var S=n.curTable.style.marginLeft.match(/[-+]?\d*\.\d+|\d+/);(0,o.isNullOrUndefined)(S)||(E=parseFloat(S[0]))}var T=E+N;if(T&&T>100)T=100-parseFloat(n.curTable.style.width);if(!n.curTable.classList.contains("e-rte-paste-table")&&T&&T<1)return n.curTable.style.marginLeft=null,void(n.curTable.style.width="100%");n.curTable.style.marginLeft="calc("+("100%"===n.curTable.style.width?0:T)+"%)";for(var O=0;O<C.length;O++){var L=n.getCurrentColWidth(C[O],d);C[O].style.width=L-N+"%"}}}else if("last"===n.currentColumnResize){if(s+=.75,n.removeResizeElement(),l&&(t=l.getBoundingClientRect().right-n.curTable.getBoundingClientRect().left,n.curTable.style.maxWidth=t+"px"),(0!==s&&5<y||s>0)&&b<=100&&n.convertPixelToPercentage(d+s,u)<=100){var k=n.findFirstLastColCells(n.curTable,!1);n.curTable.style.width=n.convertPixelToPercentage(d+s,u)>100?"100%":n.convertPixelToPercentage(d+s,u)+"%";for(N=b-n.convertPixelToPercentage(d+s,u),O=0;O<k.length;O++){L=n.getCurrentColWidth(k[O],d);k[O].style.width=L-N+"%"}}}else{var x=g[n.colIndex].offsetWidth-s,w=g[n.colIndex].offsetWidth+g[n.colIndex-1].offsetWidth;if(w-x>20&&x>20){var D=w-x,M=x;g[n.colIndex-1].style.width=n.convertPixelToPercentage(D,d)+"%",g[n.colIndex].style.width=n.convertPixelToPercentage(M,d)+"%"}}n.updateHelper()}else if(n.resizeBtnStat.row){n.parent.preventDefaultResize(e);var A=[],B=n.curTable.querySelectorAll("tr");for(O=0;O<B.length;O++)n.rowEle!==B[O]&&(A[O]=parseFloat(B[O].clientHeight.toString()));n.curTable.style.height=parseFloat(n.curTable.clientHeight.toString())+(a>0?0:a)+"px";for(O=0;O<B.length;O++)n.rowEle===B[O]?B[O].style.height=parseFloat(B[O].clientHeight.toString())+a+"px":B[O].style.height=A[O]+"px";(0,o.isNullOrUndefined)(r)||(r.style.cssText="top: "+(n.calcPos(n.curTable).top+c-4)+"px; left:"+(n.calcPos(n.curTable).left+d-4)+"px;"),n.updateHelper()}else if(n.resizeBtnStat.tableBox){if(l){var R=n.curTable.getBoundingClientRect().left-l.getBoundingClientRect().left;t=Math.abs(R-l.getBoundingClientRect().width)-5,n.curTable.style.maxWidth=t+"px"}var I;if(n.curTable.style.height=c+a+"px",(0,o.isNullOrUndefined)(r)||(r.classList.add("e-rbox-select"),r.style.cssText="top: "+(n.calcPos(n.curTable).top+parseInt(getComputedStyle(n.curTable).height,10)-4)+"px; left:"+(n.calcPos(n.curTable).left+d-4)+"px;"),n.curTable.closest("li")&&(u=n.curTable.closest("li").offsetWidth),(I=n.curTable.style.width.indexOf("%")>-1)&&parseFloat(n.curTable.style.width.split("%")[0])>100)return void(n.curTable.style.width="100%");if(!I&&n.curTable.offsetWidth>n.contentModule.getEditPanel().offsetWidth)return void(n.curTable.style.width=p+"px");n.curTable.style.width=I?n.convertPixelToPercentage(d+s,u)+"%":d+s+"px"}}}))},t.prototype.getCurrentColWidth=function(e,t){return""!==e.style.width&&e.style.width.includes("%")?parseFloat(e.style.width.split("%")[0]):this.convertPixelToPercentage(e.offsetWidth,t)},t.prototype.getCurrentTableWidth=function(e,t){return e/t*100},t.prototype.findFirstLastColCells=function(e,t){for(var n=[],i=e.rows,o=[],r=function(e){for(var r=t?0:i[e].cells.length-1,s=i[e].cells[r],a=1;a<s.rowSpan;a++){var l=e+a+"-"+r;o.push(l)}var d=e+"-"+r;(0===o.length||t&&-1===o.indexOf(d)||!t&&-1===o.indexOf(d)&&o.every((function(t){return t.split("-")[0]!==e.toString()})))&&n.push(s)},s=0;s<i.length;s++)r(s);return n},t.prototype.convertPixelToPercentage=function(e,t){return e/t*100},t.prototype.cancelResizeAction=function(){this.isResizeBind=!0,o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchMoveEvent,this.resizing),o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchEndEvent,this.resizeEnd),this.removeResizeElement()},t.prototype.resizeEnd=function(e){this.resizeBtnInit(),this.isResizeBind=!0,o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchMoveEvent,this.resizing),o.EventHandler.remove(this.contentModule.getDocument(),o.Browser.touchEndEvent,this.resizeEnd),this.contentModule.getEditPanel().querySelector(".e-table-box")&&this.contentModule.getEditPanel().contains(this.contentModule.getEditPanel().querySelector(".e-table-box"))&&this.removeResizeElement(),this.helper&&this.contentModule.getEditPanel().contains(this.helper)&&((0,o.detach)(this.helper),this.helper=null),this.resetResizeHelper(this.curTable),this.pageX=null,this.pageY=null,this.moveEle=null;for(var t=this.curTable.querySelectorAll("tr"),n=[],i=0;i<t.length;i++){var r=parseFloat(t[i].clientHeight.toString())/parseFloat(this.curTable.clientHeight.toString())*100;n[i]=r}for(i=0;i<t.length;i++)"THEAD"===t[i].parentElement.nodeName?(t[i].parentElement.style.height=n[i]+"%",t[i].style.height=n[i]+"%"):t[i].style.height=n[i]+"%";var s={event:e,requestType:"table"};this.parent.trigger(W,s),this.parent.formatter.saveData(),this.resizeEndTime=(new Date).getTime()},t.prototype.resetResizeHelper=function(e){var t=this.parent.element.querySelectorAll(".e-table-rhelper.e-column-helper");Array.from(t).forEach((function(e){e.parentNode&&e.parentNode.removeChild(e)}));var n=this.parent.element.querySelectorAll(".e-table-rhelper.e-row-helper");Array.from(n).forEach((function(e){e.parentNode&&e.parentNode.removeChild(e)})),0===parseInt(e.style.width,10)&&(e.style.width=e.offsetWidth+"px");var i=e.querySelector("colgroup");if(i){for(var o=0;o<e.rows.length;o++)for(var r=0;r<e.rows[o].cells.length;r++){var s=this.convertPixelToPercentage(e.rows[o].cells[r].offsetWidth,parseInt(getComputedStyle(e).width,10))+"%";e.rows[o].cells[r].style.width=s}e.removeChild(i)}},t.prototype.resizeBtnInit=function(){return this.resizeBtnStat={column:!1,row:!1,tableBox:!1}},t.prototype.addRow=function(e,t,n){var i;n&&(i={item:{command:"Table",subCommand:"InsertRowAfter"}});var o={selection:e,subCommand:n?i.item.subCommand:t.item.subCommand};this.parent.formatter.process(this.parent,n?i:t,t,o)},t.prototype.addColumn=function(e,t){this.parent.formatter.process(this.parent,t,t,{selection:e,width:this.parent.tableSettings.width,subCommand:t.item.subCommand})},t.prototype.removeRowColumn=function(e,t){this.parent.formatter.process(this.parent,t,t,{selection:e,subCommand:t.item.subCommand}),this.hideTableQuickToolbar()},t.prototype.removeTable=function(e,t,n){var i;n&&(i={item:{command:"Table",subCommand:"TableRemove"}});var o={selection:e,subCommand:n?i.item.subCommand:t.item.subCommand};this.parent.formatter.process(this.parent,n?i:t,t.originalEvent,o),this.contentModule.getEditPanel().focus(),null!==this.parent.inputElement.innerHTML&&""!==this.parent.inputElement.innerHTML||("DIV"===this.parent.enterKey?this.contentModule.getEditPanel().innerHTML="<div><br/></div>":"BR"===this.parent.enterKey?this.contentModule.getEditPanel().innerHTML="<br/>":this.contentModule.getEditPanel().innerHTML="<p><br/></p>"),this.removeResizeElement(),this.hideTableQuickToolbar()},t.prototype.renderDlgContent=function(e){var t=this,n=e.args.originalEvent.target;if(o.Browser.isDevice||this.parent.inlineMode.enable||!(0,o.isNullOrUndefined)((0,o.closest)(n,".e-rte-text-popup")))this.insertTableDialog(e);else if(this.popupObj)this.popupObj.hide();else{this.hideTableQuickToolbar();var i=this.l10n.getConstant("inserttablebtn");this.dlgDiv=this.parent.createElement("div",{className:"e-rte-table-popup"+this.parent.getCssClass(!0),id:this.rteID+"_table"}),this.createTablePopupBoundFn=this.createTablePopupKeyDown.bind(this),this.dlgDiv.addEventListener("keydown",this.createTablePopupBoundFn),this.tblHeader=this.parent.createElement("div",{className:"e-rte-popup-header"+this.parent.getCssClass(!0)}),this.tblHeader.innerHTML="1X1",this.dlgDiv.appendChild(this.tblHeader);var r=this.parent.createElement("div",{className:"e-rte-table-span"+this.parent.getCssClass(!0)});this.drawTable(r,e),this.dlgDiv.appendChild(r),this.dlgDiv.appendChild(this.parent.createElement("span",{className:"e-span-border"+this.parent.getCssClass(!0)}));var s=this.parent.createElement("button",{className:"e-insert-table-btn"+this.parent.getCssClass(!0),id:this.rteID+"_insertTable",attrs:{type:"button",tabindex:"0"}});(0,o.isNullOrUndefined)(this.parent.getToolbarElement().querySelector(".e-expended-nav"))||this.parent.getToolbarElement().querySelector(".e-expended-nav").setAttribute("tabindex","1"),this.dlgDiv.appendChild(s),this.createTableButton=new hl.Button({iconCss:"e-icons e-create-table",content:i,cssClass:"e-flat"+this.parent.getCssClass(!0),enableRtl:this.parent.enableRtl,locale:this.parent.locale}),this.createTableButton.isStringTemplate=!0,this.createTableButton.appendTo(s),o.EventHandler.add(s,"click",this.insertTableDialog,{self:this,args:e.args,selection:e.selection}),this.parent.getToolbar().parentElement.appendChild(this.dlgDiv);var a=e.args.originalEvent.target;a=a.classList.contains("e-toolbar-item")?a.firstChild:a.parentElement,this.popupObj=new Wr.Popup(this.dlgDiv,{targetType:"relative",relateTo:a,collision:{X:"fit",Y:"none"},offsetY:8,viewPortElement:this.parent.element,position:{X:"left",Y:"bottom"},enableRtl:this.parent.enableRtl,zIndex:10001,close:function(e){o.EventHandler.remove(s,"click",t.insertTableDialog),t.dlgDiv.removeEventListener("keydown",t.createTablePopupBoundFn),(0,o.detach)(s),t.createTableButton&&!t.createTableButton.isDestroyed&&(t.createTableButton.destroy(),t.createTableButton.element=null,t.createTableButton=null),t.parent.isBlur=!1,t.popupObj.element.parentElement.style.zIndex="",t.popupObj.destroy(),(0,o.detach)(t.popupObj.element),t.popupObj=null}}),(0,o.addClass)([this.popupObj.element],"e-popup-open"),this.popupObj.element.parentElement.style.zIndex="11",(0,o.isNullOrUndefined)(this.parent.cssClass)||(0,o.addClass)([this.popupObj.element],this.parent.getCssClass()),s.focus(),this.popupObj.refreshPosition(a)}},t.prototype.onIframeMouseDown=function(){this.popupObj&&this.popupObj.hide(),this.parent.inlineMode.enable&&this.editdlgObj&&this.editdlgObj.hide(),(0,o.isNullOrUndefined)(this.parent)||(0,o.isNullOrUndefined)(this.parent.contentModule)||(0,o.isNullOrUndefined)(this.parent.contentModule.getEditPanel())||this.removeResizeElement()},t.prototype.docClick=function(e){var t=e.args.target;t&&t.classList&&(this.popupObj&&!(0,o.closest)(t,"[id='"+this.popupObj.element.id+"']")||this.editdlgObj&&!(0,o.closest)(t,"#"+this.editdlgObj.element.id))&&!t.classList.contains("e-create-table")&&t.offsetParent&&!t.offsetParent.classList.contains("e-rte-backgroundcolor-dropdown")&&(this.popupObj&&this.popupObj.hide(),this.editdlgObj&&(this.parent.notify(Yt,{closedBy:"outside click"}),this.editdlgObj.hide()),this.parent.isBlur=!0,Tr(this.parent.element,"focusout"));var n=(0,o.closest)(t,"td"),i=!(!n||!this.parent.contentModule.getEditPanel().contains(n));!t||"TD"===t.tagName||"TH"===t.tagName||i||null!==(0,o.closest)(t,".e-rte-quick-popup")||!t.offsetParent||t.offsetParent.classList.contains("e-quick-dropdown")||t.offsetParent.classList.contains("e-rte-backgroundcolor-dropdown")||(0,o.closest)(t,".e-rte-dropdown-popup")||(0,o.closest)(t,".e-rte-elements")||(!(!t||!t.closest(".e-toolbar"))||this.removeCellSelectClasses(),this.removeTableSelection(),o.Browser.isIE||this.hideTableQuickToolbar());!t||!t.classList||t.classList.contains(zi)||t.classList.contains(_i)||t.classList.contains(Vi)||this.removeResizeElement()},t.prototype.drawTable=function(e,t){for(var n,i,r=0;r<3;r++){n=this.parent.createElement("div",{className:"e-rte-table-row"+this.parent.getCssClass(!0),attrs:{"data-column":""+r}}),o.EventHandler.add(n,"mouseleave",this.tableCellLeave,this);for(var s=0;s<10;s++)i=this.parent.createElement("div",{className:"e-rte-tablecell e-default"+this.parent.getCssClass(!0),attrs:{"data-cell":""+s}}),n.appendChild(i),i.style.display="inline-block",0===s&&0===r&&(0,o.addClass)([i],"e-active"),o.EventHandler.add(i,"mousemove",this.tableCellSelect,this),o.EventHandler.add(i,"mouseup",this.tableCellClick,{self:this,args:t.args,selection:t.selection});e.appendChild(n)}},t.prototype.editTable=function(e){var t=this;this.createDialog(e);var n=this.tableDlgContent(e),i=this.l10n.getConstant("dialogUpdate"),o=this.l10n.getConstant("dialogCancel"),r=this.l10n.getConstant("tableEditHeader");this.editdlgObj.setProperties({height:"initial",width:"290px",content:n,header:r,buttons:[{click:this.applyProperties.bind(this,e),buttonModel:{content:i,cssClass:"e-flat e-size-update"+this.parent.getCssClass(!0),isPrimary:!0}},{click:function(e){t.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel"+this.parent.getCssClass(!0),content:o}}],cssClass:this.editdlgObj.cssClass+" e-rte-edit-table-prop-dialog"}),this.editdlgObj.element.style.maxHeight="none",this.editdlgObj.content.querySelector("input").focus(),this.hideTableQuickToolbar()},t.prototype.insertTableDialog=function(e){var t=this.self?this.self:this;t.popupObj&&t.popupObj.hide(),t.createDialog(e);var n=t.tableCellDlgContent(),i=t.l10n.getConstant("dialogInsert"),r=t.l10n.getConstant("dialogCancel");(0,o.isNullOrUndefined)(t.editdlgObj)||(t.editdlgObj.setProperties({height:"initial",width:"290px",content:n,buttons:[{click:t.customTable.bind(this,e),buttonModel:{content:i,cssClass:"e-flat e-insert-table "+t.parent.cssClass,isPrimary:!0}},{click:function(e){t.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel "+t.parent.cssClass,content:r}}]}),(0,o.isNullOrUndefined)(t.parent.cssClass)||t.editdlgObj.setProperties({cssClass:t.parent.cssClass}),t.editdlgObj.element.style.maxHeight="none",t.editdlgObj.content.querySelector("input").focus())},t.prototype.tableCellDlgContent=function(){var e=this.l10n.getConstant("columns"),t=this.l10n.getConstant("rows"),n=this.parent.createElement("div",{className:"e-cell-wrap"+this.parent.getCssClass(!0)}),i=Or('<div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text"  data-role ="none" id="tableColumn" class="e-table-column'+this.parent.getCssClass(!0)+'"/></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" id="tableRow" class="e-table-row'+this.parent.getCssClass(!0)+'" /></div>');return n.appendChild(i),this.columnTextBox=new Qr.NumericTextBox({format:"n0",min:1,value:3,placeholder:e,floatLabelType:"Auto",max:50,enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:this.parent.getCssClass()}),this.columnTextBox.isStringTemplate=!0,this.columnTextBox.appendTo(n.querySelector("#tableColumn")),this.rowTextBox=new Qr.NumericTextBox({format:"n0",min:1,value:3,placeholder:t,floatLabelType:"Auto",max:1e3,enableRtl:this.parent.enableRtl,locale:this.parent.locale,cssClass:this.parent.getCssClass()}),this.rowTextBox.isStringTemplate=!0,this.rowTextBox.appendTo(n.querySelector("#tableRow")),n},t.prototype.clearDialogObj=function(){this.editdlgObj&&(this.editdlgObj.destroy(),(0,o.detach)(this.editdlgObj.element),this.editdlgObj=null)},t.prototype.createDialog=function(e){var t=this;if(this.editdlgObj)this.editdlgObj.hide({returnValue:!0});else{var n=this.parent.createElement("div",{className:"e-rte-edit-table"+this.parent.getCssClass(!0),id:this.rteID+"_tabledialog"});this.parent.rootContainer.appendChild(n);var i=this.l10n.getConstant("dialogInsert"),r=this.l10n.getConstant("dialogCancel"),s={header:this.l10n.getConstant("tabledialogHeader"),cssClass:bi+this.parent.getCssClass(!0),enableRtl:this.parent.enableRtl,locale:this.parent.locale,showCloseIcon:!0,closeOnEscape:!0,width:o.Browser.isDevice?"290px":"340px",height:"initial",position:{X:"center",Y:o.Browser.isDevice?"center":"top"},isModal:o.Browser.isDevice,buttons:[{buttonModel:{content:i,cssClass:"e-flat e-insert-table"+this.parent.getCssClass(!0),isPrimary:!0}},{click:function(e){t.cancelDialog(e)},buttonModel:{cssClass:"e-flat e-cancel"+this.parent.getCssClass(!0),content:r}}],target:o.Browser.isDevice?document.body:this.parent.element,animationSettings:{effect:"None"},close:function(e){t.parent.isBlur=!1,t.editdlgObj.destroy(),(0,o.detach)(t.editdlgObj.element),t.dialogRenderObj.close(e),t.editdlgObj=null}};this.editdlgObj=this.dialogRenderObj.render(s),this.editdlgObj.appendTo(n),this.quickToolObj&&this.quickToolObj.inlineQTBar&&document.body.contains(this.quickToolObj.inlineQTBar.element)&&this.quickToolObj.inlineQTBar.hidePopup(),this.quickToolObj&&this.quickToolObj.textQTBar&&this.parent.element.ownerDocument.body.contains(this.quickToolObj.textQTBar.element)&&this.quickToolObj.textQTBar.hidePopup()}},t.prototype.customTable=function(e,t){var n=this.self?this.self:this;if(n&&n.rowTextBox&&n.rowTextBox.value&&n.columnTextBox&&n.columnTextBox.value){var i=o.Browser.isDevice||!(0,o.isNullOrUndefined)(e.args)&&!(0,o.isNullOrUndefined)(e.args.originalEvent)&&"insert-table"===e.args.originalEvent.action||n.parent.inlineMode.enable||!(0,o.isNullOrUndefined)(n.parent.quickToolbarSettings.text)&&!(e instanceof PointerEvent)?e:this;n.tableInsert(n.rowTextBox.value,n.columnTextBox.value,t,i)}},t.prototype.cancelDialog=function(e){this.parent.isBlur=!1,this.editdlgObj.hide({returnValue:!0})},t.prototype.applyProperties=function(e,t){var n=this.editdlgObj.element;if(n&&e&&e.selectNode.length>0&&e.selectNode[0]){var i=e.selectNode[0]&&3===e.selectNode[0].nodeType?e.selectNode[0].parentNode:e.selectNode[0],r=i?(0,o.closest)(i,"table"):null;if(r){if(r.style.width=n.querySelector(".e-table-width")?n.querySelector(".e-table-width").value+"px":r.style.width,n.querySelector(".e-cell-padding")&&""!==n.querySelector(".e-cell-padding").value)for(var s=r.querySelectorAll("td"),a=0;a<s.length;a++){var l="";""===s[a].style.padding?l=s[a].getAttribute("style")+" padding:"+n.querySelector(".e-cell-padding").value+"px;":(s[a].style.padding=n.querySelector(".e-cell-padding").value+"px",l=s[a].getAttribute("style")),s[a].style.cssText=l}r.cellSpacing=n.querySelector(".e-cell-spacing")?n.querySelector(".e-cell-spacing").value:r.cellSpacing,(0,o.isNullOrUndefined)(r.cellSpacing)||"0"===r.cellSpacing?Fs([r],vo):(0,o.addClass)([r],vo),this.parent.formatter.saveData(),this.editdlgObj.hide({returnValue:!0})}}},t.prototype.tableDlgContent=function(e){var t=e.selectParent[0],n=this.l10n.getConstant("tableWidth"),i=this.l10n.getConstant("cellpadding"),r=this.l10n.getConstant("cellspacing"),s=this.parent.createElement("div",{className:"e-table-sizewrap"+this.parent.getCssClass(!0)}),a=(0,o.closest)(t,"table").getClientRects()[0].width,l=(0,o.closest)(t,"td").style.padding,d=(0,o.closest)(t,"table").getAttribute("cellspacing"),c=Or('<div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" id="tableWidth" class="e-table-width'+this.parent.getCssClass(!0)+'"  /></div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" id="cellPadding" class="e-cell-padding'+this.parent.getCssClass(!0)+'" /> </div><div class="e-rte-field'+this.parent.getCssClass(!0)+'"><input type="text" data-role ="none" id="cellSpacing" class="e-cell-spacing'+this.parent.getCssClass(!0)+'" /></div>');return s.appendChild(c),this.tableWidthNum=new Qr.NumericTextBox({format:"n0",min:0,value:a,placeholder:n,floatLabelType:"Auto",enableRtl:this.parent.enableRtl,locale:this.parent.locale}),this.tableWidthNum.isStringTemplate=!0,this.tableWidthNum.appendTo(s.querySelector("#tableWidth")),this.tableCellPadding=new Qr.NumericTextBox({format:"n0",min:0,value:""!==l?parseInt(l,null):0,placeholder:i,floatLabelType:"Auto",enableRtl:this.parent.enableRtl,locale:this.parent.locale}),this.tableCellPadding.isStringTemplate=!0,this.tableCellPadding.appendTo(s.querySelector("#cellPadding")),this.tableCellSpacing=new Qr.NumericTextBox({format:"n0",min:0,value:""===d||(0,o.isNullOrUndefined)(d)?0:parseInt(d,null),placeholder:r,floatLabelType:"Auto",enableRtl:this.parent.enableRtl,locale:this.parent.locale}),this.tableCellSpacing.isStringTemplate=!0,this.tableCellSpacing.appendTo(s.querySelector("#cellSpacing")),s},t.prototype.destroy=function(){this.isDestroyed||(this.resizeIconPositionTime&&(clearTimeout(this.resizeIconPositionTime),this.resizeIconPositionTime=null),this.removeEventListener(),o.EventHandler.remove(this.parent.contentModule.getDocument(),"selectionchange",this.tableCellsKeyboardSelection),this.curTable&&o.EventHandler.remove(this.curTable,"mouseleave",this.tableMouseLeave),this.tableCellSpacing&&!this.tableCellSpacing.isDestroyed&&(this.tableCellSpacing.destroy(),this.tableCellSpacing=null),this.tableCellPadding&&!this.tableCellPadding.isDestroyed&&(this.tableCellPadding.destroy(),this.tableCellPadding=null),this.tableWidthNum&&!this.tableWidthNum.isDestroyed&&(this.tableWidthNum.destroy(),this.tableWidthNum=null),this.rowTextBox&&!this.rowTextBox.isDestroyed&&(this.rowTextBox.destroy(),this.rowTextBox=null),this.columnTextBox&&!this.columnTextBox.isDestroyed&&(this.columnTextBox.destroy(),this.columnTextBox=null),this.createTableButton&&!this.createTableButton.isDestroyed&&(this.createTableButton.destroy(),this.createTableButton=null),this.createTablePopupBoundFn=null,this.isDestroyed=!0)},t.prototype.getModuleName=function(){return"table"},t.prototype.afterKeyDown=function(){var e=this;this.curTable&&(this.resizeIconPositionTime=setTimeout((function(){e.updateResizeIconPosition()}),1))},t.prototype.updateResizeIconPosition=function(){var e=this.parent.contentModule.getEditPanel().querySelector(".e-table-box");if(!(0,o.isNullOrUndefined)(e)){var t=this.calcPos(this.curTable);e.style.cssText="top: "+(t.top+parseInt(getComputedStyle(this.curTable).height,10)-4)+"px; left:"+(t.left+parseInt(getComputedStyle(this.curTable).width,10)-4)+"px;"}},t.prototype.createTablePopupKeyDown=function(e){if("Escape"===e.key){var t=e.target.closest(".e-rte-table-popup"),n=(0,o.getComponent)(t,"popup"),i=n.relateTo;n.hide(),i.focus({preventScroll:!0})}},t}(),El=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(f,this.removeEventListener,this),this.parent.on(Yt,this.documentClickClosedBy,this))},e.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(f,this.removeEventListener),this.parent.off(Yt,this.documentClickClosedBy))},e.prototype.render=function(e){e.beforeOpen=this.beforeOpen.bind(this),e.open=this.open.bind(this),e.position={X:"center",Y:"string"===e.target||"BODY"!==e.target.nodeName||(0,o.isNullOrUndefined)(e.position)?this.getDialogPosition():e.position.Y},(0,o.isNullOrUndefined)(e.close)&&(e.close=this.close.bind(this)),e.beforeClose=this.beforeClose.bind(this),"true"===this.parent.element.dataset.rteUnitTesting&&(e.animationSettings={effect:"None",duration:0});var t=new Wr.Dialog(e);return t.isStringTemplate=!0,t},e.prototype.beforeOpen=function(e){if(e.element.classList.contains("e-dialog")){var t=(0,o.closest)(e.target,"form");(0,o.isNullOrUndefined)(t)||(this.dialogEle=e.element,this.dialogEle.addEventListener("keydown",this.handleEnterKeyDown))}this.parent.trigger(Je,e,this.beforeOpenCallback.bind(this,e))},e.prototype.handleEnterKeyDown=function(e){"Enter"===e.key&&e.preventDefault()},e.prototype.beforeOpenCallback=function(e){e.cancel&&this.parent.notify($e,null)},e.prototype.open=function(e){!(0,o.isNullOrUndefined)(e.container.querySelector(".e-rte-file-manager-dialog"))&&(e.preventFocus=!0),this.parent.trigger(et,e)},e.prototype.documentClickClosedBy=function(e){this.outsideClickClosedBy=e.closedBy},e.prototype.beforeClose=function(e){this.dialogEle&&this.dialogEle.removeEventListener("keydown",this.handleEnterKeyDown),e.closedBy="outside click"===this.outsideClickClosedBy?this.outsideClickClosedBy:e.closedBy,this.parent.trigger(tt,e,(function(e){e.cancel||e.container.classList.contains("e-popup-close")&&(e.cancel=!0)})),this.outsideClickClosedBy=""},e.prototype.getDialogPosition=function(){var e=this.parent.element.getBoundingClientRect().top;if(e<0){for(var t=0,n=this.parent.element;"BODY"!==n.nodeName;){var i=n.getBoundingClientRect().top;i>0&&(t=i),n=n.parentElement}return(e=Math.abs(e)+t).toString()}return"top"},e.prototype.close=function(e){this.parent.trigger(nt,e)},e}(),Sl=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Tl="\n    <!DOCTYPE html> \n    <html>\n         <head>\n            <meta charset='utf-8' /> \n            <style>"+'\n@charset "UTF-8";\n\n* {\n    box-sizing: border-box;\n}\n\nhtml {\n    height: auto;\n}\n\nhtml, body {\n    margin: 0;\n}\n\nbody {\n    color: #333;\n    word-wrap: break-word;\n}\n\n.e-content {\n    background: unset;\n    min-height: 100px;\n    outline: 0 solid transparent;\n    padding: 16px;\n    position: relative;\n    overflow-x: auto;\n    font-weight: normal;\n    line-height: 1.5;\n    font-size: 14px;\n    text-align: inherit;\n    font-family: "Roboto", "Segoe UI", "GeezaPro", "DejaVu Serif", "sans-serif", "-apple-system", "BlinkMacSystemFont";\n}\n\n.e-content p {\n    margin: 0 0 10px;\n    margin-bottom: 10px;\n}\n\n.e-content h1 {\n    font-size: 2.857em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h2 {\n    font-size: 2.285em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h3 {\n    font-size: 2em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h4 {\n    font-size: 1.714em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h5 {\n    font-size: 1.428em;\n    font-weight: 600;\n    line-height: 1.2;\n    margin: 10px 0;\n}\n\n.e-content h6 {\n    font-size: 1.142em;\n    font-weight: 600;\n    line-height: 1.5;\n    margin: 10px 0;\n}\n\n.e-content blockquote {\n    margin: 10px 0;\n    padding-left: 12px;\n    border-left: 2px solid #5c5c5c;\n}\n\n.e-rtl.e-content blockquote {\n    padding-left: 0;\n    padding-right: 12px;\n}\n\n.e-content pre {\n    border: 0;\n    border-radius: 0;\n    color: #333;\n    font-size: inherit;\n    line-height: inherit;\n    margin: 0 0 10px;\n    overflow: visible;\n    padding: 0;\n    white-space: pre-wrap;\n    word-break: inherit;\n    word-wrap: break-word;\n}\n\n.e-content code {\n    background: #9d9d9d26;\n    color: #ed484c;\n}\n\n.e-content strong,\n.e-content b {\n    font-weight: bold;\n}\n\n.e-content a {\n    text-decoration: none;\n    user-select: auto;\n}\n\n.e-content a:hover {\n    text-decoration: underline;\n}\n\n.e-content li {\n    margin-bottom: 10px;\n}\n\n.e-content li ol,\n.e-content li ul {\n    margin-block-start: 10px;\n}\n\n.e-content ul {\n    list-style-type: disc;\n}\n\n.e-content ul ul,\n.e-content ol ul {\n    list-style-type: circle;\n}\n\n.e-content ul ul ul,\n.e-content ol ul ul,\n.e-content ul ol ul,\n.e-content ol ol ul {\n    list-style-type: square;\n}\n\n.e-content p:last-child,\n.e-content pre:last-child,\n.e-content blockquote:last-child {\n    margin-bottom: 0;\n}\n\n.e-content h3 + h4,\n.e-content h4 + h5,\n.e-content h5 + h6 {\n    margin-top: 0.6em;\n}\n\n.e-content ul:last-child {\n    margin-bottom: 0;\n}\n\n.e-content table {\n    margin-bottom: 10px;\n    border-collapse: collapse;\n    empty-cells: show;\n}\n\n.e-content table.e-cell-select {\n    position: relative;\n}\n\n.e-content table.e-cell-select::after {\n    content: \'\';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    border: 2px solid #4a90e2;\n    pointer-events: none;\n}\n\ntable .e-cell-select {\n    border: 1px double #4a90e2 !important;\n}\n\n.e-content table.e-rte-table th {\n    background-color: rgba(157, 157, 157, .15);\n}\n\n.e-rte-table td,\n.e-rte-table th {\n    border: 1px solid #BDBDBD;\n    height: 20px;\n    min-width: 20px;\n    padding: 2px 5px;\n}\n\n.e-rte-table td.e-cell-select.e-multi-cells-select,\n.e-rte-table th.e-cell-select.e-multi-cells-select {\n    position: relative;\n}\n\n.e-rte-table td.e-cell-select.e-multi-cells-select::after,\n.e-rte-table th.e-cell-select.e-multi-cells-select::after {\n    background-color: rgba(13, 110, 253, 0.08);\n    content: "";\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    bottom: 0;\n    pointer-events: none;\n    right: 0;\n}\n\ntable td.e-multi-cells-select ::selection,\ntable th.e-multi-cells-select ::selection {\n    background-color: transparent;\n}\n\ntd.e-multi-cells-select,\nth.e-multi-cells-select {\n    user-select: none !important;\n}\n\n.e-rte-table.e-dashed-border > tbody > tr > td,\n.e-rte-table.e-dashed-border > tbody > tr > th {\n    border-style: dashed;\n}\n\n.e-rte-table.e-alternate-border tbody tr:nth-child(2n) {\n    background-color: #F5F5F5;\n}\n\n.e-rte-image,\n.e-rte-audio,\n.e-rte-video  {\n    border: 0;\n    cursor: pointer;\n    display: block;\n    float: none;\n    margin: auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-rte-image.e-imginline,\n.e-rte-audio.e-audio-inline,\n.e-rte-video.e-video-inline {\n    margin-left: 5px;\n    margin-right: 5px;\n    display: inline-block;\n    float: none;\n    max-width: 100%;\n    padding: 1px;\n    vertical-align: bottom;\n}\n\n.e-rte-image.e-imgcenter,\n.e-rte-video.e-video-center {\n    cursor: pointer;\n    display: block;\n    float: none;\n    margin: 5px auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-rte-image.e-imgright,\n.e-rte-video.e-video-right {\n    float: right;\n    margin: 0 auto;\n    margin-left: 5px;\n    text-align: right;\n}\n\n.e-rte-image.e-imgleft,\n.e-rte-video.e-video-left {\n    float: left;\n    margin: 0 auto;\n    margin-right: 5px;\n    text-align: left;\n}\n\n.e-rte-img-caption {\n    display: inline-block;\n    margin: 5px auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-rte-img-caption.e-caption-inline {\n    display: inline-block;\n    margin: 5px auto;\n    margin-left: 5px;\n    margin-right: 5px;\n    max-width: calc(100% - (2 * 5px));\n    position: relative;\n    text-align: center;\n    vertical-align: bottom;\n}\n\n.e-rte-img-caption.e-imgcenter {\n    display: contents;\n    margin-left: auto;\n    margin-right: auto;\n}\n\n.e-rte-img-caption.e-imgright {\n    display: contents;\n    margin-left: auto;\n    margin-right: 0;\n}\n\n.e-rte-img-caption.e-imgleft {\n    display: contents;\n    margin-left: 0;\n    margin-right: auto;\n}\n\n.e-img-caption.e-rte-img-caption.e-imgbreak {\n    display: contents;\n}\n\n.e-rte-img-caption .e-img-inner {\n    display: block;\n    font-size: 16px;\n    font-weight: initial;\n    margin: auto;\n    opacity: .9;\n    position: relative;\n    text-align: center;\n    width: 100%;\n}\n\n.e-img-wrap {\n    display: inline-block;\n    margin: auto;\n    padding: 0;\n    text-align: center;\n    width: 100%;\n}\n\n.e-imgleft,\n.e-video-left {\n    float: left;\n    margin: 0 5px 0 0;\n    text-align: left;\n}\n\n.e-imgright,\n.e-video-right {\n    float: right;\n    margin: 0 0 0 5px;\n    text-align: right;\n}\n\n.e-imgcenter,\n.e-video-center {\n    cursor: pointer;\n    display: block;\n    float: none;\n    height: auto;\n    margin: 5px auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-control img:not(.e-resize) {\n    border: 2px solid transparent;\n    z-index: 1000\n}\n\n.e-imginline,\n.e-audio-inline,\n.e-video-inline {\n    display: inline-block;\n    float: none;\n    margin-left: 5px;\n    margin-right: 5px;\n    vertical-align: bottom;\n}\n\n.e-imgbreak,\n.e-audio-break,\n.e-video-break {\n    border: 0;\n    cursor: pointer;\n    display: block;\n    float: none;\n    margin: 5px auto;\n    max-width: 100%;\n    position: relative;\n}\n\n.e-rte-image.e-img-focus:not(.e-resize),\n.e-audio-focus:not(.e-resize),\n.e-video-focus:not(.e-resize) {\n    border: solid 2px #4a90e2;\n}\n\nimg.e-img-focus::selection,\naudio.e-audio-focus::selection,\n.e-video-focus::selection {\n    background: transparent;\n    color: transparent;\n}\n\nspan.e-rte-imageboxmark,\nspan.e-rte-videoboxmark {\n    width: 10px;\n    height: 10px;\n    position: absolute;\n    display: block;\n    background: #4a90e2;\n    border: 1px solid #fff;\n    z-index: 1000;\n}\n\n.e-mob-rte.e-mob-span span.e-rte-imageboxmark,\n.e-mob-rte.e-mob-span span.e-rte-videoboxmark {\n    background: #4a90e2;\n    border: 1px solid #fff;\n}\n\n.e-mob-rte span.e-rte-imageboxmark,\n.e-mob-rte span.e-rte-videoboxmark {\n    background: #fff;\n    border: 1px solid #4a90e2;\n    border-radius: 15px;\n    height: 20px;\n    width: 20px;\n}\n\n.e-mob-rte.e-mob-span span.e-rte-imageboxmark,\n.e-mob-rte.e-mob-span span.e-rte-videoboxmark {\n    background: #4a90e2;\n    border: 1px solid #fff;\n}\n\n.e-content img.e-resize,\n.e-content video.e-resize {\n    z-index: 1000;\n}\n\n.e-img-caption .e-img-inner {\n    outline: 0;\n}\n\n.e-rte-img-caption.e-imgleft .e-img-inner {\n    float: left;\n    text-align: left;\n}\n\n.e-rte-img-caption.e-imgright .e-img-inner {\n    float: right;\n    text-align: right;\n}\n\n.e-rte-img-caption.e-imgleft .e-img-wrap,\n.e-rte-img-caption.e-imgright .e-img-wrap {\n    display: contents;\n}\n\n.e-img-caption a:focus-visible {\n    outline: none;\n}\n\n.e-rte-img-caption .e-rte-image.e-imgright {\n    margin-left: auto;\n    margin-right: 0;\n}\n\n.e-rte-img-caption .e-rte-image.e-imgleft {\n    margin: 0;\n}\n\nspan.e-table-box {\n    cursor: nwse-resize;\n    display: block;\n    height: 10px;\n    position: absolute;\n    width: 10px;\n    background-color: #ffffff;\n    border: 1px solid #BDBDBD;\n}\n\nspan.e-table-box.e-rmob {\n    height: 14px;\n    width: 14px;\n    background-color: #BDBDBD;\n    border: 1px solid #BDBDBD;\n}\n\n.e-row-resize,\n.e-column-resize {\n    background-color: transparent;\n    background-repeat: repeat;\n    bottom: 0;\n    cursor: col-resize;\n    height: 1px;\n    overflow: visible;\n    position: absolute;\n    width: 1px;\n}\n\n.e-row-resize {\n    cursor: row-resize;\n    height: 1px;\n}\n\n.e-table-rhelper {\n    cursor: col-resize;\n    opacity: .87;\n    position: absolute;\n}\n\n.e-table-rhelper.e-column-helper {\n    width: 1px;\n}\n\n.e-table-rhelper.e-row-helper {\n    height: 1px;\n}\n\n.e-reicon::before {\n    border-bottom: 6px solid transparent;\n    border-right: 6px solid;\n    border-top: 6px solid transparent;\n    content: \'\';\n    display: block;\n    height: 0;\n    position: absolute;\n    right: 4px;\n    top: 4px;\n    width: 20px;\n}\n\n.e-reicon::after {\n    border-bottom: 6px solid transparent;\n    border-left: 6px solid;\n    border-top: 6px solid transparent;\n    content: \'\';\n    display: block;\n    height: 0;\n    left: 4px;\n    position: absolute;\n    top: 4px;\n    width: 20px;\n    z-index: 3;\n}\n\n.e-row-helper.e-reicon::after {\n    top: 10px;\n    transform: rotate(90deg);\n}\n\n.e-row-helper.e-reicon::before {\n    left: 4px;\n    top: -20px;\n    transform: rotate(90deg);\n}\n\n\n.e-table-rhelper {\n    background-color: #4a90e2;\n}\n\n.e-rtl {\n    direction: rtl;\n}\n\n.e-rte-placeholder::before {\n    content: attr(placeholder);\n    opacity: 0.54;\n    overflow: hidden;\n    padding-top: 16px;\n    position: absolute;\n    text-align: start;\n    top: 0;\n    z-index: 1;\n}\n\n.e-resize-enabled,\n.e-count-enabled {\n    padding-bottom: 0px;\n}\n'.replace(/[\n\t]/g,"")+"\n            </style>\n        </head>\n",Ol=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Sl(t,e),t.prototype.renderPanel=function(){var e=this.parent,t=xr(e.value,e),n=Tl+('<body contenteditable="true">'+t+"</body></html>"),i=this.parent.createElement("iframe",{id:this.parent.getID()+"_rte-view",className:"e-rte-content",attrs:{srcdoc:n}});if(i.setAttribute("role","none"),this.setPanel(i),!(0,o.isNullOrUndefined)(this.parent.iframeSettings.sandbox)){var r=this.parent.iframeSettings.sandbox.map((function(e){return e.toLocaleLowerCase().trim()})).join(" ");r.includes("allow-same-origin")||(r+=" allow-same-origin"),i.setAttribute("sandbox",r.trim())}e.rootContainer.appendChild(i),i.contentDocument.body.setAttribute("aria-owns",this.parent.getID()),i.contentDocument.open(),n=this.setThemeColor(n,{color:"#333"}),i.contentDocument.write(n),i.contentDocument.close();var s=i.contentDocument.body;if(s.className="e-content","auto"===this.parent.height&&(s.style.overflowY="hidden"),(0,o.isNullOrUndefined)(this.parent.fontFamily.default)||(s.style.fontFamily=this.parent.fontFamily.default),(0,o.isNullOrUndefined)(this.parent.fontSize.default)||(s.style.fontSize=this.parent.fontSize.default),s.id=this.parent.getID()+"_rte-edit-view",e.enableRtl&&this.contentPanel.contentDocument.body.setAttribute("class","e-rtl"),!(0,o.isNullOrUndefined)(i.contentDocument.head)&&this.parent.iframeSettings.metaTags.length>0){var a=i.contentDocument.head;this.parent.iframeSettings.metaTags.forEach((function(e){var t=document.createElement("meta");for(var n in e)(0,o.isNullOrUndefined)(e[n])||t.setAttribute("httpEquiv"===n?"http-equiv":n,e[n]);a.appendChild(t)}))}},t.prototype.setThemeColor=function(e,t){var n=getComputedStyle(this.parent.element,".e-richtexteditor").getPropertyValue("color");return e.replace(t.color,n)},t.prototype.getEditPanel=function(){return(0,o.isNullOrUndefined)(this.contentPanel.contentDocument)?this.parent.inputElement:this.contentPanel.contentDocument.body},t.prototype.getDocument=function(){return this.getEditPanel().ownerDocument},t}(qr),Ll=function(){function e(e){this.parent=e}return e.prototype.renderPanel=function(){var e=this.parent,t=this.parent.createElement("div",{id:this.parent.getID()+"_view",className:"e-rte-content"});this.editableElement=this.parent.createElement("textarea",{className:"e-content",id:this.parent.getID()+"_editable-content",attrs:{"aria-labelledby":this.parent.getID()+"_view"}}),t.appendChild(this.editableElement),this.setPanel(t),e.rootContainer.appendChild(t)},e.prototype.getPanel=function(){return this.contentPanel},e.prototype.getEditPanel=function(){return this.editableElement},e.prototype.getText=function(){return this.getEditPanel().value},e.prototype.setPanel=function(e){this.contentPanel=e},e.prototype.getDocument=function(){return this.getEditPanel().ownerDocument},e}(),kl=function(){function e(e){this.parent=e}return e.prototype.quickToolbarOpen=function(){var e=this.popupObj;this.parent.trigger(ot,e)},e.prototype.renderPopup=function(e){this.setPanel(e.element),this.renderPanel(),e.popupObj=new Wr.Popup(e.element,{targetType:"relative",relateTo:this.parent.element,open:this.quickToolbarOpen.bind(this)}),this.popupObj=e.popupObj,e.popupObj.hide()},e.prototype.renderPanel=function(){this.getPanel().classList.add(On)},e.prototype.getPanel=function(){return this.popupPanel},e.prototype.setPanel=function(e){this.popupPanel=e},e}(),xl=c(778),wl={bold:{command:"Style",subCommand:"Bold",value:"strong"},italic:{command:"Style",subCommand:"Italic",value:"em"},underline:{command:"Style",subCommand:"Underline",value:"span"},strikeThrough:{command:"Style",subCommand:"StrikeThrough",value:"span"},insertCode:{command:"Formats",subCommand:"Pre",value:"pre"},superscript:{command:"Effects",subCommand:"SuperScript",value:"sup"},subscript:{command:"Effects",subCommand:"SubScript",value:"sub"},uppercase:{command:"Casing",subCommand:"UpperCase"},lowercase:{command:"Casing",subCommand:"LowerCase"},fontColor:{command:"font",subCommand:"fontcolor",value:"#ff0000"},fontName:{command:"font",subCommand:"fontname",value:"Segoe UI"},fontSize:{command:"font",subCommand:"fontsize",value:"10pt"},backColor:{command:"font",subCommand:"backgroundcolor",value:"#ffff00"},justifyCenter:{command:"Alignments",subCommand:"JustifyCenter"},justifyFull:{command:"Alignments",subCommand:"JustifyFull"},justifyLeft:{command:"Alignments",subCommand:"JustifyLeft"},justifyRight:{command:"Alignments",subCommand:"JustifyRight"},undo:{command:"Actions",subCommand:"Undo"},redo:{command:"Actions",subCommand:"Redo"},createLink:{command:"Links",subCommand:"createLink"},editLink:{command:"Links",subCommand:"createLink"},createImage:{command:"Images",subCommand:"Images"},formatBlock:{command:"Formats",value:"P"},heading:{command:"Formats",value:"H1"},indent:{command:"Indents",subCommand:"Indent"},outdent:{command:"Indents",subCommand:"Outdent"},insertHTML:{command:"InsertHTML",subCommand:"InsertHTML",value:""},insertText:{command:"InsertText",subCommand:"InsertText",value:""},insertHorizontalRule:{command:"InsertHTML",subCommand:"InsertHTML",value:"<hr/>"},insertImage:{command:"Images",subCommand:"Image"},insertAudio:{command:"Audios",subCommand:"Audio"},insertVideo:{command:"Videos",subCommand:"Video"},editImage:{command:"Images",subCommand:"Image"},insertTable:{command:"Table",subCommand:"CreateTable"},insertBrOnReturn:{command:"InsertHTML",subCommand:"InsertHTML",value:"<br/>"},insertOrderedList:{command:"Lists",value:"OL"},insertUnorderedList:{command:"Lists",value:"UL"},insertParagraph:{command:"Formats",value:"P"},removeFormat:{command:"Clear",subCommand:"ClearFormat"},copyFormatPainter:{command:"FormatPainter",value:"format-copy"},applyFormatPainter:{command:"FormatPainter",value:"format-paste"},escapeFormatPainter:{command:"FormatPainter",value:"escape"},InlineCode:{command:"Style",subCommand:"inlinecode",value:"inlinecode"}},Dl=function(){function e(){this.services={}}return e.prototype.register=function(e,t){(0,o.isNullOrUndefined)(this.services[""+e])&&(this.services[""+e]=t)},e.prototype.getService=function(e){if((0,o.isNullOrUndefined)(this.services[""+e]))throw"The service "+e+" is not registered";return this.services[""+e]},e.prototype.destroy=function(){this.services={}},e}(),Ml=function(){function t(){this.rendererMap={}}return t.prototype.addRenderer=function(t,n){var i=(0,o.getEnumValue)(e,t);(0,o.isNullOrUndefined)(this.rendererMap[""+i])&&(this.rendererMap[""+i]=n)},t.prototype.getRenderer=function(t){var n=(0,o.getEnumValue)(e,t);if((0,o.isNullOrUndefined)(this.rendererMap[""+n]))throw"The renderer "+n+" is not found";return this.rendererMap[""+n]},t.prototype.destroy=function(){this.rendererMap={}},t}(),Al=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(P,this.commandCallBack,this),this.parent.on(f,this.removeEventListener,this)},e.prototype.commandCallBack=function(e){var t=!(0,o.isNullOrUndefined)(e.requestType)&&"FormatPainter"===e.requestType&&"format-copy"===e.action;(0,o.isNullOrUndefined)(e)||(0,o.isNullOrUndefined)(e.requestType)||"Undo"===e.requestType||"Redo"===e.requestType||t||this.parent.formatter.saveData(),this.parent.notify(b,{args:e}),this.parent.notify(ke,{})},e.prototype.removeEventListener=function(){this.parent.off(P,this.commandCallBack),this.parent.off(f,this.removeEventListener)},e}(),Bl=c(771),Rl=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Il=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},Ul=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return Rl(n,e),Il([(0,o.Property)(!0)],n.prototype,"enable",void 0),Il([(0,o.Property)(!0)],n.prototype,"enableFloating",void 0),Il([(0,o.Property)(t.Expand)],n.prototype,"type",void 0),Il([(0,o.Property)(Qo)],n.prototype,"items",void 0),Il([(0,o.Property)({})],n.prototype,"itemConfigs",void 0),n}(o.ChildProperty),Pl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)(null)],t.prototype,"serviceUrl",void 0),t}(o.ChildProperty),Hl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)(null)],t.prototype,"serviceUrl",void 0),Il([(0,o.Property)("Sample.docx")],t.prototype,"fileName",void 0),Il([(0,o.Property)(null)],t.prototype,"stylesheet",void 0),t}(o.ChildProperty),jl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)(null)],t.prototype,"serviceUrl",void 0),Il([(0,o.Property)("Sample.pdf")],t.prototype,"fileName",void 0),Il([(0,o.Property)(null)],t.prototype,"stylesheet",void 0),t}(o.ChildProperty),Fl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)([".jpeg",".jpg",".png"])],t.prototype,"allowedTypes",void 0),Il([(0,o.Property)("inline")],t.prototype,"display",void 0),Il([(0,o.Property)("Blob")],t.prototype,"saveFormat",void 0),Il([(0,o.Property)("auto")],t.prototype,"width",void 0),Il([(0,o.Property)("auto")],t.prototype,"height",void 0),Il([(0,o.Property)(null)],t.prototype,"saveUrl",void 0),Il([(0,o.Property)(null)],t.prototype,"path",void 0),Il([(0,o.Property)(!0)],t.prototype,"resize",void 0),Il([(0,o.Property)(null)],t.prototype,"removeUrl",void 0),Il([(0,o.Property)(0)],t.prototype,"minWidth",void 0),Il([(0,o.Property)(null)],t.prototype,"maxWidth",void 0),Il([(0,o.Property)(0)],t.prototype,"minHeight",void 0),Il([(0,o.Property)(null)],t.prototype,"maxHeight",void 0),Il([(0,o.Property)(!1)],t.prototype,"resizeByPercent",void 0),t}(o.ChildProperty),ql=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)([".wav",".mp3",".m4a",".wma"])],t.prototype,"allowedTypes",void 0),Il([(0,o.Property)("Inline")],t.prototype,"layoutOption",void 0),Il([(0,o.Property)("Blob")],t.prototype,"saveFormat",void 0),Il([(0,o.Property)(null)],t.prototype,"saveUrl",void 0),Il([(0,o.Property)(null)],t.prototype,"removeUrl",void 0),Il([(0,o.Property)(null)],t.prototype,"path",void 0),t}(o.ChildProperty),zl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)([".mp4",".mov",".wmv",".avi"])],t.prototype,"allowedTypes",void 0),Il([(0,o.Property)("Inline")],t.prototype,"layoutOption",void 0),Il([(0,o.Property)("Blob")],t.prototype,"saveFormat",void 0),Il([(0,o.Property)("auto")],t.prototype,"width",void 0),Il([(0,o.Property)("auto")],t.prototype,"height",void 0),Il([(0,o.Property)(null)],t.prototype,"saveUrl",void 0),Il([(0,o.Property)(null)],t.prototype,"path",void 0),Il([(0,o.Property)(!0)],t.prototype,"resize",void 0),Il([(0,o.Property)(null)],t.prototype,"removeUrl",void 0),Il([(0,o.Property)(0)],t.prototype,"minWidth",void 0),Il([(0,o.Property)(null)],t.prototype,"maxWidth",void 0),Il([(0,o.Property)(0)],t.prototype,"minHeight",void 0),Il([(0,o.Property)(null)],t.prototype,"maxHeight",void 0),Il([(0,o.Property)(!1)],t.prototype,"resizeByPercent",void 0),t}(o.ChildProperty),_l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Event)()],t.prototype,"beforeSend",void 0),Il([(0,o.Complex)({getImageUrl:null,url:null,uploadUrl:null},Bl.AjaxSettings)],t.prototype,"ajaxSettings",void 0),Il([(0,o.Property)(!1)],t.prototype,"allowDragAndDrop",void 0),Il([(0,o.Complex)({visible:!0,file:["Open","|","Cut","Copy","|","Delete","Rename","|","Details"],folder:["Open","|","Cut","Copy","Paste","|","Delete","Rename","|","Details"],layout:["SortBy","View","Refresh","|","Paste","|","NewFolder","Upload","|","Details","|","SelectAll"]},Bl.ContextMenuSettings)],t.prototype,"contextMenuSettings",void 0),Il([(0,o.Property)("")],t.prototype,"cssClass",void 0),Il([(0,o.Complex)({},Bl.DetailsViewSettings)],t.prototype,"detailsViewSettings",void 0),Il([(0,o.Property)(!1)],t.prototype,"enable",void 0),Il([(0,o.Complex)({maxWidth:"650px",minWidth:"240px",visible:!0},Bl.NavigationPaneSettings)],t.prototype,"navigationPaneSettings",void 0),Il([(0,o.Property)("/")],t.prototype,"path",void 0),Il([(0,o.Property)(null)],t.prototype,"rootAliasName",void 0),Il([(0,o.Complex)({},Bl.SearchSettings)],t.prototype,"searchSettings",void 0),Il([(0,o.Property)(!0)],t.prototype,"showFileExtension",void 0),Il([(0,o.Property)(!1)],t.prototype,"showHiddenItems",void 0),Il([(0,o.Property)(!0)],t.prototype,"showThumbnail",void 0),Il([(0,o.Property)("Ascending")],t.prototype,"sortOrder",void 0),Il([(0,o.Complex)({visible:!0,items:["NewFolder","Upload","Cut","Copy","Paste","Delete","Download","Rename","SortBy","Refresh","Selection","View","Details"]},Bl.ToolbarSettings)],t.prototype,"toolbarSettings",void 0),Il([(0,o.Complex)({autoUpload:!0,minFileSize:0,maxFileSize:3e7,allowedExtensions:"",autoClose:!1},Bl.UploadSettings)],t.prototype,"uploadSettings",void 0),Il([(0,o.Property)("LargeIcons")],t.prototype,"view",void 0),t}(o.ChildProperty),Vl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)("100%")],t.prototype,"width",void 0),Il([(0,o.Property)(Wo)],t.prototype,"styles",void 0),Il([(0,o.Property)(!0)],t.prototype,"resize",void 0),Il([(0,o.Property)(0)],t.prototype,"minWidth",void 0),Il([(0,o.Property)(null)],t.prototype,"maxWidth",void 0),t}(o.ChildProperty),Wl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)(!0)],t.prototype,"enable",void 0),Il([(0,o.Property)(!1)],t.prototype,"showOnRightClick",void 0),Il([(0,o.Property)("hide")],t.prototype,"actionOnScroll",void 0),Il([(0,o.Property)(["Open","Edit","UnLink"])],t.prototype,"link",void 0),Il([(0,o.Property)(["Replace","Align","Caption","Remove","-","InsertLink","OpenImageLink","EditImageLink","RemoveImageLink","Display","AltText","Dimension"])],t.prototype,"image",void 0),Il([(0,o.Property)(["AudioReplace","AudioRemove","AudioLayoutOption"])],t.prototype,"audio",void 0),Il([(0,o.Property)(["VideoReplace","VideoAlign","VideoRemove","VideoLayoutOption","VideoDimension"])],t.prototype,"video",void 0),Il([(0,o.Property)(null)],t.prototype,"text",void 0),Il([(0,o.Property)(["TableHeader","TableRows","TableColumns","BackgroundColor","-","TableRemove","Alignments","TableCellVerticalAlign","Styles"])],t.prototype,"table",void 0),t}(o.ChildProperty),Ql=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)("b; em; font; sub; sup; kbd; i; s; u; code; strong; span; p; div; h1; h2; h3; h4; h5; h6; blockquote; ol; ul; li; pre;")],t.prototype,"allowedFormats",void 0),Il([(0,o.Property)(null)],t.prototype,"deniedFormats",void 0),t}(o.ChildProperty),Kl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)(nr)],t.prototype,"iconsSet",void 0),Il([(0,o.Property)(!0)],t.prototype,"showSearchBox",void 0),t}(o.ChildProperty),Gl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)(!1)],t.prototype,"prompt",void 0),Il([(0,o.Property)(null)],t.prototype,"deniedAttrs",void 0),Il([(0,o.Property)(["background","background-color","border","border-bottom","border-left","border-radius","border-right","border-style","border-top","border-width","clear","color","cursor","direction","display","float","font","font-family","font-size","font-weight","font-style","height","left","line-height","list-style-type","margin","margin-top","margin-left","margin-right","margin-bottom","max-height","max-width","min-height","min-width","overflow","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","position","right","table-layout","text-align","text-decoration","text-transform","text-indent","top","vertical-align","visibility","white-space","width","flex-direction"])],t.prototype,"allowedStyleProps",void 0),Il([(0,o.Property)(null)],t.prototype,"deniedTags",void 0),Il([(0,o.Property)(!0)],t.prototype,"keepFormat",void 0),Il([(0,o.Property)(!1)],t.prototype,"plainText",void 0),t}(o.ChildProperty),Xl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)(null)],t.prototype,"default",void 0),Il([(0,o.Property)("72px")],t.prototype,"width",void 0),Il([(0,o.Property)(Ko)],t.prototype,"items",void 0),t}(o.ChildProperty),Yl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)(null)],t.prototype,"default",void 0),Il([(0,o.Property)("60px")],t.prototype,"width",void 0),Il([(0,o.Property)(Go)],t.prototype,"items",void 0),t}(o.ChildProperty),Jl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)(null)],t.prototype,"default",void 0),Il([(0,o.Property)("65px")],t.prototype,"width",void 0),Il([(0,o.Property)(Xo)],t.prototype,"types",void 0),t}(o.ChildProperty),$l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)("#ff0000")],t.prototype,"default",void 0),Il([(0,o.Property)("Palette")],t.prototype,"mode",void 0),Il([(0,o.Property)(10)],t.prototype,"columns",void 0),Il([(0,o.Property)(Yo)],t.prototype,"colorCode",void 0),Il([(0,o.Property)(!1)],t.prototype,"modeSwitcher",void 0),t}(o.ChildProperty),Zl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)("#ffff00")],t.prototype,"default",void 0),Il([(0,o.Property)("Palette")],t.prototype,"mode",void 0),Il([(0,o.Property)(10)],t.prototype,"columns",void 0),Il([(0,o.Property)(Jo)],t.prototype,"colorCode",void 0),Il([(0,o.Property)(!1)],t.prototype,"modeSwitcher",void 0),t}(o.ChildProperty),ed=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)($o)],t.prototype,"types",void 0),t}(o.ChildProperty),td=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rl(t,e),Il([(0,o.Property)(Zo)],t.prototype,"types",void 0),t}(o.ChildProperty),nd=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),id=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},od=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return nd(t,e),id([(0,o.Property)([])],t.prototype,"styles",void 0),id([(0,o.Property)([])],t.prototype,"scripts",void 0),t}(o.ChildProperty),rd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return nd(t,e),id([(0,o.Property)(!1)],t.prototype,"enable",void 0),id([(0,o.Property)(null)],t.prototype,"attributes",void 0),id([(0,o.Complex)({},od)],t.prototype,"resources",void 0),id([(0,o.Property)([])],t.prototype,"metaTags",void 0),id([(0,o.Property)(null)],t.prototype,"sandbox",void 0),t}(o.ChildProperty),sd=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ad=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},ld=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return sd(t,e),ad([(0,o.Property)(!1)],t.prototype,"enable",void 0),ad([(0,o.Property)(!0)],t.prototype,"onSelection",void 0),t}(o.ChildProperty);function dd(e,t,n,i){var o;n?o=t.contentModule.getDocument().querySelector("body"):o=t.element;if(Object.keys(e).length)for(var r=0,s=Object.keys(e);r<s.length;r++){var a=s[r];if("class"===a)o.classList.add(e[""+a]);else if("disabled"===a&&"disabled"===e[""+a])t.enabled=!1,t.setEnable();else if("readonly"===a&&"readonly"===e[""+a])t.readonly=!0,t.setReadOnly(i);else if("style"===a)o.style.cssText=e[""+a];else if("tabindex"===a)t.inputElement.setAttribute("tabindex",e[""+a]);else if("placeholder"===a)t.placeholder=e[""+a],t.setPlaceHolder();else{["name","required"].indexOf(a)>-1?t.valueContainer.setAttribute(a,e[""+a]):o.setAttribute(a,e[""+a])}}}var cd=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.showFullScreen=function(e){var t=this;if(!0!==this.parent.toolbarSettings.enable||"Markdown"===this.parent.editorMode||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule)||this.parent.quickToolbarModule.hideQuickToolbars(),this.parent.showTooltip&&!(0,o.isNullOrUndefined)(document.querySelector(".e-tooltip-wrap"))&&this.parent.notify(Wt,{args:e}),this.scrollableParent=(0,Wr.getScrollableParent)(this.parent.element),!this.parent.element.classList.contains(Cn)){var n={cancel:!1,requestType:"Maximize",targetItem:"Maximize",args:e};this.parent.trigger($,n,(function(n){n.cancel||(t.parent.toolbarSettings.enableFloating&&!t.parent.inlineMode.enable&&t.parent.toolbarSettings.enable&&(t.parent.getToolbarElement().style.width="100%",t.parent.getToolbarElement().style.top="0px"),t.parent.element.classList.add(Cn),t.toggleParentOverflow(!0),t.parent.toolbarModule&&(t.parent.getBaseToolbarObject().toolbarObj.items[0].properties||t.parent.getBaseToolbarObject().toolbarObj.removeItems(0),o.Browser.isDevice&&t.parent.toolbarModule.removeFixedTBarClass(),t.parent.toolbarModule.updateItem({targetItem:"Maximize",updateItem:"Minimize",baseToolbar:t.parent.getBaseToolbarObject()})),t.parent.refreshUI(),t.parent.trigger(Z,{requestType:"Maximize",targetItem:"Maximize",args:e}))}))}},e.prototype.hideFullScreen=function(e){var t=this;if(!0!==this.parent.toolbarSettings.enable||"Markdown"===this.parent.editorMode||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule)||this.parent.quickToolbarModule.hideQuickToolbars(),this.parent.showTooltip&&!(0,o.isNullOrUndefined)(document.querySelector(".e-tooltip-wrap"))&&this.parent.notify(Wt,{args:e}),this.parent.element.classList.contains(Cn)){var n={cancel:!1,requestType:"Minimize",targetItem:"Minimize",args:e};this.parent.trigger($,n,(function(n){if(!n.cancel){t.parent.element.classList.remove(Cn);for(var i=document.querySelectorAll(".e-rte-overflow"),r=0;r<i.length;r++)(0,o.removeClass)([i[r]],["e-rte-overflow"]);t.parent.toolbarModule&&(t.parent.getBaseToolbarObject().toolbarObj.items[0].properties||t.parent.getBaseToolbarObject().toolbarObj.removeItems(0),t.parent.toolbarModule.updateItem({targetItem:"Minimize",updateItem:"Maximize",baseToolbar:t.parent.getBaseToolbarObject()}),o.Browser.isDevice&&t.parent.inlineMode.enable&&t.parent.toolbarModule.addFixedTBarClass()),t.parent.refreshUI(),t.parent.trigger(Z,{requestType:"Minimize",targetItem:"Minimize",args:e})}}))}},e.prototype.toggleParentOverflow=function(e){if(!(0,o.isNullOrUndefined)(this.scrollableParent))for(var t=0;t<this.scrollableParent.length;t++)if("#document"===this.scrollableParent[t].nodeName){var n=document.querySelector("body");(0,o.addClass)([n],["e-rte-overflow"])}else{n=this.scrollableParent[t];(0,o.addClass)([n],["e-rte-overflow"])}},e.prototype.onKeyDown=function(e){var t=e.args;switch(t.action){case"full-screen":this.showFullScreen(e.args),t.preventDefault();break;case"escape":this.hideFullScreen(e.args),t.preventDefault()}},e.prototype.addEventListener=function(){this.parent.on(k,this.onKeyDown,this),this.parent.on(f,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.off(k,this.onKeyDown),this.parent.off(f,this.destroy)},e.prototype.destroy=function(){if(!(0,o.isNullOrUndefined)(this.parent)){this.parent.element.classList.contains(Cn)&&this.toggleParentOverflow(!1);for(var e=document.querySelectorAll(".e-rte-overflow"),t=0;t<e.length;t++)(0,o.removeClass)([e[t]],["e-rte-overflow"]);this.removeEventListener()}},e}(),hd=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(Ye,this.enterHandler,this),this.parent.on(f,this.destroy,this)},e.prototype.destroy=function(){(0,o.isNullOrUndefined)(this.parent)||this.removeEventListener()},e.prototype.removeEventListener=function(){this.parent.off(Ye,this.enterHandler),this.parent.off(f,this.destroy)},e.prototype.getRangeNode=function(){this.range=this.parent.getRange(),this.startNode="#text"===this.range.startContainer.nodeName?this.range.startContainer.parentElement:this.range.startContainer,this.endNode="#text"===this.range.endContainer.nodeName?this.range.endContainer.parentElement:this.range.endContainer},e.prototype.enterHandler=function(e){var t=this;this.getRangeNode();var n=!0;this.formatTags=["h1","h2","h3","h4","h5","h6","blockquote"];var i=this.processedTableImageCursor();if(!i.start&&!i.end||"TABLE"!==i.startName&&"TABLE"!==i.endName)if(!i.start&&!i.end&&"IMG"!==this.range.startContainer.nodeName||"BR"!==this.parent.enterKey||"IMG"!==i.startName&&"IMG"!==i.endName&&"IMG"!==this.range.startContainer.nodeName){if(!(0,o.isNullOrUndefined)(this.startNode.closest("TABLE"))&&!(0,o.isNullOrUndefined)(this.endNode.closest("TABLE"))){n=!1;for(var r=this.startNode,s=r;!this.parent.formatter.editorManager.domNode.isBlockNode(r);)s=r=r.parentElement;n="TH"!==s.tagName&&"TD"!==s.tagName&&"TBODY"!==s.tagName}var a=e.args;if(13===a.which&&!a.ctrlKey&&(o.Browser.isDevice?"Enter"===a.key:"Enter"===a.code||"NumpadEnter"===a.code)&&(0,o.isNullOrUndefined)(this.startNode.closest("LI, UL, OL"))&&(0,o.isNullOrUndefined)(this.endNode.closest("LI, UL, OL"))&&(0,o.isNullOrUndefined)(this.startNode.closest(".e-img-inner"))&&n&&(0,o.isNullOrUndefined)(this.startNode.closest("PRE"))&&(0,o.isNullOrUndefined)(this.endNode.closest("PRE"))&&(0,o.isNullOrUndefined)(this.startNode.closest("BLOCKQUOTE"))&&(0,o.isNullOrUndefined)(this.endNode.closest("BLOCKQUOTE"))){var l=e.args.shiftKey,d={cancel:!1,name:$,requestType:l?"ShiftEnterAction":"EnterAction",originalEvent:e.args};this.parent.trigger($,d,(function(i){if(!i.cancel){if(0===t.parent.formatter.getUndoRedoStack().length&&t.parent.formatter.saveData(),t.range.startOffset!==t.range.endOffset||t.range.startContainer!==t.range.endContainer)if(t.range.startContainer.nodeType!==Node.TEXT_NODE&&("IMG"===t.range.startContainer.nodeName||t.range.startContainer.querySelector("img")||"SPAN"===t.range.startContainer.nodeName&&(t.range.startContainer.classList.contains("e-video-wrap")||t.range.startContainer.classList.contains("e-audio-wrap")))||t.range.deleteContents(),"#text"===t.range.startContainer.nodeName&&0===t.range.startContainer.textContent.length&&t.range.startContainer.parentElement!==t.parent.inputElement)"BR"===t.parent.enterKey?t.range.startContainer.parentElement.innerHTML="&#8203;":t.range.startContainer.parentElement.innerHTML="<br>";else if(t.range.startContainer===t.parent.inputElement&&""===t.range.startContainer.innerHTML){"P"===t.parent.enterKey?t.range.startContainer.innerHTML="<p><br></p>":"DIV"===t.parent.enterKey?t.range.startContainer.innerHTML="<div><br></div>":t.range.startContainer.innerHTML="<br>";var r=t.range.startContainer.childNodes[t.range.startOffset];t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),r,0)}else if(t.parent.inputElement===t.range.startContainer){if("#text"===(r=t.range.startContainer.childNodes[t.range.startOffset]).nodeName&&0===r.textContent.length)t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),r,0===r.textContent.length?0:r.previousSibling.textContent.length);else if(t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),r,r.textContent.length>=0?0:1),0===r.previousSibling.textContent.length){if((0,o.detach)(r.previousSibling),!l){for(var s=(0,o.isNullOrUndefined)(r.lastChild)?r:r.lastChild;!(0,o.isNullOrUndefined)(s)&&"#text"!==s.nodeName&&"BR"!==s.nodeName;)s=s.lastChild;"BR"!==s.nodeName&&0===s.parentElement.textContent.length&&0===s.parentElement.innerHTML.length&&"BR"!==s.parentElement.nodeName&&s.parentElement.appendChild(t.parent.createElement("BR")),t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),"BR"===s.nodeName?s:s.parentElement,s.parentElement.textContent.length>=0||"BR"===s.nodeName?0:1)}}else if(0===r.textContent.length){for(s="#text"===r.previousSibling.nodeName?r.previousSibling:r.previousSibling.lastChild;!(0,o.isNullOrUndefined)(s)&&"#text"!==s.nodeName;)s=s.lastChild;t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),s,s.textContent.length),(0,o.detach)(r)}else if("BR"!==t.parent.enterKey&&0!==r.previousSibling.textContent.length&&0!==r.textContent.length)return void e.args.preventDefault();t.getRangeNode()}if(t.range.startContainer===t.range.endContainer&&t.range.startOffset===t.range.endOffset&&t.range.startContainer===t.parent.inputElement){if(1!==t.parent.inputElement.childNodes.length||"TABLE"!==t.parent.inputElement.childNodes[0].nodeName)if((0,o.isNullOrUndefined)(t.range.startContainer.childNodes[t.range.startOffset])){for(var a=t.range.startContainer.childNodes[t.range.startOffset-1];null!==a.lastChild&&"#text"!==a.nodeName;)a=a.lastChild;t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),a,"BR"===a.nodeName?0:a.textContent.length)}else t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),t.range.startContainer.childNodes[t.range.startOffset],0);t.getRangeNode()}if("P"===t.parent.enterKey&&!l||"DIV"===t.parent.enterKey&&!l||"P"===t.parent.shiftEnterKey&&l||"DIV"===t.parent.shiftEnterKey&&l){if(1===t.range.startOffset&&1===t.parent.inputElement.childNodes.length&&"TABLE"===t.parent.inputElement.childNodes[0].nodeName){(F=t.createInsertElement(l)).appendChild(t.parent.createElement("BR")),t.parent.inputElement.appendChild(F),t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),F,0)}else{var d=void 0;d=n&&t.parent.formatter.editorManager.domNode.isBlockNode(t.startNode)?"#text"!==t.range.startContainer.nodeName||(0,o.isNullOrUndefined)(t.range.startContainer.previousSibling)||"HR"!==t.range.startContainer.previousSibling.nodeName?t.startNode:t.range.startContainer.nextSibling:t.parent.formatter.editorManager.domNode.blockParentNode(t.startNode);var c=!1,h=!1,p=!1,u=!1;if(ee=t.range.startContainer.parentElement){var m=t.parent.contentModule.getDocument().defaultView.getComputedStyle(ee);p="pre-wrap"===m.getPropertyValue("white-space"),u="nowrap"===m.getPropertyValue("text-wrap")}if(0===t.range.startOffset||0===t.range.endOffset||t.range.startContainer!==t.range.endContainer||!(0,o.isNullOrUndefined)(d.childNodes[0])&&("IMG"===d.childNodes[0].nodeName||d.querySelectorAll("img, audio, video").length>0))0===t.range.startOffset&&0===t.range.endOffset&&(h=!0);else{var f=t.range.startContainer.textContent,g=f.substring(0,t.range.startOffset),b=g.charCodeAt(t.range.startOffset-1),v=0===g.trim().length,y=0!==f.slice(t.range.startOffset).trim().length;!(160!==b&&v&&!p&&!u)&&!(32===b&&(p||u)&&v&&y)||t.range.startContainer.previousSibling||(h=!0)}t.removeBRElement(d);var C=-1!==o.Browser.userAgent.indexOf("Firefox")&&0===t.range.startOffset&&t.range.startContainer===t.range.endContainer&&"#text"===t.range.startContainer.nodeName&&!(0,o.isNullOrUndefined)(t.range.startContainer.previousSibling)&&!t.parent.formatter.editorManager.domNode.isBlockNode(t.range.startContainer.previousSibling)&&t.range.startContainer.parentElement===t.range.startContainer.previousSibling.parentElement,N="#text"===t.range.startContainer.nodeName&&t.range.startContainer.textContent.includes("​")&&"​"===t.range.startContainer.textContent.trim()||"#text"===t.range.startContainer.nodeName&&!(0,o.isNullOrUndefined)(t.range.startContainer.textContent[t.range.startOffset])&&t.range.startContainer.textContent[t.range.startOffset].includes("​")&&"​"===t.range.startContainer.textContent[t.range.startOffset]&&"​"!==t.parent.inputElement.textContent[0];if(("#text"===t.range.startContainer.nodeName||"BR"===t.range.startContainer.nodeName)&&0===t.range.startOffset&&0===t.range.endOffset&&t.range.startContainer.parentElement===t.parent.inputElement&&"BR"===t.parent.enterKey&&l||N||C||!(0===t.range.startOffset&&0===t.range.endOffset||h)||!((0,o.isNullOrUndefined)(t.range.startContainer.previousSibling)||"IMG"!==t.range.startContainer.previousSibling.nodeName&&"BR"!==t.range.startContainer.previousSibling.nodeName))if(d===t.parent.inputElement||0!==d.textContent.length||(!(0,o.isNullOrUndefined)(d.childNodes[0])&&"IMG"===d.childNodes[0].nodeName||d.querySelectorAll("video").length>0||d.querySelectorAll("audio").length>0||d.querySelectorAll("img").length>0))if(t.range.startContainer===t.range.endContainer&&t.range.startContainer.nodeType!==Node.TEXT_NODE&&("IMG"===t.range.startContainer.nodeName||t.range.startContainer.querySelector("img")||"SPAN"===t.range.startContainer.nodeName&&(t.range.startContainer.classList.contains("e-video-wrap")||t.range.startContainer.classList.contains("e-audio-wrap")))){if(d.textContent.trim().length>0){F=t.parent.formatter.editorManager.nodeCutter.SplitNode(t.range,d,!0);var E=(0,o.isNullOrUndefined)(F.previousSibling.querySelector(".e-video-wrap"))?F.previousSibling.querySelector(".e-audio-wrap"):F.previousSibling.querySelector(".e-video-wrap"),S=!1;if(!(0,o.isNullOrUndefined)(E)){for(var T=E.previousSibling;!(0,o.isNullOrUndefined)(T)&&"#text"!==T.nodeName;)T=T.lastChild;if((0,o.isNullOrUndefined)(T)){var O=t.parent.createElement("br");E.parentElement.appendChild(O),S=!0}S?t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),E.parentElement,0):t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),T,T.textContent.length),(0,o.detach)(E)}}else{r=(F=t.parent.formatter.editorManager.nodeCutter.SplitNode(t.range,d,!0)).hasChildNodes()?F.previousSibling:F;var L=(0,o.isNullOrUndefined)(F.querySelector("img"))?null:F.querySelector("img");z=t.createInsertElement(l);for((0,o.isNullOrUndefined)(L)?(0,o.isNullOrUndefined)(L)&&r.querySelector("img")&&(r=F):h?(F.parentElement.insertBefore(z,F),r=F.previousSibling):(t.parent.formatter.editorManager.domNode.insertAfter(z,F),r=F.nextSibling);!(0,o.isNullOrUndefined)(r.firstChild);)(0,o.detach)(r.firstChild);O=t.parent.createElement("br");r.appendChild(O),t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),r,0)}(0,o.isNullOrUndefined)(t.parent.audioModule)||t.parent.audioModule.hideAudioQuickToolbar(),(0,o.isNullOrUndefined)(t.parent.videoModule)||t.parent.videoModule.hideVideoQuickToolbar()}else if("BR"===t.parent.enterKey&&l&&t.range.startContainer.nodeType===Node.TEXT_NODE&&t.range.startContainer.parentElement&&t.range.startContainer.parentElement===t.parent.inputElement){var k=t.range,x=k.startContainer,w=k.startOffset,D=t.parent.createElement(t.parent.shiftEnterKey);if(x.nodeType===Node.TEXT_NODE&&0!==k.endOffset&&0!==k.startOffset){var M=x;if(w<M.length){var A=M.splitText(w);D.appendChild(A)}else D.innerHTML="<br>";M.parentNode.insertBefore(D,M.nextSibling),t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),D,0)}else if(0===w&&0===k.endOffset){if(D.innerHTML="<br>",k.endOffset===x.textContent.length){var B=t.parent.createElement("br");x.parentNode.insertBefore(B,x)}x.parentNode.insertBefore(D,x);var R=k.endOffset===x.textContent.length?D:D.nextSibling;x.parentNode.insertBefore(D,x),t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),R,0)}}else{F=t.parent.formatter.editorManager.nodeCutter.SplitNode(t.range,d,!0);if((0,o.isNullOrUndefined)(F.childNodes[0])||"#text"!==F.childNodes[0].nodeName||0!==F.childNodes[0].textContent.length||(0,o.detach)(F.childNodes[0]),0===F.textContent.trim().length||F.childNodes[0].textContent.trim().includes("​")&&"​"===F.childNodes[0].textContent.trim()){O=t.parent.createElement("br");if("A"===t.startNode.nodeName||t.startNode.closest("a")){t.startNode="A"===t.startNode.nodeName?t.startNode:t.startNode.closest("a");var I=t.startNode.parentElement;t.startNode.parentElement.insertBefore(O,t.startNode),(0,o.detach)(t.startNode),t.startNode=I}else"BR"!==t.startNode.nodeName&&t.startNode.appendChild(O);"\n"===F.childNodes[0].textContent&&(0,o.detach)(F.childNodes[0]),F.childNodes[0].textContent.trim().includes("​")&&"​"===F.childNodes[0].textContent.trim()&&(0,o.detach)(F.childNodes[0]),t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),t.startNode,0)}if(("P"===t.parent.enterKey||"DIV"===t.parent.enterKey)&&!l||("DIV"===t.parent.shiftEnterKey||"P"===t.parent.shiftEnterKey)&&l){var U=t.formatTags.indexOf(F.nodeName.toLocaleLowerCase());if(U<0||U>=0&&0===F.textContent.trim().length){for(var P=t.createInsertElement(l);F.firstChild;)P.appendChild(F.firstChild);t.parent.formatter.editorManager.domNode.insertAfter(P,F),(0,o.detach)(F);var H=t.parent.formatter.editorManager.domNode.isBlockNode(t.startNode)?P:t.startNode,j=0;H&&("A"===H.nodeName||H.closest("a"))&&(H="A"===H.nodeName?H:H.closest("a"),(H=t.getFirstTextNode(H)).nodeValue="​"+H.nodeValue,j=1),t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),H,j)}}}else if((0,o.isNullOrUndefined)(d.children[0])||"BR"===d.children[0].tagName){(z=t.createInsertElement(l)).innerHTML="<br>",t.parent.formatter.editorManager.domNode.insertAfter(z,d),t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),z,0)}else{var F=t.parent.formatter.editorManager.nodeCutter.SplitNode(t.range,d,!1).cloneNode(!0);t.parent.formatter.editorManager.domNode.insertAfter(F,d),t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),F,F.textContent.length>=0?0:1)}else{var q=void 0,F=void 0;(0,o.isNullOrUndefined)(t.range.startContainer.childNodes)||0!==t.range.startContainer.textContent.length&&("#text"===t.range.startContainer.nodeName||(0,o.isNullOrUndefined)(t.range.startContainer.querySelector(".e-video-clickelem"))||0!==t.range.startContainer.querySelector(".e-video-clickelem").textContent.length)||!(t.range.startContainer.querySelectorAll("img, audio, video").length>0)&&(0,o.isNullOrUndefined)(t.range.startContainer.querySelector(".e-video-clickelem"))&&"IMG"!==t.range.startContainer.nodeName&&"TABLE"!==t.range.startContainer.nodeName?0!==d.textContent.trim().length||!(0,o.isNullOrUndefined)(d.childNodes[0])&&"IMG"===d.childNodes[0].nodeName||""===d.textContent.trim()&&d.querySelectorAll("img, audio, video").length>0?(t.range.startOffset===t.range.endOffset&&0!==t.range.startOffset?F=t.parent.formatter.editorManager.nodeCutter.SplitNode(t.range,d,!1).cloneNode(!0):(F=t.parent.formatter.editorManager.nodeCutter.SplitNode(t.range,d,!0).cloneNode(!0),c=!0),q=!1):(F=t.parent.formatter.editorManager.nodeCutter.SplitNode(t.range,d,!0).cloneNode(!0),q=!0):(F=t.createInsertElement(l),c=!0,q=!1);var z=void 0;for(z=t.formatTags.indexOf(F.nodeName.toLocaleLowerCase())<0?t.createInsertElement(l):t.parent.createElement(F.nodeName);F.firstChild;)z.appendChild(F.firstChild);var _=!(t.range.startContainer===d||!(d.querySelector(".e-video-wrap")||d.querySelector(".e-audio-wrap")&&t.range.startContainer.classList.contains("e-clickelem"))),V=!(t.range.startContainer===d||!d.querySelector("img"));if(_?t.parent.formatter.editorManager.domNode.insertAfter(z,d):d.parentElement.insertBefore(z,d),!q){s=z;var W=void 0;if(t.range.startOffset===t.range.endOffset&&0!==t.range.startOffset)for(;!(0,o.isNullOrUndefined)(s)&&"#text"!==s.nodeName&&"BR"!==s.nodeName;)W=s,s=s.lastChild;else W=s;W.innerHTML="<br>",c||(0,o.detach)(d)}_||V?t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),z,0):t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),z.nextElementSibling,0)}}e.args.preventDefault()}if("BR"===t.parent.enterKey&&!l||"BR"===t.parent.shiftEnterKey&&l){var Q=void 0;if(t.parent.formatter.editorManager.domNode.isBlockNode(t.startNode))Q=t.startNode;else{for(var K=t.startNode,G=K;!t.parent.formatter.editorManager.domNode.isBlockNode(K);)G=K,K=K.parentElement;Q=K===t.parent.inputElement?G:K}var X=window.getComputedStyle(Q);t.removeBRElement(Q);for(var Y=Q.lastChild;!(0,o.isNullOrUndefined)(Y)&&"#text"!==Y.nodeName&&"BR"!==Y.nodeName&&"IMG"!==Y.nodeName;)Y=Y.lastChild;var J=t.range.startContainer===Y?t.range.startContainer.textContent.length:Q.textContent.length;V="IMG"===t.range.startContainer.nodeName||t.range.startContainer.childNodes.length>0&&!(0,o.isNullOrUndefined)(t.range.startContainer.childNodes[t.range.startOffset])&&"IMG"===t.range.startContainer.childNodes[t.range.startOffset].nodeName||1===t.range.startContainer.nodeType&&null!==t.range.startContainer.querySelector("img");if(Q!==t.parent.inputElement&&t.parent.formatter.editorManager.domNode.isBlockNode(Q)&&t.range.startOffset===t.range.endOffset&&(t.range.startOffset===J||0===Q.textContent.trim().length&&V)){var $=t.parent.createElement("br");if(0===t.range.startOffset&&"TABLE"===t.range.startContainer.nodeName)t.range.startContainer.parentElement.insertBefore($,t.range.startContainer);else if("BR"===Y.nodeName&&0===Q.textContent.length)t.parent.formatter.editorManager.domNode.insertAfter($,Y);else if(0===t.range.startOffset&&0===t.range.endOffset&&V){var Z="IMG"===t.range.startContainer.nodeName?t.range.startContainer:t.range.startContainer.childNodes[t.range.startOffset];Q.insertBefore($,Z)}else{var ee,te=t.parent.createElement("br"),ne=void 0;if((ee=t.range.startContainer.parentElement)&&"A"===ee.nodeName&&ee.textContent.length===t.range.startOffset)ne=ee;else if(ee){var ie=ee.closest("a");ne=ie||t.range.startContainer}t.parent.formatter.editorManager.domNode.insertAfter($,ne),t.parent.formatter.editorManager.domNode.insertAfter(te,ne);var oe=ne.nextElementSibling,re=(0,o.isNullOrUndefined)(oe)?null:oe.nextElementSibling;(0,o.isNullOrUndefined)(oe)||(0,o.isNullOrUndefined)(re)||(0,o.isNullOrUndefined)(re.nextElementSibling)||"BR"!==oe.nodeName||"BR"!==re.nodeName||"BR"!==re.nextElementSibling.nodeName||re.nextElementSibling.remove()}t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),$,0)}else if((0,o.isNullOrUndefined)(Q)||Q===t.parent.inputElement||"BR"===Q.nodeName)t.insertBRElement();else if(0===Q.textContent.trim().length||1===Q.textContent.trim().length&&8203===Q.textContent.charCodeAt(0))if(Q.childElementCount>0&&"IMG"===Q.lastElementChild.nodeName||Q.lastElementChild&&"BR"===Q.lastElementChild.nodeName||!(0,o.isNullOrUndefined)(Q.firstElementChild)&&(Q.querySelector(".e-video-wrap")||Q.querySelector(".e-audio-wrap")))t.insertBRElement();else{F=t.parent.formatter.editorManager.nodeCutter.SplitNode(t.range,Q,!0).cloneNode(!0);t.parent.formatter.editorManager.domNode.insertAfter(F,Q);var se=t.parent.createElement("br");F.parentElement.insertBefore(se,F),t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),F,0)}else{F=void 0,se=t.parent.createElement("br");if(0!==t.range.startOffset||0!==t.range.endOffset||(0,o.isNullOrUndefined)(Q.previousSibling)||"BR"!==Q.previousSibling.nodeName||"P"===Q.nodeName||"DIV"===Q.nodeName)if(Q===t.parent.inputElement||"inline"!==X.display&&"inline-block"!==X.display)if("A"===t.startNode.nodeName||t.startNode.closest("A")){t.startNode="A"===t.startNode.nodeName?t.startNode:t.startNode.closest("A"),t.parent.formatter.editorManager.nodeCutter.SplitNode(t.range,t.startNode,!0).cloneNode(!0),t.startNode.parentElement.insertBefore(se,t.startNode);var ae=t.getFirstTextNode(t.startNode);ae.nodeValue="​"+ae.nodeValue,t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),ae,1)}else t.insertBRElement();else F=t.parent.formatter.editorManager.nodeCutter.SplitNode(t.range,Q,!0).cloneNode(!0),Q.parentElement.insertBefore(se,Q),t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),Q,0),t.insertFocusContent();else{F=t.parent.formatter.editorManager.nodeCutter.SplitNode(t.range,Q,!1).cloneNode(!0),t.parent.formatter.editorManager.domNode.insertAfter(se,Q),t.insertFocusContent();for(s=se.nextSibling;!(0,o.isNullOrUndefined)(s)&&"#text"!==s.nodeName;)s=s.lastChild;t.parent.formatter.editorManager.nodeSelection.setCursorPoint(t.parent.contentModule.getDocument(),s,0)}}e.args.preventDefault()}t.triggerActionComplete(e,l),t.parent.inputElement.dispatchEvent(new Event("input"))}}))}}else this.handleEnterKeyAtImageSide(e,i.start,i.end);else this.handleCursorAtTableSide(e,i.start,i.end)},e.prototype.getFirstTextNode=function(e){return this.parent.contentModule.getDocument().createTreeWalker(e,NodeFilter.SHOW_TEXT,null).nextNode()},e.prototype.removeBRElement=function(e){-1!==o.Browser.userAgent.indexOf("Firefox")&&this.range.endOffset===e.textContent.length&&(0!==e.textContent.length||e.querySelectorAll("BR").length>1)&&!(0,o.isNullOrUndefined)(e.lastChild)&&"BR"===e.lastChild.nodeName&&(0,o.detach)(e.lastChild)},e.prototype.insertBRElement=function(){var e=!1,t=!0,n=!1;0===this.range.endContainer.textContent.length&&"BR"===this.range.startContainer.nodeName&&(t=!1);for(var i=this.parent.createElement("br"),r=this.startNode;r.lastChild;)r=r.lastChild;var s="A"===this.startNode.nodeName&&"A"===this.endNode.nodeName&&!(0,o.isNullOrUndefined)(this.range.startContainer.parentElement)&&this.range.startOffset===this.range.endOffset&&this.range.startContainer.textContent.trim().length===r.textContent.trim().length;if("BR"===this.startNode.nodeName&&"BR"===this.endNode.nodeName&&0===this.range.startOffset&&this.range.startOffset===this.range.endOffset)this.parent.formatter.editorManager.domNode.insertAfter(i,this.startNode),e=!0;else if(this.startNode!==this.parent.inputElement||(0,o.isNullOrUndefined)(this.range.startContainer.previousSibling)||"BR"!==this.range.startContainer.previousSibling.nodeName||0!==this.range.startContainer.textContent.length||(e=!0),s)this.parent.formatter.editorManager.domNode.insertAfter(i,this.startNode);else if("SPAN"===this.startNode.tagName&&(this.startNode.classList.contains("e-video-wrap")||this.startNode.classList.contains("e-audio-wrap"))){this.startNode.parentElement.insertBefore(i,this.startNode);var a=this.parent.formatter.editorManager.domNode.blockParentNode(this.startNode),l=this.parent.formatter.editorManager.nodeCutter.SplitNode(this.range,a,!0);(0,o.detach)(l.previousSibling.childNodes[1]),e=!0}else this.startNode.nodeType===Node.ELEMENT_NODE&&this.startNode.childElementCount>0&&"IMG"===this.startNode.lastElementChild.nodeName?(this.startNode.parentElement.insertBefore(i,this.startNode),e=!0,n=!0):(this.range.insertNode(i),e=!0);var d=!(0,o.isNullOrUndefined)(i.nextSibling)&&(i.nextSibling.textContent.length>0||"#text"!==i.nextSibling.nodeName&&i.nextSibling.querySelectorAll("audio,video,table,img").length>0)||!(0,o.isNullOrUndefined)(i.nextElementSibling)&&"BR"===i.nextElementSibling.tagName||"BR"===this.range.startContainer.nodeName,c=!(0,o.isNullOrUndefined)(i.nextSibling)&&!(0,o.isNullOrUndefined)(i.nextSibling.classList)&&(i.nextSibling.classList.contains("e-video-wrap")||i.nextSibling.classList.contains("e-audio-wrap"));if(d&&(e||!(0,o.isNullOrUndefined)(i.nextSibling)&&"#text"===i.nextSibling.nodeName&&0===i.nextSibling.textContent.trim().length&&!(0,o.isNullOrUndefined)(i.nextSibling.nextSibling)&&i.nextSibling.nextSibling.textContent.trim().length>0))this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),(0,o.isNullOrUndefined)(i.nextSibling)||!t||n||c?i:i.nextSibling,0),e=!1;else{var h=this.parent.createElement("br");s?this.parent.formatter.editorManager.domNode.insertAfter(h,this.startNode):this.range.insertNode(h),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),i,0)}},e.prototype.insertFocusContent=function(){0===this.range.startContainer.textContent.length&&("#text"===this.range.startContainer.nodeName?this.range.startContainer.parentElement.innerHTML="&#8203;":this.range.startContainer.innerHTML="&#8203;")},e.prototype.createInsertElement=function(e){var t;"DIV"===this.parent.enterKey&&!e||"DIV"===this.parent.shiftEnterKey&&e?t=this.parent.createElement("div"):("P"===this.parent.enterKey&&!e||"P"===this.parent.shiftEnterKey&&e)&&(t=this.parent.createElement("p"));var n=this.parent.formatter.editorManager.domNode.blockNodes()[0].previousSibling,i=this.parent.formatter.editorManager.domNode.blockNodes()[0].nextSibling;return!(0,o.isNullOrUndefined)(n)&&"#text"!==n.nodeName&&n.hasAttribute("style")&&"TABLE"!==n.nodeName&&(t.style.cssText=n.getAttribute("style")),(0,o.isNullOrUndefined)(n)&&!(0,o.isNullOrUndefined)(i)&&"#text"!==i.nodeName&&i.hasAttribute("style")&&"TABLE"!==i.nodeName&&(t.style.cssText=i.getAttribute("style")),t},e.prototype.triggerActionComplete=function(e,t){this.parent.trigger(Z,{requestType:t?"ShiftEnterAction":"EnterAction",args:e.args})},e.prototype.handleCursorAtTableSide=function(e,t,n){var i=this;if("BR"!==this.parent.enterKey){var r=e.args.shiftKey,s={cancel:!1,name:$,requestType:r?"ShiftEnterAction":"EnterAction",originalEvent:e.args};this.parent.trigger($,s,(function(s){if(!s.cancel){var a=i.parent.createElement(i.parent.enterKey);a.innerHTML="<br>";var l=void 0;t&&(l=i.range.startContainer.childNodes[i.range.startOffset]).parentElement.insertBefore(a,l),n&&(l=i.range.startContainer.childNodes[i.range.startOffset-1],(0,o.isNullOrUndefined)(l.nextSibling)?(0,o.isNullOrUndefined)(l.nextSibling)&&l.parentElement.appendChild(a):l.parentElement.insertBefore(a,l.nextSibling)),i.parent.formatter.editorManager.nodeSelection.setCursorPoint(i.parent.contentModule.getDocument(),a,0),e.args.preventDefault(),i.triggerActionComplete(e,r)}}))}},e.prototype.handleEnterKeyAtImageSide=function(e,t,n){var i=this,r={cancel:!1,name:$,requestType:e.args.shiftKey?"ShiftEnterAction":"EnterAction",originalEvent:e.args},s=!1;"IMG"===this.range.startContainer.nodeName&&0===this.range.startOffset&&(s=!0),this.parent.trigger($,r,(function(r){if(!r.cancel&&"BR"===i.parent.enterKey){var a=i.parent.createElement("BR"),l=void 0;if(s&&((l=i.range.startContainer).parentElement.insertBefore(a,l),i.parent.formatter.editorManager.nodeSelection.setCursorPoint(i.parent.contentModule.getDocument(),l,0)),t&&((l=i.range.startContainer.childNodes[i.range.startOffset]).parentElement.insertBefore(a,l),i.parent.formatter.editorManager.nodeSelection.setCursorPoint(i.parent.contentModule.getDocument(),l,0)),n)if(l=i.range.startContainer.childNodes[i.range.startOffset-1],(0,o.isNullOrUndefined)(l.nextSibling)){if((0,o.isNullOrUndefined)(l.nextSibling)){l.parentElement.appendChild(a);var d=i.parent.createElement("BR");l.parentElement.appendChild(d),i.parent.formatter.editorManager.nodeSelection.setCursorPoint(i.parent.contentModule.getDocument(),d,0)}}else l.parentElement.insertBefore(a,l.nextSibling),i.parent.formatter.editorManager.nodeSelection.setCursorPoint(i.parent.contentModule.getDocument(),a.nextSibling,0);e.args.preventDefault(),i.triggerActionComplete(e,e.args.shiftKey)}}))},e.prototype.isTableOrImageStart=function(){var e=this.range.startContainer,t=this.range.startOffset,n=this.range.collapsed&&1===e.nodeType&&e.isContentEditable&&e.childNodes[t]&&["IMG","TABLE"].indexOf(e.childNodes[t].nodeName)>-1;return n?{start:n,startNodeName:e.childNodes[t].nodeName}:{start:!1,startNodeName:""}},e.prototype.isTableOrImageEnd=function(){var e=this.range.startContainer,t=this.range.startOffset,n=this.range.collapsed&&1===e.nodeType&&e.isContentEditable&&e.childNodes[t-1]&&["IMG","TABLE"].indexOf(e.childNodes[t-1].nodeName)>-1;return n?{end:n,endNodeName:e.childNodes[t-1].nodeName}:{end:!1,endNodeName:""}},e.prototype.processedTableImageCursor=function(){var e=this.isTableOrImageStart(),t=e.start,n=e.startNodeName,i=this.isTableOrImageEnd();return{start:t,startName:n,end:i.end,endName:i.endNodeName}},e}(),pd=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ud=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},md=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return pd(t,e),ud([(0,o.Property)(!1)],t.prototype,"enable",void 0),ud([(0,o.Property)(["Paragraph","Heading 1","Heading 2","Heading 3","Heading 4","OrderedList","UnorderedList","CodeBlock","Blockquote"])],t.prototype,"items",void 0),ud([(0,o.Property)("300px")],t.prototype,"popupWidth",void 0),ud([(0,o.Property)("320px")],t.prototype,"popupHeight",void 0),t}(o.ChildProperty),fd=[{command:"Paragraph",subCommand:"p",type:"Basic Block",iconCss:"e-rte-paragraph"},{command:"Heading 1",subCommand:"h1",type:"Basic Block",iconCss:"e-rte-h1"},{command:"Heading 2",subCommand:"h2",type:"Basic Block",iconCss:"e-rte-h2"},{command:"Heading 3",subCommand:"h3",type:"Basic Block",iconCss:"e-rte-h3"},{command:"Heading 4",subCommand:"h4",type:"Basic Block",iconCss:"e-rte-h4"},{command:"OrderedList",subCommand:"insertOrderedList",type:"Basic Block",iconCss:"e-list-ordered e-icons"},{command:"UnorderedList",subCommand:"insertUnorderedList",type:"Basic Block",iconCss:"e-list-unordered e-icons"},{command:"Blockquote",subCommand:"blockquote",type:"Basic Block",iconCss:"e-blockquote e-icons"},{command:"CodeBlock",subCommand:"pre",type:"Basic Block",iconCss:"e-code-view e-icons"}],gd=[{command:"Image",subCommand:n.InsertImage,type:"Media",module:"Image",iconCss:"e-icons e-image"},{command:"Audio",subCommand:n.InsertAudio,type:"Media",module:"Audio",iconCss:"e-icons e-audio"},{command:"Video",subCommand:n.InsertVideo,type:"Media",module:"Video",iconCss:"e-icons e-video"},{command:"Link",subCommand:n.InsertLink,type:"Inline",module:"Link",iconCss:"e-icons e-link"},{command:"Table",subCommand:n.InsertTable,type:"Basic Block",module:"Table",iconCss:"e-icons e-table"},{command:"Emojipicker",subCommand:null,type:"Inline",module:"EmojiPicker",iconCss:"e-icons e-emoji"}],bd=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),vd=function(){return vd=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},vd.apply(this,arguments)},yd=function(e,t,n,i){var o,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,n,s):o(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},Cd=function(t){function i(e,n){var i=t.call(this,e,n)||this;return i.isPlainPaste=!1,i.needsID=!0,i.isCopyAll=!1,i}return bd(i,t),i.prototype.requiredModules=function(){var e=[];return this.toolbarSettings.enable&&(e.push({member:"toolbar",args:[this,this.serviceLocator]}),e.push({member:"link",args:[this,this.serviceLocator]}),e.push({member:"table",args:[this,this.serviceLocator]}),e.push({member:"image",args:[this,this.serviceLocator]}),e.push({member:"audio",args:[this,this.serviceLocator]}),e.push({member:"video",args:[this,this.serviceLocator]}),this.quickToolbarSettings.enable&&e.push({member:"quickToolbar",args:[this,this.serviceLocator]})),"HTML"===this.editorMode&&this.slashMenuSettings.enable&&e.push({member:"slashMenu",args:[this,this.serviceLocator]}),this.showCharCount&&e.push({member:"count",args:[this,this.serviceLocator]}),"Markdown"===this.editorMode&&e.push({member:"markdownEditor",args:[this,this.serviceLocator]}),"HTML"===this.editorMode&&(e.push({member:"htmlEditor",args:[this,this.serviceLocator]}),e.push({member:"pasteCleanup",args:[this,this.serviceLocator]}),e.push({member:"importExport",args:[this,this.serviceLocator]}),e.push({member:"formatPainter",args:[this]}),e.push({member:"emojiPicker",args:[this,this.serviceLocator]})),this.fileManagerSettings.enable&&e.push({member:"fileManager",args:[this,this.serviceLocator]}),this.enableResize&&e.push({member:"resize",args:[this]}),e},i.prototype.updateEnable=function(){this.enabled?((0,o.removeClass)([this.element],cn),this.element.setAttribute("aria-disabled","false"),(0,o.isNullOrUndefined)(this.htmlAttributes.tabindex)?this.inputElement.setAttribute("tabindex","0"):this.inputElement.setAttribute("tabindex",this.htmlAttributes.tabindex)):(this.getToolbar()&&((0,o.removeClass)(this.getToolbar().querySelectorAll("."+fi),fi),(0,o.removeClass)([this.getToolbar().parentElement],[gn])),(0,o.addClass)([this.element],cn),this.element.tabIndex=-1,this.element.setAttribute("aria-disabled","true"),this.inputElement.setAttribute("tabindex","-1"))},i.prototype.setEnable=function(){this.updateEnable(),this.enabled?this.eventInitializer():this.unWireEvents()},i.prototype.initializeValue=function(){this.isFocusOut=!1,this.isRTE=!1,this.isBlur=!0,this.defaultResetValue=null,this.isResizeInitialized=!1},i.prototype.preRender=function(){this.initializeValue(),this.clickPoints={clientX:0,clientY:0},this.initialValue=this.value,this.serviceLocator=new Dl,this.initializeServices(),this.setContainer(),this.persistData(),(0,o.setStyleAttribute)(this.element,{width:(0,o.formatUnit)(this.width)}),(0,o.attributes)(this.element,{role:"application","aria-label":"Rich Text Editor"}),this.beforeRenderClassValue=this.element.getAttribute("class")},i.prototype.persistData=function(){if(this.enablePersistence&&"TEXTAREA"===this.originalElement.tagName){this.element.id=this.originalElement.id+"_wrapper";var e=window.localStorage.getItem(this.getModuleName()+this.element.id);(0,o.isNullOrUndefined)(e)||""===e||this.setProperties(JSON.parse(e),!0)}},i.prototype.setContainer=function(){this.originalElement=this.element.cloneNode(!0),null!==this.value&&null===this.valueTemplate||this.setValue(),this.element.hasAttribute("tabindex")&&(this.htmlAttributes={tabindex:this.element.getAttribute("tabindex")},this.element.removeAttribute("tabindex")),this.element.innerHTML="";for(var e=["class","style","id","ejs-for"],t={},n=0;n<this.element.attributes.length;n++)-1!==e.indexOf(this.element.attributes[n].name)||/^data-val/.test(this.element.attributes[n].name)||(t[this.element.attributes[n].name]=this.element.getAttribute(this.element.attributes[n].name));if((0,o.extend)(t,this.htmlAttributes,t),this.setProperties({htmlAttributes:t},!0),(0,o.isNullOrUndefined)(this.htmlAttributes.id)||(this.element.id=this.htmlAttributes.id),this.internalID=this.element.id,"TEXTAREA"===this.element.tagName){var i=this.createElement("div",{className:this.element.getAttribute("class")});this.element.innerHTML="",this.element.parentElement.insertBefore(i,this.element),this.valueContainer=this.element,(0,o.removeClass)([this.valueContainer],this.element.getAttribute("class").split(" ")),this.element=i}else this.valueContainer=this.createElement("textarea",{id:this.getID()+"-value",attrs:{"aria-labelledby":this.getID()}});if(this.valueContainer.name=this.getID(),(0,o.addClass)([this.valueContainer],Wi),!(0,o.isNullOrUndefined)(this.cssClass))for(var r=this.cssClass.split(" "),s=0;s<r.length;s++)(0,o.addClass)([this.valueContainer],r[s]);this.rootContainer=this.createElement("div",{className:un,attrs:{role:"presentation"}}),this.element.appendChild(this.rootContainer),this.rootContainer.appendChild(this.valueContainer)},i.prototype.getPersistData=function(){return this.addOnPersist(["value"])},i.prototype.focusIn=function(){this.enabled&&(this.inputElement.focus(),this.focusHandler({}))},i.prototype.focusOut=function(){this.enabled&&(this.inputElement.blur(),this.blurHandler({}))},i.prototype.selectAll=function(){this.notify(Pe,{})},i.prototype.selectRange=function(e){this.notify(He,{range:e})},i.prototype.getSelection=function(){var e="";return this.notify(je,{callBack:function(t){e=t}}),e},i.prototype.showEmojiPicker=function(e,t){this.readonly||this.notify(Vt,{x:e,y:t})},i.prototype.executeCommand=function(e,t,n){if("importWord"===e){var i=this.createElement("div");i.innerHTML=t;for(var r=i.querySelectorAll("table:not(.e-rte-table):not(.e-rte-paste-table)"),s=0;s<r.length;s++)r[s].classList.add("e-rte-paste-table");t=i.innerHTML,i.remove(),e="insertHTML"}var a;if(t=this.htmlPurifier(e,t),"HTML"===this.editorMode){var l=this.getRange();this.iframeSettings.enable&&this.formatter.editorManager.nodeSelection.Clear(this.element.ownerDocument),(!(!this.iframeSettings.enable||l.startContainer!==this.inputElement)||!this.inputElement.contains(l.startContainer))&&this.focusIn()}var d=wl[""+e];if(n&&n.undo&&n.undo&&0===this.formatter.getUndoRedoStack().length&&this.formatter.saveData(),-1!==this.maxLength&&!(0,o.isNullOrUndefined)(d.command)){var c=0;if("Links"===d.command&&(c=0===t.text.length?t.url.length:t.text.length),"Images"!==d.command&&"Table"!==d.command&&"Files"!==d.command||(c=1),"InsertHTML"===d.command)if((0,o.isNullOrUndefined)(t))(0,o.isNullOrUndefined)(d.value)||"<hr/>"!==d.value&&"<br/>"!==d.value||(c=1);else{var h=this.createElement("div");h.innerHTML=t,c=h.textContent.length}"InsertText"===d.command&&(c=t.length);var u=this.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length-this.getSelection().length+c;if(!(-1===this.maxLength||u<=this.maxLength))return}a=t,"FormatPainter"===d.command&&((0,o.isNullOrUndefined)(t)||(this.formatPainterSettings=t),a={formatPainterAction:d.value}),this.formatter.editorManager.execCommand(d.command,d.subCommand?d.subCommand:a||d.value,null,null,a||d.value,a||("UL"===d.value||"OL"===d.value?null:d.value),null,this.enterKey),Hs(this.contentModule.getDocument(),this.inputElement),n&&n.undo&&(this.formatter.saveData(),this.formatter.enableUndo(this)),this.setPlaceHolder(),this.notify(p,{})},i.prototype.htmlPurifier=function(e,t){if("HTML"===this.editorMode)switch(e){case"insertHTML":this.enableHtmlSanitizer&&("string"==typeof t?(t=t.replace(/&(times|divide|ne)/g,"&amp;amp;$1"),t=this.htmlEditorModule.sanitizeHelper(t)):t=this.htmlEditorModule.sanitizeHelper(t.outerHTML));break;case"insertTable":(0,o.isNullOrUndefined)(t.width)&&(t.width={minWidth:this.tableSettings.minWidth,maxWidth:this.tableSettings.maxWidth,width:this.tableSettings.width});break;case"insertImage":var n=(s=this.createElement("img",{attrs:{src:t.url}})).outerHTML;this.enableHtmlSanitizer&&(n=this.htmlEditorModule.sanitizeHelper(s.outerHTML));var i=""!==n&&this.createElement("div",{innerHTML:n}).firstElementChild.getAttribute("src")||null;i=(0,o.isNullOrUndefined)(i)?"":i,t.url=i,(0,o.isNullOrUndefined)(t.width)&&(t.width={minWidth:this.insertImageSettings.minWidth,maxWidth:this.insertImageSettings.maxWidth,width:this.insertImageSettings.width}),(0,o.isNullOrUndefined)(t.height)&&(t.height={minHeight:this.insertImageSettings.minHeight,maxHeight:this.insertImageSettings.maxHeight,height:this.insertImageSettings.height});break;case"insertAudio":var r=this.createElement("audio",{attrs:{controls:""}}),s=this.createElement("source",{attrs:{src:t.url,type:t.url&&t.url.split(".").length>0?"audio/"+t.url.split(".")[t.url.split(".").length-1]:""}});r.appendChild(s);var a=r.outerHTML;this.enableHtmlSanitizer&&(a=this.htmlEditorModule.sanitizeHelper(r.outerHTML));i=""!==a&&this.createElement("div",{innerHTML:a}).firstElementChild.firstElementChild.getAttribute("src")||null;i=(0,o.isNullOrUndefined)(i)?"":i,t.url=i;break;case"insertVideo":r=this.createElement("video",{attrs:{controls:""}}),s=this.createElement("source",{attrs:{src:t.url,type:t.url&&t.url.split(".").length>0?"video/"+t.url.split(".")[t.url.split(".").length-1]:""}});r.appendChild(s);a=r.outerHTML;this.enableHtmlSanitizer&&(a=this.htmlEditorModule.sanitizeHelper(s.outerHTML));i=""!==a&&this.createElement("div",{innerHTML:a}).firstElementChild.getAttribute("src")||null;i=(0,o.isNullOrUndefined)(i)?"":i,t.url=i,(0,o.isNullOrUndefined)(t.width)&&(t.width={minWidth:this.insertVideoSettings.minWidth,maxWidth:this.insertVideoSettings.maxWidth,width:this.insertVideoSettings.width}),(0,o.isNullOrUndefined)(t.height)&&(t.height={minHeight:this.insertVideoSettings.minHeight,maxHeight:this.insertVideoSettings.maxHeight,height:this.insertVideoSettings.height});break;case"createLink":var l=this.createElement("a",{attrs:{href:t.url}}),d=l.outerHTML;this.enableHtmlSanitizer&&(d=this.htmlEditorModule.sanitizeHelper(l.outerHTML));var c=""!==d&&this.createElement("div",{innerHTML:d}).firstElementChild.getAttribute("href")||null;c=(0,o.isNullOrUndefined)(c)?"":c,t.url=c}return t},i.prototype.encode=function(e){var t=this.createElement("div");return t.innerText=e.trim(),t.innerHTML.replace(/<br\s*[\/]?>/gi,"\n")},i.prototype.render=function(){this.setProperties({value:this.replaceEntities(this.value)},!0),this.value&&!this.valueTemplate&&this.setProperties({value:this.serializeValue(this.value)},!0),this.value="Markdown"===this.editorMode||(0,o.isNullOrUndefined)(this.value)?this.value:this.addAnchorAriaLabel(this.value),this.renderModule=new zr(this,this.serviceLocator),this.sourceCodeModule=new Cl(this,this.serviceLocator),this.notify(d,{}),this.trigger(l),this.RTERender();new Al(this);"true"===this.element.dataset.rteUnitTesting?this.userAgentData=new Ga(o.Browser.userAgent,!0):this.userAgentData=new Ga(o.Browser.userAgent,!1),this.notify(u,{}),this.enableXhtml&&this.setProperties({value:this.getXhtml()},!0),this.toolbarSettings.enable&&("Expand"===this.toolbarSettings.type||"MultiRow"===this.toolbarSettings.type||"Scrollable"===this.toolbarSettings.type)&&!(0,o.isNullOrUndefined)(this.getToolbar())&&this.toolbarSettings.items.indexOf("Undo")>-1&&this.toolbarSettings.items.indexOf("Redo")>-1&&this.disableToolbarItem(["Undo","Redo"]),null!==this.value&&(this.valueContainer.defaultValue=this.value),this.enabled&&!this.readonly?this.eventInitializer():this.unWireEvents(),this.notify(qt,{cssClass:this.getCssClass()}),this.addAudioVideoWrapper(),this.notify(a,{}),this.autoResize(),this.renderComplete()},i.prototype.addAudioVideoWrapper=function(){for(var e,t=this,n=this.element.querySelectorAll("audio"),i=0;i<n.length;i++)if(n[i].classList.contains("e-rte-audio")||(n[i].classList.add("e-rte-audio"),n[i].classList.add(di)),!n[i].parentElement.classList.contains(ei)&&!n[i].parentElement.classList.contains(ni)){var r=this.createElement("span",{className:ni});(0,o.updateCSSText)(r,"width:300px; margin:0 auto;"),r.contentEditable="false";var s=this.createElement("span",{className:ei});r.appendChild(s),n[i].parentNode.insertBefore(r,n[i].nextSibling),s.appendChild(n[i]),null===r.nextElementSibling&&(e=this.createElement("br"),r.parentNode.insertBefore(e,r.nextSibling))}var a=this.element.querySelectorAll("video");for(i=0;i<a.length;i++){if(a[i].classList.contains("e-rte-video")||(a[i].classList.add("e-rte-video"),a[i].classList.add(ci)),!a[i].parentElement.classList.contains(ei)&&!a[i].parentElement.classList.contains(ii)){var l=this.createElement("span",{className:ii});l.contentEditable="false",a[i].parentNode.insertBefore(l,a[i].nextSibling),l.appendChild(a[i]),null===l.nextElementSibling&&(e=this.createElement("br"),l.parentNode.insertBefore(e,l.nextSibling))}-1!==o.Browser.userAgent.indexOf("Firefox")&&(a[i].addEventListener("play",(function(e){t.notify(De,{args:e}),t.notify("editAreaClick",{args:e})})),a[i].addEventListener("pause",(function(e){t.notify(De,{args:e}),t.notify("editAreaClick",{args:e})})))}},i.prototype.eventInitializer=function(){this.wireEvents()},i.prototype.cleanList=function(e){var t=this.getRange(),n=t.startContainer,i=t.endContainer,r=t.startOffset,s=n===i,a=(i.textContent.length,"#text"===t.endContainer.nodeName?t.endContainer.parentElement:t.endContainer),l=(0,o.closest)(a,"LI"),d=!1,c=t.endOffset;if(i.nodeType===Node.TEXT_NODE&&"\ufeff"===i.textContent.charAt(c-1)&&c--,!(0,o.isNullOrUndefined)(l)&&a.textContent.trim().length===c&&!t.collapsed&&(0,o.isNullOrUndefined)(a.nextElementSibling)&&!a.classList.contains(ho)){for(var h=0;h<l.childNodes.length;h++)"#text"===l.childNodes[h].nodeName&&0===l.childNodes[h].textContent.trim().length&&((0,o.detach)(l.childNodes[h]),d=!0,h--);for(var p=l;null!==p.lastChild&&"#text"!==p.nodeName;)p=p.lastChild;if(d){var u="BR"!==p.nodeName||(0,o.isNullOrUndefined)(p.previousSibling)?p:p.previousSibling;this.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),s?u:n,u,r,"BR"===u.nodeName?0:u.textContent.length)}}},i.prototype.keyDown=function(e){var t="macOS"===this.userAgentData.getPlatform();if(((e.ctrlKey||e.metaKey&&t)&&e.shiftKey&&86===e.keyCode||e.metaKey&&t&&e.altKey&&e.shiftKey&&86===e.keyCode)&&(this.isPlainPaste=!0),this.inputElement.classList.contains("e-mention")){var n=this.element.ownerDocument.getElementById(this.inputElement.id+"_popup"),i=this.element.ownerDocument.getElementById(this.inputElement.id+"_slash_menu_popup"),r=-1!==Is.indexOf(e.key),s=n&&n.classList.contains("e-popup-open"),a=i&&i.classList.contains("e-popup-open");if(r&&(s||a))return}if(this.enableTabKey){this.quickToolbarModule&&!e.altKey&&"F10"!==e.key&&"toolbar-focus"!==e.action&&this.quickToolbarModule.hideQuickToolbars();var l=!(!this.imageModule||!this.imageModule.imgResizeDiv),d=!(!this.videoModule||!this.videoModule.vidResizeDiv);l&&this.imageModule.cancelResizeAction(),d&&this.videoModule.cancelResizeAction()}if(this.notify(k,{member:"keydown",args:e}),this.restrict(e),"HTML"===this.editorMode&&this.cleanList(e),"HTML"===this.editorMode&&(8===e.which&&"Backspace"===e.code||46===e.which&&"Delete"===e.code)){var c="#text"===(C=this.getRange()).startContainer.nodeName?C.startContainer.parentElement:C.startContainer;if((0,o.closest)(c,"pre")&&8===e.which&&8203===C.startContainer.textContent.charCodeAt(C.startOffset-1)||46===e.which&&8203===C.startContainer.textContent.charCodeAt(C.startOffset)){var h=new RegExp("​","g"),p=8===e.which?C.startOffset-1:C.startOffset;C.startContainer.textContent=C.startContainer.textContent.replace(h,""),this.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),C.startContainer,p)}else if("Backspace"===e.code&&8===e.which&&8203===C.startContainer.textContent.charCodeAt(0)&&C.collapsed){var u=C.startContainer.parentElement,m=void 0,f=void 0;for(f=0;f<u.childNodes.length;f++)u.childNodes[f]===C.startContainer&&(m=f);var g=!0,b=[];for(f=m;f>=0;f--)3===u.childNodes[f].nodeType&&8203===u.childNodes[f].textContent.charCodeAt(0)&&g?b.push(f):g=!1;if(b.length>0)for(f=b.length-1;f>0;f--)u.childNodes[b[f]].textContent="";this.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),C.startContainer,C.startOffset)}}var v=!!(0,o.isNullOrUndefined)(e.action)||"format-copy"!==e.action;0===this.formatter.getUndoRedoStack().length&&v&&!(e.altKey||e.shiftKey&&16===e.which||e.altKey&&e.shiftKey&&67===e.which)&&this.formatter.saveData();var y=!1;if("HTML"===this.editorMode){var C=this.getRange();y=!(0,o.isNullOrUndefined)(C.startContainer)&&C.startContainer===C.endContainer&&C.endContainer.childNodes.length>1&&!(0,o.isNullOrUndefined)(C.startContainer.childNodes[C.startOffset-1])&&"#text"===C.startContainer.childNodes[C.startOffset-1].nodeName&&!(0,o.isNullOrUndefined)(C.startContainer.childNodes[C.startOffset-1].previousSibling)&&32===C.startContainer.childNodes[C.startOffset-1].textContent.charCodeAt(0)&&C.startContainer.childNodes[C.startOffset-1].previousSibling.classList.contains("e-mention-chip")}if(-1===["insert-link","format-copy","format-paste","insert-image","insert-table","insert-audio","insert-video"].indexOf(e.action)&&(!e.target||!e.target.classList.contains("e-mention")||(0,o.isNullOrUndefined)(document.querySelector("#"+e.target.id+"_popup.e-popup-open"))||"Tab"!==e.code)&&(e.action&&"paste"!==e.action&&"space"!==e.action||9===e.which||"Backspace"===e.code&&8===e.which)&&!y){var N=!1;switch((0,o.isNullOrUndefined)(this.formatPainterModule)||(N="escape"===this.formatPainterModule.previousAction),N||("HTML"!==this.editorMode||"increase-fontsize"!==e.action&&"decrease-fontsize"!==e.action?this.formatter.process(this,null,e):this.notify(rn,{member:"onHandleFontsizeChange",args:e})),e.action){case"toolbar-focus":if(this.toolbarSettings.enable&&this.getToolbarElement()){this.userAgentData.isSafari()&&"keydown"===e.type&&this.formatter.editorManager.nodeSelection&&this.formatter.editorManager.nodeSelection.get(this.contentModule.getDocument()).rangeCount>0&&this.inputElement.contains(this.getRange().startContainer)&&this.notify(Te,{});var E="toolbar",S=this.getToolbarElement().querySelector(".e-toolbar-item:not(.e-overlay)[title]"),T=this.getRenderedQuickToolbarElem();if(T&&(S=T.querySelector(".e-toolbar-item:not(.e-overlay)[title]"),E="quickToolbar"),S){var O=S.firstElementChild;O.removeAttribute("tabindex"),O.focus(),!this.userAgentData.isSafari()||"toolbar"!==E&&"quickToolbar"!==E||this.inputElement.ownerDocument.getSelection().removeAllRanges()}}break;case"escape":this.contentModule.getEditPanel().focus()}}if(this.notify(Gt,{member:"afterKeyDown",args:e}),this.autoResize(),(0,o.isNullOrUndefined)(this.placeholder)||this.setPlaceHolder(),!((0,o.isNullOrUndefined)(e)||(0,o.isNullOrUndefined)(e.code)||"Backspace"!==e.code&&"Delete"!==e.code)){C=this.contentModule.getDocument().getSelection().getRangeAt(0);var L=document.createElement("div");L.appendChild(C.cloneContents()),L.innerHTML===this.inputElement.innerHTML&&(this.isCopyAll=!0)}e.metaKey&&"Backspace"===e.key&&this.autoSaveOnIdle&&this.keyUp(e)},i.prototype.keyUp=function(e){if("HTML"===this.editorMode){var t=this.getRange();if(!((0,o.isNullOrUndefined)(e)||(0,o.isNullOrUndefined)(e.code)||"Backspace"!==e.code&&"Delete"!==e.code)){var n=this.getRange(),i=this.iframeSettings.enable?this.contentModule.getPanel().ownerDocument.getSelection():this.contentModule.getDocument().getSelection();if(this.isCopyAll){var r=this.createElement("br"),s="BR"===this.enterKey?r:this.createElement(this.enterKey).appendChild(r).parentElement;this.inputElement.innerHTML="",this.inputElement.appendChild(s),this.formatter.editorManager.nodeSelection.setCursorPoint(this.contentModule.getDocument(),r,0),this.isCopyAll=!1}i.rangeCount>0&&"INPUT"!==this.contentModule.getDocument().activeElement.tagName&&this.inputElement.contains(this.contentModule.getDocument().activeElement)&&"<br>"===t.startContainer.innerHTML&&""===t.startContainer.textContent&&(i.removeAllRanges(),i.addRange(n))}if(-1!==o.Browser.userAgent.indexOf("Firefox")&&"#text"===t.startContainer.nodeName&&t.startContainer.parentElement===this.inputElement&&"BR"!==this.enterKey){var a=this.getRange(),l=this.createElement(this.enterKey);a.startContainer.parentElement.insertBefore(l,a.startContainer),l.appendChild(a.startContainer),this.formatter.editorManager.nodeSelection.setSelectionText(this.contentModule.getDocument(),l.childNodes[0],l.childNodes[0],l.childNodes[0].textContent.length,l.childNodes[0].textContent.length)}}0===this.formatter.getCurrentStackIndex()&&this.updateUndoRedoStack(e),this.notify(L,{member:"keyup",args:e}),this.notify(O,{member:"tableModulekeyUp",args:e}),"KeyX"!==e.code||88!==e.which||88!==e.keyCode||!e.ctrlKey||""!==this.inputElement.innerHTML&&"<br>"!==this.inputElement.innerHTML||(this.inputElement.innerHTML=Pr(xr(Dr(this),this),this.editorMode));var d=this.inputElement.classList.contains("e-mention"),c=32===e.which||13===e.which||8===e.which||46===e.which||9===e.which&&d,h="C"===e.key&&e.altKey&&e.shiftKey,p="V"===e.key&&e.altKey&&e.shiftKey;(!h&&!p&&("shift"!==e.key&&!e.ctrlKey&&e.key&&1===e.key.length||c)||"Markdown"===this.editorMode&&("shift"!==e.key&&!e.ctrlKey&&e.key&&1===e.key.length||c)||this.autoSaveOnIdle&&o.Browser.isDevice&&!this.inlineMode.enable)&&this.formatter.onKeyHandler(this,e),(this.inputElement&&0!==this.inputElement.textContent.length||this.element.querySelectorAll(".e-toolbar-item.e-active").length>0||this.formatter.getUndoRedoStack().length>0)&&this.notify(b,{args:e}),this.setPlaceHolder()},i.prototype.serializeValue=function(e){return"HTML"!==this.editorMode||(0,o.isNullOrUndefined)(e)||(this.enableHtmlEncode?(e=this.htmlEditorModule.sanitizeHelper(Ar(e)),e=this.encode(e)):(e=this.htmlEditorModule.sanitizeHelper(e),e=this.enableXhtml?this.htmlEditorModule.xhtmlValidation.selfEncloseValidation(e):e)),e},i.prototype.sanitizeHtml=function(e){return this.serializeValue(e)},i.prototype.updateValue=function(e){if((0,o.isNullOrUndefined)(e)){var t=this.inputElement.innerHTML;this.setProperties({value:Mr(t)?null:t})}else this.setProperties({value:e})},i.prototype.triggerEditArea=function(e){if(fr()){var t=e.touches?e.changedTouches[0]:e;this.clickPoints.clientX===t.clientX&&this.clickPoints.clientY===t.clientY&&this.notify(Ae,{member:"editAreaClick",args:e})}else this.notify(Ae,{member:"editAreaClick",args:e})},i.prototype.notifyMouseUp=function(e){var t=e.touches?e.changedTouches[0]:e;this.notify(D,{member:"mouseUp",args:e,touchData:{prevClientX:this.clickPoints.clientX,prevClientY:this.clickPoints.clientY,clientX:t.clientX,clientY:t.clientY}}),(this.inputElement&&("HTML"===this.editorMode&&(0!==this.inputElement.textContent.length||e.target&&!(0,o.isNullOrUndefined)(e.target.querySelector("li")))||"Markdown"===this.editorMode&&0!==this.inputElement.value.length)||e.target&&!(0,o.isNullOrUndefined)((0,o.closest)(e.target,"table"))||e.target&&!(0,o.isNullOrUndefined)(e.target.querySelector("img"))||e.target&&("VIDEO"===e.target.nodeName||e.target.querySelectorAll("."+ii).length>0)||e.target&&"BR"!==e.target.nodeName&&(e.target.classList.contains(ni)||e.target.classList.contains(ei)||e.target.classList.contains(ti)))&&this.notify(b,{args:e}),this.triggerEditArea(e)},i.prototype.updateUndoRedoStack=function(e){var t=this.formatter.getUndoRedoStack(),n=this.formatter.getCurrentStackIndex(),i=-1!==["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].indexOf(e.key),o="keyup"!==e.type||i;if(0===t.length||0===n)if(0===t.length)this.formatter.saveData();else if(0===n&&"HTML"===this.editorMode&&o){var r=t[0],s=new sl(this.inputElement).save(this.getRange(),this.contentModule.getDocument());r.range=s}else if(0===n&&"Markdown"===this.editorMode&&o){var a=t[0],l=this.inputElement.selectionStart,d=this.inputElement.selectionEnd;a.start=l,a.end=d}},i.prototype.mouseUp=function(e){if(this.quickToolbarSettings.showOnRightClick&&o.Browser.isDevice){var t=e.target,n=(0,o.closest)(t,"table");if(t&&"A"===t.nodeName||"IMG"===t.nodeName||"TD"===t.nodeName||"TH"===t.nodeName||"TABLE"===t.nodeName||n&&this.contentModule.getEditPanel().contains(n))return}this.notifyMouseUp(e),this.setPlaceHolder(),this.autoResize(),this.updateUndoRedoStack(e)},i.prototype.ensureModuleInjected=function(e){return this.getInjectedModules().indexOf(e)>=0},i.prototype.onCopy=function(){this.contentModule.getDocument().execCommand("copy",!1,null)},i.prototype.onCut=function(){this.contentModule.getDocument().execCommand("cut",!1,null)},i.prototype.onPaste=function(e){var t=this,n={originalEvent:e,cancel:!1,requestType:"Paste"};this.isPlainPaste=e&&e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length&&1===e.clipboardData.items.length&&"text/plain"===e.clipboardData.items[0].type,this.trigger($,n,(function(n){var i=t.getText().replace(/\u200B/g,"").replace("HTML"===t.editorMode?/(\r\n|\n|\r|\t)/gm:"","").length-t.getSelection().length+((0,o.isNullOrUndefined)(e)||(0,o.isNullOrUndefined)(e.clipboardData)?0:e.clipboardData.getData("text/plain").replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length);if("Markdown"===t.editorMode){var r={requestType:"Paste",editorMode:t.editorMode,event:e};return setTimeout((function(){t.formatter.onSuccess(t,r)}),0),void(-1===t.maxLength||i<=t.maxLength||e.preventDefault())}if(!n.cancel&&"true"===t.inputElement.contentEditable&&(-1===t.maxLength||i<=t.maxLength)){var s=t.contentModule.getDocument().querySelector(".e-rte-img-dialog");if((0,o.isNullOrUndefined)(t.pasteCleanupModule)){if(!t.isPlainPaste){console.warn('[WARNING] :: Module "pasteCleanup" is not available in RichTextEditor component! You either misspelled the module name or forgot to load it.');var a={requestType:"Paste",editorMode:t.editorMode,event:e},l=null,d=!1;e&&!(0,o.isNullOrUndefined)(e.clipboardData)&&(l=e.clipboardData.getData("text/plain"),d=e.clipboardData.getData("text/html").indexOf("MsoNormal")>0);var c=e&&e.clipboardData&&e.clipboardData.items.length>0?e.clipboardData.items[0].getAsFile():null;null!==l&&t.notify(qe,{file:c,args:e,text:l,isWordPaste:d}),setTimeout((function(){t.formatter.onSuccess(t,a)}),0)}}else(0,o.isNullOrUndefined)(s)&&t.notify(Xe,{args:e,isPlainPaste:t.isPlainPaste})}else e.preventDefault()})),this.isPlainPaste=!1},i.prototype.clipboardAction=function(e,t){switch(e.toLowerCase()){case"cut":this.onCut(),this.formatter.onSuccess(this,{requestType:"Cut",editorMode:this.editorMode,event:t});break;case"copy":this.onCopy(),this.formatter.onSuccess(this,{requestType:"Copy",editorMode:this.editorMode,event:t});break;case"paste":this.onPaste(t)}},i.prototype.destroy=function(){if(!this.isDestroyed&&this.isRendered){if(this.element.className=this.beforeRenderClassValue,this.removeHtmlAttributes(),this.removeAttributes(),this.beforeRenderClassValue=null,(0,o.isNullOrUndefined)(this.timeInterval)||(clearInterval(this.timeInterval),this.timeInterval=null),(0,o.isNullOrUndefined)(this.autoSaveTimeOut)||(clearTimeout(this.autoSaveTimeOut),this.autoSaveTimeOut=null),(0,o.isNullOrUndefined)(this.idleInterval)||(clearTimeout(this.idleInterval),this.idleInterval=null),this.notify(f,{}),this.destroyDependentModules(),this.unWireEvents(),"TEXTAREA"===this.originalElement.tagName){this.element.parentElement.insertBefore(this.valueContainer,this.element),this.valueContainer.id=this.getID(),this.valueContainer.removeAttribute("name"),(0,o.detach)(this.element),""!==this.originalElement.innerHTML.trim()?(this.valueContainer.value=this.originalElement.innerHTML.trim(),this.setProperties({value:(0,o.isNullOrUndefined)(this.initialValue)?null:this.initialValue},!0)):this.valueContainer.value=this.valueContainer.defaultValue,this.element=this.valueContainer;for(var e=0;e<this.originalElement.classList.length;e++)(0,o.addClass)([this.element],this.originalElement.classList[e]);if(!(0,o.isNullOrUndefined)(this.cssClass)){var n=this.cssClass.split(" ");for(e=0;e<n.length;e++)(0,o.addClass)([this.element],n[e])}(0,o.removeClass)([this.element],Wi)}else""!==this.originalElement.innerHTML.trim()?(this.element.innerHTML=this.originalElement.innerHTML.trim(),this.setProperties({value:(0,o.isNullOrUndefined)(this.initialValue)?null:this.initialValue},!0)):this.element.innerHTML="";var i=document.querySelector(".e-dialog.e-rte-elements");if(i&&(0,o.detach)(i),this.placeholder&&this.placeHolderWrapper&&(this.placeHolderWrapper=null),!(0,o.isNullOrUndefined)(this.cssClass)){var r=this.cssClass.split(" ");for(e=0;e<r.length;e++)""!==r[e].trim()&&(0,o.removeClass)([this.element],r[e])}this.rootContainer&&(this.rootContainer=null),this.valueContainer&&(this.valueContainer=null),this.originalElement&&(this.originalElement=null),this.currentTarget=null,this.scrollParentElements=[],this.userAgentData=null,this.isRendered=!1,t.prototype.destroy.call(this)}},i.prototype.removeHtmlAttributes=function(){if(this.htmlAttributes)for(var e=Object.keys(this.htmlAttributes),t=0;t<e.length&&this.element.hasAttribute(e[t]);t++)this.element.removeAttribute(e[t])},i.prototype.removeAttributes=function(){this.enabled||(0,o.removeClass)([this.element],cn),this.enableRtl&&(0,o.removeClass)([this.element],ln),this.readonly&&(0,o.removeClass)([this.element],Ui),""!==this.element.style.width&&""===this.originalElement.style.width&&this.element.style.removeProperty("width"),""!==this.element.style.height&&""===this.originalElement.style.height&&this.element.style.removeProperty("height"),this.element.removeAttribute("aria-disabled"),this.element.removeAttribute("role"),this.element.removeAttribute("tabindex"),this.element.removeAttribute("aria-label")},i.prototype.destroyDependentModules=function(){this.renderModule.destroy(),this.formatter.editorManager.destroy()},i.prototype.getContent=function(){return this.contentModule.getPanel()},i.prototype.getText=function(){return this.contentModule.getText()},i.prototype.getSelectedHtml=function(){var e=this.createElement("div"),t=this.contentModule.getDocument().getSelection();if(t.rangeCount>0){var n=t.getRangeAt(0).cloneContents();e.appendChild(n)}return e.innerHTML},i.prototype.showInlineToolbar=function(){if(this.inlineMode.enable){var e=this.getRange(),t="#text"===e.endContainer.nodeName?e.endContainer.parentElement:e.endContainer,n=Array.from(e.getClientRects(),(function(e){return e}));if(0===n.length&&(n=[e.startContainer.getBoundingClientRect()]),n.length>0){var i=n[0].left,o=n[0].top;this.quickToolbarModule.showInlineQTBar(i,o,t)}}},i.prototype.hideInlineToolbar=function(){this.quickToolbarModule.hideInlineQTBar()},i.prototype.getModuleName=function(){return"richtexteditor"},i.prototype.onPropertyChanged=function(e,n){for(var i=0,r=Object.keys(e);i<r.length;i++){var s=r[i];switch(s){case"enterKey":case"value":var l=void 0;l="enterKey"===s?null===this.value||"<div><br></div>"===this.value||"<p><br></p>"===this.value||"<br>"===this.value?null:this.value:e[s],l="HTML"===this.editorMode?this.replaceEntities(l):l,l=this.serializeValue(l);var d="HTML"===this.editorMode?xr(l,this):l;(!(0,o.isNullOrUndefined)(l)&&""!==l||"enterKey"===s)&&this.setProperties({value:this.enableHtmlEncode?this.encode(Ar(d)):d},!0),this.updatePanelValue(),this.inputElement&&this.notify(a,{}),this.setPlaceHolder(),this.notify(Nt,{module:"XhtmlValidation",newProp:e,oldProp:n}),this.enableXhtml&&this.setProperties({value:this.getXhtml()},!0),this.showCharCount&&this.countModule.refresh(),this.addAudioVideoWrapper();break;case"valueTemplate":this.setValue(!0),this.showCharCount&&this.countModule.refresh();break;case"width":this.setWidth(e[s]),this.toolbarSettings.enable&&!this.inlineMode.enable&&(this.toolbarModule.refreshToolbarOverflow(),this.resizeHandler());break;case"height":this.setHeight(e[s]),this.autoResize();break;case"readonly":this.setReadOnly(!1);break;case"cssClass":this.element.classList.remove(n[s]),this.setCssClass(e[s]),this.notify(qt,{cssClass:e[s],oldCssClass:n[s]});break;case"enabled":this.setEnable();break;case"enableRtl":this.updateRTL();break;case"placeholder":this.placeholder=e[s],this.setPlaceHolder();break;case"htmlAttributes":dd(this.htmlAttributes,this,!1,!1);break;case"iframeSettings":var c=n[s];if(c.resources){var h=this.contentModule.getDocument().querySelector("head"),p=void 0;c.resources.scripts&&(p=h.querySelectorAll("."+hn),this.removeSheets(p)),c.resources.styles&&(p=h.querySelectorAll("."+pn),this.removeSheets(p))}this.setIframeSettings();break;case"locale":t.prototype.refresh.call(this);break;case"inlineMode":this.notify(T,{module:"quickToolbar",newProp:e,oldProp:n});break;case"toolbarSettings":this.notify(T,{module:"toolbar",newProp:e,oldProp:n});break;case"maxLength":this.showCharCount&&this.countModule.refresh();break;case"showCharCount":e[s]&&this.countModule?this.countModule.renderCount():!1===e[s]&&this.countModule&&this.countModule.destroy();break;case"enableHtmlEncode":this.updateValueData(),this.updatePanelValue(),this.setPlaceHolder(),this.showCharCount&&this.countModule.refresh();break;case"undoRedoSteps":case"undoRedoTimer":this.formatter.editorManager.observer.notify(Zs,{newProp:e,oldProp:n});break;case"enableXhtml":this.notify(Nt,{module:"XhtmlValidation",newProp:e,oldProp:n});break;case"quickToolbarSettings":e.quickToolbarSettings.showOnRightClick?this.wireContextEvent():this.unWireContextEvent(),this.notify(T,{newProp:e,oldProp:n});break;case"formatPainterSettings":this.formatter.editorManager.observer.notify(Zs,{module:"formatPainter",newProp:e});break;default:this.notify(T,{newProp:e,oldProp:n})}this.autoResize()}},i.prototype.updateValueData=function(){this.enableHtmlEncode?this.setProperties({value:this.encode(Ar(this.inputElement.innerHTML))},!0):this.setProperties({value:/<[a-z][\s\S]*>/i.test(this.inputElement.innerHTML)?this.inputElement.innerHTML:Ar(this.inputElement.innerHTML)})},i.prototype.removeSheets=function(e){var t;for(t=0;t<e.length;t++)(0,o.detach)(e[t])},i.prototype.replaceEntities=function(e){var t=this;if("HTML"!==this.editorMode||(0,o.isNullOrUndefined)(e)||!/&(amp;)*((times)|(divide)|(ne))/.test(e))return e;for(var n=this.enableHtmlEncode||this.enableHtmlSanitizer,i=["times","divide","ne"].map((function(e){var i=n?"&amp;amp;"+e:"&amp;"+e,o=!t.enableHtmlEncode&&t.enableHtmlSanitizer?"&("+e+")":"&(amp;)*("+e+")";return[i,new RegExp(o,"g")]})),r=0,s=i;r<s.length;r++){var a=s[r],l=a[0],d=a[1];d.test(e)&&(e=e.replace(d,l))}return e},i.prototype.updatePanelValue=function(){this.setProperties({value:this.replaceEntities(this.value)},!0);var e="HTML"===this.editorMode?this.listOrderCorrection(this.value):this.value;e=this.enableHtmlEncode&&this.value?Ar(e):e;var t=this.element.querySelector("."+So);e?(!(0,o.isNullOrUndefined)(t)&&this.rootContainer.classList.contains("e-source-code-enabled")&&(t.value=this.value),this.valueContainer&&(this.valueContainer.value=this.enableHtmlEncode?this.value:e),"HTML"===this.editorMode&&this.inputElement&&this.inputElement.innerHTML.trim()!==e.trim()?this.inputElement.innerHTML=Pr(e,this.editorMode):"Markdown"===this.editorMode&&this.inputElement&&this.inputElement.value.trim()!==e.trim()&&(this.inputElement.value=e)):(!(0,o.isNullOrUndefined)(t)&&this.rootContainer.classList.contains("e-source-code-enabled")&&(t.value=""),"HTML"===this.editorMode?"DIV"===this.enterKey?this.inputElement.innerHTML="<div><br/></div>":"BR"===this.enterKey?this.inputElement.innerHTML="<br/>":this.inputElement.innerHTML="<p><br/></p>":this.inputElement.value="",this.valueContainer&&(this.valueContainer.value="")),this.showCharCount&&this.countModule.refresh()},i.prototype.listOrderCorrection=function(e){var t=this.createElement("div");t.innerHTML=e;for(var n=t.querySelectorAll("UL, OL"),i=0;i<n.length;i++)(0,o.isNullOrUndefined)(n[i])||(0,o.isNullOrUndefined)(n[i].parentElement)||(0,o.isNullOrUndefined)(n[i].previousElementSibling)||"UL"!==n[i].parentElement.nodeName&&"OL"!==n[i].parentElement.nodeName||n[i].previousElementSibling.appendChild(n[i]);return t.innerHTML},i.prototype.setHeight=function(e){this.element.style.height="auto"!==e?(0,o.formatUnit)(e):"auto","Expand"===this.toolbarSettings.type&&("string"==typeof this.height&&this.height.indexOf("px")>-1||"number"==typeof this.height)?this.element.classList.add(Co):this.element.classList.remove(Co)},i.prototype.setPlaceHolder=function(){this.inputElement&&this.placeholder&&!0!==this.iframeSettings.enable&&("Markdown"!==this.editorMode?(this.placeHolderWrapper&&this.inputElement.parentElement.contains(this.placeHolderWrapper)||(this.placeHolderWrapper=this.createElement("span",{className:"rte-placeholder e-rte-placeholder "+this.getCssClass()}),this.fontSize.default&&(this.placeHolderWrapper.style.fontSize=this.fontSize.default),this.inputElement&&this.inputElement.parentElement.insertBefore(this.placeHolderWrapper,this.inputElement)),this.placeHolderWrapper.innerHTML=this.placeholder,0===this.inputElement.textContent.length&&this.inputElement.childNodes.length<2&&!(0,o.isNullOrUndefined)(this.inputElement.firstChild)&&("BR"===this.inputElement.firstChild.nodeName||("P"===this.inputElement.firstChild.nodeName||"DIV"===this.inputElement.firstChild.nodeName)&&!(0,o.isNullOrUndefined)(this.inputElement.firstChild.firstChild)&&this.inputElement.firstChild.childNodes.length<2&&"BR"===this.inputElement.firstChild.firstChild.nodeName)?(this.placeHolderWrapper.classList.add("enabled"),o.EventHandler.add(this.inputElement,"input",this.setPlaceHolder,this)):(this.placeHolderWrapper.classList.remove("enabled"),o.EventHandler.remove(this.inputElement,"input",this.setPlaceHolder))):this.inputElement.setAttribute("placeholder",this.placeholder)),this.placeholder&&this.iframeSettings.enable&&this.inputElement&&(!(0===this.inputElement.textContent.length&&this.inputElement.childNodes.length<2)||(0,o.isNullOrUndefined)(this.inputElement.firstChild)||"BR"!==this.inputElement.firstChild.nodeName&&("P"!==this.inputElement.firstChild.nodeName&&"DIV"!==this.inputElement.firstChild.nodeName||(0,o.isNullOrUndefined)(this.inputElement.firstChild.firstChild)||"BR"!==this.inputElement.firstChild.firstChild.nodeName)?((0,o.removeClass)([this.inputElement],"e-rte-placeholder"),o.EventHandler.remove(this.inputElement,"input",this.setPlaceHolder)):((0,o.addClass)([this.inputElement],"e-rte-placeholder"),this.inputElement.setAttribute("placeholder",this.placeholder),o.EventHandler.add(this.inputElement,"input",this.setPlaceHolder,this)))},i.prototype.setWidth=function(e){"auto"!==e?(0,o.setStyleAttribute)(this.element,{width:(0,o.formatUnit)(this.width)}):this.element.style.width="auto"},i.prototype.setCssClass=function(e){if(!(0,o.isNullOrUndefined)(e))for(var t=e.split(" "),n=0;n<t.length;n++)""!==t[n].trim()&&this.element.classList.add(t[n])},i.prototype.updateRTL=function(){this.notify(_e,{enableRtl:this.enableRtl}),this.enableRtl?(this.element.classList.add(ln),this.inputElement.classList.add(ln)):(this.element.classList.remove(ln),this.inputElement.classList.remove(ln))},i.prototype.updateReadOnly=function(){this.notify(Ge,{editPanel:this.inputElement,mode:this.readonly})},i.prototype.setReadOnly=function(e){this.updateReadOnly(),e||(this.readonly&&this.enabled?(this.unbindEvents(),this.unWireEvents()):this.enabled&&this.wireEvents())},i.prototype.print=function(){var e,t=this,n={element:this.inputElement,requestType:"print",cancel:!1};this.trigger($,n,(function(n){if(e=window.open("","print","height="+window.outerHeight+",width="+window.outerWidth),"msie"===o.Browser.info.name&&e.resizeTo(screen.availWidth,screen.availHeight),e=(0,o.print)(t.inputElement,e),!n.cancel){t.trigger(Z,{requestType:"print"})}}))},i.prototype.refreshUI=function(){this.renderModule.refresh(),"Markdown"===this.editorMode&&this.autoResize()},i.prototype.showFullScreen=function(){this.fullScreenModule.showFullScreen()},i.prototype.enableToolbarItem=function(e,t){this.toolbarModule.enableTBarItems(this.getBaseToolbarObject(),e,!0,t)},i.prototype.disableToolbarItem=function(e,t){this.toolbarModule.enableTBarItems(this.getBaseToolbarObject(),e,!1,t)},i.prototype.removeToolbarItem=function(e){this.toolbarModule.removeTBarItems(e)},i.prototype.getRange=function(){return this.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument())},i.prototype.initializeServices=function(){this.serviceLocator.register("rendererFactory",new Ml),this.serviceLocator.register("rteLocale",this.localeObj=new o.L10n(this.getModuleName(),ir,this.locale)),this.serviceLocator.register("dialogRenderObject",new El(this))},i.prototype.RTERender=function(){var t=this.serviceLocator.getService("rendererFactory");this.contentModule=t.getRenderer(e.Content),this.fullScreenModule=new cd(this),this.enterKeyModule=new hd(this),this.renderModule.render(),this.inputElement=this.contentModule.getEditPanel(),this.setHeight(this.height),dd(this.htmlAttributes,this,!1,!0),this.iframeSettings&&this.setIframeSettings(),this.setCssClass(this.cssClass),this.updateEnable(),this.setPlaceHolder(),this.updateRTL(),this.updateReadOnly(),this.updatePanelValue(),this.enableHtmlEncode&&!(0,o.isNullOrUndefined)(this.value)&&this.setProperties({value:this.encode(Ar(this.value))})},i.prototype.setIframeSettings=function(){if(this.iframeSettings.resources){var e=this.iframeSettings.resources.styles,t=this.iframeSettings.resources.scripts;!(0,o.isNullOrUndefined)(this.iframeSettings.resources.scripts)&&this.iframeSettings.resources.scripts.length>0&&this.InjectSheet(!0,t),!(0,o.isNullOrUndefined)(this.iframeSettings.resources.styles)&&this.iframeSettings.resources.styles.length>0&&this.InjectSheet(!1,e)}this.iframeSettings.attributes&&dd(this.iframeSettings.attributes,this,!0,!1)},i.prototype.InjectSheet=function(e,t){try{if(t&&t.length>0)for(var n=this.contentModule.getDocument().querySelector("head"),i=0;i<t.length;i++)if(e){var o=this.createScriptElement();o.src=t[i],n.appendChild(o)}else{var r=this.createStyleElement();r.href=t[i],n.appendChild(r)}}catch(e){return}},i.prototype.createScriptElement=function(){var e=this.createElement("script",{className:hn});return e.type="text/javascript",e},i.prototype.createStyleElement=function(){var e=this.createElement("link",{className:pn});return e.rel="stylesheet",e},i.prototype.setValue=function(e){var t=this;if(this.valueTemplate){var n=new RegExp(/<(?=.*? .*?\/ ?>|br|hr|input|!--|wbr)[a-z]+.*?>|<([a-z]+).*?<\/\1>/i);if("string"==typeof this.valueTemplate&&n.test(this.valueTemplate))this.setProperties({value:this.valueTemplate});else{var i=(0,o.compile)(this.valueTemplate)("",this,"valueTemplate");if("string"!=typeof this.valueTemplate&&this.isReact){this.displayTempElem=this.createElement("div");for(var r=0;r<i.length;r++){var s=i[r];(0,o.append)([s],this.displayTempElem)}this.renderTemplates((function(){t.inputElement.innerHTML=Pr(t.displayTempElem.childNodes[0].innerHTML,t.editorMode),t.setProperties({value:t.inputElement.innerHTML.trim()})}))}else{var a=this.element;e&&(this.inputElement.innerHTML="",a=this.inputElement);for(r=0;r<i.length;r++){s=i[r];(0,o.append)([s],a)}var l=a.innerHTML.trim();l.length>0&&this.setProperties({value:l}),this.renderReactTemplates()}}}else{var d=!(0,o.isNullOrUndefined)(this.element.innerHTML)&&this.element.innerHTML.replace(/<(\/?|\!?)(!--!--)>/g,"").trim();""!==d&&("TEXTAREA"===this.element.tagName?this.setProperties({value:Ar(d)}):this.setProperties({value:d}))}},i.prototype.renderTemplates=function(e){this.renderReactTemplates(e)},i.prototype.updateResizeFlag=function(){this.isResizeInitialized=!0},i.prototype.getInsertImgMaxWidth=function(){var e=this.insertImageSettings.maxWidth,t=this.contentModule.getEditPanel();if("HTML"===this.editorMode&&!(0,o.isNullOrUndefined)(this.formatter.editorManager.nodeSelection)&&!(0,o.isNullOrUndefined)(this.formatter.editorManager.nodeSelection.range)){var n=this.formatter.editorManager.nodeSelection.range;3!==n.startContainer.nodeType&&n.startContainer.closest&&!(0,o.isNullOrUndefined)(n.startContainer.closest("TD"))&&(t=n.startContainer)}var i=window.getComputedStyle(t),r=t.offsetWidth-(14+parseFloat(i.paddingLeft.split("px")[0])+parseFloat(i.paddingRight.split("px")[0])+parseFloat(i.marginLeft.split("px")[0])+parseFloat(i.marginRight.split("px")[0]));return(0,o.isNullOrUndefined)(e)?r:e},i.prototype.getInsertVidMaxWidth=function(){var e=this.insertVideoSettings.maxWidth,t=this.contentModule.getEditPanel(),n=window.getComputedStyle(t),i=t.offsetWidth-(14+parseFloat(n.paddingLeft.split("px")[0])+parseFloat(n.paddingRight.split("px")[0])+parseFloat(n.marginLeft.split("px")[0])+parseFloat(n.marginRight.split("px")[0]));return(0,o.isNullOrUndefined)(e)?i:e},i.prototype.getHtml=function(){var e=Hr(this.contentModule.getEditPanel().innerHTML,this.editorMode);return!this.enableXhtml||"<p><br></p>"!==e&&"<div><br></div>"!==e&&"<br>"!==e?this.serializeValue(e):null},i.prototype.getXhtml=function(){var e=Hr(this.value,this.editorMode);return!(0,o.isNullOrUndefined)(e)&&this.enableXhtml&&(e=this.htmlEditorModule.xhtmlValidation.selfEncloseValidation(e)),e},i.prototype.showSourceCode=function(){this.readonly||this.notify(Ce,{})},i.prototype.getCharCount=function(){var e="Markdown"===this.editorMode?this.inputElement.value.trim():this.inputElement.textContent.trim();return"Markdown"!==this.editorMode&&-1!==e.indexOf("​")?e.replace(/\u200B/g,"").length:e.length},i.prototype.showDialog=function(e){e===n.InsertLink?this.notify(Mt,{}):e===n.InsertImage?this.notify(Bt,{}):e===n.InsertAudio?this.notify(Rt,{}):e===n.InsertVideo?this.notify(It,{}):e===n.InsertTable&&this.notify(jt,{})},i.prototype.closeDialog=function(e){e===n.InsertLink?this.notify(At,{}):e===n.InsertImage?this.notify(Ut,{}):e===n.InsertAudio?this.notify(Pt,{}):e===n.InsertVideo?this.notify(Ht,{}):e===n.InsertTable&&this.notify(Ft,{})},i.prototype.getBaseToolbarObject=function(){return!this.inlineMode.enable||o.Browser.isDevice&&!fr()?this.toolbarModule&&this.toolbarModule.getBaseToolbar():this.quickToolbarModule&&this.quickToolbarModule.getInlineBaseToolbar()},i.prototype.getToolbar=function(){return this.toolbarModule?this.toolbarModule.getToolbarElement():null},i.prototype.getToolbarElement=function(){return this.toolbarModule&&this.toolbarModule.getToolbarElement()},i.prototype.getID=function(){return this.internalID},i.prototype.getCssClass=function(e){return(0,o.isNullOrUndefined)(this.cssClass)?"":e?" "+this.cssClass:this.cssClass},i.prototype.mouseDownHandler=function(e){var t=e.touches?e.changedTouches[0]:e;(0,o.addClass)([this.element],[Kn]),this.preventDefaultResize(e),this.notify(De,{args:e}),this.formatter.editorManager.observer.notify(De,{args:e}),this.clickPoints={clientX:t.clientX,clientY:t.clientY}},i.prototype.preventImgResize=function(e){"img"===e.target.nodeName.toLocaleLowerCase()&&e.preventDefault()},i.prototype.preventDefaultResize=function(e){"msie"===o.Browser.info.name?this.contentModule.getEditPanel().addEventListener("mscontrolselect",this.preventImgResize):"mozilla"===o.Browser.info.name&&(this.contentModule.getDocument().execCommand("enableObjectResizing",!1,"false"),this.contentModule.getDocument().execCommand("enableInlineTableEditing",!1,"false"))},i.prototype.defaultResize=function(e){"msie"===o.Browser.info.name?this.contentModule.getEditPanel().removeEventListener("mscontrolselect",this.preventImgResize):"mozilla"===o.Browser.info.name&&(this.contentModule.getDocument().execCommand("enableObjectResizing",!0,"true"),this.contentModule.getDocument().execCommand("enableInlineTableEditing",!0,"true"))},i.prototype.resizeHandler=function(){if(!document.body.contains(this.element))return document.defaultView.removeEventListener("resize",this.resizeHandler,!0),void(this.onResizeHandler=null);this.toolbarSettings.enable&&!this.inlineMode.enable&&this.toolbarModule.refreshToolbarOverflow(),this.notify(z,null),this.autoResize()},i.prototype.scrollHandler=function(e){this.element&&this.notify(Be,{args:e})},i.prototype.contentScrollHandler=function(e){this.notify(Re,{args:e})},i.prototype.focusHandler=function(e){if(!this.isRTE||this.isFocusOut){this.isRTE=!this.isFocusOut,this.isFocusOut=!1,(0,o.addClass)([this.element],[Kn]),"HTML"===this.editorMode?this.cloneValue="<p><br></p>"===this.inputElement.innerHTML||"<div><br></div>"===this.inputElement.innerHTML||"<br>"===this.inputElement.innerHTML?null:this.enableHtmlEncode?this.encode(Ar(this.inputElement.innerHTML)):this.inputElement.innerHTML:this.cloneValue=""===this.inputElement.value?null:this.inputElement.value;var t=document.activeElement;if((t===this.element||t===this.getToolbarElement()||t===this.contentModule.getEditPanel()||this.iframeSettings.enable&&t===this.contentModule.getPanel()&&e.target&&!e.target.classList.contains("e-img-inner")&&e.target&&e.target.parentElement&&!e.target.parentElement.classList.contains("e-img-wrap")||(0,o.closest)(t,".e-rte-toolbar")===this.getToolbarElement())&&(this.contentModule.getEditPanel().focus(),!(0,o.isNullOrUndefined)(this.getToolbarElement()))){this.getToolbarElement().setAttribute("tabindex","-1");for(var n=this.getToolbarElement().querySelectorAll('[tabindex="0"]'),i=0;i<n.length;i++)n[i].setAttribute("tabindex","-1")}this.preventDefaultResize(e),this.trigger("focus",{event:e,isInteracted:0!==Object.keys(e).length}),!(0,o.isNullOrUndefined)(this.saveInterval)&&this.saveInterval>0&&!this.autoSaveOnIdle&&(0,o.isNullOrUndefined)(this.timeInterval)&&(this.timeInterval=setInterval(this.updateValueOnIdle.bind(this),this.saveInterval)),o.EventHandler.add(document,"mousedown",this.onDocumentClick,this)}if(!this.readonly){var r=this.getCurrentFocus(e);"editArea"!==r&&"textArea"!==r&&"sourceCode"!==r||this.resetToolbarTabIndex()}},i.prototype.getUpdatedValue=function(){var e,t=this.element.querySelector("."+So);return"HTML"===this.editorMode?(e="<p><br></p>"===this.inputElement.innerHTML||"<div><br></div>"===this.inputElement.innerHTML||"<br>"===this.inputElement.innerHTML?null:this.enableHtmlEncode?this.encode(Ar(Hr(this.inputElement.innerHTML,this.editorMode))):this.inputElement.innerHTML,this.enableHtmlSanitizer&&!(0,o.isNullOrUndefined)(e)&&/&(amp;)*((times)|(divide)|(ne))/.test(e)&&(e=e.replace(/&(amp;)*(times|divide|ne)/g,"&amp;amp;$2")),!(0,o.isNullOrUndefined)(t)&&this.rootContainer.classList.contains("e-source-code-enabled")&&(e=/&(amp;)*((times)|(divide)|(ne))/.test(t.value)?t.value.replace(/&(amp;)*(times|divide|ne)/g,"&amp;amp;$2"):t.value)):e=""===this.inputElement.value?null:this.inputElement.value,null==e||this.enableHtmlEncode||(e=Hr(e,this.editorMode)),e},i.prototype.updateValueOnIdle=function(){((0,o.isNullOrUndefined)(this.tableModule)||(0,o.isNullOrUndefined)(this.inputElement.querySelector(".e-table-box.e-rbox-select")))&&(this.setProperties({value:this.getUpdatedValue()},!0),this.valueContainer.value=this.value,this.isValueChangeBlurhandler=!1,this.invokeChangeEvent())},i.prototype.updateIntervalValue=function(){clearTimeout(this.idleInterval),this.idleInterval=setTimeout(this.updateValueOnIdle.bind(this),0)},i.prototype.cleanupResizeElements=function(e){var t=Hr(e.value,this.editorMode);e.callBack(t)},i.prototype.addAnchorAriaLabel=function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.querySelectorAll("a");if(n.length>0)for(var i=0;i<n.length;i++)n[i].hasAttribute("target")&&"_blank"===n[i].getAttribute("target")&&n[i].setAttribute("aria-label",this.serviceLocator.getService("rteLocale").getConstant("linkAriaLabel"));return t.innerHTML},i.prototype.updateStatus=function(e){if(!(0,o.isNullOrUndefined)(e.html)||!(0,o.isNullOrUndefined)(e.markdown)){var t=this.formatter.editorManager.undoRedoManager.getUndoStatus(),n={undo:t.undo,redo:t.redo,html:e.html,markdown:e.markdown};this.trigger(ee,n)}},i.prototype.onDocumentClick=function(e){var t=e.target,n=(0,o.closest)(t,"."+an);this.element.contains(e.target)||document===e.target||n===this.element||(0,o.closest)(t,'[aria-owns="'+this.getID()+'"]')||(this.isBlur=!0,this.isRTE=!1),this.notify(We,{args:e});var i=this.quickToolbarModule&&!this.inlineMode.enable&&(0,o.isNullOrUndefined)(this.quickToolbarModule.inlineQTBar);(i&&!(0,o.isNullOrUndefined)((0,o.closest)(t,".e-toolbar-wrapper"))||i&&(!(0,o.isNullOrUndefined)((0,o.closest)(t,".e-rte-table-resize"))||!(0,o.isNullOrUndefined)((0,o.closest)(t,".e-table-box"))))&&this.quickToolbarModule.hideQuickToolbars(),"msie"!==o.Browser.info.name&&e.detail>3&&e.preventDefault()},i.prototype.blurHandler=function(e){var t=e.relatedTarget;if(t){var n=(0,o.closest)(t,"."+an);if(!n&&this.iframeSettings.enable){var i=this.element.querySelector("#"+this.getID()+"_rte-view");i&&i.contentWindow.document.body.contains(t)&&(n=(0,o.closest)(i,"."+an))}n&&n===this.element?(this.isBlur=!1,t===this.getToolbarElement()&&t.setAttribute("tabindex","-1")):(0,o.closest)(t,'[aria-owns="'+this.getID()+'"]')||(0,o.closest)(t,"."+bi)?this.isBlur=!1:(this.isBlur=!0,t=null)}if(this.isBlur&&(0,o.isNullOrUndefined)(t)){(0,o.removeClass)([this.element],[Kn]),jr(this.inputElement),this.notify(Ue,{});var r=this.getUpdatedValue();this.rootContainer.classList.contains("e-source-code-enabled")?this.setProperties({value:r}):this.setProperties({value:r},!0),this.valueContainer.value=this.value,this.isValueChangeBlurhandler=!0,this.invokeChangeEvent(),this.isFocusOut=!0,this.isBlur=!1,Tr(this.valueContainer,"focusout"),this.defaultResize(e),this.trigger("blur",{event:e,isInteracted:0!==Object.keys(e).length}),(0,o.isNullOrUndefined)(this.timeInterval)||(clearInterval(this.timeInterval),this.timeInterval=null),!(0,o.isNullOrUndefined)(this.placeHolderWrapper)&&this.element.querySelector("[title = Preview]")&&(this.placeHolderWrapper.style.display="none"),o.EventHandler.remove(document,"mousedown",this.onDocumentClick)}else this.isRTE=!0;this.readonly||"outside"!==this.getCurrentFocus(e)||this.resetToolbarTabIndex()},i.prototype.contentChanged=function(e){var t=this.inputElement.querySelector(".tempSpan");t&&(0,o.detach)(t),e&&!(0,o.isNullOrUndefined)(e.detail)&&e.detail.click&&this.formatter.saveData(),this.autoSaveOnIdle&&((0,o.isNullOrUndefined)(this.saveInterval)||(clearTimeout(this.autoSaveTimeOut),this.autoSaveTimeOut=setTimeout(this.updateIntervalValue.bind(this),this.saveInterval)))},i.prototype.invokeChangeEvent=function(){var e={value:this.enableXhtml?this.getXhtml():this.value,isInteracted:this.isValueChangeBlurhandler};this.value!==Hr(this.cloneValue,this.editorMode)&&(this.trigger("change",e),this.cloneValue=this.value)},i.prototype.wireScrollElementsEvents=function(){this.scrollParentElements=(0,Wr.getScrollableParent)(this.element);for(var e=0,t=this.scrollParentElements;e<t.length;e++){var n=t[e];o.EventHandler.add(n,"scroll",this.scrollHandler,this)}this.iframeSettings.enable||o.EventHandler.add(this.inputElement,"scroll",this.contentScrollHandler,this)},i.prototype.wireContextEvent=function(){this.quickToolbarSettings.showOnRightClick&&(o.EventHandler.add(this.inputElement,"contextmenu",this.contextHandler,this),o.Browser.isDevice&&(this.touchModule=new o.Touch(this.inputElement,{tapHold:this.touchHandler.bind(this),tapHoldThreshold:500})))},i.prototype.unWireContextEvent=function(){o.EventHandler.remove(this.inputElement,"contextmenu",this.contextHandler),o.Browser.isDevice&&this.touchModule&&this.touchModule.destroy()},i.prototype.unWireScrollElementsEvents=function(){this.scrollParentElements=(0,Wr.getScrollableParent)(this.element);for(var e=0,t=this.scrollParentElements;e<t.length;e++){var n=t[e];o.EventHandler.remove(n,"scroll",this.scrollHandler)}this.iframeSettings.enable||o.EventHandler.remove(this.inputElement,"scroll",this.contentScrollHandler)},i.prototype.touchHandler=function(e){this.notifyMouseUp(e.originalEvent),this.triggerEditArea(e.originalEvent)},i.prototype.contextHandler=function(e){var t=(0,o.closest)(e.target,"a, table, img, video, audio, .e-embed-video-wrap");!t&&e.target&&e.target.classList&&(e.target.classList.contains(ni)||e.target.classList.contains(ei))&&(t=e.target.querySelector("audio")),!1!==this.inlineMode.onSelection&&((0,o.isNullOrUndefined)(t)||!this.inputElement.contains(t)||"IMG"!==t.tagName&&"TABLE"!==t.tagName&&"A"!==t.tagName&&"video"!==t.tagName.toLowerCase()&&"audio"!==t.tagName.toLowerCase()&&"SPAN"!==t.tagName)||e.preventDefault()},i.prototype.resetHandler=function(){var e=this.valueContainer.defaultValue.trim();this.setProperties({value:""===e?null:e})},i.prototype.autoResize=function(){if(this.element&&this.originalElement&&this.valueContainer)if("auto"===this.height){if("Markdown"===this.editorMode)this.setAutoHeight(this.inputElement);else if(this.iframeSettings.enable){var e=this.element.querySelector("#"+this.getID()+"_rte-view");e&&this.setAutoHeight(e)}}else if("Markdown"===this.editorMode){var t=this.inputElement,n=this.enableResize||this.showCharCount?20:0;t&&(t.style.height=this.element.clientHeight-(this.toolbarModule.getToolbarHeight()+n+3)+"px")}else if(this.iframeSettings.enable){var i=this.element.querySelector("#"+this.getID()+"_rte-view");n=this.enableResize||this.showCharCount?20:0;i&&this.toolbarModule&&(i.style.height=this.element.clientHeight-(this.toolbarModule.getToolbarHeight()+n+3)+"px")}},i.prototype.setAutoHeight=function(e){"TEXTAREA"===e.nodeName?(e.style.height="auto",e.style.height=this.inputElement.scrollHeight+16+"px",e.style.overflow="hidden"):"IFRAME"===e.nodeName&&(e.style.height=this.inputElement.parentElement.offsetHeight+"px")},i.prototype.wireEvents=function(){this.onBlurHandler=this.blurHandler.bind(this),this.onFocusHandler=this.focusHandler.bind(this),this.onResizeHandler=this.resizeHandler.bind(this),this.element.addEventListener("focusin",this.onFocusHandler,!0),this.element.addEventListener("focusout",this.onBlurHandler,!0),this.on(p,this.contentChanged,this),this.on(Tt,this.updateResizeFlag,this),this.on(Dt,this.updateStatus,this),this.on(Kt,this.cleanupResizeElements,this),this.on(Xt,this.updateValueOnIdle,this),this.on(Zt,this.autoResize,this),this.iframeSettings.enable&&(this.onLoadHandler=this.iframeEditableElemLoad.bind(this),this.contentModule.getEditPanel().addEventListener("load",this.onLoadHandler,!0)),this.readonly&&this.enabled||this.bindEvents()},i.prototype.restrict=function(e){if(this.maxLength>=0){var t="Markdown"===this.editorMode?this.contentModule.getText():this.getText().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"");if(!t)return;for(var n=[8,16,17,37,38,39,40,46,65],i=void 0,o=0;o<=n.length-1;o++)if(e.which===n[o]){if(e.ctrlKey&&65===e.which)return;if(65!==e.which)return void(i=n[o])}t.length>=this.maxLength&&-1!==this.maxLength&&e.which!==i&&e.preventDefault()}},i.prototype.beforeInputHandler=function(e){if(this.maxLength>=0){var t="Markdown"===this.editorMode?this.contentModule.getText():this.getText().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"");e.data&&t.length>=this.maxLength&&!this.isSpecialInputType(e)&&e.preventDefault()}},i.prototype.isSpecialInputType=function(e){return e.inputType?-1!==e.inputType.indexOf("delete")||-1!==e.inputType.indexOf("backward")||"insertLineBreak"===e.inputType:-1!==[8,16,17,37,38,39,40,46,65].indexOf(e.which)},i.prototype.bindEvents=function(){this.keyboardModule=new yl(this.inputElement,{keyAction:this.keyDown.bind(this),keyConfigs:vd({},this.formatter.keyConfig,this.keyConfig),eventName:"keydown"}),this.userAgentData&&"Android"===this.userAgentData.getPlatform()&&o.EventHandler.add(this.inputElement,"beforeinput",this.beforeInputHandler,this);var e=(0,o.closest)(this.valueContainer,"form");e&&o.EventHandler.add(e,"reset",this.resetHandler,this),o.EventHandler.add(this.inputElement,"keyup",this.keyUp,this),o.EventHandler.add(this.inputElement,"paste",this.onPaste,this),o.EventHandler.add(this.inputElement,"content-changed",this.contentChanged,this),this.mouseDownDebListener=(0,o.debounce)(this.mouseUp,30),o.EventHandler.add(this.inputElement,o.Browser.touchEndEvent,this.mouseDownDebListener,this),o.EventHandler.add(this.inputElement,o.Browser.touchStartEvent,this.mouseDownHandler,this),o.EventHandler.add(this.inputElement,"input",this.inputHandler,this),this.wireContextEvent(),this.formatter.editorManager.observer.on(Gs,this.editorKeyDown,this),this.element.ownerDocument.defaultView.addEventListener("resize",this.onResizeHandler,!0),this.iframeSettings.enable&&(o.EventHandler.add(this.inputElement,"focusin",this.focusHandler,this),o.EventHandler.add(this.inputElement,"focusout",this.blurHandler,this),o.EventHandler.add(this.inputElement.ownerDocument,"scroll",this.contentScrollHandler,this),o.EventHandler.add(this.inputElement.ownerDocument,o.Browser.touchStartEvent,this.onIframeMouseDown,this),o.EventHandler.add(this.contentModule.getPanel(),"load",this.iframeLoadHandler,this)),this.wireScrollElementsEvents()},i.prototype.onIframeMouseDown=function(e){this.isBlur=!1,this.currentTarget=e.target,this.notify(m,e)},i.prototype.inputHandler=function(){this.autoResize()},i.prototype.editorKeyDown=function(e){switch(e.event.action){case"copy":this.onCopy();break;case"cut":this.onCut();break;case"tab":this.iframeSettings.enable&&(this.isBlur=!0)}!e.callBack||"copy"!==e.event.action&&"cut"!==e.event.action&&"delete"!==e.event.action||e.callBack({requestType:e.event.action,editorMode:"HTML",event:e.event})},i.prototype.unWireEvents=function(){this.element.removeEventListener("focusin",this.onFocusHandler,!0),this.onFocusHandler=null,this.element.removeEventListener("focusout",this.onBlurHandler,!0),this.onBlurHandler=null,this.off(p,this.contentChanged),this.off(Tt,this.updateResizeFlag),this.off(Dt,this.updateStatus),this.off(Kt,this.cleanupResizeElements),this.off(Xt,this.updateValueOnIdle),this.off(Zt,this.autoResize),this.iframeSettings.enable&&(this.contentModule.getEditPanel().removeEventListener("load",this.onLoadHandler,!0),this.onLoadHandler=null),this.readonly&&this.enabled||this.unbindEvents()},i.prototype.unbindEvents=function(){this.keyboardModule&&!this.keyboardModule.isDestroyed&&(this.keyboardModule.destroy(),this.keyboardModule=null);var e=(0,o.closest)(this.valueContainer,"form");e&&o.EventHandler.remove(e,"reset",this.resetHandler),o.EventHandler.remove(this.inputElement,"keyup",this.keyUp),o.EventHandler.remove(this.inputElement,"paste",this.onPaste),o.EventHandler.remove(this.inputElement,"content-changed",this.contentChanged),o.EventHandler.remove(this.inputElement,o.Browser.touchEndEvent,this.mouseDownDebListener),this.mouseDownDebListener=null,o.EventHandler.remove(this.inputElement,o.Browser.touchStartEvent,this.mouseDownHandler),o.EventHandler.remove(this.inputElement,"input",this.inputHandler),o.EventHandler.remove(document,"mousedown",this.onDocumentClick),this.unWireContextEvent(),this.formatter&&this.formatter.editorManager.observer.off(Gs,this.editorKeyDown),this.element.ownerDocument.defaultView.removeEventListener("resize",this.onResizeHandler,!0),this.onResizeHandler=null,this.iframeSettings.enable&&(o.EventHandler.remove(this.inputElement,"focusin",this.focusHandler),o.EventHandler.remove(this.inputElement,"focusout",this.blurHandler),o.EventHandler.remove(this.inputElement.ownerDocument,"scroll",this.contentScrollHandler),o.EventHandler.remove(this.inputElement.ownerDocument,o.Browser.touchStartEvent,this.onIframeMouseDown),o.EventHandler.remove(this.contentModule.getPanel(),"load",this.iframeLoadHandler)),this.userAgentData&&"Android"===this.userAgentData.getPlatform()&&o.EventHandler.remove(this.inputElement,"beforeinput",this.beforeInputHandler),this.unWireScrollElementsEvents()},i.prototype.getCurrentFocus=function(e){return e.target===this.inputElement&&document.activeElement===this.inputElement?"editArea":e.target===this.getToolbarElement()||!(0,o.isNullOrUndefined)(e.relatedTarget)&&(0,o.closest)(e.relatedTarget,".e-rte-toolbar")===this.getToolbarElement()?"toolbar":e.target===this.valueContainer&&document.activeElement===this.valueContainer?"textArea":!(0,o.isNullOrUndefined)(e.target)&&e.target.classList.contains(So)&&document.activeElement===e.target?"sourceCode":"outside"},i.prototype.resetToolbarTabIndex=function(){if(this.getToolbarElement())for(var e=this.getToolbarElement().querySelectorAll("input,select,button,a,[tabindex]"),t=0;t<e.length;t++)e[t].classList.contains("e-rte-dropdown-btn")||e[t].classList.contains("e-insert-table-btn")||e[t].hasAttribute("tabindex")&&"-1"===e[t].getAttribute("tabindex")||e[t].setAttribute("tabindex","-1")},i.prototype.getRenderedQuickToolbarElem=function(){if(!(0,o.isNullOrUndefined)(this.quickToolbarModule))for(var e=this.quickToolbarModule.getQuickToolbarInstance(),t=0;t<e.length;t++)if(e[t]&&e[t].isRendered)return e[t].element;return null},i.prototype.iframeLoadHandler=function(){this.autoResize()},i.prototype.iframeEditableElemLoad=function(){this.autoResize()},yd([(0,o.Complex)({},Ul)],i.prototype,"toolbarSettings",void 0),yd([(0,o.Complex)({enable:!1,items:["Paragraph","Heading 1","Heading 2","Heading 3","Heading 4","OrderedList","UnorderedList","CodeBlock","Blockquote"],popupWidth:"300px",popupHeight:"320px"},md)],i.prototype,"slashMenuSettings",void 0),yd([(0,o.Complex)({},Wl)],i.prototype,"quickToolbarSettings",void 0),yd([(0,o.Complex)({},Gl)],i.prototype,"pasteCleanupSettings",void 0),yd([(0,o.Complex)({},Ql)],i.prototype,"formatPainterSettings",void 0),yd([(0,o.Complex)({},Kl)],i.prototype,"emojiPickerSettings",void 0),yd([(0,o.Complex)({},rd)],i.prototype,"iframeSettings",void 0),yd([(0,o.Complex)({},Fl)],i.prototype,"insertImageSettings",void 0),yd([(0,o.Complex)({},Pl)],i.prototype,"importWord",void 0),yd([(0,o.Complex)({},Hl)],i.prototype,"exportWord",void 0),yd([(0,o.Complex)({},jl)],i.prototype,"exportPdf",void 0),yd([(0,o.Complex)({},ql)],i.prototype,"insertAudioSettings",void 0),yd([(0,o.Complex)({},zl)],i.prototype,"insertVideoSettings",void 0),yd([(0,o.Complex)({},Vl)],i.prototype,"tableSettings",void 0),yd([(0,o.Property)(0)],i.prototype,"floatingToolbarOffset",void 0),yd([(0,o.Complex)({},ld)],i.prototype,"inlineMode",void 0),yd([(0,o.Complex)({},_l)],i.prototype,"fileManagerSettings",void 0),yd([(0,o.Property)("100%")],i.prototype,"width",void 0),yd([(0,o.Property)(!1)],i.prototype,"enablePersistence",void 0),yd([(0,o.Property)(!0)],i.prototype,"showTooltip",void 0),yd([(0,o.Property)(!1)],i.prototype,"enableResize",void 0),yd([(0,o.Property)({})],i.prototype,"htmlAttributes",void 0),yd([(0,o.Property)(null)],i.prototype,"placeholder",void 0),yd([(0,o.Property)(!1)],i.prototype,"autoSaveOnIdle",void 0),yd([(0,o.Property)(!1)],i.prototype,"readonly",void 0),yd([(0,o.Property)(!0)],i.prototype,"enabled",void 0),yd([(0,o.Property)(!0)],i.prototype,"enableHtmlSanitizer",void 0),yd([(0,o.Property)(!1)],i.prototype,"enableHtmlEncode",void 0),yd([(0,o.Property)(!1)],i.prototype,"enableXhtml",void 0),yd([(0,o.Property)("auto")],i.prototype,"height",void 0),yd([(0,o.Property)(null)],i.prototype,"cssClass",void 0),yd([(0,o.Property)(null)],i.prototype,"value",void 0),yd([(0,o.Property)("P")],i.prototype,"enterKey",void 0),yd([(0,o.Property)("BR")],i.prototype,"shiftEnterKey",void 0),yd([(0,o.Property)(30)],i.prototype,"undoRedoSteps",void 0),yd([(0,o.Property)(300)],i.prototype,"undoRedoTimer",void 0),yd([(0,o.Property)("HTML")],i.prototype,"editorMode",void 0),yd([(0,o.Property)(null)],i.prototype,"keyConfig",void 0),yd([(0,o.Property)(!1)],i.prototype,"showCharCount",void 0),yd([(0,o.Property)(!1)],i.prototype,"enableTabKey",void 0),yd([(0,o.Property)(!1)],i.prototype,"enableAutoUrl",void 0),yd([(0,o.Property)(-1)],i.prototype,"maxLength",void 0),yd([(0,o.Complex)({},Jl)],i.prototype,"format",void 0),yd([(0,o.Complex)({},ed)],i.prototype,"numberFormatList",void 0),yd([(0,o.Complex)({},td)],i.prototype,"bulletFormatList",void 0),yd([(0,o.Complex)({},Xl)],i.prototype,"fontFamily",void 0),yd([(0,o.Complex)({},Yl)],i.prototype,"fontSize",void 0),yd([(0,o.Complex)({},$l)],i.prototype,"fontColor",void 0),yd([(0,o.Complex)({},Zl)],i.prototype,"backgroundColor",void 0),yd([(0,o.Property)(null)],i.prototype,"valueTemplate",void 0),yd([(0,o.Property)(1e4)],i.prototype,"saveInterval",void 0),yd([(0,o.Event)()],i.prototype,"actionBegin",void 0),yd([(0,o.Event)()],i.prototype,"actionComplete",void 0),yd([(0,o.Event)()],i.prototype,"beforeDialogOpen",void 0),yd([(0,o.Event)()],i.prototype,"dialogOpen",void 0),yd([(0,o.Event)()],i.prototype,"beforeDialogClose",void 0),yd([(0,o.Event)()],i.prototype,"dialogClose",void 0),yd([(0,o.Event)()],i.prototype,"beforeQuickToolbarOpen",void 0),yd([(0,o.Event)()],i.prototype,"quickToolbarOpen",void 0),yd([(0,o.Event)()],i.prototype,"quickToolbarClose",void 0),yd([(0,o.Event)()],i.prototype,"toolbarStatusUpdate",void 0),yd([(0,o.Event)()],i.prototype,"updatedToolbarStatus",void 0),yd([(0,o.Event)()],i.prototype,"imageSelected",void 0),yd([(0,o.Event)()],i.prototype,"beforeImageUpload",void 0),yd([(0,o.Event)()],i.prototype,"imageUploading",void 0),yd([(0,o.Event)()],i.prototype,"imageUploadSuccess",void 0),yd([(0,o.Event)()],i.prototype,"imageUploadFailed",void 0),yd([(0,o.Event)()],i.prototype,"imageRemoving",void 0),yd([(0,o.Event)()],i.prototype,"afterImageDelete",void 0),yd([(0,o.Event)()],i.prototype,"fileSelected",void 0),yd([(0,o.Event)()],i.prototype,"beforeFileUpload",void 0),yd([(0,o.Event)()],i.prototype,"fileUploading",void 0),yd([(0,o.Event)()],i.prototype,"fileUploadSuccess",void 0),yd([(0,o.Event)()],i.prototype,"fileUploadFailed",void 0),yd([(0,o.Event)()],i.prototype,"fileRemoving",void 0),yd([(0,o.Event)()],i.prototype,"afterMediaDelete",void 0),yd([(0,o.Event)()],i.prototype,"created",void 0),yd([(0,o.Event)()],i.prototype,"destroyed",void 0),yd([(0,o.Event)()],i.prototype,"beforeSanitizeHtml",void 0),yd([(0,o.Event)()],i.prototype,"blur",void 0),yd([(0,o.Event)()],i.prototype,"toolbarClick",void 0),yd([(0,o.Event)()],i.prototype,"focus",void 0),yd([(0,o.Event)()],i.prototype,"change",void 0),yd([(0,o.Event)()],i.prototype,"resizing",void 0),yd([(0,o.Event)()],i.prototype,"resizeStart",void 0),yd([(0,o.Event)()],i.prototype,"resizeStop",void 0),yd([(0,o.Event)()],i.prototype,"beforePasteCleanup",void 0),yd([(0,o.Event)()],i.prototype,"afterPasteCleanup",void 0),yd([(0,o.Event)()],i.prototype,"beforeImageDrop",void 0),yd([(0,o.Property)(null)],i.prototype,"formatter",void 0),yd([(0,o.Event)()],i.prototype,"slashMenuItemSelect",void 0),i=yd([o.NotifyPropertyChanges],i)}(o.Component),Nd=function(){function e(e,t){this.parent=e,this.currentDocument=this.parent.element.ownerDocument,this.L10n=t.getService("rteLocale"),this.savedSelection=new sl(this.parent.inputElement),this.defaultItems=fd,this.injectibleItems=gd,this.parent.on(T,this.onPropertyChanged,this),this.parent.on(f,this.removeEventListener,this),this.parent.on(u,this.render,this)}return e.prototype.removeEventListener=function(){this.parent.off(T,this.onPropertyChanged),this.parent.off(f,this.removeEventListener)},e.prototype.onPropertyChanged=function(e){for(var t=0,n=Object.keys(e.newProp);t<n.length;t++){if("slashMenuSettings"===n[t])switch(Object.keys(e.newProp.slashMenuSettings)[0]){case"enable":e.newProp.slashMenuSettings.enable?this.render():this.removeEventListener();break;case"items":this.mention.dataSource=this.getItems();break;case"popupHeight":this.mention.popupHeight=e.newProp.slashMenuSettings.popupHeight;break;case"popupWidth":this.mention.popupWidth=e.newProp.slashMenuSettings.popupWidth}}},e.prototype.getModuleName=function(){return"slashMenu"},e.prototype.destroy=function(){this.mention&&!this.mention.isDestroyed&&(this.mention.destroy(),this.defaultItems=[],this.injectibleItems=[])},e.prototype.generateMentionModel=function(){var e=this;return{dataSource:this.getItems(),cssClass:"e-slash-menu"+this.parent.getCssClass(),fields:{text:"text",groupBy:"type",iconCss:"iconCss",value:"description"},mentionChar:"/",target:this.parent.inputElement,popupHeight:this.parent.slashMenuSettings.popupHeight,popupWidth:this.parent.slashMenuSettings.popupWidth,allowSpaces:!0,itemTemplate:'${if(iconCss && description)}<div class="e-rte-slash-menu-item-content" style="display: grid; grid-template-columns: auto 1fr; gap: 10px; align-items: center;"><div class="e-slash-menu-icon"style="padding: 15px 15px 15px 15px;"><div class="${iconCss}"></div></div> <div style="display: flex; flex-direction: column;"><span class="e-rte-slash-menu-item-text" style="font-weight: 500;">${text}</span>${if(description)}<span class="e-rte-slash-menu-item-description">${description}</span>${/if}</div></div>${else}${if(iconCss && text)}<div class="e-rte-slash-menu-item-content" style="display: flex; flex-direction: row; align-items: center; height: 25px; font-weight: 500;"><div class="e-slash-menu-icon"style="margin-left: 15px; width: 30px"><div class="${iconCss}"></div></div> <span class="e-rte-slash-menu-item-icon-text">${text}</span></div>${/if}${/if}',beforeOpen:function(){e.parent.notify(v,{}),e.savedSelection=e.savedSelection.save(e.savedSelection.getRange(e.currentDocument),e.currentDocument)},filtering:function(){e.savedSelection=e.savedSelection.save(e.savedSelection.getRange(e.currentDocument),e.currentDocument)},select:this.handleSelect.bind(this)}},e.prototype.handleSelect=function(e){var t=this;e.cancel=!0,this.parent.focusIn(),this.savedSelection.restore();var i=e.itemData,o={isInteracted:e.isInteracted,item:e.item,itemData:e.itemData,originalEvent:e.e,cancel:!1};e.itemData.isCustomItem&&this.parent.formatter.beforeSlashMenuApply(),this.parent.trigger("slashMenuItemSelect",o,(function(e){if(!e.cancel)if(e.itemData.isCustomItem){if(t.parent.inputElement.classList.contains("e-mention")){var r=t.parent.inputElement.ownerDocument.getElementById(t.parent.inputElement.id+"_slash_menu_popup");r&&r.classList.contains("e-popup-open")&&t.mention.hidePopup()}}else{t.parent.formatter.beforeSlashMenuApply();var s=i;switch(s.command){case"OrderedList":t.parent.executeCommand("insertOrderedList");break;case"UnorderedList":t.parent.executeCommand("insertUnorderedList");break;case"Audio":case"Video":case"Image":case"Table":case"Link":t.mention.hidePopup(),setTimeout((function(){s.subCommand===n.InsertLink?t.parent.notify(Mt,{}):s.subCommand===n.InsertImage?t.parent.notify(Bt,o):s.subCommand===n.InsertAudio?t.parent.notify(Rt,o):s.subCommand===n.InsertVideo?t.parent.notify(It,o):s.subCommand===n.InsertTable&&t.parent.notify(jt,{})}),100);break;case"Emojipicker":t.mention.hidePopup(),setTimeout((function(){t.parent.showEmojiPicker()}),100);break;default:t.parent.executeCommand("formatBlock",s.subCommand)}t.parent.notify(b,{})}}))},e.prototype.getItems=function(){for(var e=this.parent.slashMenuSettings.items,t=[],n=function(n){if("string"==typeof e[n]){var r=e[n],s=i.defaultItems.filter((function(e){return e.command===r}))[0];(0,o.isNullOrUndefined)(s)&&(s=i.injectibleItems.filter((function(e){return e.module.toLowerCase().replace(" ","")===r.toLowerCase().replace(" ","")}))[0]);var a=dr.get(r);t.push({text:i.L10n.getConstant(a.text),command:s.command,subCommand:s.subCommand,type:s.type,module:s.module,iconCss:s.iconCss,description:i.L10n.getConstant(a.description)})}else t.push({text:e[n].text,command:e[n].command,type:e[n].type,iconCss:e[n].iconCss,description:e[n].description,isCustomItem:!0})},i=this,r=0;r<e.length;r++)n(r);return t},e.prototype.render=function(){if("HTML"===this.parent.editorMode&&this.parent.slashMenuSettings.enable){var e=this.generateMentionModel();this.mention=new xl.Mention(e),this.mention.appendTo(this.parent.rootContainer.appendChild(this.parent.createElement("div",{className:"e-rte-slash-menu",id:this.parent.getID()+"_slash_menu"})))}},e}(),Ed=function(){function t(t,n){this.tools={},this.parent=t,this.locator=n,this.isDestroyed=!1,this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.parent.toolbarSettings&&Object.keys(this.parent.toolbarSettings.itemConfigs).length>0?(0,o.extend)(this.tools,Lo,kr(this.parent.toolbarSettings.itemConfigs),!0):this.tools=Lo,(this.parent.toolbarSettings.enable||this.parent.quickToolbarSettings.enable)&&(this.toolbarRenderer=new cl(this.parent,this.locator),this.renderFactory.addRenderer(e.Toolbar,this.toolbarRenderer))}return t.prototype.addEventListener=function(){this.parent.on(_e,this.setRtl,this),this.parent.on(qt,this.setCssClass,this)},t.prototype.removeEventListener=function(){this.parent.off(_e,this.setRtl),this.parent.off(qt,this.setCssClass)},t.prototype.setCssClass=function(e){(0,o.isNullOrUndefined)(this.toolbarObj)||((0,o.isNullOrUndefined)(e.oldCssClass)?this.toolbarObj.setProperties({cssClass:(this.toolbarObj.cssClass+" "+e.cssClass).trim()}):this.toolbarObj.setProperties({cssClass:(this.toolbarObj.cssClass.replace(e.oldCssClass,"").trim()+" "+e.cssClass).trim()}))},t.prototype.setRtl=function(e){(0,o.isNullOrUndefined)(this.toolbarObj)||this.toolbarObj.setProperties({enableRtl:e.enableRtl})},t.prototype.getClass=function(e){var t;switch(e){case"fontsize":t="e-rte-inline-size-template";break;case"fontcolor":case"backgroundcolor":t="e-rte-inline-color-template";break;default:t="e-rte-inline-template"}return t},t.prototype.getTemplateObject=function(e,t){var n;switch(e){case"fontcolor":case"backgroundcolor":case"numberformatlist":case"bulletformatlist":n="span";break;default:n="button"}return{command:this.tools[e.toLocaleLowerCase()].command,subCommand:this.tools[e.toLocaleLowerCase()].subCommand,template:this.parent.createElement(n,{id:this.parent.getID()+"_"+t+"_"+this.tools[e.toLocaleLowerCase()].id}).outerHTML,cssClass:this.parent.inlineMode.enable?this.getClass(e):"",tooltipText:vr(e,this.locator)}},t.prototype.getObject=function(e,t){var n=e.toLowerCase();if(-1!==Oo.indexOf(n))return this.getTemplateObject(n,t);switch(n){case"|":return{type:"Separator"};case"-":return{type:"Separator",cssClass:yi};default:return{id:this.parent.getID()+"_"+t+"_"+this.tools[n.toLocaleLowerCase()].id,prefixIcon:this.tools[n.toLocaleLowerCase()].icon,tooltipText:vr(n,this.locator),command:this.tools[n.toLocaleLowerCase()].command,subCommand:this.tools[n.toLocaleLowerCase()].subCommand}}},t.prototype.getItems=function(e,t){var n=this;if(this.parent.toolbarSettings.items.length<1)return[];for(var i=[],r=function(e){if("string"==typeof e)i.push(s.getObject(e,t));else{if(!(0,o.isNullOrUndefined)(e.click)){var r=e,a=r.click;r.click=function(){if(r.undo&&0===n.parent.formatter.getUndoRedoStack().length&&n.parent.formatter.saveData(),a.call(n),n.parent.formatter.getUndoRedoStack().length>0){var e=n.parent.createElement("div"),t=n.parent.formatter.getUndoRedoStack()[n.parent.formatter.getUndoRedoStack().length-1].text.cloneNode(!0);if(e.appendChild(t),e.innerHTML.trim()===n.parent.inputElement.innerHTML.trim())return}r.undo&&n.parent.formatter.saveData()}}i.push(e)}},s=this,a=0,l=e;a<l.length;a++){r(l[a])}if(this.parent.showTooltip)for(var d=function(e){var t=i[e].tooltipText,n=void 0,r="macOS"===c.parent.userAgentData.getPlatform();!tr[""+i[e].subCommand]||(0,o.isNullOrUndefined)(i[e].id)&&(0,o.isNullOrUndefined)(i[e].cssClass)?n=t:n=tr[""+i[e].subCommand].split(",").map((function(e){return r?e.replace("Ctrl+","⌘").replace("Shift+","⇧").replace("Alt+","⌥"):e})).join(", ");n&&("Images"===i[e].command&&"InsertLink"===i[e].subCommand||(i[e].tooltipText=t!==n?t+" ("+n+")":t))},c=this,h=0;h<i.length;h++)d(h);return i},t.prototype.getToolbarOptions=function(e){return{target:e.target,rteToolbarObj:this,items:this.getItems(e.items,e.container),overflowMode:e.mode,enablePersistence:this.parent.enablePersistence,enableRtl:this.parent.enableRtl,cssClass:e.cssClass,type:e.container}},t.prototype.render=function(t){this.toolbarRenderer=this.renderFactory.getRenderer(e.Toolbar),this.toolbarRenderer&&this.toolbarRenderer.isDestroyed&&(this.toolbarRenderer=new cl(this.parent,this.locator)),this.toolbarRenderer.renderToolbar(this.getToolbarOptions(t))},t.prototype.destroy=function(){this.isDestroyed||(this.removeEventListener(),this.toolbarObj&&!this.toolbarObj.isDestroyed&&(this.toolbarObj.destroy(),this.toolbarObj=null),this.toolbarRenderer.destroy(),this.toolbarRenderer=null,this.tools={},this.isDestroyed=!0)},t}(),Sd=function(){function t(e,t){this.parent=e,this.locator=t,this.i10n=t.getService("rteLocale"),this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener()}return t.prototype.initializeInstance=function(){this.toolbarRenderer=this.renderFactory.getRenderer(e.Toolbar)},t.prototype.beforeRender=function(e){var t=e.item;t.cssClass&&(0,o.addClass)([e.element],t.cssClass)},t.prototype.dropdownContent=function(e,t,n){return'<span style="display: inline-flex;width:'+("quick"===t?"auto":e)+'" ><span class="e-rte-dropdown-btn-text">'+n+"</span></span>"},t.prototype.renderDropDowns=function(e,t){var n=this;this.initializeInstance();var i=e.containerType,r=e.container;Oo.forEach((function(s){var a=void 0;if(-1!==pr(s,e.items))switch(s){case"numberformatlist":if(a=(0,o.select)("#"+n.parent.getID()+"_"+i+"_NumberFormatList",r),(0,o.isNullOrUndefined)(a)||a.classList.contains(Rn))return;var l=n.parent.numberFormatList.types.slice();l.forEach((function(e){Object.defineProperties(e,{command:{value:"Lists",enumerable:!0},subCommand:{value:"NumberFormatList",enumerable:!0}})})),n.numberFormatListDropDown=n.toolbarRenderer.renderListDropDown({cssClass:"e-order-list "+bi+" "+mi,itemName:"NumberFormatList",items:l,element:a});break;case"bulletformatlist":if(a=(0,o.select)("#"+n.parent.getID()+"_"+i+"_BulletFormatList",r),(0,o.isNullOrUndefined)(a)||a.classList.contains(Rn))return;var d=n.parent.bulletFormatList.types.slice();d.forEach((function(e){Object.defineProperties(e,{command:{value:"Lists",enumerable:!0},subCommand:{value:"BulletFormatList",enumerable:!0}})})),n.bulletFormatListDropDown=n.toolbarRenderer.renderListDropDown({cssClass:"e-unorder-list "+bi+" "+mi,itemName:"BulletFormatList",items:d,element:a});break;case"formats":if(a=(0,o.select)("#"+n.parent.getID()+"_"+i+"_Formats",r),(0,o.isNullOrUndefined)(a)||a.classList.contains(Rn))return;var c=n.parent.format.types.slice();c.forEach((function(e){Object.defineProperties(e,{command:{value:"Formats",enumerable:!0},subCommand:{value:e.value,enumerable:!0}})}));var h=(0,o.isNullOrUndefined)(n.parent.format.default)?c[0].text:n.parent.format.default;n.formatDropDown=n.toolbarRenderer.renderDropDownButton({iconCss:"quick"===i?"e-formats e-icons":"",content:n.dropdownContent(n.parent.format.width,i,"quick"===i?"":mr(c,h,"text","text")),cssClass:Mn+" "+Bn+" "+Ti,itemName:"Formats",items:c,element:a});break;case"fontname":if(a=(0,o.select)("#"+n.parent.getID()+"_"+i+"_FontName",r),(0,o.isNullOrUndefined)(a)||a.classList.contains(Rn))return;var p=n.parent.fontFamily.items.slice();p.forEach((function(e){Object.defineProperties(e,{command:{value:"Font",enumerable:!0},subCommand:{value:"FontName",enumerable:!0}})}));var u=(0,o.isNullOrUndefined)(n.parent.fontFamily.default)?0===p.length?"":p[0].text:n.parent.fontFamily.default;n.fontNameDropDown=n.toolbarRenderer.renderDropDownButton({iconCss:"quick"===i?"e-font-name e-icons":"",content:n.dropdownContent(n.parent.fontFamily.width,i,0===p.length?n.i10n.getConstant("fontName"):"quick"===i?"":"Default"===mr(p,u,"text","text")?n.i10n.getConstant("fontName"):mr(p,u,"text","text")),cssClass:Mn+" "+Bn+" "+Oi,itemName:"FontName",items:p,element:a});break;case"fontsize":if(a=(0,o.select)("#"+n.parent.getID()+"_"+i+"_FontSize",r),(0,o.isNullOrUndefined)(a)||a.classList.contains(Rn))return;var m=!(0,o.isNullOrUndefined)(n.fontSizeDropDown)&&!(0,o.isNullOrUndefined)(n.fontSizeDropDown.items)&&n.fontSizeDropDown.items.length>0?n.fontSizeDropDown.items:JSON.parse(JSON.stringify(n.parent.fontSize.items.slice()));m.forEach((function(e){Object.defineProperties(e,{command:{value:"Font",enumerable:!0},subCommand:{value:"FontSize",enumerable:!0}})}));var f=(0,o.isNullOrUndefined)(n.parent.fontSize.default)?0===m.length?"":m[0].text:n.parent.fontSize.default,g=mr(m,f.replace(/\s/g,""),"Default"===f?"text":"value","text");n.fontSizeDropDown=n.toolbarRenderer.renderDropDownButton({content:n.dropdownContent(n.parent.fontSize.width,i,0===m.length?n.i10n.getConstant("fontSize"):gr("Default"===g?n.i10n.getConstant("fontSize"):g)),cssClass:Mn+" "+Bn+" "+Li,itemName:"FontSize",items:m,element:a});break;case"alignments":if(a=(0,o.select)("#"+n.parent.getID()+"_"+i+"_Alignments",r),(0,o.isNullOrUndefined)(a)||a.classList.contains(Rn))return;n.alignDropDown=n.toolbarRenderer.renderDropDownButton({iconCss:"e-justify-left e-icons",cssClass:Mn+" "+Bn+" "+ki,itemName:"Alignments",items:xo,element:a});break;case"align":case"videoalign":n.renderAlignmentDropDown(i,r,t,s);break;case"display":case"audiolayoutoption":case"videolayoutoption":n.renderDisplayDropDown(i,r,t,s);break;case"tablerows":n.rowDropDown(i,r,a,t);break;case"tablecolumns":n.columnDropDown(i,r,a);break;case"tablecell":n.cellDropDown(i,r,a);break;case"tablecellverticalalign":n.verticalAlignDropDown(i,r,a);break;case"styles":n.tableStylesDropDown(i,r,a)}})),this.parent.inlineMode.enable&&this.setCssClass({cssClass:this.parent.getCssClass()})},t.prototype.getUpdateItems=function(e,t){var n=e.slice();return n.forEach((function(e){Object.defineProperties(e,{command:{value:"Format"===t?"Formats":"Font",enumerable:!0},subCommand:{value:"Format"===t?e.value:t,enumerable:!0}})})),n},t.prototype.onPropertyChanged=function(e){for(var t,n,i=e.newProp,r=0,s=Object.keys(i);r<s.length;r++){switch(s[r]){case"fontFamily":if(this.fontNameDropDown)for(var a=0,l=Object.keys(i.fontFamily);a<l.length;a++){switch(l[a]){case"default":case"width":var d=this.fontNameDropDown.items;t=(0,o.isNullOrUndefined)((0,o.closest)(this.fontNameDropDown.element,"."+Nn))?"toolbar":"quick";var c=(0,o.isNullOrUndefined)(this.parent.fontFamily.default)?d[0].text:this.parent.fontFamily.default;n=this.dropdownContent(this.parent.fontFamily.width,t,"quick"===t?"":"Default"===mr(d,c,"text","text")?this.i10n.getConstant("fontName"):mr(d,c,"text","text")),this.fontNameDropDown.setProperties({content:n}),(0,o.isNullOrUndefined)(this.parent.fontFamily.default)?this.getEditNode().style.removeProperty("font-family"):this.getEditNode().style.fontFamily=this.parent.fontFamily.default;break;case"items":this.fontNameDropDown.setProperties({items:this.getUpdateItems(i.fontFamily.items,"FontName")})}}break;case"fontSize":if(this.fontSizeDropDown)for(var h=0,p=Object.keys(i.fontSize);h<p.length;h++){switch(p[h]){case"default":case"width":var u=this.fontSizeDropDown.items;t=(0,o.isNullOrUndefined)((0,o.closest)(this.fontSizeDropDown.element,"."+Nn))?"toolbar":"quick";var m=(0,o.isNullOrUndefined)(this.parent.fontSize.default)?u[0].text:this.parent.fontSize.default,f=mr(u,m.replace(/\s/g,""),"Default"===m?"text":"value","text");n=this.dropdownContent(this.parent.fontSize.width,t,gr("Default"===f?this.i10n.getConstant("fontSize"):f)),this.fontSizeDropDown.setProperties({content:n}),(0,o.isNullOrUndefined)(this.parent.fontSize.default)?this.getEditNode().style.removeProperty("font-size"):this.getEditNode().style.fontSize=this.parent.fontSize.default;break;case"items":this.fontSizeDropDown.setProperties({items:this.getUpdateItems(i.fontSize.items,"FontSize")})}}break;case"format":if(this.formatDropDown)for(var g=0,b=Object.keys(i.format);g<b.length;g++){switch(b[g]){case"default":case"width":var v=this.formatDropDown.items;t=(0,o.isNullOrUndefined)((0,o.closest)(this.formatDropDown.element,"."+Nn))?"toolbar":"quick";var y=(0,o.isNullOrUndefined)(this.parent.format.default)?v[0].text:this.parent.format.default;n=this.dropdownContent(this.parent.format.width,t,"quick"===t?"":mr(v,y,"text","text")),this.formatDropDown.setProperties({content:n});break;case"types":this.formatDropDown.setProperties({items:this.getUpdateItems(i.format.types,"Format")})}}}}},t.prototype.getEditNode=function(){return this.parent.contentModule.getEditPanel()},t.prototype.rowDropDown=function(e,t,n,i){n=(0,o.select)("#"+this.parent.getID()+"_"+e+"_TableRows",t);var r=Array.from(jo);n.classList.contains(Rn)||(i.closest("th")&&r.shift(),this.tableRowsDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-table-rows e-icons",cssClass:Mn+" "+Bn+" "+Ln,itemName:"TableRows",items:r,element:n}))},t.prototype.columnDropDown=function(e,t,n){(n=(0,o.select)("#"+this.parent.getID()+"_"+e+"_TableColumns",t)).classList.contains(Rn)||(this.tableColumnsDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-table-columns e-icons",cssClass:Mn+" "+Bn+" "+Ln,itemName:"TableColumns",items:qo,element:n}))},t.prototype.cellDropDown=function(e,t,n){(n=(0,o.select)("#"+this.parent.getID()+"_"+e+"_TableCell",t)).classList.contains(Rn)||(this.tableCellDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-table-cell e-icons",cssClass:Mn+" "+Bn+" "+Ln,itemName:"TableCell",items:Po,element:n}))},t.prototype.verticalAlignDropDown=function(e,t,n){(n=(0,o.select)("#"+this.parent.getID()+"_"+e+"_TableCellVerticalAlign",t)).classList.contains(Rn)||(this.tableCellVerticalAlignDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-table-cell-ver-align e-icons",cssClass:Mn+" "+Bn+" "+Ln,itemName:"TableCellVerticalAlign",items:_o,element:n}))},t.prototype.renderDisplayDropDown=function(e,t,n,i){var r=n;(n=(0,o.select)("#"+this.parent.getID()+"_"+e+("display"===i?"_Display":"videolayoutoption"===i?"_VideoLayoutOption":"_AudioLayoutOption"),t)).classList.contains(Rn)||(this.displayDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"display"===i?"e-display e-icons":"videolayoutoption"===i?"e-video-display e-icons":"e-audio-display e-icons",cssClass:Mn+" "+Bn+" "+Ln,itemName:"display"===i?"Display":"videolayoutoption"===i?"VideoLayoutOption":"AudioLayoutOption",items:"display"===i?Ro:"videolayoutoption"===i?Uo:Io,element:n,activeElement:r}))},t.prototype.renderAlignmentDropDown=function(e,t,n,i){var r=n;(n=(0,o.select)("#"+this.parent.getID()+"_"+e+("align"===i?"_Align":"_VideoAlign"),t)).classList.contains(Rn)||(this.imageAlignDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-justify-left e-icons",cssClass:Mn+" "+An+" "+Ln,itemName:"align"===i?"Align":"VideoAlign",items:"align"===i?wo:Do,element:n,activeElement:r}))},t.prototype.tableStylesDropDown=function(e,t,n){(n=(0,o.select)("#"+this.parent.getID()+"_"+e+"_Styles",t)).classList.contains(Rn)||(this.imageAlignDropDown=this.toolbarRenderer.renderDropDownButton({iconCss:"e-style e-icons",cssClass:Mn+" "+An+" "+Ln,itemName:"Styles",items:this.parent.tableSettings.styles,element:n}))},t.prototype.removeDropDownClasses=function(e){(0,o.removeClass)([e],[Rn,Mn,An,Bn])},t.prototype.destroyDropDowns=function(){this.formatDropDown&&(this.removeDropDownClasses(this.formatDropDown.element),this.formatDropDown.destroy(),this.formatDropDown=null),this.fontNameDropDown&&(this.removeDropDownClasses(this.fontNameDropDown.element),this.fontNameDropDown.destroy(),this.fontNameDropDown=null),this.fontSizeDropDown&&(this.removeDropDownClasses(this.fontSizeDropDown.element),this.fontSizeDropDown.destroy(),this.fontSizeDropDown=null),this.alignDropDown&&(this.removeDropDownClasses(this.alignDropDown.element),this.alignDropDown.destroy(),this.alignDropDown=null),this.imageAlignDropDown&&(this.removeDropDownClasses(this.imageAlignDropDown.element),this.imageAlignDropDown.destroy(),this.imageAlignDropDown=null),this.displayDropDown&&(this.removeDropDownClasses(this.displayDropDown.element),this.displayDropDown.destroy(),this.displayDropDown=null),this.tableRowsDropDown&&(this.removeDropDownClasses(this.tableRowsDropDown.element),this.tableRowsDropDown.destroy(),this.tableRowsDropDown=null),this.tableColumnsDropDown&&(this.removeDropDownClasses(this.tableColumnsDropDown.element),this.tableColumnsDropDown.destroy(),this.tableColumnsDropDown=null),this.tableCellDropDown&&(this.removeDropDownClasses(this.tableCellDropDown.element),this.tableCellDropDown.destroy(),this.tableCellDropDown=null),this.tableCellVerticalAlignDropDown&&(this.removeDropDownClasses(this.tableCellVerticalAlignDropDown.element),this.tableCellVerticalAlignDropDown.destroy(),this.tableCellVerticalAlignDropDown=null),this.numberFormatListDropDown&&(this.removeDropDownClasses(this.numberFormatListDropDown.element),this.numberFormatListDropDown.destroy(),this.numberFormatListDropDown=null),this.bulletFormatListDropDown&&(this.removeDropDownClasses(this.bulletFormatListDropDown.element),this.bulletFormatListDropDown.destroy(),this.bulletFormatListDropDown=null),this.toolbarRenderer=null},t.prototype.setRtl=function(e){this.formatDropDown&&this.formatDropDown.setProperties({enableRtl:e.enableRtl}),this.fontNameDropDown&&this.fontNameDropDown.setProperties({enableRtl:e.enableRtl}),this.fontSizeDropDown&&this.fontSizeDropDown.setProperties({enableRtl:e.enableRtl}),this.alignDropDown&&this.alignDropDown.setProperties({enableRtl:e.enableRtl}),this.imageAlignDropDown&&this.imageAlignDropDown.setProperties({enableRtl:e.enableRtl}),this.displayDropDown&&this.displayDropDown.setProperties({enableRtl:e.enableRtl}),this.numberFormatListDropDown&&this.numberFormatListDropDown.setProperties({enableRtl:e.enableRtl}),this.bulletFormatListDropDown&&this.bulletFormatListDropDown.setProperties({enableRtl:e.enableRtl})},t.prototype.updateCss=function(e,t){e&&t.cssClass&&((0,o.isNullOrUndefined)(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},t.prototype.setCssClass=function(e){for(var t=[this.formatDropDown,this.fontNameDropDown,this.fontSizeDropDown,this.alignDropDown,this.imageAlignDropDown,this.displayDropDown,this.numberFormatListDropDown,this.bulletFormatListDropDown,this.tableRowsDropDown,this.tableColumnsDropDown,this.tableCellDropDown,this.tableCellVerticalAlignDropDown],n=0;n<t.length;n++)this.updateCss(t[n],e)},t.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(U,this.beforeRender,this),this.parent.on(m,this.onIframeMouseDown,this),this.parent.on(_e,this.setRtl,this),this.parent.on(T,this.onPropertyChanged,this),this.parent.on(qt,this.setCssClass,this))},t.prototype.onIframeMouseDown=function(){!(0,o.isNullOrUndefined)(this.parent.getToolbarElement())&&(this.parent.getToolbarElement().querySelectorAll('.e-rte-dropdown-btn[aria-expanded="true"]').length>0||this.parent.getToolbarElement().querySelectorAll('.e-dropdown-btn.e-rte-inline-dropdown[aria-expanded="true"]').length>0)&&this.closeOpenDropdowns()},t.prototype.closeOpenDropdowns=function(){[this.formatDropDown,this.fontNameDropDown,this.fontSizeDropDown,this.alignDropDown,this.imageAlignDropDown,this.displayDropDown,this.numberFormatListDropDown,this.bulletFormatListDropDown,this.tableRowsDropDown,this.tableColumnsDropDown,this.tableCellDropDown,this.tableCellVerticalAlignDropDown,this.parent.toolbarModule.colorPickerModule.fontColorDropDown,this.parent.toolbarModule.colorPickerModule.backgroundColorDropDown].forEach((function(e){e&&e.dropDown&&e.dropDown.element&&e.dropDown.element.classList.contains("e-popup-open")&&e.toggle()}))},t.prototype.removeEventListener=function(){this.parent.off(m,this.onIframeMouseDown),this.parent.off(_e,this.setRtl),this.parent.off(U,this.beforeRender),this.parent.off(T,this.onPropertyChanged),this.parent.off(qt,this.setCssClass)},t.prototype.destroy=function(){this.removeEventListener(),this.destroyDropDowns()},t}(),Td=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(g,this.toolbarClick,this),this.parent.on(I,this.dropDownSelect,this),this.parent.on(Ie,this.renderSelection,this),this.parent.on(f,this.removeEventListener,this)},e.prototype.toolbarClick=function(e){if(this.parent.userAgentData.isSafari()&&this.parent.formatter.editorManager.nodeSelection&&!this.parent.inputElement.contains(this.parent.getRange().startContainer)&&this.parent.notify(Oe,{}),!(0,o.isNullOrUndefined)(e.item)){if(!(0,o.isNullOrUndefined)(e.item.controlParent)){var t=e.item.controlParent.activeEle;t&&(t.tabIndex=-1)}"NumberFormatList"!==e.item.command&&"BulletFormatList"!==e.item.command||(e.originalEvent.target.classList.contains("e-order-list")||e.originalEvent.target.classList.contains("e-unorder-list"))&&(e.item.command="Lists",e.item.subCommand="NumberFormatList"===e.item.subCommand?"OL":"UL"),"Lists"===e.item.command&&e.originalEvent.target.classList.contains("e-caret")&&(e.originalEvent.target.parentElement.classList.contains("e-rte-bulletformatlist-dropdown")||e.originalEvent.target.parentElement.classList.contains("e-rte-numberformatlist-dropdown"))||(this.parent.notify(E,e),this.parent.notify(S,e))}},e.prototype.dropDownSelect=function(e){if(this.parent.notify(Oe,{}),!document.body.contains(document.body.querySelector(".e-rte-quick-toolbar"))||!e.item||"Images"!==e.item.command&&"Audios"!==e.item.command&&"Videos"!==e.item.command&&"VideoLayoutOption"!==e.item.command&&"Display"!==e.item.command&&"Table"!==e.item.command){var t=e.item.controlParent&&this.parent.quickToolbarModule&&this.parent.quickToolbarModule.tableQTBar&&this.parent.quickToolbarModule.tableQTBar.element.contains(e.item.controlParent.element)?"Table":null;if("Lists"===e.item.command){var n={listStyle:e.item.value,listImage:e.item.listImage,type:e.item.subCommand};this.parent.formatter.process(this.parent,e,e.originalEvent,n)}else this.parent.formatter.process(this.parent,e,e.originalEvent,t)}this.parent.notify(Te,{})},e.prototype.renderSelection=function(e){this.parent.notify(Oe,{}),this.parent.formatter.process(this.parent,e,e.originalEvent,null),this.parent.notify(Te,{})},e.prototype.removeEventListener=function(){this.parent.off(g,this.toolbarClick),this.parent.off(I,this.dropDownSelect),this.parent.off(Ie,this.renderSelection),this.parent.off(f,this.removeEventListener)},e}(),Od=function(){function t(e,t){this.tools={},this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.parent.toolbarSettings&&Object.keys(this.parent.toolbarSettings.itemConfigs).length>0?(0,o.extend)(this.tools,Lo,kr(this.parent.toolbarSettings.itemConfigs),!0):this.tools=Lo}return t.prototype.initializeInstance=function(){this.toolbarRenderer=this.renderFactory.getRenderer(e.Toolbar)},t.prototype.renderColorPickerInput=function(e){var t=this;this.initializeInstance();var n,i,r=e.containerType,s=e.container;Oo.forEach((function(a){if(-1!==pr(a,e.items))switch(a){case"fontcolor":n=t.parent.getID()+"_"+r+"_FontColor_Target";var l=t.parent.createElement("input");if(l.id=n,l.classList.add(xi),!(0,o.isNullOrUndefined)(t.parent.cssClass))for(var d=t.parent.cssClass.split(" "),c=0;c<d.length;c++)""!==d[c].trim()&&l.classList.add(d[c]);document.body.appendChild(l),i={cssClass:t.tools[a.toLocaleLowerCase()].icon+" "+bi+" "+mi+t.parent.getCssClass(!0),value:t.tools[a.toLocaleLowerCase()].value,command:t.tools[a.toLocaleLowerCase()].command,subCommand:t.tools[a.toLocaleLowerCase()].subCommand,element:(0,o.select)("#"+t.parent.getID()+"_"+r+"_FontColor",s),target:n},t.fontColorPicker=t.toolbarRenderer.renderColorPicker(i,"fontcolor"),t.fontColorDropDown=t.toolbarRenderer.renderColorPickerDropDown(i,"fontcolor",t.fontColorPicker);break;case"backgroundcolor":n=t.parent.getID()+"_"+r+"_BackgroundColor_Target";var h=t.parent.createElement("input");if(h.id=n,h.classList.add(wi),!(0,o.isNullOrUndefined)(t.parent.cssClass))for(d=t.parent.cssClass.split(" "),c=0;c<d.length;c++)""!==d[c].trim()&&h.classList.add(d[c]);document.body.appendChild(h),i={cssClass:t.tools[a.toLocaleLowerCase()].icon+" "+bi+" "+mi+t.parent.getCssClass(!0),value:t.tools[a.toLocaleLowerCase()].value,command:t.tools[a.toLocaleLowerCase()].command,subCommand:t.tools[a.toLocaleLowerCase()].subCommand,element:(0,o.select)("#"+t.parent.getID()+"_"+r+"_BackgroundColor",s),target:n},t.backgroundColorPicker=t.toolbarRenderer.renderColorPicker(i,"backgroundcolor",e.containerType),t.backgroundColorDropDown=t.toolbarRenderer.renderColorPickerDropDown(i,"backgroundcolor",t.backgroundColorPicker,t.defaultColorPicker,e.containerType)}})),this.parent.inlineMode.enable&&this.setCssClass({cssClass:this.parent.getCssClass()})},t.prototype.destroy=function(){this.removeEventListener(),this.destroyColorPicker(),this.defaultColorPicker=null,this.fontColorPicker=null,this.fontColorDropDown=null,this.backgroundColorDropDown=null,this.backgroundColorPicker=null,this.tools={}},t.prototype.destroyColorPicker=function(){var e;(this.fontColorPicker&&!this.fontColorPicker.isDestroyed&&this.fontColorPicker.destroy(),this.backgroundColorPicker&&!this.backgroundColorPicker.isDestroyed&&this.backgroundColorPicker.destroy(),this.fontColorDropDown&&!this.fontColorDropDown.isDestroyed)&&((e=this.fontColorDropDown.element.querySelector(".e-rte-color-content"))&&(0,o.detach)(e),this.fontColorDropDown.destroy());this.backgroundColorDropDown&&!this.backgroundColorDropDown.isDestroyed&&((e=this.backgroundColorDropDown.element.querySelector(".e-rte-color-content"))&&(this.defaultColorPicker=e.children[0].style.borderBottomColor,(0,o.detach)(e)),this.backgroundColorDropDown.destroy())},t.prototype.setRtl=function(e){this.fontColorPicker&&(this.fontColorPicker.setProperties({enableRtl:e.enableRtl}),this.fontColorDropDown.setProperties({enableRtl:e.enableRtl})),this.backgroundColorPicker&&(this.backgroundColorPicker.setProperties({enableRtl:e.enableRtl}),this.backgroundColorDropDown.setProperties({enableRtl:e.enableRtl}))},t.prototype.setCssClass=function(e){this.updateCss(this.fontColorPicker,this.fontColorDropDown,e),this.updateCss(this.backgroundColorPicker,this.backgroundColorDropDown,e)},t.prototype.updateCss=function(e,t,n){e&&n.cssClass&&((0,o.isNullOrUndefined)(n.oldCssClass)?(e.setProperties({cssClass:(e.cssClass+" "+n.cssClass).trim()}),t.setProperties({cssClass:(t.cssClass+" "+n.cssClass).trim()})):(e.setProperties({cssClass:(e.cssClass.replace(n.oldCssClass,"").replace("  "," ").trim()+" "+n.cssClass).trim()}),t.setProperties({cssClass:(t.cssClass.replace(n.oldCssClass,"").replace("  "," ").trim()+" "+n.cssClass).trim()})))},t.prototype.addEventListener=function(){this.parent.on(A,this.renderColorPickerInput,this),this.parent.on(_e,this.setRtl,this),this.parent.on(T,this.onPropertyChanged,this),this.parent.on(qt,this.setCssClass,this),this.parent.on(Jt,this.showColorPicker,this)},t.prototype.showColorPicker=function(e){(0,o.isNullOrUndefined)(this.fontColorPicker)||"fontcolor"!==e.toolbarClick?(0,o.isNullOrUndefined)(this.backgroundColorPicker)||"backgroundcolor"!==e.toolbarClick||this.backgroundColorDropDown.toggle():this.fontColorDropDown.toggle()},t.prototype.onPropertyChanged=function(e){for(var t=e.newProp,n=0,i=Object.keys(t);n<i.length;n++){switch(i[n]){case"fontColor":if(this.fontColorPicker)for(var o=0,r=Object.keys(t.fontColor);o<r.length;o++){switch(r[o]){case"default":this.fontColorPicker.setProperties({value:t.fontColor.default}),this.fontColorDropDown.element.querySelector("."+this.tools.fontcolor.icon).style.borderBottomColor=t.fontColor.default;break;case"mode":this.fontColorPicker.setProperties({mode:t.fontColor.mode});break;case"columns":this.fontColorPicker.setProperties({columns:t.fontColor.columns});break;case"colorCode":this.fontColorPicker.setProperties({presetColors:t.fontColor.colorCode});break;case"modeSwitcher":this.fontColorPicker.setProperties({modeSwitcher:t.fontColor.modeSwitcher})}}break;case"backgroundColor":if(this.backgroundColorPicker)for(var s=0,a=Object.keys(t.backgroundColor);s<a.length;s++){switch(a[s]){case"default":this.backgroundColorPicker.setProperties({value:t.backgroundColor.default}),this.backgroundColorDropDown.element.querySelector("."+this.tools.backgroundcolor.icon).style.borderBottomColor=t.backgroundColor.default;break;case"mode":this.backgroundColorPicker.setProperties({mode:t.backgroundColor.mode});break;case"columns":this.backgroundColorPicker.setProperties({columns:t.backgroundColor.columns});break;case"colorCode":this.backgroundColorPicker.setProperties({presetColors:t.backgroundColor.colorCode});break;case"modeSwitcher":this.backgroundColorPicker.setProperties({modeSwitcher:t.backgroundColor.modeSwitcher})}}}}},t.prototype.removeEventListener=function(){this.parent.off(A,this.renderColorPickerInput),this.parent.off(_e,this.setRtl),this.parent.off(T,this.onPropertyChanged),this.parent.off(qt,this.setCssClass),this.parent.off(Jt,this.showColorPicker)},t}(),Ld=function(){function n(e,t){this.tools={},this.parent=e,this.isDestroyed=!1,this.isToolbar=!1,this.locator=t,this.isTransformChild=!1,this.renderFactory=this.locator.getService("rendererFactory"),function(e){xo.forEach((function(t,n){xo[n].text=er(e,ko,xo[n])})),Ro.forEach((function(t,n){Ro[n].text=er(e,Mo,Ro[n])})),Io.forEach((function(t,n){Io[n].text=er(e,Ao,Io[n])})),Uo.forEach((function(t,n){Uo[n].text=er(e,Bo,Uo[n])})),jo.forEach((function(t,n){jo[n].text=er(e,Ho,jo[n])})),qo.forEach((function(t,n){qo[n].text=er(e,Fo,qo[n])})),_o.forEach((function(t,n){_o[n].text=er(e,zo,_o[n])})),Wo.forEach((function(t,n){Wo[n].text=er(e,Vo,Wo[n])}))}(this.parent),Fr(this.parent),this.baseToolbar=new Ed(this.parent,this.locator),this.addEventListener(),this.parent.toolbarSettings&&Object.keys(this.parent.toolbarSettings.itemConfigs).length>0?(0,o.extend)(this.tools,Lo,kr(this.parent.toolbarSettings.itemConfigs),!0):this.tools=Lo}return n.prototype.initializeInstance=function(){this.contentRenderer=this.renderFactory.getRenderer(e.Content),this.editableElement=this.contentRenderer.getEditPanel(),this.editPanel=this.contentRenderer.getPanel()},n.prototype.toolbarBindEvent=function(){this.parent.inlineMode.enable||(this.keyBoardModule=new o.KeyboardEvents(this.getToolbarElement(),{keyAction:this.toolBarKeyDown.bind(this),keyConfigs:this.parent.formatter.keyConfig,eventName:"keydown"}))},n.prototype.toolBarKeyDown=function(e){switch(e.action){case"escape":this.parent.contentModule.getEditPanel().focus();break;case"enter":(0,o.isNullOrUndefined)(e.target)||!e.target.classList.contains("e-rte-fontcolor-dropdown")&&!e.target.classList.contains("e-rte-backgroundcolor-dropdown")||this.parent.notify(Jt,{toolbarClick:e.target.classList.contains("e-rte-fontcolor-dropdown")?"fontcolor":"backgroundcolor"})}},n.prototype.createToolbarElement=function(){this.tbElement=this.parent.createElement("div",{id:this.parent.getID()+"_toolbar"}),!o.Browser.isDevice&&this.parent.inlineMode.enable&&fr()||(this.parent.inlineMode.enable?this.parent.rootContainer.insertBefore(this.tbElement,this.editPanel):(this.tbWrapper=this.parent.createElement("div",{id:this.parent.getID()+"_toolbar_wrapper",innerHTML:this.tbElement.outerHTML,className:Hn}),this.tbElement=this.tbWrapper.firstElementChild,this.parent.rootContainer.insertBefore(this.tbWrapper,this.editPanel)))},n.prototype.getToolbarMode=function(){var e;switch(this.parent.toolbarSettings.type){case t.Expand:e="Extended";break;case t.Scrollable:e="Scrollable";break;default:e="MultiRow"}return fr()&&this.parent.toolbarSettings.type===t.Expand&&(e=t.Scrollable),e},n.prototype.checkToolbarResponsive=function(e){return!(!o.Browser.isDevice||fr())&&(n=this.parent.toolbarSettings.type===t.Expand?t.MultiRow:this.parent.toolbarSettings.type,this.baseToolbar.render({container:this.parent.inlineMode.enable?"quick":"toolbar",items:this.parent.toolbarSettings.items,mode:n,target:e,cssClass:this.parent.getCssClass()}),this.parent.toolbarSettings.type===t.Expand&&((0,o.addClass)([e],["e-rte-tb-mobile"]),this.parent.inlineMode.enable?this.addFixedTBarClass():(0,o.addClass)([e],[Tn])),this.wireEvents(),this.dropDownModule.renderDropDowns({container:e,containerType:this.parent.inlineMode.enable?"quick":"toolbar",items:this.parent.toolbarSettings.items}),this.renderColorPicker({container:this.tbElement,containerType:this.parent.inlineMode.enable?"quick":"toolbar",items:this.parent.toolbarSettings.items}),!0);var n},n.prototype.checkIsTransformChild=function(){this.isTransformChild=!1;for(var e=(0,o.selectAll)('[style*="transform"]',document),t=0;t<e.length;t++)if(!(0,o.isNullOrUndefined)(e[t].contains)&&e[t].contains(this.parent.element)){this.isTransformChild=!0;break}},n.prototype.toggleFloatClass=function(){var e=this.parent.floatingToolbarOffset;this.parent.toolbarSettings.enableFloating?((0,o.addClass)([this.tbElement.parentElement],[gn]),(0,o.setStyleAttribute)(this.tbElement.parentElement,{top:e+"px"})):((0,o.removeClass)([this.tbElement.parentElement],[gn]),(0,o.setStyleAttribute)(this.tbElement.parentElement,{top:""}))},n.prototype.renderToolbar=function(){this.initializeInstance(),this.createToolbarElement(),this.checkToolbarResponsive(this.tbElement)||(this.parent.inlineMode.enable?this.parent.notify(Fe,{}):(this.baseToolbar.render({container:"toolbar",items:this.parent.toolbarSettings.items,mode:this.getToolbarMode(),target:this.tbElement,cssClass:this.parent.getCssClass()}),this.parent.element.classList.contains("e-rte-full-screen")&&this.updateItem({targetItem:"Maximize",updateItem:"Minimize",baseToolbar:this.parent.getBaseToolbarObject()}),this.parent.inlineMode.enable||(this.parent.toolbarSettings.enableFloating&&(this.checkIsTransformChild(),this.toggleFloatClass()),(0,o.addClass)([this.parent.element],[No]),this.parent.toolbarSettings.type===t.Expand&&(0,o.addClass)([this.parent.element],[yn]))),this.wireEvents(),this.parent.inlineMode.enable&&!fr()&&this.addFixedTBarClass(),this.parent.inlineMode.enable||(this.dropDownModule.renderDropDowns({container:this.tbElement,containerType:"toolbar",items:this.parent.toolbarSettings.items}),this.renderColorPicker({container:this.tbElement,containerType:"toolbar",items:this.parent.toolbarSettings.items}),this.refreshToolbarOverflow()),this.parent.rootContainer&&this.parent.rootContainer.classList.contains("e-source-code-enabled")&&(this.parent.notify(ne,{targetItem:"SourceCode",updateItem:"Preview",baseToolbar:this.parent.getBaseToolbarObject()}),this.parent.disableToolbarItem(this.parent.toolbarSettings.items)))},n.prototype.addFixedTBarClass=function(){(0,o.addClass)([this.tbElement],[fn])},n.prototype.removeFixedTBarClass=function(){(0,o.removeClass)([this.tbElement],[fn])},n.prototype.showFixedTBar=function(){(0,o.addClass)([this.tbElement],[Vn]),o.Browser.isIos&&(0,o.addClass)([this.tbElement],[Ci])},n.prototype.hideFixedTBar=function(){this.isToolbar?this.isToolbar=!1:(0,o.removeClass)([this.tbElement],[Vn,Ci])},n.prototype.updateItem=function(e){var t=this.tools[e.updateItem.toLocaleLowerCase()];("Code View"!==vr(e.updateItem.toLocaleLowerCase(),this.locator)&&"Preview"!==vr(e.updateItem.toLocaleLowerCase(),this.locator)||"en-US"!==this.parent.locale)&&(t.tooltip=vr(e.updateItem.toLocaleLowerCase(),this.locator));var n=Er(Cr(this.tools[e.targetItem.toLocaleLowerCase()].subCommand),e.baseToolbar.toolbarObj.items)[0];if((0,o.isNullOrUndefined)(n))this.addTBarItem(e,0);else{var i=this.parent.inlineMode.enable?"_quick_":"_toolbar_";e.baseToolbar.toolbarObj.items[n].id=this.parent.getID()+i+t.id,e.baseToolbar.toolbarObj.items[n].prefixIcon=t.icon,e.baseToolbar.toolbarObj.items[n].tooltipText=t.tooltip,e.baseToolbar.toolbarObj.items[n].subCommand=t.subCommand,e.baseToolbar.toolbarObj.dataBind(),e.baseToolbar.toolbarObj.refreshOverflow()}},n.prototype.updateToolbarStatus=function(e){this.tbElement&&(!this.parent.inlineMode.enable||!fr()&&o.Browser.isDevice)&&yr({args:e,dropDownModule:this.dropDownModule,parent:this.parent,tbElements:(0,o.selectAll)("."+Un,this.tbElement),tbItems:this.baseToolbar.toolbarObj.items},!!this.parent.inlineMode.enable,this.parent)},n.prototype.fullScreen=function(e){this.parent.fullScreenModule.showFullScreen(e)},n.prototype.hideScreen=function(e){this.parent.fullScreenModule.hideFullScreen(e)},n.prototype.getBaseToolbar=function(){return this.baseToolbar},n.prototype.addTBarItem=function(e,t){e.baseToolbar.toolbarObj.addItems([e.baseToolbar.getObject(e.updateItem,"toolbar")],t)},n.prototype.enableTBarItems=function(e,t,n,i){var r=Er(Cr(t),e.toolbarObj.items);this.tbItems=(0,o.selectAll)("."+Un,e.toolbarObj.element);for(var s=0;s<r.length;s++){var a=this.tbItems[r[s]];a&&e.toolbarObj.enableItems(a,n)}(0,o.select)("."+So,this.parent.element)||i||Sr(e,this.parent.formatter.editorManager.undoRedoManager.getUndoStatus())},n.prototype.removeTBarItems=function(e){(0,o.isNullOrUndefined)(this.baseToolbar.toolbarObj)&&(this.baseToolbar=this.parent.getBaseToolbarObject());var t=Er(Cr(e),this.baseToolbar.toolbarObj.items);this.tbItems=this.parent.inlineMode.enable?(0,o.selectAll)("."+Un,this.baseToolbar.toolbarObj.element):(0,o.selectAll)("."+Un,this.parent.element);for(var n=0;n<t.length;n++)this.baseToolbar.toolbarObj.removeItems(this.tbItems[t[n]])},n.prototype.getExpandTBarPopHeight=function(){var e=0;if(this.parent.toolbarSettings.type===t.Expand&&this.tbElement.classList.contains("e-extended-toolbar")){var n=(0,o.select)(".e-toolbar-extended",this.tbElement);n&&this.tbElement.classList.contains("e-expand-open")||n&&n.classList.contains("e-popup-open")?((0,o.addClass)([n],[Qn]),e+=n.offsetHeight,(0,o.removeClass)([n],[Qn])):(0,o.removeClass)([this.tbElement],[gi])}return e},n.prototype.getToolbarHeight=function(){return this.tbElement.offsetHeight},n.prototype.getToolbarElement=function(){return this.parent&&this.parent.element?(0,o.select)("."+mn,this.parent.element):null},n.prototype.refreshToolbarOverflow=function(){this.parent.element.classList.remove(ln),this.baseToolbar.toolbarObj.refreshOverflow(),this.parent.enableRtl&&this.parent.element.classList.add(ln)},n.prototype.isToolbarDestroyed=function(){return!!(this.baseToolbar&&this.baseToolbar.toolbarObj&&this.baseToolbar.toolbarObj.isDestroyed)},n.prototype.destroyToolbar=function(){if(!this.isToolbarDestroyed()){this.parent.unWireScrollElementsEvents(),this.unWireEvents(),this.dropDownModule.destroy(),this.parent.emojiPickerModule&&!this.parent.emojiPickerModule.isPopupDestroyed&&this.parent.emojiPickerModule.childDestroy(),this.dropDownModule=null,this.colorPickerModule.destroy(),this.colorPickerModule=null,this.keyBoardModule&&(this.keyBoardModule.destroy(),this.keyBoardModule=null),this.baseToolbar.destroy(),this.removeEventListener(),(0,o.removeClass)([this.parent.element],[No]),(0,o.removeClass)([this.parent.element],[yn]);var e=(0,o.select)("."+Hn,this.parent.element),t=(0,o.select)("."+mn,this.parent.element);(0,o.isNullOrUndefined)(e)||(0,o.detach)(e),(0,o.isNullOrUndefined)(t)||(0,o.detach)(t)}},n.prototype.destroy=function(){this.isDestroyed||(this.isToolbarDestroyed()||this.destroyToolbar(),this.toolbarObj=null,this.editPanel=null,this.isToolbar=null,this.editableElement=null,this.tbItems=null,this.baseToolbar=null,this.tbElement=null,this.tbWrapper=null,this.isTransformChild=null,this.contentRenderer=null,this.dropDownModule=null,this.colorPickerModule=null,this.toolbarActionModule=null,this.tools=null,this.locator=null,this.renderFactory=null,this.isDestroyed=!0)},n.prototype.mouseDownHandler=function(){o.Browser.isDevice&&this.parent.inlineMode.enable&&!fr()&&this.showFixedTBar()},n.prototype.focusChangeHandler=function(){o.Browser.isDevice&&this.parent.inlineMode.enable&&!fr()&&(this.isToolbar=!1,this.hideFixedTBar())},n.prototype.dropDownBeforeOpenHandler=function(){this.isToolbar=!0},n.prototype.tbFocusHandler=function(e){var t=document.activeElement,n=(0,o.closest)(t,".e-rte-toolbar");if(t===this.parent.getToolbarElement()||n===this.parent.getToolbarElement())for(var i=this.parent.getToolbarElement().querySelectorAll(".e-expended-nav"),r=0;r<i.length;r++)(0,o.isNullOrUndefined)(this.parent.getToolbarElement().querySelector(".e-insert-table-btn"))?i[r].setAttribute("tabindex","0"):i[r].setAttribute("tabindex","1")},n.prototype.wireEvents=function(){this.parent.inlineMode.enable&&fr()||o.EventHandler.add(this.tbElement,"focusin",this.tbFocusHandler,this)},n.prototype.unWireEvents=function(){o.EventHandler.remove(this.tbElement,"focusin",this.tbFocusHandler)},n.prototype.addEventListener=function(){this.parent.isDestroyed||(this.dropDownModule=new Sd(this.parent,this.locator),this.toolbarActionModule=new Td(this.parent),this.colorPickerModule=new Od(this.parent,this.locator),this.parent.on(u,this.renderToolbar,this),this.parent.on(N,this.toolbarBindEvent,this),this.parent.on(C,this.updateToolbarStatus,this),this.parent.on(T,this.onPropertyChanged,this),this.parent.on(y,this.onRefresh,this),this.parent.on(f,this.destroy,this),this.parent.on(B,this.fullScreen,this),this.parent.on(R,this.hideScreen,this),this.parent.on(ne,this.updateItem,this),this.parent.on(Se,this.dropDownBeforeOpenHandler,this),this.parent.on(Ue,this.focusChangeHandler,this),this.parent.on(De,this.mouseDownHandler,this),this.parent.on(Me,this.mouseDownHandler,this),this.parent.on(qt,this.setCssClass,this))},n.prototype.removeEventListener=function(){this.parent.off(u,this.renderToolbar),this.parent.off(N,this.toolbarBindEvent),this.parent.off(C,this.updateToolbarStatus),this.parent.off(T,this.onPropertyChanged),this.parent.off(y,this.onRefresh),this.parent.off(f,this.destroy),this.parent.off(B,this.parent.fullScreenModule.showFullScreen),this.parent.off(R,this.parent.fullScreenModule.hideFullScreen),this.parent.off(ne,this.updateItem),this.parent.off(Se,this.dropDownBeforeOpenHandler),this.parent.off(Ue,this.focusChangeHandler),this.parent.off(De,this.mouseDownHandler),this.parent.off(Me,this.mouseDownHandler),this.parent.off(qt,this.setCssClass)},n.prototype.setCssClass=function(e){this.toolbarObj&&e.cssClass&&((0,o.isNullOrUndefined)(e.oldCssClass)?this.toolbarObj.setProperties({cssClass:(this.toolbarObj.cssClass+" "+e.cssClass).trim()}):this.toolbarObj.setProperties({cssClass:(this.toolbarObj.cssClass.replace(e.oldCssClass,"").trim()+" "+e.cssClass).trim()}))},n.prototype.onRefresh=function(){this.parent.inlineMode.enable||this.refreshToolbarOverflow(),this.parent.autoResize()},n.prototype.onPropertyChanged=function(e){if(!(0,o.isNullOrUndefined)(e.newProp.inlineMode))for(var t=0,n=Object.keys(e.newProp.inlineMode);t<n.length;t++){if("enable"===n[t])this.refreshToolbar()}(0,o.isNullOrUndefined)(e.newProp.toolbarSettings)||(0,o.isNullOrUndefined)(e.newProp.toolbarSettings.enableFloating)||this.toggleFloatClass(),e.module===this.getModuleName()&&this.refreshToolbar()},n.prototype.refreshToolbar=function(){(0,o.isNullOrUndefined)(this.baseToolbar.toolbarObj)&&(this.baseToolbar=this.parent.getBaseToolbarObject());var e=(0,o.select)("."+Hn,this.parent.element);((0,o.select)("."+mn,this.parent.element)||e)&&this.destroyToolbar(),this.parent.toolbarSettings.enable&&(this.baseToolbar&&this.baseToolbar.toolbarObj&&!this.baseToolbar.toolbarObj.isDestroyed&&this.baseToolbar.destroy(),this.baseToolbar=new Ed(this.parent,this.locator),this.addEventListener(),this.renderToolbar(),this.parent.wireScrollElementsEvents(),(0,o.select)("."+So,this.parent.element)||this.parent.inlineMode.enable||Sr(this.baseToolbar,this.parent.formatter.editorManager.undoRedoManager.getUndoStatus()),this.parent.notify(kt,{}))},n.prototype.getModuleName=function(){return"toolbar"},n.prototype.renderColorPicker=function(e){this.colorPickerModule.renderColorPickerInput(e)},n}(),kd=function(){function t(t,n){this.parent=t,this.locator=n,this.isRendered=!1,this.isDestroyed=!1,this.renderFactory=this.locator.getService("rendererFactory"),this.contentRenderer=this.renderFactory.getRenderer(e.Content),this.popupRenderer=this.renderFactory.getRenderer(e.Popup),this.dropDownButtons=new Sd(this.parent,this.locator),this.colorPickerObj=new Od(this.parent,this.locator)}return t.prototype.appendPopupContent=function(){this.toolbarElement=this.parent.createElement("div",{className:Nn}),this.element.classList.contains(xn)&&this.toolbarElement.classList.add(En),this.element.appendChild(this.toolbarElement)},t.prototype.render=function(e){var t;t="Image"===e.popupType?kn:"Inline"===e.popupType?wn:"Text"===e.popupType?xn:"";var n=(0,o.getUniqueID)(e.popupType+"_Quick_Popup");this.stringItems=e.toolbarItems,this.element=this.parent.createElement("div",{id:n,className:t+" "+bi}),this.element.setAttribute("aria-owns",this.parent.getID()),this.appendPopupContent(),this.createToolbar(e.toolbarItems,e.mode,e.cssClass),this.popupRenderer.renderPopup(this),this.addEventListener()},t.prototype.createToolbar=function(e,t,n){this.quickTBarObj=new Ed(this.parent,this.locator),this.quickTBarObj.render({container:"quick",target:this.toolbarElement,items:e,mode:t,cssClass:n}),this.quickTBarObj.toolbarObj.refresh()},t.prototype.setPosition=function(e){var t,n,i,r,s=(0,o.closest)(e.target,".e-img-caption"),a=!!e.target.classList.contains("e-imginline");i=a&&!(0,o.isNullOrUndefined)(s)?s:e.target,(0,o.addClass)([this.toolbarElement],[Gn]);var l=!(0,o.isNullOrUndefined)(i.classList)&&["e-rte-image","e-rte-img-caption","e-clickelem","e-rte-audio","e-rte-video"].some((function(e){return i.classList.contains(e)}));if((0,o.isNullOrUndefined)((0,o.closest)(i,"table"))||i.classList.contains("e-multi-cells-select")||l)this.parent.iframeSettings.enable?(i.classList.contains("e-clickelem")&&(i=i.childNodes[0]),r=i.offsetTop):r=i.parentElement&&i.classList.contains("e-rte-audio")||i.parentElement.classList.contains("e-video-clickelem")?i.parentElement.offsetTop:i.offsetTop;else{r=i.offsetTop;for(var d=(0,o.closest)(i,"table");!(0,o.isNullOrUndefined)(d);)r+=d.offsetTop,d=(0,o.closest)(d.parentElement,"table")}var c,h=window.pageYOffset+e.parentData.top;if(n=r-e.editTop>e.popHeight?h+e.tBarElementHeight+(r-e.editTop)-e.popHeight-5:e.editTop+e.editHeight-(r+i.offsetHeight)>e.popHeight?h+e.tBarElementHeight+(r-e.editTop)+i.offsetHeight+5:e.y,(0,o.isNullOrUndefined)((0,o.closest)(i,"table"))||i.classList.contains("e-multi-cells-select")||l)c=this.parent.iframeSettings.enable?i.offsetLeft:i.parentElement&&i.classList.contains("e-rte-audio")||i.parentElement.classList.contains("e-video-clickelem")?i.parentElement.offsetLeft:i.offsetLeft;else{c=i.offsetLeft;for(d=(0,o.closest)(i.parentElement,"th, td");!(0,o.isNullOrUndefined)(d);)c+=d.offsetLeft,d=(0,o.closest)(d.parentElement,"table")}t=i.offsetWidth>e.popWidth?i.offsetWidth/2-e.popWidth/2+e.parentData.left+c:e.parentData.left+c,this.popupObj.position.X=t+e.popWidth>e.parentData.right?e.parentData.right-e.popWidth:t,this.popupObj.position.Y=n>=0?n:e.y+5,this.popupObj.dataBind(),(0,o.removeClass)([this.toolbarElement],[Gn])},t.prototype.checkCollision=function(e,t,n){var i,o,r=e.parentData.top,s=e.windowY+r+e.tBarElementHeight,a=[];a="document"===t?(0,Wr.isCollide)(e.popup):(0,Wr.isCollide)(e.popup,e.parentElement);for(var l=0;l<a.length;l++)switch(a[l]){case"top":o="document"===t?e.windowY:window.pageYOffset+r+e.tBarElementHeight;break;case"bottom":o="document"===t?"inline"===n||"text"===n?e.y-e.popHeight-10:e.windowHeight-(r+e.tBarElementHeight)>e.popHeight?s-e.windowHeight>e.popHeight?s+(e.windowHeight-r)-e.popHeight:s:e.windowY+(r+e.tBarElementHeight):"IMG"!==e.target.tagName?e.parentData.bottom+window.pageYOffset-e.popHeight-10:e.parentData.bottom+window.pageYOffset-e.popHeight-5;break;case"right":i="inline"===n||"text"===n?window.pageXOffset+(e.windowWidth-(e.popWidth+e.bodyRightSpace+10)):e.x-e.popWidth;break;case"left":i="inline"===n||"text"===n?0:e.parentData.left}this.popupObj.position.X=i||this.popupObj.position.X,this.popupObj.position.Y=o||this.popupObj.position.Y,this.popupObj.dataBind()},t.prototype.showPopup=function(e,t,n,i){var r=this,s={popup:this.popupObj,cancel:!1,targetElement:n,positionX:e,positionY:t};this.parent.trigger(it,s,(function(s){if(!s.cancel){var a,l=void 0,d=void 0,c=window.getComputedStyle(document.body),h=parseFloat(c.marginRight.split("px")[0])+parseFloat(c.paddingRight.split("px")[0]),p=window.innerHeight,u=window.innerWidth,m=r.parent.element,f=!(0,o.isNullOrUndefined)(r.parent.getToolbar()),g=f&&r.parent.toolbarModule.getToolbarHeight(),b=f&&r.parent.toolbarModule.getExpandTBarPopHeight(),v=f?g+b:0;if((0,o.addClass)([r.element],[Wn]),o.Browser.isDevice&&!fr()&&(0,o.addClass)([r.parent.getToolbar()],[Wn]),r.parent.iframeSettings.enable)l=(a=r.contentRenderer.getPanel().contentWindow).pageYOffset,d=a.innerHeight;else l=(a=(0,o.closest)(n,"."+In))?a.scrollTop:0,d=a?a.offsetHeight:0;var y=!(0,o.isNullOrUndefined)(n.classList)&&["e-rte-image","e-clickelem","e-rte-audio","e-rte-video"].some((function(e){return n.classList.contains(e)}));!r.parent.inlineMode.enable&&!(0,o.closest)(n,"table")&&"text"!==i&&"link"!==i||y?(r.parent.disableToolbarItem(r.parent.toolbarSettings.items),r.parent.enableToolbarItem(["Undo","Redo"])):r.parent.enableToolbarItem(r.parent.toolbarSettings.items),(0,o.append)([r.element],document.body),r.parent.showTooltip&&(r.tooltip=new Wr.Tooltip({target:"#"+r.element.id+" [title]",openDelay:400,showTipPointer:!0,beforeRender:r.tooltipBeforeRender.bind(r),windowCollision:!0,position:"BottomCenter",cssClass:r.parent.getCssClass()}),r.tooltip.appendTo(r.element)),r.popupObj.position.X=s.positionX+20,r.popupObj.position.Y=s.positionY+20,r.popupObj.dataBind(),r.popupObj.element.classList.add("e-popup-open"),r.dropDownButtons.renderDropDowns({container:r.toolbarElement,containerType:"quick",items:r.stringItems},s.targetElement),r.colorPickerObj.renderColorPickerInput({container:r.toolbarElement,containerType:"quick",items:r.stringItems});var C={x:e,y:t,target:n,editTop:l,editHeight:d,popup:r.popupObj.element,popHeight:r.popupObj.element.offsetHeight,popWidth:r.popupObj.element.offsetWidth,parentElement:m,bodyRightSpace:h,windowY:window.pageYOffset,windowHeight:p,windowWidth:u,parentData:m.getBoundingClientRect(),tBarElementHeight:v};!((0,o.closest)(n,"TABLE")||"IMG"===n.tagName||"AUDIO"===n.tagName||"VIDEO"===n.tagName||"IFRAME"===n.tagName||n.classList&&(n.classList.contains(ni)||n.classList.contains(ei)||n.classList.contains(ti)))||e!==s.positionX&&t!==s.positionY||r.setPosition(C),r.parent.inlineMode.enable&&!r.parent.iframeSettings.enable||r.checkCollision(C,"parent",""),r.checkCollision(C,"document",r.parent.inlineMode.enable?"inline":"text"===i?"text":""),r.popupObj.element.classList.remove("e-popup-open"),(0,o.removeClass)([r.element],[Wn]),r.popupObj.show({name:"ZoomIn",duration:o.Browser.isIE?250:400},n),r.popupObj&&r.parent.cssClass&&((0,o.removeClass)([r.popupObj.element],r.parent.cssClass.replace(/\s+/g," ").trim().split(" ")),(0,o.addClass)([r.popupObj.element],r.parent.cssClass.replace(/\s+/g," ").trim().split(" "))),(0,o.setStyleAttribute)(r.element,{maxWidth:window.outerWidth+"px"}),(0,o.addClass)([r.element],[Sn]),r.isRendered=!0}}))},t.prototype.tooltipBeforeRender=function(e){e.target.querySelector(".e-active")&&(e.cancel=!0,(0,o.isNullOrUndefined)(e.target.getAttribute("title"))||this.parent.notify($t,{target:e.target,isTitle:!0}))},t.prototype.hidePopup=function(){var e=!(0,o.isNullOrUndefined)(this.parent.rootContainer)&&this.parent.rootContainer.classList.contains("e-source-code-enabled");(o.Browser.isDevice&&!fr()&&(0,o.removeClass)([this.parent.getToolbar()],[Wn]),(0,o.isNullOrUndefined)(this.element.querySelectorAll("[data-title]")))||this.element.querySelectorAll("[data-title]").forEach((function(e){var t=new MouseEvent("mouseout",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}));if((0,o.isNullOrUndefined)(document.querySelector(".e-tooltip-wrap")))(0,o.isNullOrUndefined)(this.tooltip)||this.tooltip.destroy();else{if(!(0,o.isNullOrUndefined)(document.querySelector("#"+this.element.id+" [data-tooltip-id]"))){var t=document.querySelector("#"+this.element.id+" [data-tooltip-id]"),n=t.getAttribute("data-content");t.removeAttribute("data-content"),t.setAttribute("title",n),t.removeAttribute("data-tooltip-id")}this.tooltip.destroy()}(0,o.isNullOrUndefined)(this.parent.getToolbar())||this.parent.inlineMode.enable||e||this.parent.enableToolbarItem(this.parent.toolbarSettings.items),this.removeEleFromDOM(),this.isRendered=!1},t.prototype.addQTBarItem=function(e,t){this.quickTBarObj.toolbarObj.addItems(this.quickTBarObj.getItems(e,"toolbar"),t)},t.prototype.removeQTBarItem=function(e){this.quickTBarObj.toolbarObj.removeItems(e)},t.prototype.removeEleFromDOM=function(){var e=this.popupObj.element;if(this.isRendered){this.dropDownButtons.destroyDropDowns(),this.colorPickerObj.destroyColorPicker(),(0,o.removeClass)([this.element],[Sn]),(0,o.detach)(e);var t=this.popupObj;this.parent.trigger(rt,t)}},t.prototype.updateStatus=function(e){(yr({args:e,dropDownModule:this.dropDownButtons,parent:this.parent,tbElements:(0,o.selectAll)("."+Un,this.element),tbItems:this.quickTBarObj.toolbarObj.items},!0,this.parent),this.parent.quickToolbarSettings.text&&this.parent.quickToolbarModule.textQTBar)&&(yr({args:e,dropDownModule:this.parent.quickToolbarModule.textQTBar.dropDownButtons,parent:this.parent,tbElements:(0,o.selectAll)("."+Un,this.parent.quickToolbarModule.textQTBar.element),tbItems:this.parent.quickToolbarModule.textQTBar.quickTBarObj.toolbarObj.items},!0,this.parent),Sr(this.parent.quickToolbarModule.textQTBar.quickTBarObj,this.parent.formatter.editorManager.undoRedoManager.getUndoStatus()));(0,o.select)("."+So,this.parent.element)||Sr(this.parent.getBaseToolbarObject(),this.parent.formatter.editorManager.undoRedoManager.getUndoStatus())},t.prototype.destroy=function(){this.isDestroyed||(this.tooltip&&!this.tooltip.isDestroyed&&(this.tooltip.destroy(),this.tooltip=null),this.removeEventListener(),this.quickTBarObj.destroy(),this.quickTBarObj=null,this.popupObj&&!this.popupObj.isDestroyed&&(this.removeEleFromDOM(),this.popupObj.destroy()),this.colorPickerObj=null,this.dropDownButtons=null,this.stringItems=null,this.dropDownButtons=null,this.colorPickerObj=null,this.toolbarElement=null,this.isDestroyed=!0)},t.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(f,this.destroy,this),this.parent.on(T,this.onPropertyChanged,this),(this.parent.inlineMode.enable||this.parent.quickToolbarSettings.text)&&this.parent.on(C,this.updateStatus,this))},t.prototype.onPropertyChanged=function(e){if(!(0,o.isNullOrUndefined)(e.newProp.inlineMode))for(var t=0,n=Object.keys(e.newProp.inlineMode);t<n.length;t++){if("enable"===n[t])e.newProp.inlineMode.enable?this.parent.on(C,this.updateStatus,this):this.parent.off(C,this.updateStatus)}},t.prototype.removeEventListener=function(){this.parent.off(f,this.destroy),this.parent.off(T,this.onPropertyChanged),(this.parent.inlineMode.enable||this.parent.quickToolbarSettings.text)&&this.parent.off(C,this.updateStatus)},t}(),xd=function(){function t(t,n){this.debounceTimeout=1e3,this.escapeKeyPressed=!1,this.parent=t,this.locator=n,this.renderFactory=this.locator.getService("rendererFactory"),this.renderFactory.addRenderer(e.Popup,new kl(this.parent)),this.addEventListener(),this.isDestroyed=!1}return t.prototype.formatItems=function(e){var t=[];return e.forEach((function(e){if("string"==typeof e)switch(e.toLocaleLowerCase()){case"open":t.push("openLink");break;case"edit":t.push("editLink");break;case"unlink":t.push("removeLink");break;default:t.push(e)}else t.push(e)})),t},t.prototype.getQTBarOptions=function(e,t,n,i){return{popupType:e,toolbarItems:n,mode:t,renderType:i,cssClass:this.parent.getCssClass()}},t.prototype.createQTBar=function(e,t,n,i){if(n.length<1)return null;var o=new kd(this.parent,this.locator);return o.render(this.getQTBarOptions(e,t,this.formatItems(n),i)),o},t.prototype.initializeQuickToolbars=function(){this.parent.quickToolbarModule=this,this.contentRenderer=this.renderFactory.getRenderer(e.Content),this.parent.inlineMode.enable&&this.parent.inlineMode.onSelection&&fr()&&o.EventHandler.add(this.contentRenderer.getDocument(),"selectionchange",this.selectionChangeHandler,this)},t.prototype.onMouseDown=function(e){this.parent.isBlur=!1,this.parent.isRTE=!0},t.prototype.keyUpQT=function(e){27===e.which&&this.hideQuickToolbars()},t.prototype.renderQuickToolbars=function(){this.linkQTBar||this.imageQTBar||this.audioQTBar||this.videoQTBar||this.textQTBar||this.tableQTBar||(this.linkQTBar=this.createQTBar("Link","Scrollable",this.parent.quickToolbarSettings.link,e.LinkToolbar),this.renderFactory.addRenderer(e.LinkToolbar,this.linkQTBar),(0,o.isNullOrUndefined)(this.parent.quickToolbarSettings.text)||this.parent.inlineMode.enable||(this.textQTBar=this.createQTBar("Text","MultiRow",this.parent.quickToolbarSettings.text,e.TextToolbar),this.renderFactory.addRenderer(e.TextToolbar,this.textQTBar)),this.imageQTBar=this.createQTBar("Image","MultiRow",this.parent.quickToolbarSettings.image,e.ImageToolbar),this.renderFactory.addRenderer(e.ImageToolbar,this.imageQTBar),this.audioQTBar=this.createQTBar("Audio","MultiRow",this.parent.quickToolbarSettings.audio,e.AudioToolbar),this.renderFactory.addRenderer(e.AudioToolbar,this.audioQTBar),this.videoQTBar=this.createQTBar("Video","MultiRow",this.parent.quickToolbarSettings.video,e.VideoToolbar),this.renderFactory.addRenderer(e.VideoToolbar,this.videoQTBar),this.tableQTBar=this.createQTBar("Table","MultiRow",this.parent.quickToolbarSettings.table,e.TableToolbar),this.renderFactory.addRenderer(e.TableToolbar,this.tableQTBar),this.linkQTBar&&(o.EventHandler.add(this.linkQTBar.element,"mousedown",this.onMouseDown,this),o.EventHandler.add(this.linkQTBar.element,"keyup",this.keyUpQT,this)),this.imageQTBar&&(o.EventHandler.add(this.imageQTBar.element,"mousedown",this.onMouseDown,this),o.EventHandler.add(this.imageQTBar.element,"keyup",this.keyUpQT,this)),this.audioQTBar&&(o.EventHandler.add(this.audioQTBar.element,"mousedown",this.onMouseDown,this),o.EventHandler.add(this.audioQTBar.element,"keyup",this.keyUpQT,this)),this.videoQTBar&&(o.EventHandler.add(this.videoQTBar.element,"mousedown",this.onMouseDown,this),o.EventHandler.add(this.videoQTBar.element,"keyup",this.keyUpQT,this)),this.textQTBar&&(o.EventHandler.add(this.textQTBar.element,"mousedown",this.onMouseDown,this),o.EventHandler.add(this.textQTBar.element,"keyup",this.keyUpQT,this)),this.tableQTBar&&(o.EventHandler.add(this.tableQTBar.element,"mousedown",this.onMouseDown,this),o.EventHandler.add(this.tableQTBar.element,"keyup",this.keyUpQT,this)))},t.prototype.renderInlineQuickToolbar=function(){!this.parent.inlineMode.enable||o.Browser.isDevice&&!fr()||((0,o.addClass)([this.parent.element],[bn]),this.inlineQTBar=this.createQTBar("Inline","MultiRow",this.parent.toolbarSettings.items,e.InlineToolbar),this.renderFactory.addRenderer(e.InlineToolbar,this.inlineQTBar),o.EventHandler.add(this.inlineQTBar.element,"mousedown",this.onMouseDown,this),o.EventHandler.add(this.inlineQTBar.element,"keyup",this.keyUpQT,this))},t.prototype.showInlineQTBar=function(e,t,n){(0,o.isNullOrUndefined)(this.parent)||this.parent.readonly||"img"===n.tagName.toLowerCase()||this.inlineQTBar.element.querySelector(".e-rte-color-content")||this.inlineQTBar.showPopup(e,t,n)},t.prototype.hideInlineQTBar=function(){this.inlineQTBar&&!ur(this.inlineQTBar.element,"e-popup-close")&&this.inlineQTBar.hidePopup(),this.escapeKeyPressed=!1},t.prototype.hideQuickToolbars=function(){this.linkQTBar&&!ur(this.linkQTBar.element,"e-popup-close")&&document.body.contains(this.linkQTBar.element)&&this.linkQTBar.hidePopup(),!this.escapeKeyPressed&&this.textQTBar&&!ur(this.textQTBar.element,"e-popup-close")&&document.body.contains(this.textQTBar.element)&&this.textQTBar.hidePopup(),!this.escapeKeyPressed&&this.imageQTBar&&!ur(this.imageQTBar.element,"e-popup-close")&&document.body.contains(this.imageQTBar.element)&&this.imageQTBar.hidePopup(),!this.escapeKeyPressed&&this.audioQTBar&&!ur(this.audioQTBar.element,"e-popup-close")&&document.body.contains(this.audioQTBar.element)&&this.audioQTBar.hidePopup(),!this.escapeKeyPressed&&this.videoQTBar&&!ur(this.videoQTBar.element,"e-popup-close")&&document.body.contains(this.videoQTBar.element)&&this.videoQTBar.hidePopup(),!this.escapeKeyPressed&&this.tableQTBar&&!ur(this.tableQTBar.element,"e-popup-close")&&document.body.contains(this.tableQTBar.element)&&this.tableQTBar.hidePopup(),(0,o.isNullOrUndefined)(this.parent)||!this.parent.inlineMode.enable||o.Browser.isDevice&&!fr()||this.hideInlineQTBar(),this.escapeKeyPressed=!1},t.prototype.deBounce=function(e,t,n){var i=this;clearTimeout(this.deBouncer),this.deBouncer=window.setTimeout((function(){i.showInlineQTBar(e,t,n)}),this.debounceTimeout)},t.prototype.mouseUpHandler=function(e){if(this.parent.inlineMode.enable&&(!o.Browser.isDevice||fr())){var t=e.args.touches?e.args.changedTouches[0]:e.args,n=this.parent.getRange(),i=e.args.target;if((0,o.isNullOrUndefined)((0,o.select)("."+wn,document.body))){if(fr()&&e.touchData&&e.touchData.prevClientX!==e.touchData.clientX&&e.touchData.prevClientY!==e.touchData.clientY)return;this.hideInlineQTBar();var r=this.parent.element.getBoundingClientRect().left;if(this.offsetX=this.parent.iframeSettings.enable?window.pageXOffset+r+t.clientX:t.pageX,this.offsetY=br(t,this.parent.element,this.parent.iframeSettings.enable),"TEXTAREA"===i.nodeName)this.showInlineQTBar(this.offsetX,this.offsetY,i);else{var s=(0,o.closest)(i,"a");i=s||i;var a=this.parent.getRange().startContainer.parentElement,l=this.parent.getRange().endContainer.parentElement;if(((0,o.isNullOrUndefined)((0,o.closest)(a,"A"))||(0,o.isNullOrUndefined)((0,o.closest)(l,"A")))&&(!(0,o.closest)(i,"td,th")||!n.collapsed)&&("IMG"!==i.tagName||this.parent.getRange().startOffset!==this.parent.getRange().endOffset)){var d=n.startOffset===n.endOffset&&n.startContainer===n.endContainer;if(this.parent.inlineMode.onSelection&&d||!this.parent.inlineMode.onSelection&&!d)return;this.target=i,this.showInlineQTBar(this.offsetX,this.offsetY,i)}}}}if(!(0,o.isNullOrUndefined)(this.textQTBar)&&!(0,o.isNullOrUndefined)(this.parent.quickToolbarSettings.text)&&!this.parent.inlineMode.enable){if(!(0,o.isNullOrUndefined)(e)&&!(0,o.isNullOrUndefined)(e.name)&&"sourceCodeMouseDown"===e.name)return;t=e.args.touches?e.args.changedTouches[0]:e.args,i=e.args.target;this.hideQuickToolbars();r=this.parent.element.getBoundingClientRect().left;if(this.offsetX=this.parent.iframeSettings.enable?this.parent.element.ownerDocument.documentElement.scrollLeft+r+t.clientX:t.pageX,this.offsetY=br(t,this.parent.element,this.parent.iframeSettings.enable),(n=this.parent.getRange()).endContainer.parentElement.tagName===n.startContainer.parentElement.tagName&&"A"===n.startContainer.parentElement.tagName&&"A"===n.endContainer.parentElement.tagName||"IMG"===i.tagName||"VIDEO"===i.tagName||this.isEmbedVidElem(i)||"AUDIO"===i.tagName||i.childNodes[0]&&1===i.childNodes[0].nodeType&&i.childNodes[0].classList.contains("e-rte-audio")||this.parent.getRange().startOffset===this.parent.getRange().endOffset)return;this.target=i,this.textQTBar.showPopup(this.offsetX,this.offsetY,i,"text")}},t.prototype.isEmbedVidElem=function(e){return!!(e&&3!==e.nodeType&&"BR"!==e.nodeName&&e.classList&&e.classList.contains(ti)||e&&"IFRAME"===e.nodeName)},t.prototype.keyDownHandler=function(e){var t=e.args.altKey;this.parent.inlineMode.enable&&e.args.metaKey&&65===e.args.keyCode?this.showInlineQTBar(this.offsetX,this.offsetY,e.args.target):t||(!this.parent.inlineMode.enable||o.Browser.isDevice&&!fr()||(0,o.isNullOrUndefined)((0,o.select)("."+wn,document))||this.hideInlineQTBar(),this.textQTBar&&!ur(this.textQTBar.element,"e-popup-close")&&this.textQTBar.hidePopup())},t.prototype.inlineQTBarMouseDownHandler=function(){!this.parent.inlineMode.enable||o.Browser.isDevice&&!fr()||(0,o.isNullOrUndefined)((0,o.select)("."+wn,document))||this.hideInlineQTBar(),(0,o.isNullOrUndefined)(this.parent.quickToolbarSettings.text)||this.textQTBar&&!ur(this.textQTBar.element,"e-popup-close")&&document.body.contains(this.textQTBar.element)&&this.textQTBar.hidePopup()},t.prototype.keyUpHandler=function(e){var t=e.args;if(this.parent.inlineMode.enable&&!o.Browser.isDevice){if(this.parent.inlineMode.onSelection)return void(this.parent.getSelection().length>0&&(t.ctrlKey&&65===t.keyCode||t.shiftKey&&(33===t.keyCode||34===t.keyCode||35===t.keyCode||36===t.keyCode||37===t.keyCode||38===t.keyCode||39===t.keyCode||40===t.keyCode))&&this.showInlineQTBar(this.offsetX,this.offsetY,t.target));this.deBounce(this.offsetX,this.offsetY,t.target)}this.parent.quickToolbarSettings.text&&!o.Browser.isDevice&&(t.ctrlKey&&65===t.keyCode||t.shiftKey&&(33===t.keyCode||34===t.keyCode||35===t.keyCode||36===t.keyCode||37===t.keyCode||38===t.keyCode||39===t.keyCode||40===t.keyCode))&&this.textQTBar.showPopup(this.offsetX,this.offsetY,t.target,"text")},t.prototype.selectionChangeHandler=function(e){var t=this;clearTimeout(this.deBouncer),this.deBouncer=window.setTimeout((function(){t.onSelectionChange(e)}),this.debounceTimeout)},t.prototype.onSelectionChange=function(e){(0,o.isNullOrUndefined)((0,o.select)("."+wn,document.body))&&(this.contentRenderer.getDocument().getSelection().isCollapsed||this.mouseUpHandler({args:e}))},t.prototype.getInlineBaseToolbar=function(){return this.inlineQTBar&&this.inlineQTBar.quickTBarObj},t.prototype.destroy=function(){this.isDestroyed||(this.linkQTBar&&!this.linkQTBar.isDestroyed&&(o.EventHandler.remove(this.linkQTBar.element,"mousedown",this.onMouseDown),o.EventHandler.remove(this.linkQTBar.element,"keyup",this.keyUpQT),this.linkQTBar.destroy()),this.textQTBar&&!this.textQTBar.isDestroyed&&(o.EventHandler.remove(this.textQTBar.element,"mousedown",this.onMouseDown),o.EventHandler.remove(this.textQTBar.element,"keyup",this.keyUpQT),this.textQTBar.destroy()),this.imageQTBar&&!this.imageQTBar.isDestroyed&&(o.EventHandler.remove(this.imageQTBar.element,"mousedown",this.onMouseDown),o.EventHandler.remove(this.imageQTBar.element,"keyup",this.keyUpQT),this.imageQTBar.destroy()),this.audioQTBar&&!this.audioQTBar.isDestroyed&&(o.EventHandler.remove(this.audioQTBar.element,"mousedown",this.onMouseDown),o.EventHandler.remove(this.audioQTBar.element,"keyup",this.keyUpQT),this.audioQTBar.destroy()),this.videoQTBar&&!this.videoQTBar.isDestroyed&&(o.EventHandler.remove(this.videoQTBar.element,"mousedown",this.onMouseDown),o.EventHandler.remove(this.videoQTBar.element,"keyup",this.keyUpQT),this.videoQTBar.destroy()),this.tableQTBar&&!this.tableQTBar.isDestroyed&&(o.EventHandler.remove(this.tableQTBar.element,"mousedown",this.onMouseDown),o.EventHandler.remove(this.tableQTBar.element,"keyup",this.keyUpQT),this.tableQTBar.destroy()),this.inlineQTBar&&!this.inlineQTBar.isDestroyed&&(o.EventHandler.remove(this.inlineQTBar.element,"mousedown",this.onMouseDown),o.EventHandler.remove(this.inlineQTBar.element,"keyup",this.keyUpQT),fr()&&o.EventHandler.remove(document,"selectionchange",this.selectionChangeHandler),this.inlineQTBar.destroy()),this.removeEventListener(),this.isDestroyed=!0)},t.prototype.wireInlineQTBarEvents=function(){this.parent.on(D,this.mouseUpHandler,this),this.parent.on(De,this.inlineQTBarMouseDownHandler,this),this.parent.on(k,this.keyDownHandler,this),this.parent.on(L,this.keyUpHandler,this),this.parent.on(Me,this.mouseUpHandler,this),this.parent.on(Fe,this.renderInlineQuickToolbar,this)},t.prototype.unWireInlineQTBarEvents=function(){this.parent.off(D,this.mouseUpHandler),this.parent.off(De,this.inlineQTBarMouseDownHandler),this.parent.off(k,this.keyDownHandler),this.parent.off(L,this.keyUpHandler),this.parent.off(Me,this.mouseUpHandler),this.parent.off(Fe,this.renderInlineQuickToolbar)},t.prototype.toolbarUpdated=function(e){this.linkQTBar&&!ur(this.linkQTBar.element,"e-popup-close")&&this.linkQTBar.hidePopup(),this.escapeKeyPressed||!this.imageQTBar||ur(this.imageQTBar.element,"e-popup-close")||this.imageQTBar.hidePopup(),this.escapeKeyPressed||!this.audioQTBar||ur(this.audioQTBar.element,"e-popup-close")||this.audioQTBar.hidePopup(),this.escapeKeyPressed||!this.videoQTBar||ur(this.videoQTBar.element,"e-popup-close")||this.videoQTBar.hidePopup(),this.escapeKeyPressed||!this.tableQTBar||ur(this.tableQTBar.element,"e-popup-close")||this.tableQTBar.hidePopup(),this.escapeKeyPressed=!1},t.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(u,this.initializeQuickToolbars,this),this.parent.on(De,this.renderQuickToolbars,this),this.parent.on(C,this.toolbarUpdated,this),this.parent.on(yt,this.renderQuickToolbars,this),this.wireInlineQTBarEvents(),this.parent.on(T,this.onPropertyChanged,this),"hide"===this.parent.quickToolbarSettings.actionOnScroll&&(this.parent.on(Be,this.hideQuickToolbars,this),this.parent.on(Re,this.hideQuickToolbars,this)),this.parent.on(Ue,this.hideQuickToolbars,this),this.parent.on(m,this.onIframeMouseDown,this),this.parent.on(f,this.destroy,this),this.parent.on(k,this.onKeyDown,this),this.parent.on(_e,this.setRtl,this),this.parent.on(qt,this.setCssClass,this),this.parent.on(Qt,this.hideQuickToolbars,this),this.parent.on(Ct,this.renderQuickToolbars,this),this.parent.on(sn,this.preventQuickToolbarClose,this))},t.prototype.preventQuickToolbarClose=function(e){var t=this.parent.getID(),n=[t+"_quick_Display-popup",t+"_quick_Align-popup",t+"_quick_VideoLayoutOption-popup",t+"_quick_VideoAlign-popup",t+"_quick_TableRows-popup",t+"_quick_TableColumns-popup",t+"_quick_TableCell-popup",t+"_quick_TableCellVerticalAlign-popup",t+"_quick_Styles-popup",t+"_quick_Alignments-popup",t+"_quick_BackgroundColor-popup",t+"_quick_AudioLayoutOption-popup",t+"_quick_FontSize-popup",t+"_quick_FontName-popup",t+"_quick_FontColor-popup",t+"_quick_BackgroundColor-popup",t+"_quick_Formats-popup",t+"_quick_Alignments-popup",t+"_quick_NumberFormatList-popup",t+"_quick_BulletFormatList-popup"];!(0,o.isNullOrUndefined)(e.element)&&!(0,o.isNullOrUndefined)(e.element.parentElement)&&n.indexOf(e.element.parentElement.id)>-1&&(this.escapeKeyPressed=!0)},t.prototype.onKeyDown=function(e){var t=e.args;8!==t.which&&46!==t.which||(this.imageQTBar&&!ur(this.imageQTBar.element,"e-popup-close")&&this.imageQTBar.hidePopup(),this.audioQTBar&&!ur(this.audioQTBar.element,"e-popup-close")&&this.audioQTBar.hidePopup(),this.videoQTBar&&!ur(this.videoQTBar.element,"e-popup-close")&&this.videoQTBar.hidePopup(),this.tableQTBar&&!ur(this.tableQTBar.element,"e-popup-close")&&this.tableQTBar.hidePopup(),this.linkQTBar&&!ur(this.linkQTBar.element,"e-popup-close")&&this.linkQTBar.hidePopup(),this.textQTBar&&!ur(this.textQTBar.element,"e-popup-close")&&this.textQTBar.hidePopup())},t.prototype.onIframeMouseDown=function(){this.hideQuickToolbars(),this.hideInlineQTBar()},t.prototype.updateCss=function(e,t){e&&t.cssClass&&((0,o.isNullOrUndefined)(t.oldCssClass&&e.quickTBarObj.toolbarObj.cssClass!==t.cssClass)?e.quickTBarObj.toolbarObj.setProperties({cssClass:(e.quickTBarObj.toolbarObj.cssClass+" "+t.cssClass).trim()}):e.quickTBarObj.toolbarObj.setProperties({cssClass:(e.quickTBarObj.toolbarObj.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},t.prototype.setCssClass=function(e){for(var t=[this.inlineQTBar,this.imageQTBar,this.linkQTBar,this.textQTBar,this.tableQTBar],n=0;n<t.length;n++)this.updateCss(t[n],e)},t.prototype.setRtl=function(e){this.inlineQTBar&&this.inlineQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.imageQTBar&&this.imageQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.audioQTBar&&this.audioQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.videoQTBar&&this.videoQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.linkQTBar&&this.linkQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl}),this.textQTBar&&this.textQTBar.quickTBarObj.toolbarObj.setProperties({enableRtl:e.enableRtl})},t.prototype.removeEventListener=function(){this.deBouncer&&(clearTimeout(this.deBouncer),this.deBouncer=null),this.parent.off(u,this.initializeQuickToolbars),this.parent.off(De,this.renderQuickToolbars),this.parent.off(C,this.toolbarUpdated),this.parent.off(yt,this.renderQuickToolbars),this.unWireInlineQTBarEvents(),this.parent.off(T,this.onPropertyChanged),"hide"===this.parent.quickToolbarSettings.actionOnScroll&&(this.parent.off(Be,this.hideQuickToolbars),this.parent.off(Re,this.hideQuickToolbars)),this.parent.off(Ue,this.hideQuickToolbars),this.parent.off(f,this.destroy),this.parent.off(m,this.onIframeMouseDown),this.parent.off(k,this.onKeyDown),this.parent.off(_e,this.setRtl),this.parent.off(qt,this.setCssClass),this.parent.off(Qt,this.hideQuickToolbars),this.parent.off(Ct,this.renderQuickToolbars),this.parent.off(sn,this.preventQuickToolbarClose)},t.prototype.onPropertyChanged=function(e){if(!(0,o.isNullOrUndefined)(e.newProp.quickToolbarSettings))for(var t=0,n=Object.keys(e.newProp.quickToolbarSettings);t<n.length;t++){if("actionOnScroll"===n[t])"none"===e.newProp.quickToolbarSettings.actionOnScroll?(this.parent.off(Be,this.hideQuickToolbars),this.parent.off(Re,this.hideQuickToolbars)):(this.parent.on(Be,this.hideQuickToolbars,this),this.parent.on(Re,this.hideQuickToolbars,this))}e.module===this.getModuleName()&&(this.inlineQTBar&&((0,o.removeClass)([this.parent.element],[bn]),this.unWireInlineQTBarEvents(),this.hideInlineQTBar()),!this.parent.inlineMode.enable||o.Browser.isDevice&&!fr()||((0,o.addClass)([this.parent.element],[bn]),this.wireInlineQTBarEvents()))},t.prototype.getModuleName=function(){return"quickToolbar"},t.prototype.getQuickToolbarInstance=function(){return[this.linkQTBar,this.imageQTBar,this.audioQTBar,this.videoQTBar,this.tableQTBar,this.textQTBar,this.inlineQTBar]},t}(),wd=function(){function t(e,t){this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.isDestroyed=!1}return t.prototype.initializeInstance=function(){this.contentRenderer=this.renderFactory.getRenderer(e.Content),this.editPanel=this.contentRenderer.getEditPanel(),this.addEventListener()},t.prototype.renderCount=function(){this.initializeInstance(),this.element=this.parent.createElement("span",{className:hi}),this.parent.rootContainer.appendChild(this.element),this.parent.rootContainer.classList.add("e-count-enabled"),this.parent.iframeSettings.enable&&this.parent.inputElement.classList.add("e-count-enabled"),this.appendCount(),-1!==this.parent.maxLength&&this.charCountBackground(this.htmlLength)},t.prototype.appendCount=function(){var e="Markdown"===this.parent.editorMode?this.editPanel.value:this.parent.getText().replace(/(\r\n|\n|\r|\t)/gm,"");"Markdown"!==this.parent.editorMode&&-1!==e.indexOf("​")?this.htmlLength=e.replace(/\u200B/g,"").length:this.htmlLength=e.length;var t=-1===this.parent.maxLength?this.htmlLength:this.htmlLength+" / "+this.parent.maxLength;this.element.innerHTML=t},t.prototype.charCountBackground=function(e){var t=e/this.parent.maxLength*100;t<85?(this.element.classList.remove(pi),this.element.classList.remove(ui)):t>85&&t<=90?(this.element.classList.remove(ui),this.element.classList.add(pi)):t>90&&(this.element.classList.remove(pi),this.element.classList.add(ui))},t.prototype.refresh=function(){(0,o.isNullOrUndefined)(this.editPanel)||(this.appendCount(),-1!==this.parent.maxLength&&this.charCountBackground(this.htmlLength))},t.prototype.destroy=function(){this.isDestroyed||(this.parent&&this.parent.rootContainer&&this.parent.rootContainer.classList.contains("e-count-enabled")&&this.parent.rootContainer.classList.remove("e-count-enabled"),this.parent.iframeSettings.enable&&!(0,o.isNullOrUndefined)(this.parent.inputElement)&&this.parent.inputElement.classList.remove("e-count-enabled"),this.element&&!(0,o.isNullOrUndefined)(this.parent.element.querySelector("."+hi))&&(0,o.detach)(this.element),this.removeEventListener(),this.editPanel&&(this.editPanel=null),this.element&&((0,o.detach)(this.element),this.element=null),this.isDestroyed=!0)},t.prototype.toggle=function(e){this.element.style.display="viewSource"===e.member?"none":"block"},t.prototype.addEventListener=function(){this.parent.on(u,this.renderCount,this),this.parent.on(L,this.refresh,this),this.parent.on(ke,this.refresh,this),this.parent.on(y,this.refresh,this),this.parent.on(De,this.refresh,this),this.parent.on(f,this.destroy,this),this.parent.on(Ce,this.toggle,this),this.parent.on(Ne,this.toggle,this)},t.prototype.removeEventListener=function(){this.parent.off(u,this.renderCount),this.parent.off(L,this.refresh),this.parent.off(y,this.refresh),this.parent.off(ke,this.refresh),this.parent.off(De,this.refresh),this.parent.off(f,this.destroy),this.parent.off(Ce,this.toggle),this.parent.off(Ne,this.toggle)},t.prototype.getModuleName=function(){return"count"},t}(),Dd=function(){function e(){}return e.prototype.getLineNumber=function(e,t){return e.value.substr(0,t).split("\n").length},e.prototype.getSelectedText=function(e){var t=e.selectionStart,n=e.selectionEnd;return e.value.substring(t,n)},e.prototype.getAllParents=function(e){return e.split("\n")},e.prototype.getSelectedLine=function(e){return this.getAllParents(e.value)[this.getLineNumber(e,e.selectionStart)-1]},e.prototype.getLine=function(e,t){return this.getAllParents(e.value)[t]},e.prototype.getSelectedParentPoints=function(e){var t=this.getAllParents(e.value),n=this.getLineNumber(e,e.selectionStart),i=this.getLineNumber(e,e.selectionEnd),o=this.getSelectedText(e).split("\n"),r=[],s=t[n-1],a=t.slice(0,n-1).join("").length,l={};if(l.line=n-1,l.start=a+l.line,l.end=""!==s?l.start+s.length+1:l.start+s.length,l.text=s,r.push(l),o.length>1){for(var d=1;d<o.length-1;d++){var c={};c.line=r[d-1].line+1,c.start=(o[d],r[d-1].end),c.end=c.start+o[d].length+1,c.text=o[d],r.push(c)}var h={};h.line=r[r.length-1].line+1,h.start=r[r.length-1].end,h.end=h.start+t[i-1].length+1,h.text=t[i-1],r.push(h)}return r},e.prototype.setSelection=function(e,t,n){e.setSelectionRange(t,n),e.focus()},e.prototype.save=function(e,t){this.selectionStart=e,this.selectionEnd=t},e.prototype.restore=function(e){this.setSelection(e,this.selectionStart,this.selectionEnd)},e.prototype.isStartWith=function(e,t){var n=!1,i=RegExp;e&&(n=(e.trim()===t.trim()?new i("^("+this.replaceSpecialChar(t.trim())+")","gim"):new i("^("+this.replaceSpecialChar(t)+")","gim")).test(e.trim()));return n},e.prototype.replaceSpecialChar=function(e){return e.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/g,"\\$&")},e.prototype.isClear=function(e,t){for(var n=RegExp,i=0;i<e.length;i++)if(new n(t,"gim").test(e[i].text))return!0;return!1},e.prototype.getSelectedInlinePoints=function(e){return{start:e.selectionStart,end:e.selectionEnd,text:this.getSelectedText(e)}},e}(),Md=function(){function e(e){this.toolbarStatus=this.prevToolbarStatus={bold:!1,italic:!1,subscript:!1,superscript:!1,strikethrough:!1,orderedlist:!1,uppercase:!1,lowercase:!1,inlinecode:!1,unorderedlist:!1,formats:null},this.selection=new Dd,this.parent=e,this.element=this.parent.contentModule.getEditPanel(),this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(b,this.onRefreshHandler,this),this.parent.on(f,this.removeEventListener,this)},e.prototype.removeEventListener=function(){this.parent.off(b,this.onRefreshHandler),this.parent.off(f,this.removeEventListener)},e.prototype.onRefreshHandler=function(e){var t=this.selection.getSelectedParentPoints(this.element);this.toolbarStatus={orderedlist:!e.documentNode&&this.isListsApplied(t,"OL"),unorderedlist:!e.documentNode&&this.isListsApplied(t,"UL"),formats:this.currentFormat(t,e.documentNode),bold:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("Bold"),italic:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("Italic"),inlinecode:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("InlineCode"),strikethrough:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("StrikeThrough"),subscript:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("SubScript"),superscript:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("SuperScript"),uppercase:!e.documentNode&&this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("UpperCase")},this.parent.formatter.editorManager.mdSelectionFormats.isAppliedCommand("InlineCode")&&(this.toolbarStatus.formats="pre");var n=JSON.stringify(this.toolbarStatus);this.parent.notify(C,this.toolbarStatus),JSON.stringify(this.prevToolbarStatus)!==n&&(this.parent.notify(Dt,{html:null,markdown:JSON.parse(n)}),this.prevToolbarStatus=JSON.parse(n))},e.prototype.isListsApplied=function(e,t){var n=!0;if("OL"===t)for(var i=0;i<e.length;i++){var o=e[i].text.trim().split(" ",2)[0]+" ";if(!/^[\d.]+[ ]+$/.test(o)){n=!1;break}}else for(i=0;i<e.length;i++)if(!this.selection.isStartWith(e[i].text,this.parent.formatter.listTags[""+t])){n=!1;break}return n},e.prototype.currentFormat=function(e,t){for(var n="p",i=Object.keys(this.parent.formatter.formatTags),o="backward"===this.element.selectionDirection?e[0].text:e[e.length-1].text,r=0;!t&&r<i.length;r++){if("pre"!==i[r]&&this.selection.isStartWith(o,this.parent.formatter.formatTags[i[r]])){n=i[r];break}if("pre"===i[r]&&this.codeFormat()){n=i[r];break}}return n},e.prototype.codeFormat=function(){var e,t=!1,n=this.parent.inputElement,i=n.selectionStart,o=(e=i,function(t){return[t.slice(0,e),t.slice(e)]})(n.value),r=this.parent.formatter.formatTags.pre,s=this.getSelectedText(n);if(""!==s&&s===s.toLocaleUpperCase())return!0;if(""===s){var a=n.value.substr(o[0].length-1,1),l=o[1].substr(0,1);if(""!==a&&""!==l&&a.match(/[a-z]/i)&&a===a.toLocaleUpperCase()&&l===l.toLocaleUpperCase())return!0}return this.isCode(o[0],r)&&this.isCode(o[1],r)&&o[0].match(this.multiCharRegx(r)).length%2==1&&o[1].match(this.multiCharRegx(r)).length%2==1&&(t=!0),t},e.prototype.getSelectedText=function(e){return e.value.substring(e.selectionStart,e.selectionEnd)},e.prototype.isCode=function(e,t){return-1!==e.search("\\"+t)},e.prototype.multiCharRegx=function(e){return new RegExp("(\\"+e+")","g")},e}(),Ad=function(){function e(){}return e.prototype.process=function(e,t,n,i){var r,s,a=this,l=e.contentModule.getDocument().getSelection(),d=l.rangeCount>0?l.getRangeAt(l.rangeCount-1):null;(0,o.isNullOrUndefined)(i)||(0,o.isNullOrUndefined)(i.selection)||(s=i.selection.range);var c=!(0,o.isNullOrUndefined)(i)&&!(0,o.isNullOrUndefined)(i.cssClass)&&"e-video-inline"!==i.cssClass;if("HTML"===e.editorMode&&((0,o.isNullOrUndefined)(t)||c||((0,o.isNullOrUndefined)(t.name)||!(0,o.isNullOrUndefined)(t.name)&&"showDialog"!==t.name&&!(0,o.isNullOrUndefined)(t.item.command))&&(r=s?this.editorManager.nodeSelection.save(s,e.contentModule.getDocument()):this.editorManager.nodeSelection.save(d,e.contentModule.getDocument()))),(0,o.isNullOrUndefined)(t)||!t.item.command||"Table"===t.item.command||"Actions"===t.item.command||"Links"===t.item.command||"Images"===t.item.command||"Files"===t.item.command||"Audios"===t.item.command||"Videos"===t.item.command||"EmojiPicker"===t.item.command||!d||e.contentModule.getEditPanel().contains(this.getAncestorNode(d.commonAncestorContainer))||e.contentModule.getEditPanel()===d.commonAncestorContainer||e.contentModule.getPanel()===d.commonAncestorContainer){if(!(0,o.isNullOrUndefined)(t)&&-1!==e.maxLength&&!(0,o.isNullOrUndefined)(t.item.command)){var h=0;"Links"===t.item.command&&(h=0===i.text.length?i.url.length:i.text.length),"Images"!==t.item.command&&"Videos"!==t.item.command&&"Table"!==t.item.command&&"Files"!==t.item.command||(h=1);var p=e.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length-e.getSelection().length+h;if(!(-1===e.maxLength||p<=e.maxLength))return}if((0,o.isNullOrUndefined)(t)){var u=n.action;t={};var m={originalEvent:n,cancel:!1,requestType:u||n.key+"Key",itemCollection:i};if((0,o.extend)(t,t,m,!0),"tab"!==u&&"enter"!==u&&"space"!==u&&"escape"!==u&&("Markdown"===e.editorMode&&"insert-table"===u&&(i={headingText:e.localeObj.getConstant("TableHeadingText"),colText:e.localeObj.getConstant("TableColText")}),e.trigger($,t,(function(e){e.cancel&&("paste"!==u&&"cut"!==u&&"copy"!==u||n.preventDefault())}))),!t.cancel){var f=!!(0,o.isNullOrUndefined)(e.tableModule)||!!e.tableModule&&e.tableModule.ensureInsideTableList;(9===n.which&&f||9!==n.which)&&(13===n.which&&"HTML"===e.editorMode&&(i={enterAction:e.enterKey}),this.editorManager.observer.notify("keydown"===n.type?Ws:Js,{event:n,callBack:this.onSuccess.bind(this,e),value:i,enterAction:e.enterKey,enableTabKey:e.enableTabKey}))}}else(0,o.isNullOrUndefined)(t)||!t.item.command||!t.item.subCommand||(t.item.command===t.item.subCommand||"Font"===t.item.command||"Export"===t.item.command)&&("FontName"!==t.item.subCommand&&"FontSize"!==t.item.subCommand||"dropDownSelect"!==t.name)&&("BackgroundColor"!==t.item.subCommand&&"FontColor"!==t.item.subCommand||"colorPickerChanged"!==t.name&&"tableColorPickerChanged"!==t.name)&&"FormatPainter"!==t.item.subCommand&&"EmojiPicker"!==t.item.subCommand||((0,o.extend)(t,t,{requestType:t.item.subCommand,cancel:!1,itemCollection:i,selectType:t.name},!0),e.trigger($,t,(function(s){if(!s.cancel){var l=!(0,o.isNullOrUndefined)(s.requestType)&&"FormatPainter"===s.requestType&&"format-copy"===s.name,d=!(0,o.isNullOrUndefined)(s.requestType)&&"FormatPainter"===s.requestType&&"format-paste"===s.name;(0===a.getUndoRedoStack().length&&"Links"!==s.item.command&&"Images"!==s.item.command&&!l||d)&&a.saveData(),e.isBlur=!1;var h=!((0,o.isNullOrUndefined)(n)||(0,o.isNullOrUndefined)(n.target)||(0,o.isNullOrUndefined)((0,o.closest)(n.target,".e-rte-elements.e-dropdown-popup.e-rte-dropdown-popup.e-quick-dropdown.e-popup-open"))&&(0,o.isNullOrUndefined)((0,o.closest)(n.target,".e-rte-elements.e-rte-quick-popup.e-popup-open")));((0,o.isNullOrUndefined)(r)||!h&&((0,o.isNullOrUndefined)((0,o.closest)(r.range.startContainer.parentElement,".e-img-caption"))||"false"!==(0,o.closest)(r.range.startContainer.parentElement,".e-img-caption").getAttribute("contenteditable"))&&-1===o.Browser.userAgent.indexOf("Firefox"))&&e.contentModule.getEditPanel().focus({preventScroll:!0}),"HTML"!==e.editorMode||c||((0,o.isNullOrUndefined)(t.selectType)||!(0,o.isNullOrUndefined)(t.selectType)&&"showDialog"!==t.selectType)&&r.restore();var p=s.item.subCommand.toLocaleLowerCase();"image"!==p&&"file"!==p&&"replace"!==p||(i=s.itemCollection),"paste"===p||"cut"===p||"copy"===p?e.clipboardAction(p,n):(a.editorManager.observer.notify(Ke,{subCommand:s.item.subCommand}),a.editorManager.execCommand(s.item.command,s.item.subCommand,n,a.onSuccess.bind(a,e),s.item.value,"Pre"===s.item.subCommand&&"dropDownSelect"===s.selectType?{name:s.selectType}:i,"#"+e.getID()+" iframe",e.enterKey))}})));!((0,o.isNullOrUndefined)(n)||n&&"copy"!==n.action)||n&&n.shiftKey&&"Tab"===n.key||this.enableUndo(e)}},e.prototype.getAncestorNode=function(e){return e=3===e.nodeType?e.parentNode:e},e.prototype.onKeyHandler=function(e,t){var n=this;this.editorManager.observer.notify(Js,{event:t,callBack:function(){e.notify(p,{}),n.enableUndo(e)},enterAction:e.enterKey})},e.prototype.onSuccess=function(e,t){e.notify(p,{}),t&&((0,o.isNullOrUndefined)(t.event)||"copy"!==t.event.action)&&("Paste"===t.requestType?(e.notify(P,t),this.enableUndo(e)):(this.enableUndo(e),e.notify(P,t))),e.trigger(Z,t,(function(t){if(e.setPlaceHolder(),("Images"===t.requestType||"Replace"===t.requestType||"Links"===t.requestType||"Audios"===t.requestType||"Videos"===t.requestType)&&"HTML"===e.editorMode){var n=t;if("Links"===t.requestType&&t.event&&"keydown"===t.event.type&&32===t.event.keyCode)return;e.notify(se,{args:n.event,type:t.requestType,isNotify:!0,elements:n.elements})}"VideosPlayPause"===t.requestType&&e.notify("editAreaClick",{args:event}),e.autoResize()}))},e.prototype.saveData=function(e){this.editorManager.undoRedoManager.saveData(e)},e.prototype.getUndoStatus=function(){return this.editorManager.undoRedoManager.getUndoStatus()},e.prototype.getUndoRedoStack=function(){return this.editorManager.undoRedoManager.undoRedoStack},e.prototype.enableUndo=function(e){var t=this.getUndoStatus();!e.inlineMode.enable||o.Browser.isDevice&&!fr()?e.toolbarModule&&e.toolbarModule.baseToolbar&&Sr(e.toolbarModule.baseToolbar,t):Sr(e.quickToolbarModule.inlineQTBar.quickTBarObj,t)},e.prototype.beforeSlashMenuApply=function(){this.editorManager.beforeSlashMenuApplyFormat()},e.prototype.getCurrentStackIndex=function(){return this.editorManager.undoRedoManager.getCurrentStackIndex()},e}(),Bd="lists-commands",Rd="command-type",Id="link-commands",Ud="clear-commands",Pd="insert-table",Hd="insert-text",jd=function(){function e(e){(0,o.extend)(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Bd,this.applyListsHandler,this),this.parent.observer.on(Gs,this.keyDownHandler,this),this.parent.observer.on(Ys,this.keyUpHandler,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Bd,this.applyListsHandler),this.parent.observer.off(Gs,this.keyDownHandler),this.parent.observer.off(Ys,this.keyUpHandler),this.parent.observer.off(da,this.destroy)},e.prototype.keyDownHandler=function(e){if(9===e.event.which)this.tabKey(e);switch(e.event.action){case"ordered-list":this.applyListsHandler({subCommand:"OL",callBack:e.callBack}),e.event.preventDefault();break;case"unordered-list":this.applyListsHandler({subCommand:"UL",callBack:e.callBack}),e.event.preventDefault()}},e.prototype.keyUpHandler=function(e){if(13===e.event.which)this.enterKey(e)},e.prototype.tabKey=function(e){var t=this.parent.element;this.selection.save(t.selectionStart,t.selectionEnd);var n=t.selectionStart,i=t.selectionEnd,o=this.selection.getSelectedParentPoints(t),r=0,s=this.isNotFirstLine(t,o[0]);if(s||e.event.shiftKey){var a=this.olListType(),l=this.getListRegex();this.currentAction=this.getAction(o[0].text);for(var d=0;d<o.length;d++){var c=(e.event.shiftKey,o[d].line-1),h=this.selection.getLine(t,c);if(h&&(!e.event.shiftKey&&s||e.event.shiftKey)){var p=h.split(". "),u="\t",m=e.event.shiftKey?-1:1,f=o[d].text.split("\t");if(e.event.shiftKey&&1===f.length)break;if("OL"===this.currentAction&&/^\d+$/.test(p[0].trim())&&a){e.event.preventDefault(),o[d].text=e.event.shiftKey?f.splice(1,f.length).join("\t"):u+o[d].text;var g=this.getTabSpace(o[d].text),b=this.getTabSpace(h),v=o[d].text.split(". ");if(g===b)this.changeTextAreaValue(v,this.nextOrderedListValue(p[0].trim()),e,t,o,d,i);else if(b<g)this.changeTextAreaValue(v,"1. ",e,t,o,d,i);else for(;b.length>g.length;null){c-=1;var y=(h=this.selection.getLine(t,c)).trim().split(". ");if(/^\d+$/.test(y[0])&&(b=this.getTabSpace(h)).length<=g.length){this.changeTextAreaValue(v,this.nextOrderedListValue(y[0]),e,t,o,d,i);break}}}else("UL"===this.currentAction&&l.test(h.trim())||!a)&&(e.event.preventDefault(),o[d].text=e.event.shiftKey?f.splice(1,f.length).join("\t"):u+o[d].text,t.value=t.value.substr(0,o[d].start)+o[d].text+"\n"+t.value.substr(o[d].end,t.value.length));if(n=0===d?n+m:n,r+=m,1!==o.length)for(var C=d;C<o.length;C++)o[C].start=0!==C?o[C].start+m:o[C].start,o[C].end=o[C].end+m}}this.restore(t,n,i+r,e)}else this.restore(t,n,i+r,e)},e.prototype.changeTextAreaValue=function(e,t,n,i,r,s,a){var l=t;e.splice(0,1);var d,c=this.selection.getAllParents(i.value).length,h="",p=this.getTabSpace(r[s].text),u=parseInt(l.split(".")[0],null),m=this.getTabSpace(r[s].text),f=!0,g=!0,b=-1,v=!0,y=0,C="";h=""!==this.selection.getLine(i,r[0].line+1)?"":h+i.value.substr(r[0].end,i.value.length);for(var N=1;N<c&&!(0,o.isNullOrUndefined)(this.selection.getLine(i,r[0].line+N))&&""!==this.selection.getLine(i,r[0].line+N);N++){var E=this.selection.getLine(i,r[0].line+N),S=this.getTabSpace(E),T=E.split(". ");if(1===T.length){h+=i.value.substr(r[0].end+y,i.value.length);break}y+=E.length;var O=!1;if(d=n.event.shiftKey?p.length+1:p.length-1,S.length>m.length&&(v=!1),p.length!==S.length&&S.length<m.length?(g=!0,f=!1,O=!(!n.event.shiftKey||p.length!==S.length)&&(g=!1,!0)):v&&n.event.shiftKey&&p.length===S.length&&S.length===m.length&&(g=!1,O=!0),C=""===h?"":"\n",d===S.length&&g){var L=n.event.shiftKey?(b++,this.nextOrderedListValue(b.toString())):this.previousOrderedListValue(T[0]);T.splice(0,1),h=h+C+S+L+T.join(". ")}else if(p.length===S.length&&f||O){L=this.nextOrderedListValue(u.toString());u++,T.splice(0,1),h=h+C+S+L+T.join(". ")}else h=h+C+E,g=!1;m=this.getTabSpace(E)}r[s].text=this.getTabSpace(r[s].text)+l+e.join(". ")+"\n",i.value=i.value.substr(0,r[s].start)+r[s].text+h},e.prototype.getTabSpace=function(e){for(var t=e.split("\t"),n="",i=0;i<t.length&&""===t[i];i++)n+="\t";return n},e.prototype.isNotFirstLine=function(e,t){var n,i=t.text,o=t.line-1,r=this.selection.getLine(e,o),s=this.getListRegex(),a=!1;if(r){this.currentAction=this.getAction(r);var l=r.split(". ");n="OL"===this.currentAction?/^\d+$/.test(l[0].trim()):s.test(r.trim())}if(r&&n){var d=this.getTabSpace(i),c=this.getTabSpace(r);for(a=d===c||a;c.length>d.length;null){o-=1;l=(r=this.selection.getLine(e,o)).trim().split(". ");if(("OL"===this.currentAction?/^\d+$/.test(l[0]):s.test(r.trim()))&&(c=this.getTabSpace(r)).length<=d.length){a=!0;break}}}return a},e.prototype.getAction=function(e){var t=e.split(". ")[0],n=/^\d+$/.test(t.trim()),i=e.trim().split(new RegExp("^("+this.selection.replaceSpecialChar(this.syntax.UL).trim()+")"))[1];return n?"OL":i?"UL":"NOTLIST"},e.prototype.nextOrderedListValue=function(e){return(parseInt(e,null)+1).toString()+". "},e.prototype.previousOrderedListValue=function(e){return(parseInt(e,null)-1).toString()+". "},e.prototype.enterKey=function(e){var t=this.parent.element;this.selection.save(t.selectionStart,t.selectionEnd);var n=t.selectionStart,i=t.selectionEnd,r=this.selection.getSelectedParentPoints(t),s=this.selection.getLine(t,r[0].line-1),a=this.olListType(),l=this.getListRegex(),d=[];(0,o.isNullOrUndefined)(s)||(d=s.split(". "),this.currentAction=this.getAction(s));var c=0;if("OL"===this.currentAction&&d.length>1&&/^\d+$/.test(d[0].trim())&&a&&""!==d[1]){var h=this.getTabSpace(s);this.currentAction=this.getAction(s);var p=this.nextOrderedListValue(d[0]);r[0].text=h+p+r[0].text;for(var u=this.selection.getAllParents(t.value).length,m="\n",f=this.getTabSpace(s),g=this.getTabSpace(r[0].text),b=!0,v=1;v<u&&""!==t.value.substr(r[0].end,t.value.length);v++){var y=this.selection.getLine(t,r[0].line+v);if((0,o.isNullOrUndefined)(y))m+="";else{var C=y.split(". "),N=this.getTabSpace(y);if(N.length<g.length&&(b=!1),C.length>1&&/^\d+$/.test(C[0].trim())&&f.length===N.length&&b){var E=this.nextOrderedListValue(C[0]);C.splice(0,1),m=m+N+E+C.join(". ")+"\n"}else m=m+y+"\n",g=this.getTabSpace(y)}}t.value=t.value.substr(0,r[0].start)+f+p+this.selection.getLine(t,r[0].line)+m,n=n+p.length+h.length,c+=p.length+h.length}else if("UL"===this.currentAction&&s&&l.test(s.trim())&&""!==s.trim().replace(l,"")||"OL"===this.currentAction&&!a&&""!==d[1]){h=this.getTabSpace(s),p=this.syntax[this.currentAction];r[0].text=h+p+r[0].text+(r[0].text.trim().length>0?"\n":""),t.value=t.value.substr(0,r[0].start)+r[0].text+t.value.substr(r[0].end,t.value.length),n=n+p.length+h.length,c+=p.length+h.length}this.restore(t,n,i+c,e)},e.prototype.olListType=function(){var e=this.syntax.OL.split(".,");return(1===e.length?null:parseInt(e[2].trim(),null)-parseInt(e[0].trim(),null))?1:0},e.prototype.applyListsHandler=function(e){var t=this.parent.element;this.selection.save(t.selectionStart,t.selectionEnd),this.currentAction=e.subCommand;for(var n,i=t.selectionStart,r=t.selectionEnd,s=0,a=0,l=0,d=this.selection.getSelectedParentPoints(t),c="",h=this.olListType(),p={},u=0;u<d.length;u++)if(n=h?"OL"===this.currentAction?u+h+". ":this.syntax[this.currentAction]:"OL"===this.currentAction?this.syntax.OL:this.syntax[this.currentAction],this.selection.isStartWith(d[u].text,n))d[u].text=d[u].text.replace(n,""),t.value=t.value.substr(0,d[u].start+l)+d[u].text+"\n"+t.value.substr(d[u].end+l,t.value.length),l-=n.length,a=n.length,this.restore(t,i-a,r+l,null);else{if(""===d[u].text&&0===u&&(this.selection.save(i,r),1!==d.length))for(var m=u;m<d.length;m++)d[m].start=0!==m?1+d[m].start:d[m].start,d[m].end=1+d[m].end;var f=(0,o.isNullOrUndefined)(d[u-1])?0:this.getTabSpace(d[u-1].text).length,g=this.appliedLine(d[u].text,n,p,f);if(c=g.line?c:n,d[u].text=g.line?g.line:c+d[u].text,g.space=g.space?g.space:0,t.value=t.value.substr(0,d[u].start+l)+d[u].text+"\n"+t.value.substr(d[u].end,t.value.length),i=0===u?i+c.length+g.space>0?i+c.length+g.space:0:i,s+=c.length+g.space,1!==d.length)for(m=u;m<d.length;m++)d[m].start=0!==m?c.length+d[m].start+g.space:d[m].start,d[m].end=c.length+d[m].end+g.space;this.restore(t,i<=n.length?0:i,r+s,null)}this.restore(t,null,null,e)},e.prototype.appliedLine=function(e,t,n,i){var r={},s=new RegExp("^["+this.syntax.UL.trim()+"]"),a=e.split(". "),l=a[0]+". ",d=s.test(e.trim())||e.trim()===this.syntax.OL.trim()||e.trim()===this.syntax.UL.trim()||/^\d+$/.test(a[0].trim()),c=this.olListType(),h=this.getTabSpace(e).length;if("OL"===this.currentAction&&c&&(n[h.toString()]=(0,o.isNullOrUndefined)(n[h.toString()])?1:n[h.toString()].valueOf()+1,t=n[h.toString()].valueOf().toString()+". ",!(0,o.isNullOrUndefined)(i)&&i>h&&(n[i.toString()]=0)),d){var p=void 0,u=void 0;s.test(e.trim())?(u=this.syntax.UL,p=t,r.space=t.trim().length-this.syntax.UL.trim().length):/^\d+$/.test(a[0].trim())&&c?(u=a[0].trim()+". ",p=t,r.space=this.syntax.UL.trim().length-l.trim().length):/^\d+$/.test(a[0].trim())&&(u=a[0].trim()+". ",p=this.syntax.UL,r.space=this.syntax.UL.trim().length-l.trim().length),r.line=e.replace(u,p)}return r},e.prototype.restore=function(e,t,n,i){(0,o.isNullOrUndefined)(t)||(0,o.isNullOrUndefined)(t)||this.selection.save(t,n),(0,o.isNullOrUndefined)(i)||this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:this.currentAction,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.getListRegex=function(){for(var e="",t=Object.keys(this.syntax),n=RegExp,i=0;i<t.length;i++){var o=this.selection.replaceSpecialChar(this.syntax[t[i]]);e+=""===e?"^("+o+")|^("+o.trim()+")":"|^("+o+")|^("+o.trim()+")"}return new n(e)},e.prototype.destroy=function(){this.removeEventListener()},e}(),Fd=function(){function e(e){(0,o.extend)(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Ks,this.applyFormats,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Ks,this.applyFormats),this.parent.observer.off(da,this.destroy)},e.prototype.applyFormats=function(e){e.subCommand=e.subCommand.toLowerCase();var t=this.parent.element;this.selection.save(t.selectionStart,t.selectionEnd);var n=this.selection.getSelectedParentPoints(t);if(this.isAppliedFormat(n)===e.subCommand){if("pre"===e.subCommand){if(!(n.length>1))return;this.applyCodeBlock(t,e,n)}return this.cleanFormat(t),void this.restore(t,t.selectionStart,t.selectionEnd,e)}if("p"===e.subCommand)return this.cleanFormat(t),void this.restore(t,t.selectionStart,t.selectionEnd,e);("pre"===e.subCommand&&1!==n.length||"pre"!==e.subCommand)&&this.cleanFormat(t,e.subCommand);var i=t.selectionStart,r=t.selectionEnd,s=0;if(n=this.selection.getSelectedParentPoints(t),"pre"!==e.subCommand){for(var a=0;a<n.length;a++)if(""===n[a].text||this.selection.isStartWith(n[a].text,"\\"+this.syntax[e.subCommand])){if(""===n[a].text&&0===a&&(this.selection.save(i,r),0===this.selection.getSelectedText(t).length&&(n[a].text=this.syntax[e.subCommand],t.value=t.value.substr(0,n[a].start)+this.syntax[e.subCommand]+t.value.substr(n[a].end,t.value.length),i=0===a?i+this.syntax[e.subCommand].length:i,s+=this.syntax[e.subCommand].length),1!==n.length))for(l=a;l<n.length;l++)n[l].start=0!==l?1+n[l].start:n[l].start,n[l].end=1+n[l].end}else if(n[a].text=this.syntax[e.subCommand]+n[a].text,t.value=t.value.substr(0,n[a].start)+n[a].text+"\n"+t.value.substr(n[a].end,t.value.length),i=0===a?i+this.syntax[e.subCommand].length:i,s+=this.syntax[e.subCommand].length,1!==n.length)for(var l=a;l<n.length;l++)n[l].start=0!==l?this.syntax[e.subCommand].length+n[l].start:n[l].start,n[l].end=this.syntax[e.subCommand].length+n[l].end;this.restore(t,i,r+s,e)}else n.length>1?this.applyCodeBlock(t,e,n):((0,o.extend)(e,e,{subCommand:"InlineCode"},!0),this.parent.observer.notify(Rd,e))},e.prototype.clearRegex=function(){for(var e="",t=Object.keys(this.syntax),n=0;n<t.length&&"pre"!==t[n]&&"p"!==t[n];n++)e+=""===e?"^("+this.selection.replaceSpecialChar(this.syntax[t[n]].trim())+")":"|^("+this.selection.replaceSpecialChar(this.syntax[t[n]].trim())+")";return e},e.prototype.cleanFormat=function(e,t){var n=this.selection.getSelectedParentPoints(e),i=e.selectionStart,o=e.selectionEnd,r=0;if(this.selection.isClear(n,this.clearRegex())){for(var s=0;s<n.length;s++){for(var a=Object.keys(this.syntax),l=0;""!==n[s].text&&l<a.length;l++){var d=this.syntax[a[l]];if(a[l]!==t){var c=new RegExp("^("+this.selection.replaceSpecialChar(d)+")","gim");if(c.test(n[s].text)){if(n[s].text=n[s].text.replace(c,""),e.value=e.value.substr(0,n[s].start)+n[s].text+"\n"+e.value.substr(n[s].end,e.value.length),i=0===s?i-d.length>0?i-d.length:0:i,r+=d.length,1!==n.length)for(var h=0;h<n.length;h++)n[h].start=0!==h?n[h].start-d.length:n[h].start,n[h].end=n[h].end-d.length;break}}}if(""===n[s].text&&0===s&&(this.selection.save(i,o),1!==n.length))for(l=s;l<n.length;l++)n[l].start=0!==l?1+n[l].start:n[l].start,n[l].end=1+n[l].end}this.restore(e,i,o-r)}},e.prototype.applyCodeBlock=function(e,t,n){var i=t.subCommand,o=n[0].start,r=n[n.length-1].end,s=this.selection.getAllParents(e.value),a=s[n[0].line-1],l=s[n.length+1+1];if(this.selection.isStartWith(a,this.syntax.pre.split("\n")[0])||this.selection.isStartWith(l,this.syntax.pre.split("\n")[0])){var d=this.syntax[""+i],c=this.parent.markdownSelection.getSelectedInlinePoints(e),h=e.value.substr(0,e.selectionStart).lastIndexOf(d),p=e.value.substr(e.selectionEnd,e.selectionEnd).indexOf(d);p+=c.end;var u=this.replaceAt(e.value.substr(0,c.start),d,"",h,c.start),m=this.replaceAt(e.value.substr(c.end,e.value.length),d,"",0,p);e.value=u+c.text+m,o=this.selection.selectionStart-d.length,r=this.selection.selectionEnd-d.length}else{var f=e.value.substring(o,r).split("\n"),g=""===f[f.length-1]?"":"\n";e.value=e.value.substr(0,o)+this.syntax[""+i]+e.value.substring(o,r)+g+this.syntax[""+i]+e.value.substr(r,e.value.length),o=this.selection.selectionStart+this.syntax[""+i].length,r=this.selection.selectionEnd+this.syntax[""+i].length-1}this.restore(e,o,r,t)},e.prototype.replaceAt=function(e,t,n,i,o){return e.slice(0,i)+e.slice(i,o).replace(t,n)+e.slice(o)},e.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.isAppliedFormat=function(e,t){for(var n="p",i=(Object.keys(this.syntax),Object.keys(this.syntax)),o="backward"===this.parent.element.selectionDirection?e[0].text:e[e.length-1].text,r=0;!t&&r<i.length;r++){if("pre"!==i[r]&&this.selection.isStartWith(o,this.syntax[i[r]])){n=i[r];break}if("pre"===i[r]){var s=this.selection.getAllParents(this.parent.element.value),a=s[e[0].line-1],l=s[e.length+1];if(this.selection.isStartWith(a,this.syntax[i[r]].split("\n")[0])&&this.selection.isStartWith(l,this.syntax[i[r]].split("\n")[0])){n=i[r];break}}}return n},e.prototype.destroy=function(){this.removeEventListener()},e}(),qd=function(){function e(e){(0,o.extend)(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Rd,this.applyCommands,this),this.parent.observer.on(Gs,this.keyDownHandler,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Rd,this.applyCommands),this.parent.observer.off(Gs,this.keyDownHandler),this.parent.observer.off(da,this.destroy)},e.prototype.keyDownHandler=function(e){switch(e.event.action){case"bold":this.applyCommands({subCommand:"Bold",callBack:e.callBack}),e.event.preventDefault();break;case"italic":this.applyCommands({subCommand:"Italic",callBack:e.callBack}),e.event.preventDefault();break;case"strikethrough":this.applyCommands({subCommand:"StrikeThrough",callBack:e.callBack}),e.event.preventDefault();break;case"uppercase":this.applyCommands({subCommand:"UpperCase",callBack:e.callBack}),e.event.preventDefault();break;case"lowercase":this.applyCommands({subCommand:"LowerCase",callBack:e.callBack}),e.event.preventDefault();break;case"superscript":this.applyCommands({subCommand:"SuperScript",callBack:e.callBack}),e.event.preventDefault();break;case"subscript":this.applyCommands({subCommand:"SubScript",callBack:e.callBack}),e.event.preventDefault()}},e.prototype.isBold=function(e,t){return-1!==e.search("\\"+t+"\\"+t)},e.prototype.isItalic=function(e,t){return-1!==e.search("\\"+t)},e.prototype.isMatch=function(e,t){var n=[""];switch(t){case this.syntax.Italic:case this.syntax.InlineCode:case this.syntax.StrikeThrough:n=e.match(this.singleCharRegx(t))}return n},e.prototype.multiCharRegx=function(e){return new RegExp("(\\"+e+"\\"+e+")","g")},e.prototype.singleCharRegx=function(e){return new RegExp("(\\"+e+")","g")},e.prototype.isAppliedCommand=function(e){var t,n=!1,i=this.parent.element,r=i.selectionStart,s=(t=r,function(e){return[e.slice(0,t),e.slice(t)]})(i.value),a=this.syntax.Bold.substr(0,1),l=this.syntax.Italic,d=this.parent.markdownSelection.getSelectedText(i);if(""!==d&&d===d.toLocaleUpperCase()&&"UpperCase"===e)return!0;if(""===d){var c=i.value.substr(s[0].length-1,1),h=s[1].substr(0,1);if(""!==c&&""!==h&&c.match(/[a-z]/i)&&c===c.toLocaleUpperCase()&&h===h.toLocaleUpperCase()&&"UpperCase"===e)return!0}return this.isBold(s[0],a)||this.isItalic(s[0],l)||this.isBold(s[1],a)||this.isItalic(s[1],l)||((0,o.isNullOrUndefined)(this.isMatch(s[0],this.syntax.StrikeThrough))||(0,o.isNullOrUndefined)(this.isMatch(s[1],this.syntax.StrikeThrough))||this.isMatch(s[0],this.syntax.StrikeThrough).length%2!=1||this.isMatch(s[1],this.syntax.StrikeThrough).length%2!=1||"StrikeThrough"!==e||(n=!0),(0,o.isNullOrUndefined)(this.isMatch(s[0],this.syntax.InlineCode))||(0,o.isNullOrUndefined)(this.isMatch(s[1],this.syntax.InlineCode))||this.isMatch(s[0],this.syntax.InlineCode).length%2!=1||this.isMatch(s[1],this.syntax.InlineCode).length%2!=1||"InlineCode"!==e||(n=!0),(0,o.isNullOrUndefined)(s[0].match(/\<sub>/g))||(0,o.isNullOrUndefined)(s[1].match(/\<\/sub>/g))||s[0].match(/\<sub>/g).length%2!=1||s[1].match(/\<\/sub>/g).length%2!=1||"SubScript"!==e||(n=!0),(0,o.isNullOrUndefined)(s[0].match(/\<sup>/g))||(0,o.isNullOrUndefined)(s[1].match(/\<\/sup>/g))||s[0].match(/\<sup>/g).length%2!=1||s[1].match(/\<\/sup>/g).length%2!=1||"SuperScript"!==e||(n=!0)),this.isBold(s[0],a)&&this.isBold(s[1],a)&&s[0].match(this.multiCharRegx(a)).length%2==1&&s[1].match(this.multiCharRegx(a)).length%2==1&&"Bold"===e&&(n=!0),s[0]=this.isBold(s[0],a)?s[0].replace(this.multiCharRegx(a),"$%@"):s[0],s[1]=this.isBold(s[1],a)?s[1].replace(this.multiCharRegx(a),"$%@"):s[1],(0,o.isNullOrUndefined)(this.isMatch(s[0],this.syntax.Italic))||(0,o.isNullOrUndefined)(this.isMatch(s[1],this.syntax.Italic))||this.isMatch(s[0],this.syntax.Italic).length%2!=1||this.isMatch(s[1],this.syntax.Italic).length%2!=1||"Italic"!==e||(n=!0),(0,o.isNullOrUndefined)(this.isMatch(s[0],this.syntax.StrikeThrough))||(0,o.isNullOrUndefined)(this.isMatch(s[1],this.syntax.StrikeThrough))||this.isMatch(s[0],this.syntax.StrikeThrough).length%2!=1||this.isMatch(s[1],this.syntax.StrikeThrough).length%2!=1||"StrikeThrough"!==e||(n=!0),(0,o.isNullOrUndefined)(this.isMatch(s[0],this.syntax.InlineCode))||(0,o.isNullOrUndefined)(this.isMatch(s[1],this.syntax.InlineCode))||this.isMatch(s[0],this.syntax.InlineCode).length%2!=1||this.isMatch(s[1],this.syntax.InlineCode).length%2!=1||"InlineCode"!==e||(n=!0),(0,o.isNullOrUndefined)(s[0].match(/\<sub>/g))||(0,o.isNullOrUndefined)(s[1].match(/\<\/sub>/g))||s[0].match(/\<sub>/g).length%2!=1||s[1].match(/\<\/sub>/g).length%2!=1||"SubScript"!==e||(n=!0),(0,o.isNullOrUndefined)(s[0].match(/\<sup>/g))||(0,o.isNullOrUndefined)(s[1].match(/\<\/sup>/g))||s[0].match(/\<sup>/g).length%2!=1||s[1].match(/\<\/sup>/g).length%2!=1||"SuperScript"!==e||(n=!0),n},e.prototype.applyCommands=function(e){this.currentAction=e.subCommand;var t=this.parent.element;this.selection.save(t.selectionStart,t.selectionEnd);var n=t.selectionStart,i=t.selectionEnd,o=0,r=this.parent.markdownSelection.getSelectedInlinePoints(t);if(this.isAppliedCommand(e.subCommand)&&""!==r.text){var s=this.syntax[e.subCommand],a="SubScript"===e.subCommand?"</sub>":"SuperScript"===e.subCommand?"</sup>":this.syntax[e.subCommand],l="UpperCase"===e.subCommand||"LowerCase"===e.subCommand?0:s.length,d=t.value.substr(0,r.start).lastIndexOf(s),c=t.value.substr(r.end,t.value.length).indexOf(a);c+=r.end;var h=this.replaceAt(t.value.substr(0,r.start),s,"",d,r.start),p=this.replaceAt(t.value.substr(r.end,t.value.length),a,"",0,c);return t.value=h+r.text+p,void this.restore(t,n-l,i-l,e)}if(""===r.text||this.isApplied(r,e.subCommand))"UpperCase"!==e.subCommand&&"LowerCase"!==e.subCommand?("SubScript"===e.subCommand||"SuperScript"===e.subCommand?(r.text=this.textReplace(r.text,e.subCommand),r.text=this.syntax[e.subCommand]+r.text+"</"+this.syntax[e.subCommand].substring(1,5)):(r.text=this.textReplace(r.text,e.subCommand),r.text=this.syntax[e.subCommand]+r.text+this.syntax[e.subCommand]),t.value=t.value.substr(0,r.start)+r.text+t.value.substr(r.end,t.value.length),o=this.syntax[e.subCommand].length,r.start===r.end?this.restore(t,n+o,i+o,e):this.restore(t,n+o,i-o,e)):this.restore(t,n,i,e);else{o="UpperCase"===e.subCommand||"LowerCase"===e.subCommand?0:this.syntax[e.subCommand].length;var u=t.value.substr(r.start-this.syntax[e.subCommand].length,this.syntax[e.subCommand].length),m=void 0;if(u===e.subCommand||r.start-this.syntax[e.subCommand].length===t.value.indexOf(this.syntax[e.subCommand])&&(r.end===t.value.lastIndexOf(this.syntax[e.subCommand])||r.end===t.value.lastIndexOf("</"+this.syntax[e.subCommand].substring(1,5)))){m="SubScript"===e.subCommand||"SuperScript"===e.subCommand?t.value.substr(r.end,this.syntax[e.subCommand].length+1):t.value.substr(r.end,this.syntax[e.subCommand].length);h=this.replaceAt(t.value.substr(0,r.start),u,"",r.start-this.syntax[e.subCommand].length,r.start),p=this.replaceAt(t.value.substr(r.end,t.value.length),m,"",0,m.length);t.value=h+r.text+p,this.restore(t,n-o,i-o,e)}else"SubScript"===e.subCommand||"SuperScript"===e.subCommand?r.text=this.syntax[e.subCommand]+r.text+"</"+this.syntax[e.subCommand].substring(1,5):"UpperCase"===e.subCommand||"LowerCase"===e.subCommand?r.text="UpperCase"===e.subCommand?r.text.toUpperCase():r.text.toLowerCase():r.text=this.syntax[e.subCommand]+r.text+this.syntax[e.subCommand],t.value=t.value.substr(0,r.start)+r.text+t.value.substr(r.end,t.value.length),this.restore(t,n+o,i+o,e)}this.parent.undoRedoManager.saveData()},e.prototype.replaceAt=function(e,t,n,i,o){return e.slice(0,i)+e.slice(i,o).replace(t,n)+e.slice(o)},e.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:this.currentAction,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.textReplace=function(e,t){var n=this.singleCharRegx(this.syntax[""+t]);switch(t){case"Bold":n=this.multiCharRegx(this.syntax[""+t].substr(0,1)),e=e.replace(n,"");break;case"Italic":if(this.isBold(e,this.syntax[""+t].substr(0,1))){var i=this.multiCharRegx(this.syntax[""+t].substr(0,1)),o=e;o=o.replace(i,"$%@").replace(n,"");var r=new RegExp("\\$%@","g");e=o.replace(r,this.syntax[""+t].substr(0,1)+this.syntax[""+t].substr(0,1))}else e=e.replace(n,"");break;case"StrikeThrough":case"InlineCode":e=e.replace(n,"");break;case"SubScript":e=e.replace(/<sub>/g,"").replace(/<\/sub>/g,"");break;case"SuperScript":e=e.replace(/<sup>/g,"").replace(/<\/sup>/g,"")}return e},e.prototype.isApplied=function(e,t){var n=this.singleCharRegx(this.syntax[""+t]);switch(t){case"SubScript":case"SuperScript":return(n=this.singleCharRegx(this.syntax[""+t])).test(e.text);case"Bold":case"StrikeThrough":return(n=this.multiCharRegx(this.syntax[""+t].substr(0,1))).test(e.text);case"UpperCase":case"LowerCase":return(n=new RegExp("^["+this.syntax[""+t]+"]*$","g")).test(e.text);case"Italic":var i=void 0,o=this.multiCharRegx(this.syntax[""+t].substr(0,1));if(o.test(e.text)){var r=e.text;r=r.replace(o,"$%#"),i=n.test(r)}else i=n.test(e.text);return i;case"InlineCode":return n.test(e.text)}},e.prototype.destroy=function(){this.removeEventListener()},e}(),zd=function(){function e(e,t){this.undoRedoStack=[],this.parent=e,this.undoRedoSteps=(0,o.isNullOrUndefined)(t)?30:t.undoRedoSteps,this.undoRedoTimer=(0,o.isNullOrUndefined)(t)?300:t.undoRedoTimer,this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){var e=(0,o.debounce)(this.keyUp,this.undoRedoTimer);this.parent.observer.on(Ys,e,this),this.parent.observer.on(Gs,this.keyDown,this),this.parent.observer.on(Qs,this.onAction,this),this.parent.observer.on($s,this.onPropertyChanged,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.onPropertyChanged=function(e){for(var t=0,n=Object.keys(e.newProp);t<n.length;t++){switch(n[t]){case"undoRedoSteps":this.undoRedoSteps=e.newProp.undoRedoSteps;break;case"undoRedoTimer":this.undoRedoTimer=e.newProp.undoRedoTimer}}},e.prototype.removeEventListener=function(){var e=(0,o.debounce)(this.keyUp,300);this.parent.observer.off(Ys,e),this.parent.observer.off(Gs,this.keyDown),this.parent.observer.off(Qs,this.onAction),this.parent.observer.off($s,this.onPropertyChanged),this.parent.observer.off(da,this.destroy)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.onAction=function(e){"Undo"===e.subCommand?this.undo(e):this.redo(e)},e.prototype.keyDown=function(e){var t=e.event;switch(t.action){case"undo":t.preventDefault(),this.undo(e);break;case"redo":t.preventDefault(),this.redo(e)}},e.prototype.keyUp=function(e){17===e.event.keyCode||e.event.ctrlKey||this.saveData(e)},e.prototype.saveData=function(e){var t=this.parent.element;this.selection.save(t.selectionStart,t.selectionEnd);var n=t.selectionStart,i=t.selectionEnd,o={text:this.parent.element.value.replace(/</g,"&lt;").replace(/>/g,"&gt;"),start:n,end:i};this.undoRedoStack.length>=this.steps&&(this.undoRedoStack=this.undoRedoStack.slice(0,this.steps+1)),this.undoRedoStack.length>1&&this.undoRedoStack[this.undoRedoStack.length-1].start===n&&this.undoRedoStack[this.undoRedoStack.length-1].end===i||(this.undoRedoStack.push(o),this.steps=this.undoRedoStack.length-1,this.steps>this.undoRedoSteps&&(this.undoRedoStack.shift(),this.steps--),e&&e.callBack&&e.callBack())},e.prototype.undo=function(e){if(this.steps>0){this.currentAction="Undo";var t=this.undoRedoStack[this.steps-1].start,n=this.undoRedoStack[this.steps-1].end,i=this.undoRedoStack[this.steps-1].text;this.parent.element.value=i.replace(/&lt;/g,"<").replace(/&gt;/g,">"),this.parent.element.focus(),this.steps--,this.restore(this.parent.element,t,n,e)}},e.prototype.redo=function(e){if(null!=this.undoRedoStack[this.steps+1]){this.currentAction="Redo";var t=this.undoRedoStack[this.steps+1].start,n=this.undoRedoStack[this.steps+1].end;this.parent.element.value=this.undoRedoStack[this.steps+1].text,this.parent.element.focus(),this.steps++,this.restore(this.parent.element,t,n,e)}},e.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:this.currentAction,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.getUndoStatus=function(){var e={undo:!1,redo:!1};return this.steps>0&&(e.undo=!0),null!=this.undoRedoStack[this.steps+1]&&(e.redo=!0),e},e.prototype.getCurrentStackIndex=function(){return this.steps},e}(),_d=function(){function e(e){this.parent=e,this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Id,this.createLink,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Id,this.createLink),this.parent.observer.off(da,this.destroy)},e.prototype.createLink=function(e){var t=this.parent.element;t.focus();var n=t.selectionStart,i=t.selectionEnd,o="Image"===e.subCommand?this.selection.getSelectedText(t):e.item.text,r="Image"===e.subCommand?n+2:n+1,s="Image"===e.subCommand?i+2:i+1;o="Image"===e.subCommand?"!["+o+"]("+e.item.url+")":"["+o+"]("+e.item.url+")",t.value=t.value.substr(0,n)+o+t.value.substr(i,t.value.length),this.parent.markdownSelection.setSelection(t,r,s),this.restore(t,r,s,e)},e.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.destroy=function(){this.removeEventListener()},e}(),Vd=function(){function e(e){(0,o.extend)(this,this,e,!0),this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Pd,this.createTable,this),this.parent.observer.on(Gs,this.onKeyDown,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Pd,this.createTable),this.parent.observer.off(Gs,this.onKeyDown),this.parent.observer.off(da,this.destroy)},e.prototype.destroy=function(){this.removeEventListener()},e.prototype.onKeyDown=function(e){"insert-table"===e.event.action&&(e.item=e.value,this.createTable(e))},e.prototype.createTable=function(e){this.element=this.parent.element;var t=this.element.selectionStart,n=this.element.selectionEnd,i=this.element.value;this.locale=e,this.selection.save(t,n),this.restore(this.element.selectionStart,this.element.selectionEnd,null),this.insertTable(t,n,i,e)},e.prototype.getTable=function(){var e="";return e+=this.textNonEmpty(),e+=this.tableHeader(this.locale),e+=this.tableCell(this.locale)},e.prototype.tableHeader=function(e){for(var t="",n=1;n<=2;n++){t+="|";for(var i=1;i<=2;i++)t+=1===n?e.item.headingText+" "+i+"|":"---------|";t+=this.insertLine()}return t},e.prototype.tableCell=function(e){for(var t="",n=1;n<=2;n++){t+="|";for(var i=1;i<=2;i++)t+=e.item.colText+" "+this.convertToLetters(n)+i+"|";t+=this.insertLine()}return t+=this.insertLine()},e.prototype.insertLine=function(){var e=document.createElement("div");return e.innerHTML="\n",e.textContent},e.prototype.insertTable=function(e,t,n,i){var o=this.selection.getSelectedParentPoints(this.element),r=o[o.length-1].text.split(" ",2),s=this.getFormatTag();r.length<2?(this.element.value=this.updateValue(this.getTable()),this.makeSelection(n,e,t)):this.ensureFormatApply(o[o.length-1].text)?this.checkValid(e,t,this.getTable(),n,i,r,o,s):(this.element.value=this.updateValue(this.getTable()),this.makeSelection(n,e,t)),this.restore(this.element.selectionStart,this.element.selectionEnd,i)},e.prototype.makeSelection=function(e,t,n){n=t+(e.length>0?12:10),t+=e.length>0?3:1,this.selection.setSelection(this.element,t,n)},e.prototype.getFormatTag=function(){for(var e=Object.keys(this.syntaxTag.Formats),t=Object.keys(this.syntaxTag.List),n=[],i=0;i<e.length;i++)n.push(this.syntaxTag.Formats[e[i]]);for(var o=0;o<t.length;o++)n.push(this.syntaxTag.List[t[o]]);return n},e.prototype.ensureFormatApply=function(e){for(var t=this.getFormatTag(),n=e.trim().split(" ",2)[0]+" ",i=0;i<t.length;i++)if(n===t[i]||/^[\d.]+[ ]+$/.test(n))return!0;return!1},e.prototype.ensureStartValid=function(e,t){for(var n=t[0].text.split(" ",2),i=e+1;i<=e+n[0].length-1;i++)if(this.element.selectionStart===i||this.element.selectionEnd===i)return!1;return!0},e.prototype.ensureEndValid=function(e,t){for(var n=e+1;n<=e+t-1;n++)if(this.element.selectionEnd===n)return!1;return!0},e.prototype.updateValueWithFormat=function(e,t){var n=this.element.value.substring(this.element.selectionEnd,this.element.value.length);return t+=n.replace(n,e[0]+" "+n),this.element.value.substr(0,this.element.selectionStart)+t},e.prototype.updateValue=function(e){return this.element.value.substr(0,this.element.selectionStart)+e+this.element.value.substr(this.element.selectionEnd,this.element.value.length)},e.prototype.checkValid=function(e,t,n,i,o,r,s,a){this.ensureStartValid(s[0].start,s)&&this.ensureEndValid(s[s.length-1].start,r[0].length)&&(e===s[0].start?e!==t&&t!==s[s.length-1].end-1?this.element.value=this.updateValueWithFormat(r,n):this.element.value=this.updateValue(n):t===s[s.length-1].end-1?this.element.value=this.updateValue(n):this.element.value=this.updateValueWithFormat(r,n),this.makeSelection(i,e,t))},e.prototype.convertToLetters=function(e){var t="A".charCodeAt(0),n="";do{e-=1,n=String.fromCharCode(t+e%26)+n,e=e/26|0}while(e>0);return n},e.prototype.textNonEmpty=function(){var e="";return(this.isCursorBased()||this.isSelectionBased())&&this.element.value.length>0&&(e+=this.insertLine(),e+=this.insertLine()),e},e.prototype.isCursorBased=function(){return this.element.selectionStart===this.element.selectionEnd},e.prototype.isSelectionBased=function(){return this.element.selectionStart!==this.element.selectionEnd},e.prototype.restore=function(e,t,n){this.selection.save(e,t),this.selection.restore(this.element),n&&n.callBack&&((0,o.isNullOrUndefined)(n.subCommand)&&"action"in n.event&&"insert-table"===n.event.action&&(n.subCommand="CreateTable"),n.callBack({requestType:n.subCommand,selectedText:this.selection.getSelectedText(this.element),editorMode:"Markdown",event:n.event}))},e}(),Wd=function(){function e(e){this.parent=e,this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Ud,this.clear,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Ud,this.clear),this.parent.observer.off(da,this.destroy)},e.prototype.replaceRegex=function(e){return e.replace(/\*/gi,"\\*").replace(/\&/gi,"\\&").replace(/\-/gi,"\\-").replace(/\^/gi,"\\^").replace(/\$/gi,"\\$").replace(/\./gi,"\\.").replace(/\|/gi,"\\|").replace(/\?/gi,"\\?").replace(/\+/gi,"\\+").replace(/\-/gi,"\\-").replace(/\&/gi,"\\&")},e.prototype.clearSelectionTags=function(e){for(var t=this.parent.selectionTags,n=Object.keys(t),i=0;i<n.length;i++){var o=n[i];if(Object.prototype.hasOwnProperty.call(t,o)&&""!==t[""+o]){var r=this.replaceRegex(t[""+o]),s=void 0,a=t[""+o].length,l="<sup>"===t[""+o]||"<sub>"===t[""+o]?t[""+o].length+1:t[""+o].length;if("<sup>"===t[""+o])s=new RegExp("<sup>(.*?)</sup>","ig");else if("<sub>"===t[""+o])s=new RegExp("<sub>(.*?)</sub>","ig");else{s=new RegExp(r+"(.*?)"+r,"ig")}for(var d=e.match(s),c=0;d&&c<d.length&&""!==d[c];c++)e=e.replace(d[c],d[c].substr(a,d[c].length-l-a))}}return e},e.prototype.clearFormatTags=function(e){var t=e.split("\n");return this.clearFormatLines(t)},e.prototype.clearFormatLines=function(e){for(var t=[this.parent.formatTags,this.parent.listTags],n="",i=0;i<e.length;i++){for(var o=0;o<t.length;o++)for(var r=t[o],s=Object.keys(r),a=0;a<s.length;a++){var l=s[a];Object.prototype.hasOwnProperty.call(r,l)&&""!==r[""+l]&&0===e[i].indexOf(r[""+l])&&(e[i]=e[i].replace(r[""+l],""),e[i]=this.clearFormatLines([e[i]]))}n=n+e[i]+(i!==e.length-1?"\n":"")}return n},e.prototype.clear=function(e){var t=this.parent.element;t.focus();var n=t.selectionStart,i=t.selectionEnd,o=this.selection.getSelectedText(t);o=this.clearSelectionTags(o),o=this.clearFormatTags(o),t.value=t.value.substr(0,n)+o+t.value.substr(i,t.value.length),this.parent.markdownSelection.setSelection(t,n,n+o.length),this.restore(t,n,n+o.length,e)},e.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.destroy=function(){this.removeEventListener()},e}(),Qd=function(){function e(e){this.parent=e,this.selection=this.parent.markdownSelection,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.observer.on(Hd,this.InsertTextExec,this),this.parent.observer.on(da,this.destroy,this)},e.prototype.removeEventListener=function(){this.parent.observer.off(Hd,this.InsertTextExec),this.parent.observer.off(da,this.destroy)},e.prototype.InsertTextExec=function(e){var t=this.parent.element;t.focus();var n=t.selectionStart,i=t.selectionEnd,o=e.value.text,r=n+o.length,s=i+o.length;t.value=t.value.substr(0,n)+o+t.value.substr(i,t.value.length),this.parent.markdownSelection.setSelection(t,r,s),this.restore(t,r,s,e)},e.prototype.restore=function(e,t,n,i){this.selection.save(t,n),this.selection.restore(e),i&&i.callBack&&i.callBack({requestType:i.subCommand,selectedText:this.selection.getSelectedText(e),editorMode:"Markdown",event:i.event})},e.prototype.destroy=function(){this.removeEventListener()},e}(),Kd=function(){function e(e){this.initialize(),(0,o.extend)(this,this,e,!0),this.observer=new o.Observer(this),this.markdownSelection=new Dd,this.listObj=new jd({parent:this,syntax:this.listTags}),this.formatObj=new Fd({parent:this,syntax:this.formatTags}),this.undoRedoManager=new zd(this,e.options),this.mdSelectionFormats=new qd({parent:this,syntax:this.selectionTags}),this.linkObj=new _d(this),this.tableObj=new Vd({parent:this,syntaxTag:{Formats:this.formatTags,List:this.listTags}}),this.clearObj=new Wd(this),this.insertTextObj=new Qd(this),this.wireEvents()}return e.prototype.initialize=function(){this.formatTags=Ls,this.listTags=xs,this.selectionTags=ks},e.prototype.wireEvents=function(){this.observer.on(Ws,this.editorKeyDown,this),this.observer.on(Js,this.editorKeyUp,this),this.observer.on(Zs,this.onPropertyChanged,this)},e.prototype.unwireEvents=function(){this.observer.off(Ws,this.editorKeyDown),this.observer.off(Js,this.editorKeyUp),this.observer.off(Zs,this.onPropertyChanged)},e.prototype.onPropertyChanged=function(e){this.observer.notify($s,e)},e.prototype.editorKeyDown=function(e){this.observer.notify(Gs,e)},e.prototype.editorKeyUp=function(e){this.observer.notify(Ys,e)},e.prototype.execCommand=function(e,t,n,i,o,r){switch(e.toLocaleLowerCase()){case"lists":this.observer.notify(Bd,{subCommand:t,event:n,callBack:i});break;case"formats":this.observer.notify(Ks,{subCommand:t,event:n,callBack:i});break;case"actions":this.observer.notify(Qs,{subCommand:t,event:n,callBack:i});break;case"style":case"effects":case"casing":this.observer.notify(Rd,{subCommand:t,event:n,callBack:i});break;case"links":case"images":this.observer.notify(Id,{subCommand:t,event:n,callBack:i,item:r});break;case"table":if("createtable"===t.toString().toLocaleLowerCase())this.observer.notify(Pd,{subCommand:t,item:r,event:n,callBack:i});break;case"clear":this.observer.notify(Ud,{subCommand:t,event:n,callBack:i});break;case"inserttext":this.observer.notify(Hd,{subCommand:t,event:n,callBack:i,value:{text:r}})}},e.prototype.destroy=function(){this.observer.notify(da,{}),this.unwireEvents()},e}(),Gd=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Xd=function(e){function t(t){var n=e.call(this)||this;return n.initialize(),(0,o.extend)(n,n,t,!0),t&&n.element&&n.updateFormatter(n.element,document,t.options),n}return Gd(t,e),t.prototype.initialize=function(){this.keyConfig=Ds,this.formatTags=Ls,this.listTags=xs,this.selectionTags=ks},t.prototype.updateFormatter=function(e,t,n){e&&(this.editorManager=new Kd({element:e,formatTags:this.formatTags,listTags:this.listTags,selectionTags:this.selectionTags,options:n}))},t}(Ad),Yd=function(){function t(e,t){this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.isDestroyed=!1}return t.prototype.destroy=function(){this.isDestroyed||(this.removeEventListener(),this.isDestroyed=!0)},t.prototype.addEventListener=function(){this.parent.isDestroyed||(this.saveSelection=new Dd,this.parent.on(d,this.instantiateRenderer,this),this.parent.on(u,this.render,this),this.parent.on(T,this.onPropertyChanged,this),this.parent.on(S,this.onToolbarClick,this),this.parent.on(f,this.destroy,this),this.parent.on(Pe,this.selectAll,this),this.parent.on(je,this.getSelectedHtml,this),this.parent.on(Te,this.onSelectionSave,this),this.parent.on(Oe,this.onSelectionRestore,this),this.parent.on(Ge,this.updateReadOnly,this))},t.prototype.updateReadOnly=function(){this.parent.readonly?(this.parent.contentModule.getEditPanel().setAttribute("readonly","readonly"),(0,o.addClass)([this.parent.element],Ui)):(this.parent.contentModule.getEditPanel().removeAttribute("readonly"),(0,o.removeClass)([this.parent.element],Ui))},t.prototype.onSelectionSave=function(){var e=this.parent.contentModule.getEditPanel();this.saveSelection.save(e.selectionStart,e.selectionEnd)},t.prototype.onSelectionRestore=function(e){this.contentRenderer.getEditPanel().focus();var t=this.parent.contentModule.getEditPanel();this.saveSelection.restore(t)},t.prototype.onToolbarClick=function(e){var t=e.item,n=this.parent.contentModule.getEditPanel();"Formats"!==t.command&&n.focus();var i=n.selectionStart,o=n.selectionEnd,r=n.value.substring(i,o);switch(t.subCommand){case"Maximize":this.parent.notify(B,{args:e});break;case"Minimize":this.parent.notify(R,{args:e});break;case"CreateLink":this.parent.notify(G,{member:"link",args:e,text:r,module:"Markdown"});break;case"Image":this.parent.notify(ie,{member:"image",args:e,text:r,module:"Markdown"});break;case"CreateTable":var s={headingText:this.parent.localeObj.getConstant("TableHeadingText"),colText:this.parent.localeObj.getConstant("TableColText")};this.parent.formatter.process(this.parent,e,e.originalEvent,s);break;default:this.parent.formatter.process(this.parent,e,e.originalEvent,null)}},t.prototype.instantiateRenderer=function(){this.renderFactory.addRenderer(e.Content,new Ll(this.parent))},t.prototype.removeEventListener=function(){this.parent.off(u,this.render),this.parent.off(T,this.onPropertyChanged),this.parent.off(f,this.destroy),this.parent.off(S,this.onToolbarClick),this.parent.off(d,this.instantiateRenderer),this.parent.off(Pe,this.selectAll),this.parent.off(je,this.getSelectedHtml),this.parent.off(Te,this.onSelectionSave),this.parent.off(Oe,this.onSelectionRestore),this.parent.off(Ge,this.updateReadOnly)},t.prototype.render=function(){this.contentRenderer=this.renderFactory.getRenderer(e.Content);var t=this.contentRenderer.getEditPanel(),n={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer};(0,o.isNullOrUndefined)(this.parent.formatter)?this.parent.formatter=new Xd({element:t,options:n}):this.parent.formatter.updateFormatter(t,this.contentRenderer.getDocument(),n),this.parent.toolbarSettings.enable&&(this.toolbarUpdate=new Md(this.parent)),this.parent.notify(N,{})},t.prototype.onPropertyChanged=function(e){if(!(0,o.isNullOrUndefined)(e.newProp.formatter)){var t=this.contentRenderer.getEditPanel(),n={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer};this.parent.formatter.updateFormatter(t,this.contentRenderer.getDocument(),n)}},t.prototype.getModuleName=function(){return"markdownEditor"},t.prototype.selectAll=function(){this.parent.formatter.editorManager.markdownSelection.setSelection(this.parent.contentModule.getEditPanel(),0,this.parent.contentModule.getEditPanel().value.length)},t.prototype.getSelectedHtml=function(e){e.callBack(this.parent.formatter.editorManager.markdownSelection.getSelectedText(this.parent.contentModule.getEditPanel()))},t}(),Jd=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),$d=function(e){function t(t){var n=e.call(this)||this;return n.initialize(),(0,o.extend)(n,n,t,!0),n.currentDocument&&n.element&&n.updateFormatter(n.element,n.currentDocument,t.options,t.formatPainterSettings),n}return Jd(t,e),t.prototype.initialize=function(){this.keyConfig=ws},t.prototype.updateFormatter=function(e,t,n,i){e&&t&&(this.editorManager=new rl({document:t,editableElement:e,options:n,formatPainterSettings:i}))},t}(Ad),Zd=function(){function e(e){this.parent=e,this.toolbarStatus=this.prevToolbarStatus={bold:!1,italic:!1,subscript:!1,superscript:!1,strikethrough:!1,orderedlist:!1,unorderedlist:!1,numberFormatList:!1,bulletFormatList:!1,underline:!1,alignments:null,backgroundcolor:null,fontcolor:null,fontname:null,fontsize:null,formats:null,createlink:!1,insertcode:!1,blockquote:!1,inlinecode:!1},this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(b,this.onRefreshHandler,this),this.parent.on(f,this.removeEventListener,this)},e.prototype.removeEventListener=function(){this.toolbarStatus=null,this.prevToolbarStatus=null,this.parent.off(b,this.onRefreshHandler),this.parent.off(f,this.removeEventListener)},e.prototype.onRefreshHandler=function(e){if(!this.parent.readonly){var t=[],n=[],i=[];this.parent.fontSize.items.forEach((function(e){t.push(e.value)})),this.parent.fontFamily.items.forEach((function(e){n.push(e.value)})),this.parent.format.types.forEach((function(e){i.push(e.value.toLocaleLowerCase())})),this.toolbarStatus=ll.get(this.parent.contentModule.getDocument(),this.parent.contentModule.getEditPanel(),i,t,n,e.documentNode);var o=JSON.stringify(this.toolbarStatus);this.parent.notify(C,this.toolbarStatus),JSON.stringify(this.prevToolbarStatus)!==o&&(this.parent.notify(Dt,{html:JSON.parse(o),markdown:null}),this.prevToolbarStatus=JSON.parse(o))}},e}(),ec=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(Nt,this.enableXhtmlValidation,this),this.parent.on(f,this.removeEventListener,this)},e.prototype.removeEventListener=function(){this.parent.off(Nt,this.enableXhtmlValidation),this.parent.off(f,this.removeEventListener)},e.prototype.enableXhtmlValidation=function(){this.parent.enableXhtml&&((0,o.isNullOrUndefined)(this.parent.inputElement)?this.currentElement=this.parent.element:this.currentElement=this.parent.inputElement,this.clean(this.currentElement),this.ImageTags(),this.removeTags(),this.RemoveUnsupported(),this.currentElement.innerHTML=this.selfEncloseValidation(this.currentElement.innerHTML,"\n"===this.currentElement.innerText?this.currentElement.innerText.length:this.currentElement.innerText.trim().length),this.parent.setProperties({value:this.currentElement.innerHTML},!0))},e.prototype.selfEncloseValidation=function(e,t){if(0===t&&e.indexOf("table")<0&&e.indexOf("img")<0&&e.includes("&nbsp;")){var n=e.split("&nbsp;");n[n.length-1]="&#8203;"+n[n.length-1],e=n.join("")}var i;e=e.replace(/<br>/g,"<br/>").replace(/<hr>/g,"<hr/>").replace(/ /g," ");for(var o=[],r=[],s=[/<img(.*?)>/gi,/<area(.*?)>/gi,/<base(.*?)>/gi,/<col (.*?)>/gi,/<embed(.*?)>/gi,/<input(.*?)>/gi,/<link(.*?)>/gi,/<meta(.*?)>/gi,/<param(.*?)>/gi,/<source(.*?)>/gi,/<track(.*?)>/gi,/<wbr(.*?)>/gi],a=0;a<s.length;a++){for(i=s[a].exec(e);null!==i;)o.push(i[0].toString()),i=s[a].exec(e);r=o.slice(0);for(var l=0;l<o.length;l++)-1!==o[l].indexOf("/")&&o[l].lastIndexOf("/")===o[l].length-2||(o[l]=o[l].substr(0,o[l].length-1)+" /"+o[l].substr(o[l].length-1,o[l].length));for(var d=0;d<=o.length-1;d++)e=e.replace(r[d],o[d])}return e},e.prototype.clean=function(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];8===n.nodeType||"V:IMAGE"===n.nodeName?(e.removeChild(n),t--):1===n.nodeType&&this.clean(n)}return this.currentElement.innerHTML},e.prototype.ImageTags=function(){for(var e=this.currentElement.querySelectorAll("IMG"),t=e.length-1;t>=0;t--){if(!e[t].hasAttribute("alt"))e[t].setAttribute("alt","")}},e.prototype.removeTags=function(){for(var e=[["br","ul"],["br","ol"],["table","span"],["div","span"],["p","span"]],t=0;t<e.length;t++)this.RemoveElementNode(e[t][0],e[t][1])},e.prototype.RemoveElementNode=function(e,t){for(var n=this.currentElement.querySelectorAll(t),i=0;i<n.length;i++)for(var r=n[i].querySelectorAll(e),s=r.length;s>0;s--)(0,o.detach)(r[s-1])},e.prototype.RemoveUnsupported=function(){for(var e=this.currentElement.querySelectorAll("u"),t=e.length-1;t>=0;t--){var n=this.parent.createElement("span");n.style.textDecoration="underline",n.innerHTML=e[t].innerHTML,e[t].parentNode.insertBefore(n,e[t]),(0,o.detach)(e[t])}var i=this.currentElement.querySelectorAll("strong");for(t=i.length-1;t>=0;t--){var r=this.parent.createElement("b");r.innerHTML=i[t].innerHTML,i[t].parentNode.insertBefore(r,i[t]),(0,o.detach)(i[t])}var s=["language","role","target","contenteditable","cellspacing","cellpadding","border","valign","colspan"];for(t=0;t<=s.length;t++)this.RemoveAttributeByName(s[t])},e.prototype.RemoveAttributeByName=function(e){if(null!==this.currentElement.firstChild&&3!==this.currentElement.firstChild.nodeType)for(var t=0;t<this.currentElement.childNodes.length;t++){var n=this.currentElement.childNodes[t];if(3!==n.nodeType&&"TABLE"!==n.nodeName&&"TBODY"!==n.nodeName&&"THEAD"!==n.nodeName&&"TH"!==n.nodeName&&"TR"!==n.nodeName&&"TD"!==n.nodeName&&(n.hasAttribute(e)&&n.removeAttribute(e),n.hasChildNodes()))for(var i=0;i<n.childNodes.length;i++){var o=n.childNodes[i];if(3!==o.nodeType&&"TABLE"!==o.nodeName&&"TBODY"!==o.nodeName&&"THEAD"!==o.nodeName&&"TH"!==o.nodeName&&"TR"!==o.nodeName&&"TD"!==o.nodeName&&o.hasAttribute(e)&&!o.classList.contains("e-mention-chip")&&o.removeAttribute(e),o.hasChildNodes())for(var r=0;r<o.childNodes.length;r++)3!==o.childNodes[r].nodeType&&"TABLE"!==o.childNodes[r].nodeName&&"TBODY"!==o.childNodes[r].nodeName&&"THEAD"!==o.childNodes[r].nodeName&&"TH"!==o.childNodes[r].nodeName&&"TR"!==o.childNodes[r].nodeName&&"TD"!==o.childNodes[r].nodeName&&o.childNodes[r].hasAttribute(e)&&o.childNodes[r].removeAttribute(e)}}},e}(),tc=function(){function t(e,t){this.rangeCollection=[],this.isImageDelete=!1,this.isMention=!1,this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.xhtmlValidation=new ec(e),this.addEventListener(),this.isDestroyed=!1,this.isCopyAll=!1,this.isSlashMenuOpen=!1,this.isPreviousNodeBrAfterBackSpace=!1}return t.prototype.destroy=function(){this.isDestroyed||(this.clickTimeout&&(clearTimeout(this.clickTimeout),this.clickTimeout=null),this.removeEventListener(),this.locator=null,this.contentRenderer=null,this.renderFactory=null,this.toolbarUpdate=null,this.nodeSelectionObj=null,this.isCopyAll=null,this.isSlashMenuOpen=null,this.rangeCollection.length>0&&(this.rangeCollection=[]),this.rangeElement&&(this.rangeElement=null),this.oldRangeElement&&(this.oldRangeElement=null),this.deleteRangeElement&&(this.deleteRangeElement=null),this.deleteOldRangeElement&&(this.deleteOldRangeElement=null),this.saveSelection&&(this.saveSelection=null),this.xhtmlValidation&&(this.xhtmlValidation=null),this.isDestroyed=!0)},t.prototype.sanitizeHelper=function(e){return e=Br(e,this.parent)},t.prototype.addEventListener=function(){this.parent.isDestroyed||(this.nodeSelectionObj=new sl(this.parent.inputElement),this.parent.on(d,this.instantiateRenderer,this),this.parent.on(E,this.onToolbarClick,this),this.parent.on(v,this.onSlashMenuOpen,this),this.parent.on(k,this.onKeyDown,this),this.parent.on(L,this.onKeyUp,this),this.parent.on(u,this.render,this),this.parent.on(T,this.onPropertyChanged,this),this.parent.on(f,this.destroy,this),this.parent.on(Pe,this.selectAll,this),this.parent.on(He,this.selectRange,this),this.parent.on(je,this.getSelectedHtml,this),this.parent.on(Te,this.onSelectionSave,this),this.parent.on(Oe,this.onSelectionRestore,this),this.parent.on(Ge,this.updateReadOnly,this),this.parent.on(qe,this.onPaste,this),this.parent.on(a,this.isTableClassAdded,this),this.parent.on(rn,this.onHandleFontsizeChange,this))},t.prototype.onSlashMenuOpen=function(){this.isSlashMenuOpen=!0},t.prototype.updateReadOnly=function(){this.parent.readonly?((0,o.attributes)(this.parent.contentModule.getEditPanel(),{contenteditable:"false"}),(0,o.addClass)([this.parent.element],Ui)):((0,o.attributes)(this.parent.contentModule.getEditPanel(),{contenteditable:"true"}),(0,o.removeClass)([this.parent.element],Ui))},t.prototype.onSelectionSave=function(){var e=this.contentRenderer.getDocument(),t=this.nodeSelectionObj.getRange(e);this.saveSelection=this.nodeSelectionObj.save(t,e)},t.prototype.onSelectionRestore=function(e){this.parent.isBlur=!1,this.contentRenderer.getEditPanel().focus({preventScroll:!0}),!(0,o.isNullOrUndefined)(e.items)&&!e.items||(0,o.isNullOrUndefined)(this.saveSelection)||this.saveSelection.restore()},t.prototype.isTableClassAdded=function(){for(var e=this.parent.inputElement.querySelectorAll("table"),t=0;t<e.length;t++)e[t].classList.contains("e-rte-table")||e[t].classList.contains("e-rte-paste-table")||e[t].classList.contains("e-rte-custom-table")||e[t].classList.add("e-rte-table")},t.prototype.onHandleFontsizeChange=function(e){var t,n=e.args,i={name:"dropDownSelect",item:{command:"Font",subCommand:"FontSize"}},r=this.parent.fontSize.items;if(this.parent.toolbarModule&&this.parent.toolbarModule.dropDownModule&&this.parent.toolbarModule.dropDownModule.fontSizeDropDown&&!(0,o.isNullOrUndefined)(this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent)&&""!==this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent)t=this.parent.toolbarModule.dropDownModule.fontSizeDropDown.activeElem[0].textContent;else{var s=void 0,a=this.parent.contentModule.getDocument().getSelection();s=a&&a.focusNode&&a.focusNode.parentElement?document.defaultView.getComputedStyle(a.focusNode.parentElement,null).getPropertyValue("font-size"):this.parent.fontSize.width;var l=(s=(0,o.isNullOrUndefined)(s)?this.parent.fontSize.width:s).match(/^([\d.]+)(\D+)$/),d=parseInt(l[1],10),c=l[2],h=r[1].value.match(/^([\d.]+)(\D+)$/);if(h[2]===c){var p=r.findIndex((function(e){var t=e.value;return parseInt(t,10)>=d}));t=r[p].text}else{var u=this.convertFontSize(d,c,h[2]);p=r.findIndex((function(e){var t=e.value;return parseInt(t,10)>=u}));t=r[p].text}}var m=r.findIndex((function(e){return e.text===("Font Size"===t?"Default":t)}));if("increase-fontsize"===n.action&&-1!==m)if(m>=r.length-1){var f=r[m].value.match(/^([\d.]+)(\D+)$/);if(f){var g=parseInt(f[1],10),b=(c=f[2],g%10==0?10*Math.ceil((g+1)/10):10*Math.ceil(g/10));i.item.value=b.toLocaleString()+c,i.item.text=b.toLocaleString()+" "+c}this.parent.fontSize.items.push(i.item)}else i.item.value=r[m+1].value,i.item.text=r[m+1].text;else"decrease-fontsize"===n.action&&-1!==m&&m>0?(i.item.value=r[m-1].value,i.item.text=r[m-1].text):m>=0&&m<r.length&&r[m]&&(i.item.value=r[m].value,i.item.text=r[m].text);this.parent.formatter.process(this.parent,i,n)},t.prototype.convertFontSize=function(e,t,n){return-1===nn.indexOf(t)&&-1===nn.indexOf(n)||(t="px"),e*on[t][n]},t.prototype.onKeyUp=function(e){var t=e.args,n=this.parent.getRange(),i=new RegExp("​","g"),r=n.startContainer===n.endContainer&&n.startOffset===n.endOffset&&1===n.startOffset&&1===n.startContainer.textContent.length&&8203===n.startContainer.textContent.charCodeAt(0)&&0===n.startContainer.textContent.replace(i,"").length,s=!1;if(n.startContainer===n.endContainer&&n.startOffset===n.endOffset&&n.startContainer!==this.parent.inputElement&&0!==n.startOffset){var a=3===n.startContainer.nodeType?n.startContainer:n.startContainer.childNodes[n.startOffset-1];s=16===t.keyCode&&8203===a.textContent.charCodeAt(0)&&!(0,o.isNullOrUndefined)(a.previousSibling)&&"false"===a.previousSibling.contentEditable}if(!this.isCopyAll){var l,d=!1;if(!this.isSlashMenuOpen&&[8,9,13,17,18,20,27,37,38,39,40,44,45,46,91,112,113,114,115,116,117,118,119,120,121,122,123].indexOf(t.keyCode)<0&&!t.shiftKey&&!t.ctrlKey&&!t.altKey&&!r&&!s){if(l=n.startOffset,"#text"===n.startContainer.nodeName?n.startContainer.parentElement!==this.parent.inputElement?n.startContainer.parentElement.classList.add("currentStartMark"):d=!0:n.startContainer.classList.add("currentStartMark"),8203===n.startContainer.textContent.charCodeAt(0)){var c=n.startContainer.textContent.length,h=n.startOffset;this.removeZeroWidthSpaces(n.startContainer,i),l=0===h?h:h-(c-n.startContainer.textContent.length),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),n.startContainer,l)}var p=this.parent.inputElement.innerHTML.length,u=this.parent.inputElement.innerHTML.replace(i,"").length,m=n.startContainer;if(p>u&&!d){if(0!==m.textContent.trim().length&&m.previousSibling){var f=document.createElement("span");f.className="tempSpan",n.insertNode(f)}for(var g=this.parent.inputElement.firstChild;!(0,o.isNullOrUndefined)(g);)"#text"!==g.nodeName?(g.textContent.replace(i,"").trim().length>0&&g.textContent.includes("​")&&this.removeZeroWidthSpaces(g,i),g=g.nextElementSibling):g=g.nextElementSibling;var b=this.parent.inputElement.querySelector(".tempSpan");if(b&&b.previousSibling&&0!==m.textContent.trim().length)m=b.previousSibling,l=b.previousSibling.textContent.length,b.parentNode.removeChild(b),b=null;var v=this.parent.inputElement.querySelector(".currentStartMark"),y=v?v.childNodes:[];if(y.length>1){for(var C=0;C<y.length;C++)if("#text"===y[C].nodeName&&0===y[C].textContent.length&&((0,o.detach)(y[C]),C--),!(0,o.isNullOrUndefined)(y[C])&&m.textContent.replace(i,"")===y[C].textContent){var N=l<=m.textContent.indexOf("​");l=m.textContent.length>1?m.textContent===y[C].textContent||N?l:l-(m.textContent.length-m.textContent.replace(i,"").length):m.textContent.length,m=y[C]}}else 1===y.length&&m.textContent.replace(i,"")===y[0].textContent&&(m=y[0]);this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),m,l)}var E=this.parent.inputElement.querySelector(".currentStartMark");(0,o.isNullOrUndefined)(E)||(E.classList.remove("currentStartMark"),""===E.getAttribute("class").trim()&&E.removeAttribute("class")),!(0,o.isNullOrUndefined)(n.startContainer.previousSibling)&&!(0,o.isNullOrUndefined)(n.startContainer.previousSibling.parentElement)&&n.startContainer.parentElement===n.startContainer.previousSibling.parentElement&&8203===n.startContainer.previousSibling.textContent.charCodeAt(0)&&n.startContainer.previousSibling.textContent.length<=1&&(n.startContainer.previousSibling.textContent=n.startContainer.previousSibling.textContent.replace(i,"")),8203===n.endContainer.textContent.charCodeAt(n.endOffset)&&(l=n.startOffset,n.endContainer.textContent=n.endContainer.textContent.replace(i,""),this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),n.startContainer,l))}this.isSlashMenuOpen=!1}},t.prototype.removeZeroWidthSpaces=function(e,t){var n=this;e.nodeType!==Node.TEXT_NODE?e.childNodes.forEach((function(e){n.removeZeroWidthSpaces(e,t)})):null!==e.textContent&&(e.textContent=e.textContent.replace(t,""))},t.prototype.onKeyDown=function(e){var t,n=this;e.args.ctrlKey&&65===e.args.keyCode?this.isCopyAll=!0:this.isCopyAll=!1;var i=e.args;if(this.parent.inputElement.querySelectorAll(".e-cell-select:not(table)").length>1&&(8===i.keyCode||32===i.keyCode||13===i.keyCode))return this.tableSelectionKeyAction(e),void this.parent.autoResize();if("chrome"===o.Browser.info.name&&(t=this.parent.getRange(),this.backSpaceCleanup(e,t),this.deleteCleanup(e,t)),9===i.keyCode&&this.parent.enableTabKey){if(this.parent.formatter.saveData(e),!(0,o.isNullOrUndefined)(i.target)&&(0,o.isNullOrUndefined)((0,o.closest)(i.target,".e-rte-toolbar"))){var r=this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()),s=this.nodeSelectionObj.getParentNodeCollection(r);if("LI"!==s[0].nodeName&&!(0,o.closest)(s[0],"li")&&!(0,o.closest)(s[0],"table")){i.preventDefault();var a=this.contentRenderer.getDocument().getSelection().getRangeAt(0),l=this.parent.formatter.editorManager.domNode.blockNodes();if("BR"===this.parent.enterKey)if(a.startOffset!==a.endOffset&&0===a.startOffset){var d=this.nodeSelectionObj.save(r,this.contentRenderer.getDocument());this.parent.formatter.editorManager.domNode.setMarker(d),l=this.parent.formatter.editorManager.domNode.blockNodes(),this.parent.formatter.editorManager.domNode.convertToBlockNodes(l,!1),this.marginTabAdd(i.shiftKey,l),(d=this.parent.formatter.editorManager.domNode.saveMarker(d)).restore()}else pa.Insert(this.contentRenderer.getDocument(),"&nbsp;&nbsp;&nbsp;&nbsp;"),this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument()));else a.startOffset!==a.endOffset&&0===a.startOffset?this.marginTabAdd(i.shiftKey,l):(pa.Insert(this.contentRenderer.getDocument(),"&nbsp;&nbsp;&nbsp;&nbsp;"),this.rangeCollection.push(this.nodeSelectionObj.getRange(this.contentRenderer.getDocument())))}}this.parent.formatter.saveData(e)}if(("space"===e.args.action||"enter"===e.args.action||13===e.args.keyCode||/[^\w\s\\/\\.\\:]/g.test(e.args.key))&&(this.spaceLink(e.args),"HTML"===this.parent.editorMode&&!this.parent.readonly)){var c=this.parent.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length-this.parent.getSelection().length+1;if(!(-1===this.parent.maxLength||c<=this.parent.maxLength||13!==e.args.keyCode))return void e.args.preventDefault();this.parent.notify(Ye,{args:e.args}),Hs(this.parent.contentModule.getDocument(),this.parent.inputElement)}if("space"===e.args.action){var h=this.parent.getRange(),p=h.startContainer.textContent.slice(0,h.startOffset),u=this.isOrderedList(p),m=this.isUnOrderedList(p),f=!1;if((u||m)&&(f=this.hasMultipleTextNode(h))&&!this.isMention){var g=h.startContainer;(g=this.parent.formatter.editorManager.domNode.getImmediateBlockNode(g)).childNodes.length>0&&!g.innerHTML.includes("<br>")&&(f=!1)}if(!f&&(u&&!m||m&&!u)){var b={callBack:null,event:e.args,name:"keydown-handler",enterKey:this.parent.enterKey,shiftEnterKey:this.parent.shiftEnterKey},v={cancel:!1,item:{command:"Lists",subCommand:u?"OL":"UL"},name:"actionBegin",originalEvent:e.args,requestType:u?"OL":"UL"};this.parent.trigger($,v,(function(t){t.cancel||(n.parent.formatter.editorManager.observer.notify(na,b),n.parent.trigger(Z,{editorMode:n.parent.editorMode,elements:n.parent.formatter.editorManager.domNode.blockNodes(),event:e.args,name:Z,range:n.parent.getRange(),requestType:u?"OL":"UL"}))}))}}"chrome"!==o.Browser.info.name||((0,o.isNullOrUndefined)(this.rangeElement)||(0,o.isNullOrUndefined)(this.oldRangeElement))&&((0,o.isNullOrUndefined)(this.deleteRangeElement)||(0,o.isNullOrUndefined)(this.deleteOldRangeElement))||"TD"===t.startContainer.parentElement.tagName||"TH"===t.startContainer.parentElement.tagName||(this.rangeElement=null,this.oldRangeElement=null,this.deleteRangeElement=null,this.deleteOldRangeElement=null,this.isImageDelete||i.preventDefault(),i.preventDefault()),this.parent.autoResize()},t.prototype.isOrderedList=function(e){e=e.replace(/\u200B/g,"");var t=[/^[1]+[.]+$/,/^[i]+[.]+$/,/^[a]+[.]+$/];if(!(0,o.isNullOrUndefined)(e))for(var n=0;n<t.length;n++)if(t[n].test(e))return!0;return!1},t.prototype.isUnOrderedList=function(e){e=e.replace(/\u200B/g,"");var t=[/^[*]$/,/^[-]$/];if(!(0,o.isNullOrUndefined)(e))for(var n=0;n<t.length;n++)if(t[n].test(e))return!0;return!1},t.prototype.hasMultipleTextNode=function(e){if(this.isMention=!1,e&&e.startContainer&&e.startContainer.parentNode){var t=e.startContainer.parentNode;if(e.startContainer.previousElementSibling&&e.startContainer.previousElementSibling.classList.contains("e-mention-chip")&&!e.startContainer.previousElementSibling.isContentEditable)return this.isMention=!0,!0;if("BR"===this.parent.enterKey||(0,o.closest)(t,"table"))return!1;for(var n=t.childNodes,i=[],r=0;r<n.length;r++){var s=n[r];if(s&&s.nodeType===Node.TEXT_NODE&&(i.push(s),i.length>1))return!0}}return!1},t.prototype.isCursorAtBlockStart=function(e){if(0!==e.startOffset||0!==e.endOffset)return!1;var t=e.startContainer,n=t.nodeType===Node.TEXT_NODE?t.parentElement:t;if("TD"===n.tagName||"TH"===n.tagName)return!1;var i=this.parent.formatter.editorManager.domNode.getImmediateBlockNode(n);if(t===i&&0===e.startOffset)return!0;for(var o=n,r=!1;o&&o!==i;){for(var s=o.previousSibling;s;){if(s.nodeType!==Node.TEXT_NODE||s.textContent&&s.textContent.trim()){r=!0;break}s=s.previousSibling}if(r)break;o=o.parentNode}return!r},t.prototype.backSpaceCleanup=function(e,t){var n=!1,i=!0;(0,o.isNullOrUndefined)(t.startContainer.previousSibling)||"SPAN"!==t.startContainer.previousSibling.nodeName||(i="false"!==t.startContainer.previousSibling.contentEditable);var r="#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer,s=!(0,o.closest)("#text"===t.startContainer.nodeName?t.startContainer.parentElement:t.startContainer,"li")||"li"!==r.nodeName&&(0,o.isNullOrUndefined)(r.previousSibling),a=this.isCursorAtBlockStart(t);if("Backspace"===e.args.code&&8===e.args.keyCode&&a&&" "!==t.startContainer.textContent&&0===this.parent.getSelection().length&&t.startContainer.textContent.length>0&&i&&s){if(!this.parent.formatter.editorManager.domNode.isBlockNode(r)&&!(0,o.isNullOrUndefined)(r.previousSibling)&&"BR"===r.previousSibling.nodeName||!(0,o.isNullOrUndefined)(t.startContainer.previousSibling)&&"BR"===t.startContainer.previousSibling.nodeName)return;if(this.rangeElement=this.getRootBlockNode(t.startContainer),"OL"===this.rangeElement.tagName||"UL"===this.rangeElement.tagName){var l=this.getRangeLiNode(t.startContainer);l.previousElementSibling&&l.previousElementSibling.childElementCount>0&&(this.oldRangeElement="BR"===l.previousElementSibling.lastElementChild.nodeName?l.previousElementSibling:l.previousElementSibling.lastChild,!(0,o.isNullOrUndefined)(l.lastElementChild)&&"BR"!==l.lastElementChild.nodeName&&(0,o.isNullOrUndefined)(l.lastElementChild.previousSibling)&&"#text"!==l.lastChild.nodeName?(this.rangeElement=l.lastElementChild,n=!0):this.rangeElement=l)}else{if(this.rangeElement===this.parent.inputElement||"TABLE"===this.rangeElement.tagName||!(0,o.isNullOrUndefined)(this.rangeElement.previousElementSibling)&&"TABLE"===this.rangeElement.previousElementSibling.tagName)return;this.oldRangeElement=this.rangeElement.previousElementSibling}var d=this.parent.formatter.editorManager.domNode.blockNodes();if(!(0,o.isNullOrUndefined)(d[0])&&t.collapsed&&0===t.startOffset&&0===t.endOffset&&""!==d[0].style.marginLeft&&(d[0].style.marginLeft=parseInt(d[0].style.marginLeft,10)<=20?"":parseInt(d[0].style.marginLeft,10)-20+"px"),(0,o.isNullOrUndefined)(this.oldRangeElement)&&(0,o.isNullOrUndefined)(d[0].previousSibling))return;if(d[0].previousSibling){var c=d[0].previousSibling,h=d[0];if(c.textContent.trim()){this.removeLastBr(c);var p=this.parent.formatter.editorManager.nodeSelection.findLastTextPosition(c),u=p.offset,m=p.node,f=Array.from(h.childNodes),g=this.nodeSelectionObj.save(t,this.contentRenderer.getDocument());this.isPreviousNodeBrAfterBackSpace&&this.parent.formatter.editorManager.domNode.setMarker(g);for(var b=this.parent.formatter.editorManager.domNode.getImmediateBlockNode(m),v=0;v<f.length;v++)b.appendChild(f[v].cloneNode(!0));this.isPreviousNodeBrAfterBackSpace?(g=this.parent.formatter.editorManager.domNode.saveMarker(g)).restore():this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),m,u),h.parentNode.removeChild(h),e.args.preventDefault()}else c.parentNode.removeChild(c)}else{"OL"!==this.oldRangeElement.tagName&&"UL"!==this.oldRangeElement.tagName||(this.oldRangeElement=this.oldRangeElement.lastElementChild.lastElementChild?this.oldRangeElement.lastElementChild.lastElementChild:this.oldRangeElement.lastElementChild);for(var y=this.oldRangeElement.lastChild?this.oldRangeElement.lastChild:this.oldRangeElement;3!==y.nodeType&&"#text"!==y.nodeName&&"BR"!==y.nodeName&&!(0,o.isNullOrUndefined)(y.lastChild);)y=y.lastChild;"IMG"===y.nodeName?this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),y.parentElement,y.parentElement.childNodes.length):this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),y,y.textContent.length);var C=!1;if(this.oldRangeElement&&"#text"!==this.oldRangeElement.nodeName&&1===this.oldRangeElement.querySelectorAll("BR").length){var N=this.oldRangeElement.querySelector("BR");if(N&&(0,o.isNullOrUndefined)(N.nextSibling)){var E=N.parentNode,S=this.oldRangeElement.innerHTML;this.parent.formatter.saveData(S),(0,o.detach)(N),E&&0===E.childNodes.length&&((0,o.detach)(E),C=!0)}}if(!(0,o.isNullOrUndefined)(this.rangeElement)&&this.oldRangeElement!==this.rangeElement&&!C){for(;this.rangeElement.firstChild;)"#text"===this.oldRangeElement.nodeName?this.oldRangeElement.parentElement.appendChild(this.rangeElement.childNodes[0]):this.oldRangeElement.appendChild(this.rangeElement.childNodes[0]);n?(0,o.detach)(this.rangeElement.parentElement):(0,o.detach)(this.rangeElement),this.oldRangeElement.normalize()}}}if("Backspace"===e.args.code&&8===e.args.keyCode&&t.startContainer.nodeType!==Node.TEXT_NODE){var T=(0,o.isNullOrUndefined)(t.startContainer.childNodes[t.startOffset-1])||(0,o.isNullOrUndefined)(t.startContainer.childNodes[t.startOffset-1].isContentEditable)||t.startContainer.childNodes[t.startOffset-1].isContentEditable?null:t.startContainer.childNodes[t.startOffset-1];T&&(T.remove(),e.args.preventDefault())}},t.prototype.getLastNode=function(e){for(;e&&e.lastChild;)e=e.lastChild;for(;e&&e.nodeType===Node.TEXT_NODE&&!e.nodeValue.trim();)e=e.previousSibling;return e},t.prototype.removeLastBr=function(e){var t=this.getLastNode(e);t&&"BR"===t.nodeName&&t.parentNode&&(this.isPreviousNodeBrAfterBackSpace=!(0,o.isNullOrUndefined)(t.previousSibling)&&"BR"===t.previousSibling.nodeName,t.parentNode.removeChild(t))},t.prototype.deleteCleanup=function(e,t){var n,i,r=!1;if("Delete"===e.args.code&&46===e.args.keyCode&&0!==this.parent.contentModule.getText().trim().replace(/(\r\n|\n|\r|\t)/gm,"").replace(/\u200B/g,"").length&&0===this.parent.getSelection().length&&"TD"!==t.startContainer.parentElement.tagName&&"TH"!==t.startContainer.parentElement.tagName){if(this.deleteRangeElement=i=this.getRootBlockNode(t.startContainer),"OL"===this.deleteRangeElement.tagName||"UL"===this.deleteRangeElement.tagName)(n=this.getRangeLiNode(t.startContainer)).nextElementSibling&&n.nextElementSibling.childElementCount>0&&!n.nextElementSibling.querySelector("BR")?(0,o.isNullOrUndefined)(n.lastElementChild)?this.deleteRangeElement=n:(this.deleteRangeElement=n.lastElementChild,r=!0):this.deleteRangeElement=this.getRangeElement(n);else if(3===this.deleteRangeElement.nodeType||"TABLE"===this.deleteRangeElement.tagName||!(0,o.isNullOrUndefined)(this.deleteRangeElement.nextElementSibling)&&"TABLE"===this.deleteRangeElement.nextElementSibling.tagName)return;var s=!1;if(this.deleteRangeElement.querySelectorAll("img").length>0&&""===this.deleteRangeElement.textContent.trim()&&(s=!0),this.getCaretIndex(t,this.deleteRangeElement)!==this.deleteRangeElement.textContent.length||s)this.deleteRangeElement=null;else{if((0,o.isNullOrUndefined)(n)?this.deleteOldRangeElement=this.deleteRangeElement.nextElementSibling:r||!(0,o.isNullOrUndefined)(n.nextElementSibling)?this.deleteOldRangeElement=this.getRangeElement(n.nextElementSibling):this.deleteOldRangeElement=i.nextElementSibling,(0,o.isNullOrUndefined)(this.deleteOldRangeElement))return;0===t.startOffset&&1===t.endOffset&&"IMG"===this.deleteRangeElement.childNodes[0].nodeName?(this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(),this.deleteRangeElement,this.deleteRangeElement,0,1),this.isImageDelete=!0):(this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),this.deleteRangeElement,this.deleteRangeElement.childNodes.length),this.isImageDelete=!1);var a=this.deleteRangeElement.querySelector("BR"),l=this.deleteRangeElement.lastChild,d=void 0;if(l&&(d=l.parentNode),a&&a.classList.contains("e-rte-image-remove-focus"))return void(0,o.removeClass)([a],["e-rte-image-focus"]);if(a&&l&&"BR"===l.nodeName){if((0,o.detach)(l),(0,o.isNullOrUndefined)(d)||0!==d.childNodes.length||(0,o.detach)(d),!(0,o.isNullOrUndefined)(this.deleteRangeElement)&&this.deleteOldRangeElement.tagName&&("OL"===this.deleteOldRangeElement.tagName||"UL"===this.deleteOldRangeElement.tagName)&&this.deleteOldRangeElement!==this.deleteRangeElement&&!this.parent.contentModule.getEditPanel().contains(this.deleteRangeElement)){var c=this.deleteOldRangeElement.querySelector("li");if(c){for(var h=c;h&&h.firstChild&&h.firstChild.nodeType!==Node.TEXT_NODE;)h=h.firstChild;h&&h.firstChild&&h.firstChild.nodeType===Node.TEXT_NODE?this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),h.firstChild,0):this.parent.formatter.editorManager.nodeSelection.setCursorPoint(this.parent.contentModule.getDocument(),c,0)}else this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(),this.deleteOldRangeElement,this.deleteOldRangeElement,0,0)}e.args.preventDefault()}if(!(0,o.isNullOrUndefined)(this.deleteRangeElement)&&"OL"!==this.deleteOldRangeElement.tagName&&"UL"!==this.deleteOldRangeElement.tagName&&this.deleteOldRangeElement!==this.deleteRangeElement&&this.parent.contentModule.getEditPanel().contains(this.deleteRangeElement)){for(;this.deleteOldRangeElement.firstChild;)this.deleteRangeElement.appendChild(this.deleteOldRangeElement.childNodes[0]);r?(0,o.detach)(this.deleteOldRangeElement.parentElement):(0,o.detach)(this.deleteOldRangeElement),this.deleteRangeElement.normalize()}else this.deleteRangeElement=null,this.deleteOldRangeElement=null}}},t.prototype.getCaretIndex=function(e,t){var n=0;if(0!==this.parent.contentModule.getDocument().getSelection().rangeCount){var i=e.cloneRange();i.selectNodeContents(t),i.setEnd(e.endContainer,e.endOffset),n=i.toString().length}return n},t.prototype.getRangeElement=function(e){return e.childNodes.length<=1&&e.lastElementChild?"BR"===e.lastElementChild.tagName?e.lastElementChild.previousElementSibling?e.lastElementChild.previousElementSibling:e:e.lastElementChild:e},t.prototype.getRootBlockNode=function(e){for(;e&&this.parent&&this.parent.inputElement!==e&&e.parentElement!==this.parent.inputElement;e)e=e.parentElement;return e},t.prototype.getRangeLiNode=function(e){for(var t=e.parentElement;t!==this.parent.inputElement&&(1!==t.nodeType||"LI"!==t.tagName);)t=t.parentElement;return t},t.prototype.onPaste=function(e){var t=new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.))(\S+))/gi);if(e.text.match(t)){if(e.isWordPaste)return;e.args.preventDefault();for(var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()),i=(this.parent.formatter.editorManager.nodeSelection.save(n,this.parent.contentModule.getDocument()),new RegExp(/([^\S]|^)(((https?\:\/\/)))/gi)),r=new RegExp(/([^\S]|^)(((www\.))(\S+))/gi),s=e.text.split("\n"),a="",l=0;l<s.length;l++)if(""===s[l].trim())a+=Dr(this.parent);else{for(var d="",c=!0,h=s[l].split(" "),p=0;p<h.length;p++)""===h[p].trim()?d+=c?"&nbsp;":" ":(c=!1,d+=h[p]+" ");a+=0===l?"<span>"+d.trim()+"</span>":"<p>"+d.trim()+"</p>"}var u=this.parent.createElement("div");u.setAttribute("class","pasteContent"),u.style.display="inline",u.innerHTML=a.replace("&para","&amp;para");var m=u.querySelectorAll("span, p");for(l=0;l<m.length;l++){var f=m[l].innerHTML.split(" "),g="";for(p=0;p<f.length;p++)f[p].match(i)||f[p].match(r)?g+='<a class="e-rte-anchor" href="'+f[p]+'" title="'+f[p]+'" target="_blank" aria-label="'+this.parent.serviceLocator.getService("rteLocale").getConstant("linkAriaLabel")+'">'+f[p]+" </a>":g+=f[p]+" ";m[l].innerHTML=g.trim()}var b=u.childNodes[0];(0,o.isNullOrUndefined)(b)||(0,o.isNullOrUndefined)(b.childNodes[0])||"SPAN"!==b.nodeName||"A"!==b.childNodes[0].nodeName||(u.innerHTML=u.innerHTML.replace("<span>","").replace("</span>","")),(0,o.isNullOrUndefined)(this.parent.pasteCleanupModule)?this.parent.formatter.editorManager.execCommand("insertHTML",null,null,null,u):e.callBack(u.innerHTML)}},t.prototype.spaceLink=function(e){var t=this.nodeSelectionObj.getRange(this.contentRenderer.getDocument());if(t.startContainer.nodeType===Node.TEXT_NODE){var n=this.nodeSelectionObj.getParentNodeCollection(t),i=t.startContainer.textContent.substr(0,t.endOffset),o=i.split(" "),r=o[o.length-1],s=t.startOffset-(i.length-o[o.length-1].length);r=r.slice(0,s);var a=new RegExp(/([^\S]|^)(((https?\:\/\/)|(www\.))(\S+))/gi);if(n[0]&&"A"!==n[0].nodeName&&r.match(a)){var l=this.nodeSelectionObj.save(t,this.parent.contentModule.getDocument()),d={url:r.indexOf("http")>-1?r:"http://"+r,selection:l,selectParent:this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(t),text:r,title:"",target:"_blank"};this.parent.formatter.process(this.parent,{item:{command:"Links",subCommand:"CreateLink"}},e,d)}}},t.prototype.onToolbarClick=function(e){var t,n,i,r=this,s=e.item,a=(0,o.closest)(e.originalEvent.target,".e-rte-quick-popup"),l=e.originalEvent.target;if(this.parent.notify($t,{target:l}),"FormatPainter"!==s.command)if(!a||a.classList.contains("e-rte-inline-popup")||a.classList.contains("e-rte-text-popup")){var d=document.getElementById(this.parent.getID()+"_rtelink"),c=document.getElementById(this.parent.getID()+"_image");if("SourceCode"!==s.subCommand&&"Preview"!==s.subCommand&&"FontColor"!==s.subCommand&&"BackgroundColor"!==s.subCommand&&"NumberFormatList"!==s.subCommand&&"BulletFormatList"!==s.subCommand){h=this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());(0,o.isNullOrUndefined)(d)&&(0,o.isNullOrUndefined)(c)&&(t=this.nodeSelectionObj.save(h,this.parent.contentModule.getDocument())),n=this.nodeSelectionObj.getNodeCollection(h),i=this.nodeSelectionObj.getParentNodeCollection(h)}switch(s.subCommand){case"Maximize":this.parent.notify(B,{args:e});break;case"Minimize":this.parent.notify(R,{args:e});break;case"CreateLink":this.parent.notify(G,{member:"link",args:e,selectNode:n,selection:t,selectParent:i});break;case"RemoveLink":this.parent.notify(X,{member:"link",args:e,selectNode:n,selection:t,selectParent:i});break;case"Print":this.parent.print();break;case"Image":this.parent.notify(ie,{member:"image",args:e,selectNode:n,selection:t,selectParent:i});break;case"Audio":this.parent.notify(oe,{member:"audio",args:e,selectNode:n,selection:t,selectParent:i});break;case"Video":this.parent.notify(re,{member:"video",args:e,selectNode:n,selection:t,selectParent:i});break;case"CreateTable":this.parent.notify(Ve,{member:"table",args:e,selection:t});break;case"SourceCode":this.parent.notify(Ce,{member:"viewSource",args:e});break;case"Preview":this.parent.notify(Ne,{member:"updateSource",args:e});break;case"FontColor":case"BackgroundColor":break;case"File":this.parent.notify(Ot,{member:"fileManager",args:e,selectNode:n,selection:t,selectParent:i});break;case"EmojiPicker":this.parent.notify(Vt,{member:"emojiPicker",args:e});break;case"ImportWord":this.parent.notify(x,{});break;case"ExportWord":this.parent.notify(w,{member:"ExportWord",args:e});break;case"ExportPdf":this.parent.notify(w,{member:"ExportPdf",args:e});break;default:this.parent.formatter.process(this.parent,e,e.originalEvent,null)}!(0,o.isNullOrUndefined)(this.parent.quickToolbarModule)&&((0,o.isNullOrUndefined)(this.parent.quickToolbarModule.imageQTBar)&&"Image"===s.subCommand||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule.audioQTBar)&&"Audio"===s.subCommand||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule.videoQTBar)&&"Video"===s.subCommand||(0,o.isNullOrUndefined)(this.parent.quickToolbarModule.linkQTBar)&&"CreateLink"===s.subCommand)&&this.parent.notify(Ct,{})}else{if("SourceCode"!==s.subCommand&&"Preview"!==s.subCommand&&"FontColor"!==s.subCommand&&"BackgroundColor"!==s.subCommand){Us()&&"Images"===s.command&&this.nodeSelectionObj.restore();var h=this.nodeSelectionObj.getRange(this.parent.contentModule.getDocument());t=this.nodeSelectionObj.save(h,this.parent.contentModule.getDocument()),n=this.nodeSelectionObj.getNodeCollection(h),i=this.nodeSelectionObj.getParentNodeCollection(h)}"Images"===s.command&&this.parent.notify(H,{member:"image",args:e,selectNode:n,selection:t,selectParent:i}),"Audios"===s.command&&this.parent.notify(j,{member:"audio",args:e,selectNode:n,selection:t,selectParent:i}),"Videos"===s.command&&this.parent.notify(F,{member:"video",args:e,selectNode:n,selection:t,selectParent:i}),"Links"===s.command&&this.parent.notify(q,{member:"link",args:e,selectNode:n,selection:t,selectParent:i}),"Table"===s.command&&this.parent.notify(Qe,{member:"table",args:e,selectNode:n,selection:t,selectParent:i})}else 1===e.originalEvent.detail?(clearTimeout(this.clickTimeout),this.clickTimeout=setTimeout((function(){r.parent.notify(zt,{member:"formatPainter",args:e})}),200)):(clearTimeout(this.clickTimeout),this.parent.notify(_t,{member:"formatPainter",args:e}))},t.prototype.instantiateRenderer=function(){this.parent.iframeSettings.enable?this.renderFactory.addRenderer(e.Content,new Ol(this.parent)):this.renderFactory.addRenderer(e.Content,new qr(this.parent))},t.prototype.removeEventListener=function(){this.parent.off(u,this.render),this.parent.off(T,this.onPropertyChanged),this.parent.off(E,this.onToolbarClick),this.parent.off(f,this.destroy),this.parent.off(k,this.onKeyDown),this.parent.off(d,this.instantiateRenderer),this.parent.off(Pe,this.selectAll),this.parent.off(He,this.selectRange),this.parent.off(je,this.getSelectedHtml),this.parent.off(Te,this.onSelectionSave),this.parent.off(Oe,this.onSelectionRestore),this.parent.off(Ge,this.updateReadOnly),this.parent.off(qe,this.onPaste),this.parent.off(a,this.isTableClassAdded)},t.prototype.render=function(){this.contentRenderer=this.renderFactory.getRenderer(e.Content);var t=this.contentRenderer.getEditPanel(),n={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer};if((0,o.isNullOrUndefined)(this.parent.formatter)){var i=new $d({currentDocument:this.contentRenderer.getDocument(),element:t,options:n,formatPainterSettings:this.parent.formatPainterSettings});this.parent.setProperties({formatter:i},!0)}else this.parent.formatter.updateFormatter(t,this.contentRenderer.getDocument(),n,this.parent.formatPainterSettings);this.parent.enableXhtml&&this.parent.notify(Nt,{}),this.parent.toolbarSettings.enable&&(this.toolbarUpdate=new Zd(this.parent)),this.parent.inlineMode.enable&&((0,o.isNullOrUndefined)(this.parent.fontFamily.default)||(t.style.fontFamily=this.parent.fontFamily.default),(0,o.isNullOrUndefined)(this.parent.fontSize.default)||(t.style.fontSize=this.parent.fontSize.default)),this.parent.notify(N,{})},t.prototype.onPropertyChanged=function(e){if((0,o.isNullOrUndefined)(e)||(0,o.isNullOrUndefined)(e.newProp.toolbarSettings)||(0,o.isNullOrUndefined)(e.newProp.toolbarSettings.enable)||(this.toolbarUpdate=new Zd(this.parent)),!(0,o.isNullOrUndefined)(e.newProp.formatter)){var t=this.contentRenderer.getEditPanel(),n={undoRedoSteps:this.parent.undoRedoSteps,undoRedoTimer:this.parent.undoRedoTimer};this.parent.formatter.updateFormatter(t,this.contentRenderer.getDocument(),n)}},t.prototype.getModuleName=function(){return"htmlEditor"},t.prototype.selectAll=function(){var e=Lr(this.parent.contentModule.getDocument(),this.parent.contentModule.getEditPanel());e.length>0&&this.parent.formatter.editorManager.nodeSelection.setSelectionText(this.parent.contentModule.getDocument(),e[0],e[e.length-1],0,e[e.length-1].textContent.length)},t.prototype.selectRange=function(e){this.parent.formatter.editorManager.nodeSelection.setRange(this.parent.contentModule.getDocument(),e.range)},t.prototype.getSelectedHtml=function(e){e.callBack(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).toString())},t.prototype.tableSelectionKeyAction=function(e){for(var t=e.args,n=this.parent.inputElement.querySelectorAll(".e-cell-select"),i=0;i<n.length;i++){var o=n[i];Fs([o],[Pi,ji,Hi]),0===i?(32===t.keyCode?o.innerHTML="&#8203;<br>":o.innerHTML="<br>",this.nodeSelectionObj.setCursorPoint(this.parent.contentModule.getDocument(),o.firstChild,0)):o.innerHTML="<br>"}},t.prototype.marginTabAdd=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(!i.closest("li"))if(i.style.marginLeft){var o=parseInt(i.style.marginLeft,10);e?o-=20:o+=20,i.style.marginLeft=o.toString()+"px","0px"===i.style.marginLeft&&i.removeAttribute("style")}else e||(i.style.marginLeft="20px")}},t}(),nc=function(){function t(e,t){this.isNotFromHtml=!1,this.containsHtml=!1,this.cropImageData=[],this.plainTextContent="",this.parent=e,this.locator=t,this.renderFactory=this.locator.getService("rendererFactory"),this.i10n=t.getService("rteLocale"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.addEventListener(),this.isDestroyed=!1}return t.prototype.addEventListener=function(){this.nodeSelectionObj=new sl(this.parent.inputElement),this.parent.isDestroyed||(this.parent.on(Xe,this.pasteClean,this),this.parent.on(qt,this.setCssClass,this),this.parent.on(f,this.destroy,this),this.parent.on(We,this.docClick,this))},t.prototype.destroy=function(){this.isDestroyed||(this.fireFoxUploadTime&&(clearTimeout(this.fireFoxUploadTime),this.fireFoxUploadTime=null),this.refreshPopupTime&&(clearTimeout(this.refreshPopupTime),this.refreshPopupTime=null),this.popupCloseTime&&(clearTimeout(this.popupCloseTime),this.popupCloseTime=null),this.failureTime&&(clearTimeout(this.failureTime),this.failureTime=null),this.iframeUploadTime&&(clearTimeout(this.iframeUploadTime),this.iframeUploadTime=null),this.removeEventListener(),this.popupObj&&!this.popupObj.isDestroyed&&(this.popupObj.destroy(),this.popupObj=null),this.uploadObj&&!this.uploadObj.isDestroyed&&(this.uploadObj.destroy(),this.uploadObj=null),this.keepRadioButton&&!this.keepRadioButton.isDestroyed&&(this.keepRadioButton.destroy(),this.keepRadioButton=null),this.cleanRadioButton&&!this.cleanRadioButton.isDestroyed&&(this.cleanRadioButton.destroy(),this.cleanRadioButton=null),this.plainTextRadioButton&&!this.plainTextRadioButton.isDestroyed&&(this.plainTextRadioButton.destroy(),this.plainTextRadioButton=null),this.isDestroyed=!0,this.plainTextContent="")},t.prototype.removeEventListener=function(){this.parent.off(Xe,this.pasteClean),this.parent.off(qt,this.setCssClass),this.parent.off(f,this.destroy),this.parent.off(We,this.docClick)},t.prototype.pasteClean=function(t){var n,i=this,r={requestType:"Paste",editorMode:this.parent.editorMode,event:t},s=null,a=this.parent.insertImageSettings.allowedTypes;if(t.args&&!(0,o.isNullOrUndefined)(t.args.clipboardData)&&(s=t.args.clipboardData.getData("text/html"),t.args.clipboardData.getData("text/plain")&&(this.plainTextContent=t.args.clipboardData.getData("text/plain"))),t.args&&null!==s&&"HTML"===this.parent.editorMode){var l=void 0;if(0===s.length){var d=new RegExp(/<\/[a-z][\s\S]*>/i);if(s=t.args.clipboardData.getData("text/plain"),this.parent.trigger(xt,{value:s}),this.isNotFromHtml=""!==s,s=(s=s.replace(/</g,"&lt;")).replace(/>/g,"&gt;"),this.containsHtml=d.test(s),this.plainTextContent=s,l=t&&t.args.clipboardData&&t.args.clipboardData.items.length>0?null===t.args.clipboardData.items[0].getAsFile()?(0,o.isNullOrUndefined)(t.args.clipboardData.items[1])?null:t.args.clipboardData.items[1].getAsFile():t.args.clipboardData.items[0].getAsFile():null){var c=l.name,h=c.substring(c.lastIndexOf("."));if(a.every((function(e){return e.toLowerCase()!==h})))return void t.args.preventDefault()}if(this.parent.notify(qe,{file:l,args:t.args,text:s,callBack:function(e){"object"==typeof(n=e)?i.parent.formatter.editorManager.execCommand("Images","Image",t.args,i.imageFormatting.bind(i,r),"pasteCleanup",n,"pasteCleanupModule"):s=n}}),!d.test(s)){var p=this.parent.createElement("div");p.innerHTML=this.splitBreakLine(s),s=p.innerHTML}}else s.length>0&&(this.parent.trigger(xt,{value:s}),this.parent.formatter.editorManager.observer.notify(ta,{args:t.args,text:t.text,allowedStylePropertiesArray:this.parent.pasteCleanupSettings.allowedStyleProps,callBack:function(e,t,n){r.pasteTableSource=n,s=e.trim(),i.cropImageData=t}}));null!==s&&""!==s&&(s=s.replace(/<base[^>]*>/g,"")),this.contentRenderer=this.renderFactory.getRenderer(e.Content);var u=this.contentRenderer.getDocument(),m=this.nodeSelectionObj.getRange(u);this.saveSelection=this.nodeSelectionObj.save(m,u);var f=this.parent.createElement("div");f.innerHTML=s;for(var g=f.querySelectorAll(".e-rte-image-unsupported"),b=0;b<g.length;b++)g[b].setAttribute("alt",this.i10n.getConstant("unsupportedImage")),g[b].classList.remove("e-rte-image-unsupported");s=f.innerHTML;var v=""!==f.textContent||!(0,o.isNullOrUndefined)(f.querySelector("img"))||!(0,o.isNullOrUndefined)(f.querySelector("table"));this.parent.notify(Kt,{value:s,callBack:function(e){s=e}}),this.parent.pasteCleanupSettings.prompt&&!t.isPlainPaste?v&&(t.args.preventDefault(),this.pasteDialog(s,r)):this.parent.pasteCleanupSettings.plainText?(t.args.preventDefault(),this.plainFormatting(s,r)):this.parent.pasteCleanupSettings.keepFormat||t.isPlainPaste?(t.args.preventDefault(),this.formatting(s,!1,r)):(t.args.preventDefault(),this.formatting(s,!0,r))}},t.prototype.splitBreakLine=function(e){for(var t=e.split("\r\n\r\n"),n="",i="P"===this.parent.enterKey?"<p>":"DIV"===this.parent.enterKey?"<div>":"",o="P"===this.parent.enterKey?"</p>":"DIV"===this.parent.enterKey?"</div>":"<br>",r=0;r<t.length;r++){var s=t[r],a=this.makeSpace(s).replace(/\r\n|\n/g,"<br>");0===r?"BR"!==this.parent.enterKey||a.endsWith("<br>")?n+=a:n+=a+o:"BR"===this.parent.enterKey?r===t.length-1?n+=a+o:n+=a+o+o:n+=i+a+o}return n},t.prototype.makeSpace=function(e){var t="";if(""===e)return e;for(var n=e.split(" "),i=0;i<n.length;i++){var o=n[i];""===o?t+="&nbsp;":"\t"===o?t+="&nbsp;&nbsp;&nbsp;&nbsp;":(i>0&&i<n.length&&(t+=" "),t+=o)}return t=(t=t.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")).replace(/&nbsp;&nbsp;/g,"&nbsp; ")},t.prototype.imgUploading=function(e){var t=e.querySelectorAll(".pasteContent_Img");if(this.parent.insertImageSettings.saveUrl&&t.length>0){for(var n=[],i=[],r=[],s=0;s<t.length;s++)!(0,o.isNullOrUndefined)(t[s].getAttribute("src"))&&t[s].getAttribute("src").split(",")[0].indexOf("base64")>=0&&(n.push(t[s].getAttribute("src")),i.push((0,o.getUniqueID)("rte_image")),r.push(t[s]));var a=[];for(s=0;s<n.length;s++)a.push(this.base64ToFile(n[s],i[s]));for(s=0;s<a.length;s++)this.uploadMethod(a[s],r[s]);(0,o.isNullOrUndefined)(this.parent.insertImageSettings.path)&&"Blob"===this.parent.insertImageSettings.saveFormat&&this.getBlob(t)}else"Blob"===this.parent.insertImageSettings.saveFormat&&this.getBlob(t);var l=e.querySelectorAll(".pasteContent_Img");for(s=0;s<l.length;s++)l[s].classList.remove("pasteContent_Img"),""===l[s].getAttribute("class").trim()&&t[s].removeAttribute("class")},t.prototype.getBlob=function(e){for(var t=0;t<e.length;t++)if(!(0,o.isNullOrUndefined)(e[t].getAttribute("src"))&&e[t].getAttribute("src").split(",")[0].indexOf("base64")>=0){var n=URL.createObjectURL(Ir(e[t].getAttribute("src")));e[t].setAttribute("src",n)}},t.prototype.toolbarEnableDisable=function(e){this.parent.inlineMode.enable||this.parent.toolbarModule.baseToolbar.toolbarObj.disable(e)},t.prototype.uploadMethod=function(e,t){var n=this;t.style.opacity="0.5";var i=this.parent.createElement("div");this.parent.rootContainer.appendChild(i);var r=this.parent.createElement("input",{id:this.parent.getID()+"_upload",attrs:{type:"File",name:"UploadFiles"}});this.popupObj=new Wr.Popup(i,{relateTo:t,height:"85px",width:"300px",collision:{X:"fit",Y:"fit"},content:r,viewPortElement:this.parent.contentModule.getPanel(),position:{X:"center",Y:"top"},enableRtl:this.parent.enableRtl,zIndex:10001,close:function(e){n.parent.isBlur=!1,n.popupObj.destroy(),(0,o.detach)(n.popupObj.element)}}),this.popupObj.element.style.display="none",(0,o.addClass)([this.popupObj.element],[ao,so]),(0,o.isNullOrUndefined)(this.parent.cssClass)||(0,o.addClass)([this.popupObj.element],this.parent.cssClass.replace(/\s+/g," ").trim().split(" "));var s=e.size>1e6?300:100;this.refreshPopupTime=setTimeout((function(){n.refreshPopup(t,n.popupObj)}),s),this.uploadObj=new Qr.Uploader({asyncSettings:{saveUrl:this.parent.insertImageSettings.saveUrl,removeUrl:this.parent.insertImageSettings.removeUrl},cssClass:uo,dropArea:this.parent.inputElement,allowedExtensions:this.parent.insertImageSettings.allowedTypes.toString(),success:function(e){n.popupClose(n.popupObj,n.uploadObj,t,e)},uploading:function(e){n.parent.isServerRendered||n.parent.trigger(lt,e,(function(e){e.cancel?((0,o.isNullOrUndefined)(t)||(0,o.detach)(t),(0,o.isNullOrUndefined)(n.popupObj.element)||(0,o.detach)(n.popupObj.element)):n.parent.inputElement.contentEditable="false"}))},beforeUpload:function(e){n.parent.trigger(Et,e),n.toolbarEnableDisable(!0)},failure:function(e){n.failureTime=setTimeout((function(){n.uploadFailure(t,n.uploadObj,n.popupObj,e)}),900)},canceling:function(){n.parent.inputElement.contentEditable="true"," "===t.nextSibling.textContent&&(0,o.detach)(t.nextSibling),(0,o.detach)(t),n.popupObj.close()},selected:function(e){e.cancel=!0},removing:function(){n.parent.inputElement.contentEditable="true"," "===t.nextSibling.textContent&&(0,o.detach)(t.nextSibling),(0,o.detach)(t),n.popupObj.close()}}),this.uploadObj.appendTo(this.popupObj.element.childNodes[0]);var a=[{name:e.name,rawFile:e,size:e.size,type:e.type,status:"Ready to Upload",validationMessages:{minSize:"",maxSize:""},statusCode:"1"}];this.uploadObj.createFileList(a),this.uploadObj.upload(a),this.popupObj.element.getElementsByClassName("e-file-select-wrap")[0].style.display="none",(0,o.detach)(this.popupObj.element.querySelector(".e-rte-dialog-upload .e-file-select-wrap"))},t.prototype.uploadFailure=function(e,t,n,i){this.parent&&this.parent.isDestroyed||(this.parent.inputElement.contentEditable="true",(0,o.detach)(e),n&&(this.parent.isBlur=!1,n.destroy(),(0,o.isNullOrUndefined)(n.element)||(0,o.detach)(n.element)),this.parent.trigger(ct,i),t&&document.body.contains(t.element)&&t.destroy())},t.prototype.popupClose=function(e,t,n,r){var s=this;this.parent.inputElement.contentEditable="true",r.element=n,r.detectImageSource=i.Pasted;var a=r.file;"2"===a.statusCode?this.parent.trigger(dt,r,(function(e){if(!(0,o.isNullOrUndefined)(s.parent.insertImageSettings.path)){var t=s.parent.insertImageSettings.path+e.file.name;if(!s.parent.inputElement.contains(n)&&n.id)for(var i=s.parent.inputElement.querySelectorAll("#"+n.id),r=0;r<i.length;r++){var a=i[r];a&&a.style&&"0.5"===a.style.opacity&&(a.src=t,a.setAttribute("alt",e.file.name))}else n.src=t,n.setAttribute("alt",e.file.name)}})):"5"===a.statusCode&&this.parent.trigger(ht,r,(function(e){(0,o.isNullOrUndefined)(e.element.src)||(e.element.src="")})),this.popupCloseTime=setTimeout((function(){if(e&&(s.parent.isBlur=!1,e.destroy(),(0,o.isNullOrUndefined)(e.element)||(0,o.detach)(e.element)),s.parent.inputElement.contains(n)||!n.id&&!n.alt)n.style.opacity="1";else{var i=n.id?"#"+n.id:'[alt="'+n.alt+'"]';if(i)for(var r=s.parent.inputElement.querySelectorAll(i),a=0;a<r.length;a++){var l=r[a];l&&l.style&&"0.5"===l.style.opacity&&(l.style.opacity="1")}}s.toolbarEnableDisable(!1),t&&document.body.contains(t.element)&&t.destroy()}),1500)},t.prototype.refreshPopup=function(e,t){(this.parent.iframeSettings.enable?this.parent.element.offsetTop+e.offsetTop:e.offsetTop)>this.parent.element.offsetTop+this.parent.element.offsetHeight?(t.relateTo=this.parent.inputElement,t.offsetY=this.parent.iframeSettings.enable?-30:-65,t.element.style.display="block"):t&&(t.refreshPosition(e),t.element.style.display="block")},t.prototype.base64ToFile=function(e,t){for(var n=e.split(","),i=n[0].match(/:(.*?);/)[1].split("/")[1],r=atob(n[1]),s=r.length,a=new Uint8Array(s);s--;)a[s]=r.charCodeAt(s);if(o.Browser.isIE||navigator.appVersion.indexOf("Edge")>-1){var l=new Blob([a],{type:i});return(0,o.extend)(l,{name:t+"."+((0,o.isNullOrUndefined)(i)?"":i)}),l}return new File([a],t+"."+((0,o.isNullOrUndefined)(i)?"":i),{type:i})},t.prototype.imageFormatting=function(t,n){(0,o.isNullOrUndefined)(n.elements[0].getAttribute("src"))||n.elements[0].classList.add("pasteContent_Img");var i=this.parent.createElement("span");i.appendChild(n.elements[0]);var r=i.innerHTML;this.contentRenderer=this.renderFactory.getRenderer(e.Content);var s=this.contentRenderer.getDocument(),a=this.nodeSelectionObj.getRange(s);this.saveSelection=this.nodeSelectionObj.save(a,s),this.parent.pasteCleanupSettings.prompt?this.pasteDialog(r,t):this.parent.pasteCleanupSettings.plainText?this.plainFormatting(r,t):this.parent.pasteCleanupSettings.keepFormat?this.formatting(r,!1,t):this.formatting(r,!0,t)},t.prototype.radioRender=function(){this.keepRadioButton=new hl.RadioButton({label:this.i10n.getConstant("keepFormat"),name:"pasteOption",checked:!0}),this.keepRadioButton.isStringTemplate=!0;var e=this.parent.element.querySelector("#keepFormating");this.keepRadioButton.appendTo(e),this.cleanRadioButton=new hl.RadioButton({label:this.i10n.getConstant("cleanFormat"),name:"pasteOption"}),this.cleanRadioButton.isStringTemplate=!0;var t=this.parent.element.querySelector("#cleanFormat");this.cleanRadioButton.appendTo(t),this.plainTextRadioButton=new hl.RadioButton({label:this.i10n.getConstant("plainText"),name:"pasteOption"}),this.plainTextRadioButton.isStringTemplate=!0;var n=this.parent.element.querySelector("#plainTextFormat");this.plainTextRadioButton.appendTo(n)},t.prototype.selectFormatting=function(e,t,n,i){n?this.formatting(e,!1,t):i?this.formatting(e,!0,t):this.plainFormatting(e,t)},t.prototype.pasteDialog=function(e,t){var n=this,i={buttons:[{click:function(){if(!n.dialogObj.isDestroyed){var i=n.parent.element.querySelector("#keepFormating").checked,o=n.parent.element.querySelector("#cleanFormat").checked;n.dialogObj.hide();var r=n.dialogObj;n.dialogRenderObj.close(r),n.dialogObj.destroy(),n.selectFormatting(e,t,i,o)}},buttonModel:{isPrimary:!0,cssClass:"e-flat "+Xi,content:this.i10n.getConstant("pasteDialogOk")}},{click:function(){if(!n.dialogObj.isDestroyed){n.dialogObj.hide();var e=n.dialogObj;n.dialogRenderObj.close(e),n.dialogObj.destroy()}},buttonModel:{cssClass:"e-flat "+Yi,content:this.i10n.getConstant("pasteDialogCancel")}}],header:this.i10n.getConstant("pasteFormat"),content:this.i10n.getConstant("pasteFormatContent")+'<br/><div><div style="padding-top:24px;"><input type="radio" class="'+Qi+'" id="keepFormating"/></div><div style="padding-top:20px;"><input type="radio" class="'+Ki+'" id="cleanFormat"/></div><div style="padding-top:20px;"><input type="radio" class="'+Gi+'" id="plainTextFormat"/></div></div>',target:this.parent.element,width:"300px",height:"265px",cssClass:Ji,isModal:o.Browser.isDevice,visible:!1};this.dialogObj=this.dialogRenderObj.render(i);var r=this.parent.element.querySelector("#"+this.parent.getID()+"_pasteCleanupDialog");null!==r&&""!==r.innerHTML&&this.destroyDialog(r),null===r&&(r=this.parent.createElement("div",{id:this.parent.getID()+"_pasteCleanupDialog"}),this.parent.rootContainer.appendChild(r)),this.dialogObj.appendTo(r),this.radioRender(),this.dialogObj.show(),this.setCssClass({cssClass:this.parent.getCssClass()})},t.prototype.updateCss=function(e,t){e&&t.cssClass&&((0,o.isNullOrUndefined)(t.oldCssClass)?e.setProperties({cssClass:(e.cssClass+" "+t.cssClass).trim()}):e.setProperties({cssClass:(e.cssClass.replace(t.oldCssClass,"").trim()+" "+t.cssClass).trim()}))},t.prototype.setCssClass=function(e){this.popupObj&&e.cssClass&&((0,o.isNullOrUndefined)(e.oldCssClass)||(0,o.removeClass)([this.popupObj.element],e.oldCssClass),(0,o.addClass)([this.popupObj.element],e.cssClass)),this.updateCss(this.dialogObj,e),this.updateCss(this.uploadObj,e),this.updateCss(this.plainTextRadioButton,e),this.updateCss(this.cleanRadioButton,e),this.updateCss(this.keepRadioButton,e)},t.prototype.destroyDialog=function(e){var t=this.parent.element.querySelector(".e-rte-dialog-minheight");(0,o.detach)(t);for(var n=e.children.length,i=0;i<n;i++)(0,o.detach)(e.children[0])},t.prototype.docClick=function(e){var t=e.args.target;t&&t.classList&&this.dialogObj&&!(0,o.closest)(t,"[id='"+this.dialogObj.element.id+"']")&&!t.classList.contains("e-toolbar-item")&&this.dialogObj&&this.dialogObj.hide()},t.prototype.cleanAppleClass=function(e){for(var t=e.querySelectorAll("br.Apple-interchange-newline"),n=0;n<t.length;n++)(0,o.detach)(t[n]);return e},t.prototype.formatting=function(e,t,n){var i=this,r=this.parent.createElement("div",{className:"pasteContent",styles:"display:inline;"});this.isNotFromHtml&&this.containsHtml&&(e=this.splitBreakLine(e)),r.innerHTML=e,r=this.cleanAppleClass(r),null!==this.parent.pasteCleanupSettings.deniedTags&&(r=this.deniedTags(r)),(t||null!==this.parent.pasteCleanupSettings.deniedAttrs)&&(r=this.deniedAttributes(r,t)),null!==this.parent.pasteCleanupSettings.allowedStyleProps&&(r=this.allowedStyle(r)),this.saveSelection.restore();var s=r.innerHTML;this.parent.enableHtmlSanitizer&&(s=r.innerHTML.split("&").join("&amp;")),r.innerHTML=this.sanitizeHelper(s);for(var a=r.querySelectorAll("img"),l=0;l<a.length;l++)(0,o.isNullOrUndefined)(a[l].getAttribute("src"))||a[l].classList.add("pasteContent_Img"),this.setImageProperties(a[l]);if(this.addTempClass(r),r.querySelectorAll("picture").length>0&&this.processPictureElement(r),""!==r.textContent||!(0,o.isNullOrUndefined)(r.querySelector("img"))||!(0,o.isNullOrUndefined)(r.querySelector("table"))){var d=this.parent.createElement("div");d.innerHTML=e;var c=[];if(!(0,o.isNullOrUndefined)(d.querySelector("img"))){var h=d.querySelectorAll("img"),p=[],u=[],m=[];for(l=0;l<h.length;l++)h[l].getAttribute("src")&&h[l].getAttribute("src").split(",")[0].indexOf("base64")>=0&&(p.push(h[l].getAttribute("src")),u.push((0,o.getUniqueID)("rte_image")),m.push(h[l]));var f=[],g=void 0;for(l=0;l<p.length;l++)f.push(this.base64ToFile(p[l],u[l])),g={name:f[l].name,rawFile:f[l],size:f[l].size,type:f[l].type,status:"",validationMessages:{minSize:"",maxSize:""},statusCode:"1"},c.push(g)}this.parent.trigger(wt,{value:r.innerHTML,filesData:c},(function(t){e=t.value})),r.innerHTML=this.parent.addAnchorAriaLabel(e),r=this.addTableClass(r,n.pasteTableSource),this.parent.formatter.editorManager.execCommand("inserthtml","pasteCleanup",n,(function(e){(0,o.extend)(n,{elements:e.elements,imageElements:e.imgElem},!0),i.parent.formatter.onSuccess(i.parent,n)}),r,null,null,this.parent.enterKey),this.parent.notify(Zt,{}),Hs(this.parent.contentModule.getDocument(),this.parent.inputElement),this.removeTempClass(),this.parent.notify(b,{}),this.cropImageHandler(this.parent.inputElement)}},t.prototype.convertBlobToBase64=function(e){for(var t=e.querySelectorAll("img"),n=function(e){if(t[e].getAttribute("src")&&t[e].getAttribute("src").startsWith("blob")){var n=t[e].getAttribute("src"),i=new Image,o=function(){var n=document.createElement("canvas"),r=n.getContext("2d");n.width=i.width,n.height=i.height,r.drawImage(i,0,0);var s=n.toDataURL("image/png");t[e].src=s,i.removeEventListener("load",o)};i.src=n,i.addEventListener("load",o)}},i=0;i<t.length;i++)n(i)},t.prototype.cropImageHandler=function(e){var t=this,n=e.querySelectorAll(".e-img-cropped");if(n.length>0)for(var i=function(e){if(n[e].getAttribute("src").split(",")[0].indexOf("base64")>=0){var i=new Image;i.src=n[e].getAttribute("src");var o=document.createElement("canvas"),r=o.getContext("2d");i.onload=function(){var s=t.cropImageData[e].goalWidth/i.naturalWidth,a=t.cropImageData[e].goalHeight/i.naturalHeight,l=t.cropImageData[e].cropLength/s,d=t.cropImageData[e].cropTop/a,c=(t.cropImageData[e].goalWidth-t.cropImageData[e].cropLength-t.cropImageData[e].cropR)/s,h=(t.cropImageData[e].goalHeight-t.cropImageData[e].cropTop-t.cropImageData[e].cropB)/a;o.width=c,o.height=h,r.drawImage(i,l,d,c,h,0,0,c,h);var p=o.toDataURL("image/png");n[e].setAttribute("src",p),n[e].classList.remove("e-img-cropped"),t.imgUploading(t.parent.inputElement),t.parent.iframeSettings.enable&&t.parent.updateValue()}}},r=0;r<n.length;r++)i(r);else!(0,o.isNullOrUndefined)(this.parent.insertImageSettings.saveUrl)&&!(0,o.isNullOrUndefined)(this.parent.insertImageSettings.path)&&this.parent.inputElement.querySelectorAll("img").length>0&&this.parent.inputElement.querySelectorAll("img")[0].src.startsWith("blob")?(this.convertBlobToBase64(this.parent.inputElement),this.iframeUploadTime=setTimeout((function(){t.imgUploading(t.parent.inputElement),t.parent.iframeSettings.enable&&t.parent.updateValue()}),20)):(this.imgUploading(this.parent.inputElement),this.parent.iframeSettings.enable&&this.parent.updateValue())},t.prototype.addTableClass=function(e,t){for(var n=e.querySelectorAll("table"),i=0;i<n.length;i++){var r="FIGURE"===n[i].parentElement.nodeName;n[i].classList.length>0&&n[i].classList.contains("e-rte-custom-table")||(this.parent.pasteCleanupSettings.keepFormat&&t&&!r?n[i].classList.add("e-rte-paste-"+t+"-table"):n[i].classList.contains("e-rte-table")||n[i].classList.add("e-rte-table"),(0,o.isNullOrUndefined)(n[i].nextElementSibling)&&n[i].nextSibling&&!n[i].nextSibling.textContent.trim()&&(0,o.detach)(n[i].nextSibling))}return e},t.prototype.setImageProperties=function(e){"auto"!==this.parent.insertImageSettings.width&&e.setAttribute("width",this.parent.insertImageSettings.width),"0"!==this.parent.insertImageSettings.minWidth&&0!==this.parent.insertImageSettings.minWidth&&(e.style.minWidth=this.parent.insertImageSettings.minWidth.toString()),null!==this.parent.insertImageSettings.maxWidth&&(e.style.maxWidth=this.parent.getInsertImgMaxWidth().toString()),"auto"!==this.parent.insertImageSettings.height&&e.setAttribute("height",this.parent.insertImageSettings.height),"0"!==this.parent.insertImageSettings.minHeight&&0!==this.parent.insertImageSettings.minHeight&&(e.style.minHeight=this.parent.insertImageSettings.minHeight.toString()),null!==this.parent.insertImageSettings.maxHeight&&(e.style.maxHeight=this.parent.insertImageSettings.maxHeight.toString())},t.prototype.addTempClass=function(e){for(var t=e.children,n=0;n<t.length;n++)t[n].classList.add("pasteContent_RTE")},t.prototype.removeTempClass=function(){for(var e=this.parent.inputElement.querySelectorAll(".pasteContent_RTE"),t=0;t<e.length;t++)e[t].classList.remove("pasteContent_RTE"),""===e[t].getAttribute("class")&&e[t].removeAttribute("class")},t.prototype.sanitizeHelper=function(e){return e=Br(e,this.parent)},t.prototype.plainFormatting=function(e,t){var n=this,i=this.parent.createElement("div",{className:"pasteContent"});this.plainTextContent=this.plainTextContent.replace(/</g,"&lt;"),this.plainTextContent=this.plainTextContent.replace(/>/g,"&gt;");var r=this.sanitizeHelper(this.plainTextContent),s=this.splitBreakLine(r);i.innerHTML=s,""!==i.textContent.trim()?(this.saveSelection.restore(),this.parent.trigger(wt,{value:i.innerHTML,filesData:null},(function(t){e=t.value})),i.innerHTML=e,this.parent.formatter.editorManager.execCommand("inserthtml","pasteCleanup",t,(function(e){(0,o.extend)(t,{elements:e.elements,imageElements:e.imgElem},!0),n.parent.formatter.onSuccess(n.parent,t)}),i,null,null,this.parent.enterKey),this.removeTempClass()):(this.saveSelection.restore(),(0,o.extend)(t,{elements:[]},!0),this.parent.formatter.onSuccess(this.parent,t))},t.prototype.tagGrouping=function(e){for(var t=e.slice(),n=Object.keys(Ms),i=n.map((function(e){return Ms[""+e]})),o=[],r=0;r<t.length;r++)if(t[r].split("[").length>1&&(t[r]=t[r].split("[")[0].trim()),n.indexOf(t[r])>-1)for(var s=0;s<i[n.indexOf(t[r])].length;s++)t.indexOf(i[n.indexOf(t[r])][s])<0&&o.indexOf(i[n.indexOf(t[r])][s])<0&&o.push(i[n.indexOf(t[r])][s]);return e.concat(o)},t.prototype.attributesfilter=function(e){for(var t=0;t<e.length;t++)if(e[t].split("[").length>1){for(var n=e[t].split("[")[1].split("]")[0].split(","),i=[],o=[],r=0;r<n.length;r++)n[r].indexOf("!")<0?i.push(n[r].trim()):o.push(n[r].split("!")[1].trim());var s=i.length>1?i.join("]["):i.join(),a=o.length>1?o.join("]["):o.join();if(a.length>0){var l=""!==s?e[t].split("[")[0]+"["+s+"]":e[t].split("[")[0];e[t]=l+":not(["+a+"])"}else e[t]=e[t].split("[")[0]+"["+s+"]"}return e},t.prototype.deniedTags=function(e){var t=(0,o.isNullOrUndefined)(this.parent.pasteCleanupSettings.deniedTags)?[]:this.parent.pasteCleanupSettings.deniedTags.slice();t=this.attributesfilter(t),t=this.tagGrouping(t);for(var n=0;n<t.length;n++)for(var i=e.querySelectorAll(t[n]),r=i.length-1;r>=0;r--){for(var s=i[r].parentNode;i[r].firstChild;)s.insertBefore(i[r].firstChild,i[r]);s.removeChild(i[r])}return e},t.prototype.deniedAttributes=function(e,t){var n=(0,o.isNullOrUndefined)(this.parent.pasteCleanupSettings.deniedAttrs)?[]:this.parent.pasteCleanupSettings.deniedAttrs.slice();t&&n.push("style");for(var i=0;i<n.length;i++)for(var r=e.querySelectorAll("["+n[i]+"]"),s=0;s<r.length;s++)r[s].removeAttribute(n[i]);return e},t.prototype.allowedStyle=function(e){var t=(0,o.isNullOrUndefined)(this.parent.pasteCleanupSettings.allowedStyleProps)?[]:this.parent.pasteCleanupSettings.allowedStyleProps.slice();t.push("list-style-type","list-style");for(var n=e.querySelectorAll("[style]"),i=0;i<n.length;i++){for(var r,s=[],a=n[i].getAttribute("style").split(";"),l=0;l<a.length;l++)t.indexOf(a[l].split(":")[0].trim())>=0&&s.push(a[l]);n[i].removeAttribute("style"),(r=""===s.join(";").trim()?s.join(";"):s.join(";")+";")&&(n[i].style.cssText+=r)}return e},t.prototype.processPictureElement=function(e){for(var t=e.querySelectorAll("picture"),n=this.parent.contentModule.getDocument().baseURI,i=0;i<t.length;i++){var o=t[i].querySelector("img"),r=t[i].querySelectorAll("source");if(o&&o.getAttribute("src"))for(var s=o.getAttribute("src"),a=s.indexOf("http")>-1?new URL(s):new URL(s,n),l=0;l<r.length;l++){var d=r[l].getAttribute("srcset");if(d&&-1===d.indexOf("http")){var c=a.origin+d;r[l].setAttribute("srcset",c)}}}},t.prototype.getModuleName=function(){return"pasteCleanup"},t}(),ic=function(){function e(e){this.parent=e,this.addEventListener(),this.isDestroyed=!1,this.isResizing=!1,this.iframeMouseUpBoundFn=this.iframeMouseUp.bind(this)}return e.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on(u,this.renderResizable,this),this.parent.on(f,this.destroy,this))},e.prototype.renderResizable=function(){var e=this,t=this.parent.enableRtl?Eo:Zi;this.resizer=this.parent.createElement("div",{id:this.parent.getID()+"-resizable",className:"e-icons "+$i+" "+t}),this.parent.element.classList.add(mo),this.parent.rootContainer.appendChild(this.resizer),this.parent.rootContainer.classList.add("e-resize-enabled"),this.parent.iframeSettings.enable&&(this.parent.inputElement.classList.add("e-resize-enabled"),this.parent.contentModule.getDocument().addEventListener("mouseup",this.iframeMouseUpBoundFn)),this.iframeElement=this.parent.contentModule.getDocument().querySelectorAll("iframe"),(0,o.isNullOrUndefined)(this.iframeElement)||this.iframeElement.forEach((function(t){o.EventHandler.add(t,"load",e.onIFrameLoad,e)})),this.touchStartEvent="msie"===o.Browser.info.name?"pointerdown":"touchstart",o.EventHandler.add(this.resizer,"mousedown",this.resizeStart,this),o.EventHandler.add(this.resizer,this.touchStartEvent,this.resizeStart,this)},e.prototype.onIFrameLoad=function(e){var t=e.target;"IFRAME"===t.nodeName&&t.contentDocument&&o.EventHandler.add(t.contentDocument,"mouseup",this.stopResize,this)},e.prototype.removeMouseUpEventListener=function(e){e.contentDocument&&o.EventHandler.remove(e.contentDocument,"mouseup",this.stopResize)},e.prototype.resizeStart=function(e){var t=this;this.isResizing=!1,e.cancelable&&e.preventDefault(),this.wireResizeEvents(),this.parent.notify(Tt,{});var n={event:e,requestType:"editor"};this.parent.trigger(_,n,(function(e){e.cancel&&t.unwireResizeEvents()}))},e.prototype.performResize=function(e){var t=this;this.isResizing=!0;var n={event:e,requestType:"editor"};this.parent.trigger(V,n,(function(e){e.cancel&&t.unwireResizeEvents()}));var i=this.parent.element.getBoundingClientRect();if(this.isMouseEvent(e)){if(this.parent.element.style.height=e.clientY-i.top+"px",this.parent.element.style.width=this.parent.enableRtl?i.right-e.clientX+"px":e.clientX-i.left+"px",this.parent.toolbarModule){var r=this.parent.toolbarModule.getToolbarElement();if(!(0,o.isNullOrUndefined)(r)&&!(0,o.isNullOrUndefined)(r.parentElement)&&r.parentElement.classList.contains(gn)&&this.parent.toolbarSettings.enableFloating&&this.parent.getToolbar()&&!this.parent.inlineMode.enable){var s=this.parent.contentModule.getPanel().getBoundingClientRect().width;r.style.width=s+"px"}}}else{var a="msie"!==o.Browser.info.name?e.touches[0]:e;this.parent.element.style.height=a.clientY-i.top+"px",this.parent.element.style.width=this.parent.enableRtl?i.right-a.clientX+"px":a.clientX-i.left+"px"}var l=this.parent.element.querySelector("#"+this.parent.getID()+"_source-view");(0,o.isNullOrUndefined)(l)||(l.style.height=this.parent.element.style.height),this.parent.refreshUI()},e.prototype.stopResize=function(e){this.isResizing=!1,this.parent.refreshUI(),this.unwireResizeEvents();var t={event:e,requestType:"editor"};this.parent.trigger(W,t)},e.prototype.getEventType=function(e){return e.indexOf("mouse")>-1?"mouse":"touch"},e.prototype.isMouseEvent=function(e){var t=!1;return("mouse"===this.getEventType(e.type)||!(0,o.isNullOrUndefined)(e.pointerType)&&"mouse"===this.getEventType(e.pointerType))&&(t=!0),t},e.prototype.wireResizeEvents=function(){o.EventHandler.add(document,"mousemove",this.performResize,this),o.EventHandler.add(document,"mouseup",this.stopResize,this),this.touchMoveEvent="msie"===o.Browser.info.name?"pointermove":"touchmove",this.touchEndEvent="msie"===o.Browser.info.name?"pointerup":"touchend",o.EventHandler.add(document,this.touchMoveEvent,this.performResize,this),o.EventHandler.add(document,this.touchEndEvent,this.stopResize,this)},e.prototype.unwireResizeEvents=function(){o.EventHandler.remove(document,"mousemove",this.performResize),o.EventHandler.remove(document,"mouseup",this.stopResize),o.EventHandler.remove(document,this.touchMoveEvent,this.performResize),o.EventHandler.remove(document,this.touchEndEvent,this.stopResize)},e.prototype.destroy=function(){this.isDestroyed||(this.removeEventListener(),this.resizer&&((0,o.detach)(this.resizer),this.resizer=null),this.isDestroyed=!0)},e.prototype.removeEventListener=function(){var e=this;this.parent.off(u,this.renderResizable),this.parent.element.classList.remove(mo),this.parent&&this.parent.rootContainer&&this.parent.rootContainer.classList.contains("e-resize-enabled")&&this.parent.rootContainer.classList.remove("e-resize-enabled"),this.parent.iframeSettings.enable&&!(0,o.isNullOrUndefined)(this.parent.inputElement)&&(this.parent.inputElement.classList.remove("e-resize-enabled"),this.parent.contentModule.getDocument().removeEventListener("mouseup",this.iframeMouseUpBoundFn)),(0,o.isNullOrUndefined)(this.iframeElement)||this.iframeElement.forEach((function(t){e.removeMouseUpEventListener(t),o.EventHandler.remove(t,"load",e.onIFrameLoad)})),this.resizer&&(o.EventHandler.remove(this.resizer,"mousedown",this.resizeStart),o.EventHandler.remove(this.resizer,this.touchStartEvent,this.resizeStart),(0,o.detach)(this.resizer)),this.parent.off(f,this.destroy),this.iframeMouseUpBoundFn=null},e.prototype.iframeMouseUp=function(e){this.isResizing&&this.stopResize(e)},e.prototype.getModuleName=function(){return"resize"},e}(),oc=function(){function t(e,t){Bl.FileManager.Inject(Bl.ContextMenu,Bl.DetailsView,Bl.NavigationPane,Bl.Toolbar),this.parent=e,this.i10n=t.getService("rteLocale"),this.dialogRenderObj=t.getService("dialogRenderObject"),this.rendererFactory=t.getService("rendererFactory"),this.addEventListener(),this.isDestroyed=!1,this.insertImageBoundFn=this.insertImageUrl.bind(this),this.cancelDialogBoundFn=this.cancelDialog.bind(this),this.renderFileManagerBoundFn=this.renderFileManager.bind(this),this.dialogClosedBoundFn=this.dialogClosed.bind(this),this.onDocumentClickBoundFn=this.onDocumentClick.bind(this)}return t.prototype.initialize=function(){this.contentModule=this.rendererFactory.getRenderer(e.Content)},t.prototype.render=function(e){var t;t=e.selectNode&&"IMG"===e.selectNode[0].nodeName?this.parent.localeObj.getConstant("dialogUpdate"):this.i10n.getConstant("dialogInsert");var n=this.parent.localeObj.getConstant("fileDialogHeader"),i=this.i10n.getConstant("dialogCancel");this.dlgButtons=[{click:this.insertImageBoundFn,buttonModel:{content:t,cssClass:"e-flat e-insertImage",isPrimary:!0,disabled:!0}},{click:this.cancelDialogBoundFn,buttonModel:{cssClass:"e-flat e-cancel",content:i}}],this.selectObj={selection:e.selection,args:e.args,selectParent:e.selectParent};var r=this.parent.createElement("div",{className:"e-rte-file-manager-dialog",id:this.parent.getID()+"_file-manager-dialog",attrs:{"aria-owns":this.parent.getID()}});document.body.appendChild(r),this.fileWrap=this.parent.createElement("div",{id:this.parent.getID()+"_rte-file-manager",className:"e-img-file-wrap"}),r.appendChild(this.fileWrap),r.appendChild(this.getInputUrlElement());var s={visible:!1,isModal:!0,header:n,target:document.body,locale:this.parent.locale,enableRtl:this.parent.enableRtl,cssClass:bi,animationSettings:{effect:"None"},showCloseIcon:!0,closeOnEscape:!0,width:"720px",height:"auto",position:{X:"center",Y:"center"},buttons:this.dlgButtons,created:this.renderFileManagerBoundFn,close:this.dialogClosedBoundFn};this.dialogObj=this.dialogRenderObj.render(s),this.dialogObj.createElement=this.parent.createElement,this.dialogObj.appendTo(r),this.dialogObj.show(!!o.Browser.isDevice),this.setCssClass({cssClass:this.parent.getCssClass()})},t.prototype.setCssClass=function(e){this.dialogObj&&e.cssClass&&((0,o.isNullOrUndefined)(e.oldCssClass)?this.dialogObj.setProperties({cssClass:(this.dialogObj.cssClass+" "+e.cssClass).trim()}):this.dialogObj.setProperties({cssClass:(this.dialogObj.cssClass.replace(e.oldCssClass,"").trim()+" "+e.cssClass).trim()}))},t.prototype.dialogClosed=function(e){this.parent.isBlur=!1,e&&e.event.returnValue&&this.selectObj.selection.restore(),this.destroyComponents(),this.parent.element.ownerDocument.removeEventListener("mousedown",this.onDocumentClickBoundFn),this.dialogRenderObj.close(e)},t.prototype.renderFileManager=function(){var e=this;this.fileObj=new Bl.FileManager({allowMultiSelection:!1,locale:this.parent.locale,enableRtl:this.parent.enableRtl,path:this.parent.fileManagerSettings.path,view:this.parent.fileManagerSettings.view,enablePersistence:this.parent.enablePersistence,cssClass:this.parent.fileManagerSettings.cssClass,sortOrder:this.parent.fileManagerSettings.sortOrder,ajaxSettings:this.parent.fileManagerSettings.ajaxSettings,showThumbnail:this.parent.fileManagerSettings.showThumbnail,rootAliasName:this.parent.fileManagerSettings.rootAliasName,uploadSettings:this.parent.fileManagerSettings.uploadSettings,searchSettings:this.parent.fileManagerSettings.searchSettings,toolbarSettings:this.parent.fileManagerSettings.toolbarSettings,showHiddenItems:this.parent.fileManagerSettings.showHiddenItems,allowDragAndDrop:this.parent.fileManagerSettings.allowDragAndDrop,showFileExtension:this.parent.fileManagerSettings.showFileExtension,detailsViewSettings:this.parent.fileManagerSettings.detailsViewSettings,contextMenuSettings:this.parent.fileManagerSettings.contextMenuSettings,navigationPaneSettings:this.parent.fileManagerSettings.navigationPaneSettings,beforeSend:this.parent.fileManagerSettings.beforeSend,fileSelect:function(t){var n=t.fileDetails;n.isFile&&e.parent.insertImageSettings.allowedTypes.indexOf(n.type)>-1?(e.inputUrl.value=e.parent.fileManagerSettings.ajaxSettings.getImageUrl+"?path="+(n.filterPath&&n.filterPath.replace(/\\/g,"/"))+n.name,e.dlgButtons[0].buttonModel.disabled=!1):(e.inputUrl.value="",e.dlgButtons[0].buttonModel.disabled=!0),e.dialogObj.setProperties({buttons:e.dlgButtons})},created:function(){e.inputUrl.removeAttribute("disabled")},success:function(){e.fileObj.refreshLayout()}}),o.Browser.isDevice&&(this.fileObj.height="85%"),this.fileObj.appendTo(this.fileWrap),this.parent.element.ownerDocument.addEventListener("mousedown",this.onDocumentClickBoundFn)},t.prototype.getInputUrlElement=function(){var e=this.parent.createElement("div",{className:"imgUrl"}),t=this.parent.createElement("div",{className:"e-rte-label"});t.innerHTML='<label for="rteSample_img_url">'+this.i10n.getConstant("linkWebUrl")+"</label>",e.appendChild(t);var n=this.i10n.getConstant("imageUrl");return this.inputUrl=this.parent.createElement("input",{className:"e-input e-img-url",attrs:{placeholder:n,spellcheck:"false",disabled:"true"}}),e.appendChild(this.inputUrl),e},t.prototype.insertImageUrl=function(e){var t=this.inputUrl.value;if(0===this.parent.formatter.getUndoRedoStack().length&&this.parent.formatter.saveData(),""!==t){if("HTML"===this.parent.editorMode&&(0,o.isNullOrUndefined)((0,o.closest)(this.selectObj.selection.range.startContainer.parentNode,"#"+this.contentModule.getPanel().id))){this.contentModule.getEditPanel().focus();var n=this.parent.formatter.editorManager.nodeSelection.getRange(this.contentModule.getDocument());this.selectObj.selection=this.parent.formatter.editorManager.nodeSelection.save(n,this.contentModule.getDocument()),this.selectObj.selectParent=this.parent.formatter.editorManager.nodeSelection.getParentNodeCollection(n)}var i=/[\w-]+.(jpg|png|jpeg|gif)/g,r=(0,o.isNullOrUndefined)(t.match(i))||"HTML"!==this.parent.editorMode?"":t.match(i)[0],s={cssClass:"inline"===this.parent.insertImageSettings.display?li:$n,url:t,selection:this.selectObj.selection,altText:r,selectParent:this.selectObj.selectParent,width:{width:this.parent.insertImageSettings.width,minWidth:this.parent.insertImageSettings.minWidth,maxWidth:this.parent.getInsertImgMaxWidth()},height:{height:this.parent.insertImageSettings.height,minHeight:this.parent.insertImageSettings.minHeight,maxHeight:this.parent.insertImageSettings.maxHeight}};this.parent.formatter.process(this.parent,this.selectObj.args,this.selectObj.args.originalEvent,s),this.dialogObj.hide({returnValue:!1})}},t.prototype.cancelDialog=function(){this.parent.isBlur=!1,this.dialogObj.hide({returnValue:!0})},t.prototype.onDocumentClick=function(e){var t=e.target,n="#document"!==t.nodeName&&!(0,o.isNullOrUndefined)(t.previousElementSibling)&&t.previousElementSibling;(0,o.isNullOrUndefined)(this.dialogObj)||(0,o.closest)(t,"#"+this.parent.getID()+"_file-manager-dialog")||(0,o.closest)(t,"#"+this.parent.getID()+"_rte-file-manager_tb_sortby-popup")||(0,o.closest)(t,"#"+this.parent.getID()+"_rte-file-manager_tb_view-popup")||(0,o.closest)(t,"#"+this.parent.getID()+"_rte-file-manager_contextmenu")||!(0,o.isNullOrUndefined)((0,o.closest)(t,".e-contextmenu-wrapper"))&&(0,o.closest)(t,".e-contextmenu-wrapper").querySelector("#"+this.parent.getID()+"_rte-file-manager_contextmenu")||(0,o.isNullOrUndefined)(n)||n.classList.contains("e-rte-file-manager-dialog")||(0,o.isNullOrUndefined)(n)||n.id===this.parent.getID()+"_rte-file-manager_contextmenu"?this.parent.isRTE=!0:(this.dialogObj.hide({returnValue:!0}),this.parent.isBlur=!0,Tr(this.parent.element,"focusout"))},t.prototype.addEventListener=function(){this.parent.on(u,this.initialize,this),this.parent.on(Ot,this.render,this),this.parent.on(qt,this.setCssClass,this),this.parent.on(f,this.destroy,this)},t.prototype.removeEventListener=function(){this.parent.element.ownerDocument.removeEventListener("mousedown",this.onDocumentClickBoundFn),this.parent.off(u,this.initialize),this.parent.off(Ot,this.render),this.parent.off(qt,this.setCssClass),this.parent.off(f,this.destroy)},t.prototype.destroyComponents=function(){this.fileObj&&(this.fileObj.destroy(),this.fileObj=null),this.dialogObj&&(this.dialogObj.destroy(),(0,o.detach)(this.dialogObj.element))},t.prototype.destroy=function(){this.isDestroyed||(this.destroyComponents(),this.removeEventListener(),this.dlgButtons=null,this.isDestroyed=!0,this.insertImageBoundFn=null,this.cancelDialogBoundFn=null,this.renderFileManagerBoundFn=null,this.dialogClosedBoundFn=null,this.onDocumentClickBoundFn=null)},t.prototype.getModuleName=function(){return"fileManager"},t}(),rc=function(){function e(e){this.isSticky=!1,this.isActive=!1,this.parent=e,this.addEventListener(),this.isDestroyed=!1}return e.prototype.addEventListener=function(){this.parent.on(zt,this.toolbarClick,this),this.parent.on(_t,this.toolbarDoubleClick,this),this.parent.on(Ae,this.editAreaClick,this),this.parent.on(k,this.onKeyDown,this),this.parent.on(f,this.destroy,this)},e.prototype.toolbarClick=function(e){this.parent.focusIn(),this.isSticky?(e.args.action="escape",this.actionHandler(e,"keyBoard")):(this.isActive=!0,this.actionHandler(e,"click")),this.parent.quickToolbarModule&&!(0,o.isNullOrUndefined)(this.parent.quickToolbarSettings.text)&&this.parent.element.ownerDocument.contains(this.parent.quickToolbarModule.textQTBar.element)&&this.parent.quickToolbarModule.textQTBar.hidePopup()},e.prototype.toolbarDoubleClick=function(e){this.isActive=!0,this.isSticky=!0,this.parent.focusIn(),this.actionHandler(e,"dbClick")},e.prototype.onKeyDown=function(e){var t=e.args;((0,o.isNullOrUndefined)(t)||(0,o.isNullOrUndefined)(t.action)||"format-copy"!==t.action&&"format-paste"!==t.action)&&("escape"!==t.action||"format-copy"!==this.previousAction&&"format-paste"!==this.previousAction)||("format-copy"!==t.action&&"format-paste"!==t.action||t.stopPropagation(),"Firefox"!==this.parent.userAgentData.getBrowser()&&"Safari"!==this.parent.userAgentData.getBrowser()||t.preventDefault(),this.actionHandler(e,"keyBoard"))},e.prototype.actionHandler=function(e,t){var n,i,r,s=!1;switch(t){case"dbClick":case"click":r=e.args.item,i=e.args.originalEvent,n="format-copy";break;case"keyBoard":i=e.args,s=!0,"escape"===(n=e.args.action)&&(this.isSticky=!1,this.isActive=!1);break;case"docClick":i=e,n="format-paste"}(0,o.isNullOrUndefined)(r)&&(r={command:"FormatPainter",subCommand:"FormatPainter"});var a={requestType:"FormatPainter",originalEvent:i,name:n,item:r},l={formatPainterAction:n};if(this.parent.formatter.process(this.parent,a,i,l),!a.cancel){this.updateCursor(s);var d="docClick"!==t&&"escape"!==n;this.updateToolbarBtn(d)}this.previousAction=n},e.prototype.updateCursor=function(e){this.parent.inputElement.classList.contains("e-rte-cursor-brush")||e?this.isSticky||(0,o.removeClass)([this.parent.inputElement],"e-rte-cursor-brush"):(0,o.addClass)([this.parent.inputElement],"e-rte-cursor-brush")},e.prototype.updateToolbarBtn=function(e){if(!(0,o.isNullOrUndefined)(this.parent.element.querySelector(".e-rte-format-painter"))){var t=this.parent.element.querySelector(".e-rte-format-painter").parentElement.parentElement;e?(0,o.addClass)([t],"e-active"):this.isSticky||(0,o.removeClass)([t],"e-active")}},e.prototype.editAreaClick=function(e){this.isActive&&(this.isSticky||(this.isActive=!1),this.actionHandler(e,"docClick"),this.updateToolbarBtn(!1))},e.prototype.destroy=function(){this.isDestroyed||(this.parent.off(zt,this.toolbarClick),this.parent.off(Ae,this.editAreaClick),this.parent.off(_t,this.toolbarDoubleClick),this.parent.off(k,this.onKeyDown),this.parent.off(f,this.destroy),this.parent=null,this.isSticky=null,this.isActive=null,this.previousAction=null,this.isDestroyed=!0)},e.prototype.getModuleName=function(){return"formatPainter"},e}(),sc=function(){function e(e,t){this.noResultsFoundCount=0,this.parent=e,this.locator=t,this.i10n=t.getService("rteLocale"),this.renderFactory=this.locator.getService("rendererFactory"),this.addEventListener(),this.isDestroyed=!1,this.isPopupDestroyed=!1}return e.prototype.destroy=function(){this.isDestroyed||(this.removeEventListener(),this.isDestroyed=!0)},e.prototype.childDestroy=function(){if(!this.isPopupDestroyed){if(this.popupObj&&!this.popupObj.isDestroyed){if(this.popupObj.element&&this.popupObj.element.querySelector(".e-rte-emoji-search")){var e=(0,o.getComponent)(this.popupObj.element.querySelector(".e-rte-emoji-search"),"textbox");e&&!e.isDestroyed&&e.destroy()}if(this.popupObj.element&&this.popupObj.element.querySelector(".e-rte-emojipicker-toolbar")){var t=(0,o.getComponent)(this.popupObj.element.querySelector(".e-rte-emojipicker-toolbar"),"toolbar");t&&!t.isDestroyed&&t.destroy()}var n=this.popupObj.element.querySelector(".e-clear-icon");(0,o.isNullOrUndefined)(n)||o.EventHandler.remove(n,"mousedown",this.searchFilter),this.popupObj.destroy(),this.isPopupDestroyed=!0}if(this.popDiv&&(o.EventHandler.remove(this.popDiv,"keydown",this.onKeyDown),o.EventHandler.remove(this.popDiv,"keyup",this.searchFilter),this.popDiv.querySelector(".e-rte-emojipicker-btn"))){var i=this.popDiv.querySelector(".e-rte-emojipicker-btn");o.EventHandler.remove(i,"scroll",this.scrollEvent),o.EventHandler.remove(i,"click",this.emojiBtnClick)}}},e.prototype.addEventListener=function(){this.parent.on(Vt,this.toolbarClick,this),this.parent.on(We,this.docClick,this),this.parent.on(m,this.onIframeMouseDown,this),this.parent.on(k,this.onkeyPress,this),this.parent.on(L,this.onkeyUp,this),this.parent.on(Re,this.contentscroll,this),this.parent.on(Be,this.contentscroll,this),this.parent.on(f,this.destroy,this)},e.prototype.toolbarClick=function(e){var t,n,i,r=this;this.noResultsFoundCount=0,(0,o.isNullOrUndefined)(this.parent.element.querySelector(".e-emoji"))?this.parent.inlineMode.enable&&(i=this.parent.element.ownerDocument.querySelector(".e-emoji")):i=this.parent.element.querySelector(".e-emoji"),this.divElement=i.closest("div"),this.parent.inputElement.contains(this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument()).startContainer)||this.parent.contentModule.getEditPanel().focus();var s=this.parent.formatter.editorManager.nodeSelection.getRange(this.parent.contentModule.getDocument());this.save=this.parent.formatter.editorManager.nodeSelection.save(s,this.parent.contentModule.getDocument()),this.clickEvent=e.args;var a=this.parent.emojiPickerSettings.iconsSet;if(this.popupObj){if((0,o.removeClass)([this.divElement],"e-active"),this.popupObj.element.querySelector(".e-rte-emoji-search")||!this.parent.emojiPickerSettings.showSearchBox)return void this.popupObj.hide();this.popupObj.hide()}this.popDiv=this.parent.createElement("div",{className:"e-rte-emojipicker-popup",id:this.parent.getID()+"_emojiPicker"}),(0,o.isNullOrUndefined)(this.parent.getToolbar())||this.parent.inlineMode.enable?this.parent.inlineMode.enable&&this.parent.rootContainer.appendChild(this.popDiv):this.parent.getToolbar().parentElement.appendChild(this.popDiv),o.EventHandler.add(this.popDiv,"keydown",this.onKeyDown,this),o.EventHandler.add(this.popDiv,"keyup",this.searchFilter,this);var l,d,c,h,p=this.parent.element.querySelector(".e-toolbar-extended");(0,o.isNullOrUndefined)(p)?l="10001":l=window.getComputedStyle(p).getPropertyValue("z-index");if((0,o.isNullOrUndefined)(e.args)||this.parent.inlineMode.enable||!(0,o.isNullOrUndefined)(this.parent.quickToolbarSettings.text))if((0,o.isNullOrUndefined)(e.x)&&(0,o.isNullOrUndefined)(e.y)&&!this.parent.inlineMode.enable&&(0,o.isNullOrUndefined)(this.parent.quickToolbarSettings.text)){if(d=this.parent.inputElement,this.parent.contentModule.getDocument().getSelection().rangeCount>0)c=(u=this.getCoordinates()).left,h=u.top}else if((0,o.isNullOrUndefined)(e.x)&&(0,o.isNullOrUndefined)(e.y)&&(this.parent.inlineMode.enable||!(0,o.isNullOrUndefined)(this.parent.quickToolbarSettings.text))){var u;if(this.parent.notify(Qt,{}),this.parent.contentModule.getDocument().getSelection().rangeCount>0)c=(u=this.getCoordinates()).left,h=u.top}else d=this.parent.inputElement,c=e.x,h=e.y;else d=(d=e.args.originalEvent.target).classList.contains("e-toolbar-item")?d.firstChild:d.parentElement,c="left",h="bottom";if(this.popupObj=new Wr.Popup(this.popDiv,{targetType:"relative",relateTo:d,collision:{X:"fit",Y:"none"},offsetY:8,viewPortElement:this.parent.element,position:{X:c,Y:h},enableRtl:this.parent.enableRtl,zIndex:parseInt(l,10)+1,actionOnScroll:"hide",close:function(){r.parent.isBlur=!1,r.childDestroy(),r.popupObj.element.parentElement.style.zIndex="",(0,o.detach)(r.popupObj.element),r.popupObj=null,r.divElement.firstChild.focus()}}),this.isPopupDestroyed=!1,(0,o.addClass)([this.popupObj.element],"e-popup-open"),this.popupObj.element.parentElement.style.zIndex="11",this.popupObj.refreshPosition(d),(!(0,o.isNullOrUndefined)(e.args)||(0,o.isNullOrUndefined)(e.x)&&(0,o.isNullOrUndefined)(e.y))&&this.parent.emojiPickerSettings.showSearchBox){var m=(0,o.createElement)("input",{id:"e-rte-emoji-search",className:"e-rte-emoji-search"});this.popDiv.append(m),new Qr.TextBox({placeholder:this.i10n.getConstant("emojiPickerTypeToFind"),showClearButton:!0}).appendTo(m),this.parent.userAgentData.isSafari()&&this.parent.inputElement.contains(this.parent.getRange().startContainer)&&this.parent.notify(Te,{}),m.focus()}var f=this.popupObj.element.querySelector(".e-clear-icon");(0,o.isNullOrUndefined)(f)||o.EventHandler.add(f,"mousedown",this.searchFilter,this);var g=this.parent.createElement("div",{className:"e-rte-emojipicker-toolbar"});this.popDiv.appendChild(g);for(var b=[],v=0;v<this.parent.emojiPickerSettings.iconsSet.length;v++)(0,o.isNullOrUndefined)(this.parent.emojiPickerSettings.iconsSet[v].iconCss)?b.push({text:"&#x"+this.parent.emojiPickerSettings.iconsSet[v].code+";",htmlAttributes:(n={},n.title=this.parent.emojiPickerSettings.iconsSet[v].name,n)}):b.push({prefixIcon:this.parent.emojiPickerSettings.iconsSet[v].iconCss,htmlAttributes:(t={},t.title=this.parent.emojiPickerSettings.iconsSet[v].name,t)});new _r.Toolbar({items:b,clicked:this.emojiToolbarClick.bind(this)}).appendTo(g);var y,C=this.parent.createElement("div",{className:"e-rte-emojipicker-btn"});this.popDiv.appendChild(C);var N=window.getComputedStyle(this.popDiv);if((!(0,o.isNullOrUndefined)(e.args)||(0,o.isNullOrUndefined)(e.x)&&(0,o.isNullOrUndefined)(e.y))&&this.parent.emojiPickerSettings.showSearchBox){var E=this.parent.element.querySelector(".e-rte-emoji-search").parentElement,S=window.getComputedStyle(E);y=this.popDiv.getBoundingClientRect().height-g.getBoundingClientRect().height-E.getBoundingClientRect().height-parseFloat(S.marginTop)-parseFloat(S.marginBottom)-2*parseFloat(N.borderWidth)+"px",C.style.setProperty("height",y,"important")}else y=this.popDiv.getBoundingClientRect().height-g.getBoundingClientRect().height-2*parseFloat(N.borderWidth)+"px",C.style.setProperty("height",y,"important");for(v=0;v<a.length;v++){var T=this.parent.createElement("div",{className:"e-rte-emojipicker-group"});C.appendChild(T);var O=this.parent.createElement("div",{className:"e-rte-emojipicker-name"});O.innerText=this.parent.emojiPickerSettings.iconsSet[v].name,O.setAttribute("aria-label",this.parent.emojiPickerSettings.iconsSet[v].name),T.appendChild(O);var L=this.parent.createElement("div",{className:"e-rte-emojipickerbtn-group"});T.appendChild(L);for(var k=0;k<a[v].icons.length;k++){var x=this.parent.createElement("button",{className:"e-btn  e-control"});x.innerHTML=this.buttoncode(this.parent.emojiPickerSettings.iconsSet[v].icons[k].code),x.setAttribute("aria-label",this.parent.emojiPickerSettings.iconsSet[v].icons[k].desc),x.setAttribute("title",this.parent.emojiPickerSettings.iconsSet[v].icons[k].desc),L.appendChild(x),x.innerHTML.length>2&&(x.style.fontSize="17px")}}o.EventHandler.add(C,"scroll",this.scrollEvent,this),o.EventHandler.add(C,"click",this.emojiBtnClick,this);var w=this.parent.element.querySelectorAll(".e-rte-emojipicker-btn button");(0,o.isNullOrUndefined)(this.parent.element.querySelector(".e-rte-emoji-search"))&&!(0,o.isNullOrUndefined)(e.args)&&(w[0].focus(),(0,o.addClass)([w[0]],"e-focus"));var D,M=this.parent.element.querySelector(".e-rte-emojipicker-btn"),A=this.parent.element.querySelectorAll(".e-rte-emojipicker-toolbar button");(0,o.isNullOrUndefined)(M)||(D=Math.round(M.scrollTop)),D<A[0].offsetHeight&&(0,o.addClass)([A[0]],"e-selected"),this.popupObj&&(0,o.addClass)([this.divElement],"e-active")},e.prototype.onIframeMouseDown=function(e){this.popupObj&&((0,o.removeClass)([this.divElement],"e-active"),this.popupObj.hide())},e.prototype.buttoncode=function(e){return e.split("-").map((function(e){return String.fromCodePoint(parseInt(e,16))})).join("‍")},e.prototype.docClick=function(e){var t=e.args.target;t&&t.classList&&this.popupObj&&!(0,o.closest)(t,"[id='"+this.popupObj.element.id+"']")&&!t.classList.contains("e-emoji")&&!t.classList.contains("e-toolbar-item")&&this.popupObj&&((0,o.removeClass)([this.divElement],"e-active"),this.popupObj.hide())},e.prototype.scrollEvent=function(){var e,t=this.parent.element.querySelector(".e-rte-emojipicker-btn"),n=this.parent.element.querySelectorAll(".e-rte-emojipicker-group"),i=this.parent.element.querySelectorAll(".e-rte-emojipicker-toolbar button");(0,o.isNullOrUndefined)(t)||(e=Math.round(t.scrollTop));for(var r=0,s=0;s<i.length;s++)e<i[0].offsetHeight&&((0,o.isNullOrUndefined)(i[s+1])||(0,o.removeClass)([i[s+1]],"e-selected"),(0,o.addClass)([i[0]],"e-selected"));for(var a=0;a<n.length;a++)if(e>=(r+=Math.round(n[a].offsetHeight))){for(var l=0;l<i.length;l++)i[l].classList.contains("e-selected")&&(0,o.removeClass)([i[l]],"e-selected");(0,o.isNullOrUndefined)(i[a+1])||(0,o.addClass)([i[a+1]],"e-selected")}},e.prototype.contentscroll=function(){if((0,o.isNullOrUndefined)(this.clickEvent)&&this.popupObj)return(0,o.removeClass)([this.divElement],"e-active"),void this.popupObj.hide()},e.prototype.emojiToolbarClick=function(e){for(var t={text:e.item.htmlAttributes.title}.text,n=this.parent.element.querySelectorAll(".e-rte-emojipicker-group"),i=this.parent.element.querySelectorAll(".e-rte-emojipicker-btn button"),r=this.parent.element.querySelectorAll(".e-rte-emojipicker-toolbar button"),s=0;s<r.length;s++)r[s].classList.contains("e-selected")&&(0,o.removeClass)([r[s]],"e-selected");for(s=0;s<i.length;s++)i[s].classList.contains("e-focus")&&(0,o.removeClass)([i[s]],"e-focus");var a=this.parent.element.querySelector(".e-rte-emojipicker-btn"),l=0;n.forEach((function(e){var n=e.childNodes[0],i=e.childNodes[1].childNodes[0],r=n.getAttribute("aria-label");t===r?n&&(a.scrollTop=l+10,(0,o.addClass)([i],"e-focus"),i.focus()):(l+=e.scrollHeight,(0,o.removeClass)([i],"e-focus"))}))},e.prototype.onKeyDown=function(e){var t=this.parent.element.querySelectorAll(".e-rte-emojipicker-btn button"),n=this.parent.element.querySelectorAll(".e-rte-emojipickerbtn-group"),i=this.parent.element.querySelector(".e-rte-emojisearch-btn button");(27===e.keyCode&&this.popupObj&&((0,o.removeClass)([this.divElement],"e-active"),this.popupObj.hide()),13===e.keyCode)&&(document.activeElement.classList.contains("e-btn")&&(this.emojiBtnClick(e),e.preventDefault()));var r=e.srcElement;if(!(0,o.isNullOrUndefined)(r)&&r.classList.contains("e-rte-emoji-search")&&40===e.keyCode)for(var s=0;s<t.length;s++)t[s].classList.contains("e-focus")&&(0,o.removeClass)([t[s]],"e-focus");if((0,o.isNullOrUndefined)(i))for(s=0;s<t.length;s++){var a=s;if(t[s].classList.contains("e-focus"))if(40===e.keyCode){if(t.length-4>s){for(var l=0,d=0;d<n.length;d++)for(var c=0;c<n[d].childNodes.length;c++){if(n[d].childNodes[c].classList.contains("e-focus")&&1!==l){var h=c,p=n[d].lastChild,u=Math.floor(c%6),m=n[d].childNodes.length-1,f=Math.floor(m%6);if(-1!==h){var g=h+6;if((0,o.isNullOrUndefined)(n[d].childNodes[g])){if((0,o.isNullOrUndefined)(n[d].childNodes[g])&&!p.classList.contains("e-focus")&&f<u){b=t[s];(0,o.removeClass)([b],"e-focus");v=n[d].lastChild;(0,o.addClass)([v],"e-focus"),v.focus(),l=1;break}b=t[s];(0,o.removeClass)([b],"e-focus");v=n[d+1].childNodes[u];(0,o.addClass)([v],"e-focus"),v.focus(),l=1;break}var b=t[s];(0,o.removeClass)([b],"e-focus");var v=t[a+=6];(0,o.addClass)([v],"e-focus"),v.focus();break}}}break}}else{if(38===e.keyCode){if(s>=6)for(l=0,d=0;d<n.length;d++)for(c=0;c<n[d].childNodes.length;c++){if(n[d].childNodes[c].classList.contains("e-focus")&&1!==l){h=c;var y=(0,o.isNullOrUndefined)(n[d-1])?null:n[d-1].childNodes.length%6||6;if(-1!==h){var C=h-6;if((0,o.isNullOrUndefined)(n[d].childNodes[C])){if((0,o.isNullOrUndefined)(n[d-1].childNodes[n[d-1].childNodes.length-(y-c)])){b=t[s];(0,o.removeClass)([b],"e-focus");v=n[d-1].lastChild;(0,o.addClass)([v],"e-focus"),v.focus(),l=1;break}b=t[s];(0,o.removeClass)([b],"e-focus");v=n[d-1].childNodes[n[d-1].childNodes.length-(y-c)];(0,o.addClass)([v],"e-focus"),v.focus(),l=1;break}var b=t[s];(0,o.removeClass)([b],"e-focus");var v=t[a-=6];(0,o.addClass)([v],"e-focus"),v.focus();break}}}else{b=t[s];(0,o.removeClass)([b],"e-focus");v=t[a-=1];var N=this.popupObj.element.querySelector(".e-rte-emoji-search");if((0,o.isNullOrUndefined)(v)&&!(0,o.isNullOrUndefined)(N)){N.focus();break}(0,o.addClass)([v],"e-focus"),v.focus()}break}if(39===e.keyCode){if(t.length!==s+1){b=t[s];(0,o.removeClass)([b],"e-focus");v=t[a+=1];(0,o.addClass)([v],"e-focus"),t[a].focus()}break}if(37===e.keyCode){if(s>0){b=t[s];(0,o.removeClass)([b],"e-focus");v=t[a-=1];(0,o.addClass)([v],"e-focus"),t[a].focus()}break}}}else this.filterKeyHandler(e);if(40===e.keyCode){b=this.parent.element.querySelector(".e-focus");if((0,o.isNullOrUndefined)(b)){v=t[0];(0,o.addClass)([v],"e-focus"),this.parent.userAgentData.isSafari()&&this.parent.inputElement.contains(this.parent.getRange().startContainer)&&this.parent.notify(Te,{}),t[0].focus()}}},e.prototype.filterKeyHandler=function(e){var t=this.parent.element.querySelectorAll(".e-rte-emojisearch-btn button"),n=this.parent.element.querySelector(".e-focus");if((0,o.isNullOrUndefined)(n)&&40===e.keyCode){var i=t[0];(0,o.addClass)([i],"e-focus"),this.parent.userAgentData.isSafari()&&this.parent.notify(Te,{}),t[0].focus()}else for(var r=0;r<t.length;r++){var s=r;if(t[r].classList.contains("e-focus"))if(38===e.keyCode){if(r>=6){var a=t[r];(0,o.removeClass)([a],"e-focus");i=t[s-=6];(0,o.addClass)([i],"e-focus"),i.focus();break}var l=t[r];(0,o.removeClass)([l],"e-focus");i=t[s-=1];var d=this.popupObj.element.querySelector(".e-rte-emoji-search");if((0,o.isNullOrUndefined)(i)&&!(0,o.isNullOrUndefined)(d)){d.focus();break}(0,o.addClass)([i],"e-focus"),i.focus()}else if(40===e.keyCode){if(t.length-6>r){var c=t[r];(0,o.removeClass)([c],"e-focus");i=t[s+=6];(0,o.addClass)([i],"e-focus"),i.focus();break}}else{if(39===e.keyCode){if(t.length!==r+1){var h=t[r];(0,o.removeClass)([h],"e-focus");i=t[s+=1];(0,o.addClass)([i],"e-focus"),t[s].focus()}break}if(37===e.keyCode&&r>0){var p=t[r];(0,o.removeClass)([p],"e-focus");i=t[s-=1];(0,o.addClass)([i],"e-focus"),t[s].focus();break}}}},e.prototype.searchFilter=function(e,t,n){void 0===n&&(n=!1);var i=this.parent.element.querySelector(".e-rte-emoji-search"),r=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel():this.parent.element.querySelector(".e-content");if(document.activeElement===i||document.activeElement===r){var s=void 0;":"===t||(0,o.isNullOrUndefined)(t)?(0,o.isNullOrUndefined)(t)||(s=t):s=t.replace(/^:/,"");var a=(0,o.isNullOrUndefined)(i)?s:i.value,l=this.parent.element.querySelectorAll(".e-rte-emojipicker-btn button"),d=this.parent.element.querySelector(".e-rte-emojipicker-btn"),c=this.parent.element.querySelectorAll(".e-rte-emojipicker-group"),h=this.parent.element.querySelector(".e-rte-emojipicker-toolbar"),p=this.parent.element.querySelector(".e-rte-emojisearch-btn"),u=this.popDiv.childNodes[0],m=window.getComputedStyle(u),f="SPAN"===u.nodeName?u.getBoundingClientRect().height+parseFloat(m.marginTop)+parseFloat(m.marginBottom):0,g=window.getComputedStyle(this.popDiv),b=(0,o.isNullOrUndefined)(p)?l:Array.from(l).filter((function(e){return!p.contains(e)}));if(!((0,o.isNullOrUndefined)(h)||(0,o.isNullOrUndefined)(d)||(0,o.isNullOrUndefined)(a))){""===a||":"===t?(h.style.display="",d.style.height=this.popDiv.getBoundingClientRect().height-h.getBoundingClientRect().height-f-2*parseFloat(g.borderWidth)+"px",c.forEach((function(e){e.style.display=""}))):(c.forEach((function(e){e.style.display="none"})),h.style.display="none",d.style.height=this.popDiv.getBoundingClientRect().height-f-2*parseFloat(g.borderWidth)+"px");var v=this.parent.createElement("div",{className:"e-rte-emojisearch-btn"}),y=this.parent.element.querySelector(".e-rte-emojisearch-btn");y&&y.remove();for(var C=!0,N=0;N<b.length;N++)if(!(0,o.isNullOrUndefined)(b[N].getAttribute("title")))for(var E=b[N].getAttribute("title").toLowerCase().split(" "),S=0;S<E.length;S++)if(E[S].startsWith(a.toLowerCase())&&""!==a){var T=b[N].cloneNode(!0);v.appendChild(T),C=!1;break}var O=this.parent.createElement("div",{className:"e-rte-emojiSearch-noEmoji"});return C&&!this.parent.element.querySelector(".e-rte-emojiSearch-noEmoji")&&""!==a&&":"!==t&&": :"!==t?(0,o.isNullOrUndefined)(O)||(O.innerHTML='<span style="color: rgba(0, 0, 0, 0.75); font-weight: 500; font-size: 16px;">'+this.i10n.getConstant("emojiPickerNoResultFound")+' 😥 </span><br><span style="color: rgba(0, 0, 0, 0.75);"> '+this.i10n.getConstant("emojiPickerTrySomethingElse")+" ? </span>",O.style.margin="55px",d.appendChild(O)):(!C&&this.parent.element.querySelector(".e-rte-emojiSearch-noEmoji")||""===a&&":"===t||""===a&&this.parent.element.querySelector(".e-rte-emojiSearch-noEmoji"))&&d.removeChild(this.parent.element.querySelector(".e-rte-emojiSearch-noEmoji")),d.appendChild(v),n&&(C&&":"!==t?this.noResultsFoundCount+=1:this.noResultsFoundCount=0,this.noResultsFoundCount>=9&&!(0,o.isNullOrUndefined)(this.popupObj))?((0,o.removeClass)([this.divElement],"e-active"),this.popupObj.hide(),void(this.noResultsFoundCount=0)):void 0}}},e.prototype.emojiBtnClick=function(e){for(var t=new MouseEvent("mouseleave",{bubbles:!0,cancelable:!0}),n=this.parent.element.querySelectorAll(".e-rte-emojipicker-popup [data-tooltip-id]"),i=0;i<n.length;i++)n[i].dispatchEvent(t);var r=e.target;if("BUTTON"===r.tagName){r.focus();var s=this.save.startOffset,a=this.save.range.startContainer.textContent.substring(s,s+1);(0,o.isNullOrUndefined)(this.clickEvent)&&":"===a||this.save.restore(),this.popupObj&&((0,o.removeClass)([this.divElement],"e-active"),this.popupObj.hide()),this.parent.userAgentData.isSafari()&&"keydown"===e.type&&this.parent.notify(Oe,{});var l=e;this.parent.formatter.process(this.parent,{item:{command:"EmojiPicker",subCommand:"EmojiPicker",value:r.innerHTML},originalEvent:l},e,l)}},e.prototype.onkeyPress=function(e){var t=e.args,n=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().contentWindow.getSelection():this.parent.contentModule.getDocument().getSelection();if(!(n.rangeCount<=0)){var i=n.getRangeAt(0).startOffset,r=n.focusNode.textContent.substring(i-1,i),s=/\s/.test(r),a=":"===n.focusNode.textContent.substring(i-1,i),l=":"===n.focusNode.textContent.charAt(i-1);if(186===t.keyCode&&t.shiftKey&&(s||0===n.focusOffset)){var d=this.getCoordinates();this.parent.showEmojiPicker(d.left,d.top)}if(8===t.keyCode&&l&&this.popupObj&&((0,o.removeClass)([this.divElement],"e-active"),this.popupObj.hide()),32===t.keyCode&&a&&this.popupObj){(0,o.removeClass)([this.divElement],"e-active");var c=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().ownerDocument:this.parent.contentModule.getDocument();this.parent.showTooltip&&!(0,o.isNullOrUndefined)(c.querySelector(".e-tooltip-wrap"))&&this.parent.notify(Wt,{args:event}),this.popupObj.hide()}!this.popupObj||37!==t.keyCode&&38!==t.keyCode&&39!==t.keyCode&&27!==t.keyCode&&40!==t.keyCode||(this.onKeyDown(t),t.preventDefault())}},e.prototype.onkeyUp=function(e){var t=e.args,n=this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().contentWindow.getSelection():this.parent.contentModule.getDocument().getSelection();if(!(n.rangeCount<=0)){for(var i,r=n.getRangeAt(0),s=r.startOffset,a=0,l=s-1;l>=s-n.focusNode.textContent.length;l--){var d=n.focusNode.textContent.substring(l-1,l);/:$/.test(d)&&!(0,o.isNullOrUndefined)(this.popDiv)&&0===a&&(i=r.startContainer.textContent.substring(l-1,s),this.searchFilter(t,i,!0),a=1)}var c=n.focusNode.textContent.substring(s-1,s);":"!==c||(0,o.isNullOrUndefined)(this.popupObj)||(i=c,this.searchFilter(t,i,!0))}},e.prototype.getCoordinates=function(){var e,t,n=(this.parent.iframeSettings.enable?this.parent.contentModule.getPanel().contentWindow.getSelection():window.getSelection()).getRangeAt(0);"P"!==n.startContainer.nodeName&&"DIV"!==n.startContainer.nodeName||"#text"!==n.startContainer.childNodes[0].nodeName&&(t=n.startContainer.childNodes[0]);var i=(0,o.isNullOrUndefined)(t)?n.getBoundingClientRect():t.getBoundingClientRect(),r=this.parent.element.querySelector(".e-rte-content"),s=this.parent.element,a=s.offsetHeight-r.offsetHeight,l=i.top-this.parent.inputElement.getBoundingClientRect().top,d=i.left-this.parent.inputElement.getBoundingClientRect().left,c=window.innerHeight,h=l,p=d+i.width;return s.getBoundingClientRect().top<0&&!this.parent.inlineMode.enable&&(h=h+r.getBoundingClientRect().top-a),i.top<330||i.top+330>c&&(h-=350),this.parent.inputElement&&(e={top:h+60,left:p+8}),e},e.prototype.removeEventListener=function(){this.parent.off(Vt,this.toolbarClick),this.parent.off(We,this.docClick),this.parent.off(m,this.onIframeMouseDown),this.parent.off(k,this.onkeyPress),this.parent.off(L,this.onkeyUp),this.parent.off(Re,this.contentscroll),this.parent.off(Be,this.contentscroll),this.parent.off(f,this.destroy)},e.prototype.getModuleName=function(){return"emojiPicker"},e}(),ac=function(){function e(e){this.parent=e,this.addEventListener()}return e.prototype.addEventListener=function(){this.parent.on(x,this.onImport,this),this.parent.on(w,this.onExport,this),this.parent.on(f,this.destroy,this)},e.prototype.onImport=function(){var e=this;this.parent.trigger($,{cancel:!1,requestType:"Import"},(function(t){if(!t.cancel){e.uploaderObj=new Qr.Uploader({allowedExtensions:".doc,.docx,.rtf,.dot,.dotx,.docm,.dotm",asyncSettings:{saveUrl:e.parent.importWord.serviceUrl},success:function(t){e.parent.executeCommand("importWord",t.e.currentTarget.response,{undo:!0}),e.parent.trigger(Z,{requestType:"Import"})}}),e.parent.setProperties({enableXhtml:!0},!0);var n=e.parent.createElement("div",{className:"e-import-uploadwrap e-droparea"+e.parent.getCssClass(!0)}),i=e.parent.createElement("input",{id:e.rteID+"_upload",attrs:{type:"File",name:"UploadFiles"},className:e.parent.getCssClass()});n.appendChild(i),e.uploaderObj.appendTo(i),e.uploaderObj.element.click(),e.uploaderObj.element.closest(".e-upload").style.display="none"}}))},e.prototype.onExport=function(e){var t,n,i=this;this.parent.setProperties({enableXhtml:!0},!0);var o,r=this.parent.getHtml();"ExportWord"===e.member?(t=this.parent.exportWord.fileName,n=this.parent.exportWord.serviceUrl,o="<html><head><style>"+this.parent.exportWord.stylesheet+"</style></head><body>"+r+"</body></html>"):"ExportPdf"===e.member&&(t=this.parent.exportPdf.fileName,n=this.parent.exportPdf.serviceUrl,o="<html><head><style>"+this.parent.exportPdf.stylesheet+"</style></head><body>"+r+"</body></html>");var s={requestType:e.member,exportValue:o,cancel:!1};this.parent.trigger($,s,(function(o){o.cancel||fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:o.exportValue})}).then((function(e){if(!e.ok)throw new Error("HTTP error! Status: "+e.status);return e.blob().then((function(e){return{blob:e,filename:t}}))})).then((function(t){var n=t.blob,o=t.filename,r=window.URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=o,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(r),i.parent.trigger(Z,{requestType:e.member})})).catch((function(e){console.error("Fetch error:",e)}))}))},e.prototype.destroy=function(){this.parent.isDestroyed||(this.parent.off(x,this.onImport),this.parent.off(w,this.onExport),this.parent.off(f,this.destroy),this.uploaderObj&&!this.uploaderObj.isDestroyed&&(this.uploaderObj.destroy(),this.uploaderObj=null))},e.prototype.getModuleName=function(){return"importExport"},e}()})(),h})()));